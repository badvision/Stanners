{"5599fcc2c02a8c6fc68f40e70d15832d243a2b3c":{"changes":{"core\/src\/main\/java\/hudson\/scm\/SubversionSCM.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/scm\/SubversionSCM.java":[{"add":["1045","            public abstract SVNAuthentication createSVNAuthentication(String kind) throws SVNException;","1061","            public SVNAuthentication createSVNAuthentication(String kind) {","1121","            public SVNSSHAuthentication createSVNAuthentication(String kind) throws SVNException {","1158","            public SVNAuthentication createSVNAuthentication(String kind) {"],"delete":["1045","            abstract SVNAuthentication createSVNAuthentication(String kind) throws SVNException;","1061","            SVNAuthentication createSVNAuthentication(String kind) {","1121","            SVNSSHAuthentication createSVNAuthentication(String kind) throws SVNException {","1158","            SVNAuthentication createSVNAuthentication(String kind) {"]}]}},"ea3452ce2cd9287c427b671e94e60d44953f38f4":{"changes":{"core\/src\/main\/java\/hudson\/tools\/ToolLocationNodeProperty.java":"MODIFY","changelog.html":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/tools\/ToolLocationNodeProperty.java":[{"add":["3"," * Copyright (c) 2004-2011, Sun Microsystems, Inc., Tom Huybrechts, Seiji Sogabe","35","import java.util.ArrayList;","48","","56","        if (locations == null) {","57","            locations = new ArrayList<ToolLocation>();","58","        }","96","        if (property != null) {","97","            result = property.getHome(installation);","98","        }","99","        if (result != null) {","100","            return result;","101","        }","104","        for (ToolLocationTranslator t : ToolLocationTranslator.all()) {","106","            if (result != null) {","107","                return result;","108","            }","122","        public DescriptorExtensionList<ToolInstallation, ToolDescriptor<?>> getToolDescriptors() {","137","","139","","141","","143","","152","","155","            this.type = key.substring(0, key.indexOf('@'));","169","            if (descriptor == null) {","170","                descriptor = (ToolDescriptor) Descriptor.find(type);","171","            }"],"delete":["3"," * Copyright (c) 2004-2009, Sun Microsystems, Inc., Tom Huybrechts","23","","55","        if(locations==null) throw new IllegalArgumentException();","93","        if (property != null)   result = property.getHome(installation);","94","        if (result != null)     return result;","97","        for( ToolLocationTranslator t : ToolLocationTranslator.all() ) {","99","            if(result!=null)    return result;","113","        public DescriptorExtensionList<ToolInstallation,ToolDescriptor<?>> getToolDescriptors() {","139","        ","142","            this.type =  key.substring(0, key.indexOf('@'));","156","            if (descriptor == null) descriptor = (ToolDescriptor) Descriptor.find(type); ","163","","165","    ","166",""]}],"changelog.html":[{"add":["99","  <li class=bug>","100","    Failed to instantiate class hudson.slaves.DumbSlave.","101","    <a href=\"http:\/\/issues.jenkins-ci.org\/browse\/JENKINS-7174\">issue 7174<\/a>)"],"delete":[]}]}},"abf9fd36582ce6277dec929e89f078678e587209":{"changes":{"core\/src\/main\/java\/jenkins\/model\/Jenkins.java":"MODIFY","core\/src\/main\/java\/hudson\/util\/PluginServletFilter.java":"MODIFY"},"diff":{"core\/src\/main\/java\/jenkins\/model\/Jenkins.java":[{"add":["180","import hudson.util.PluginServletFilter;","2904","        PluginServletFilter.cleanUp();","2905",""],"delete":[]}],"core\/src\/main\/java\/hudson\/util\/PluginServletFilter.java":[{"add":["44","import org.kohsuke.accmod.Restricted;","45","import org.kohsuke.accmod.restrictions.NoExternalUse;","146","    @Restricted(NoExternalUse.class)","147","    public static void cleanUp() {","148","        PluginServletFilter instance = getInstance(Jenkins.getInstance().servletContext);","149","        if (instance != null) {","150","            for (Iterator<Filter> iterator = instance.list.iterator(); iterator.hasNext(); ) {","151","                Filter f = iterator.next();","152","                try {","153","                    f.destroy();","154","                } catch (RuntimeException e) {","155","                    LOGGER.log(Level.WARNING, \"Filter \" + f + \" propagated an exception from its destroy method\", e);","156","                } catch (Error e) {","157","                    throw e; \/\/ we are not supposed to catch errors, don't log as could be an OOM","158","                } catch (Throwable e) {","159","                    LOGGER.log(Level.SEVERE, \"Filter \" + f + \" propagated an exception from its destroy method\", e);","160","                }","161","                iterator.remove();","162","            }","163","        }","164","    }","165",""],"delete":[]}]}},"d5017813ecd411a30de12008778955ec3bf051d2":{"changes":{"core\/src\/test\/java\/hudson\/UtilTest.java":"MODIFY"},"diff":{"core\/src\/test\/java\/hudson\/UtilTest.java":[{"add":["33","import static org.junit.Assert.*;","35","import org.junit.Test;","43","public class UtilTest {","44","    @Test","74","    @Test","118","    @Test","128","    @Test","138","    @Test","156","    @Test","164","    @Test","166","        Assume.assumeTrue(!Functions.isWindows());","203","    @Test","233","    @Test","234","    public void testHtmlEscape() {","237","        assertEquals(\"&#039;&quot;\", Util.escape(\"'\\\"\"));","246","    @Test"],"delete":["26","import junit.framework.TestCase;","27","","43","public class UtilTest extends TestCase {","73","","160","        if (Functions.isWindows())     return;","226","    public void TestEscape() {","229","        assertEquals(\"&quot;&#039;\", Util.escape(\"'\\\"\"));"]}]}},"83c040c481a4d660667e6a1bc49cc3305b24f13a":{"changes":{"core\/src\/main\/resources\/hudson\/util\/Messages.properties":"MODIFY","core\/src\/main\/java\/hudson\/tasks\/Ant.java":"MODIFY","core\/src\/main\/java\/hudson\/util\/FormValidation.java":"MODIFY","core\/src\/main\/resources\/hudson\/util\/Messages_ja.properties":"MODIFY","core\/src\/test\/java\/hudson\/util\/FormValidationTest.java":"ADD","core\/src\/main\/java\/hudson\/model\/JDK.java":"MODIFY","core\/src\/main\/java\/hudson\/tasks\/Maven.java":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/util\/Messages.properties":[{"add":["2","# Copyright (c) 2004-2010, Sun Microsystems, Inc., Kohsuke Kawaguchi, Seiji Sogabe","25","ClockDifference.Failed=Failed to check","26","FormValidation.ValidateRequired=Required"],"delete":["2","# Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi, Seiji Sogabe","25","ClockDifference.Failed=Failed to check"]}],"core\/src\/main\/java\/hudson\/tasks\/Ant.java":[{"add":["32","import hudson.model.AbstractBuild;","33","import hudson.model.AbstractProject;","34","import hudson.model.BuildListener;","35","import hudson.model.Computer;","36","import hudson.model.EnvironmentSpecific;","37","import hudson.model.Hudson;","38","import hudson.model.Node;","39","import hudson.model.TaskListener;","255","    @Extension","426","","427","            public FormValidation doCheckName(@QueryParameter String value) {","428","                return FormValidation.validateRequired(value);","429","            }"],"delete":["32","import hudson.model.*;","248","            @Extension"]}],"core\/src\/main\/java\/hudson\/util\/FormValidation.java":[{"add":["357","     * Makes sure that the given string is not null or empty.","358","     *\/","359","    public static FormValidation validateRequired(String value) {","360","        if (Util.fixEmptyAndTrim(value) == null)","361","            return error(Messages.FormValidation_ValidateRequired());","362","        return ok();","363","    }","364","","365","    \/**"],"delete":[]}],"core\/src\/main\/resources\/hudson\/util\/Messages_ja.properties":[{"add":["2","# Copyright (c) 2004-2010, Sun Microsystems, Inc., Kohsuke Kawaguchi, Seiji Sogabe","22","ClockDifference.InSync=\\u540c\\u671f\\u4e2d","23","ClockDifference.Ahead=\\ \\u9032\\u3093\\u3067\\u3044\\u307e\\u3059","24","ClockDifference.Behind=\\ \\u9045\\u308c\\u3066\\u3044\\u307e\\u3059","25","ClockDifference.Failed=\\u30c1\\u30a7\\u30c3\\u30af\\u306b\\u5931\\u6557\\u3057\\u307e\\u3057\\u305f","26","FormValidation.ValidateRequired=\\u5fc5\\u9808\\u9805\\u76ee\\u3067\\u3059\\u3002"],"delete":["2","# Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi, Seiji Sogabe","22","ClockDifference.InSync=\\u540C\\u671F\\u4E2D","23","ClockDifference.Ahead=\\ \\u9032\\u3093\\u3067\\u3044\\u307E\\u3059","24","ClockDifference.Behind=\\ \\u9045\\u308C\\u3066\\u3044\\u307E\\u3059","25","ClockDifference.Failed=\\u30C1\\u30A7\\u30C3\\u30AF\\u306B\\u5931\\u6557\\u3057\\u307E\\u3057\\u305F"]}],"core\/src\/test\/java\/hudson\/util\/FormValidationTest.java":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/JDK.java":[{"add":["31","import hudson.Util;","180","","181","        public FormValidation doCheckName(@QueryParameter String value) {","182","            return FormValidation.validateRequired(value);","183","        }"],"delete":[]}],"core\/src\/main\/java\/hudson\/tasks\/Maven.java":[{"add":["549","","550","            public FormValidation doCheckName(@QueryParameter String value) {","551","                return FormValidation.validateRequired(value);","552","            }"],"delete":[]}]}},"71854d1b6982f606cac284e60a04aecdb66bd81d":{"changes":{"test\/src\/test\/java\/hudson\/model\/JobTest.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/Run.java":"MODIFY","core\/src\/main\/resources\/lib\/hudson\/artifactList.jelly":"MODIFY","test\/src\/test\/resources\/hudson\/model\/JobTest\/testGetArtifactsUpTo.zip":"ADD"},"diff":{"test\/src\/test\/java\/hudson\/model\/JobTest.java":[{"add":["32","import org.jvnet.hudson.test.Bug;","218","","219","    @LocalData @Bug(6371)","220","    public void testGetArtifactsUpTo() throws Exception {","221","        \/\/ There was a bug where intermediate directories were counted,","222","        \/\/ so too few artifacts were returned.","223","        Run r = hudson.getItemByFullName(\"testJob\", Job.class).getLastCompletedBuild();","224","        assertEquals(3, r.getArtifacts().size());","225","        assertEquals(3, r.getArtifactsUpTo(3).size());","226","        assertEquals(2, r.getArtifactsUpTo(2).size());","227","        assertEquals(1, r.getArtifactsUpTo(1).size());","228","    }"],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/Run.java":[{"add":["792","                if (n>=upTo) break;","796","                if (++n>=upTo) break;;"],"delete":["774","            if (n>upTo)     break;  \/\/ collected enough","775","","786","                n++;","798","                n++;"]}],"core\/src\/main\/resources\/lib\/hudson\/artifactList.jelly":[{"add":["39","  <j:set var=\"artifacts\" value=\"${build.getArtifactsUpTo(build.TREE_CUTOFF+1)}\" \/>","40","  <j:if test=\"${!build.building and !empty(artifacts)}\">","41","    <t:summary icon=\"package.gif\">","42","      <a href=\"${baseURL}artifact\/\">${caption}<\/a>","43","      <j:choose>","44","        <j:when test=\"${size(artifacts) le build.LIST_CUTOFF}\">","45","          <!-- if not too many, just list them -->","46","          <ul>","47","            <j:forEach var=\"f\" items=\"${artifacts}\">","48","              <li>","49","                <a href=\"${baseURL}artifact\/${f.href}\">${h.xmlEscape(f.displayPath)}<\/a>","52","              <\/li>","53","            <\/j:forEach>","54","          <\/ul>","55","        <\/j:when>","56","        <j:when test=\"${size(artifacts) le build.TREE_CUTOFF}\">","57","            <!-- otherwise (unless way too many) use a tree view -->","58","            <l:yui module=\"treeview\"\/>","59","            <link rel=\"stylesheet\" href=\"${resURL}\/scripts\/yui\/treeview\/assets\/skins\/sam\/treeview.css\" type=\"text\/css\"\/>","60","            <link rel=\"stylesheet\" href=\"${resURL}\/scripts\/yui\/fonts\/fonts-min.css\" type=\"text\/css\"\/>","61","            <style type=\"text\/css\">#artifact-tree td { vertical-align:middle; }<\/style>","62","            <div id=\"artifact-tree\"><\/div>","63","            <script language=\"javascript\">\/\/ &lt;![CDATA[","64","              YAHOO.util.Event.onContentReady('artifact-tree', function () {","65","              var artifactTree = new YAHOO.widget.TreeView('artifact-tree');","66","              var artifactRoot = new YAHOO.widget.TextNode('${h.jsStringEscape('%View')}',","67","                                                           artifactTree.getRoot(), false);","68","              <j:forEach var=\"e\" items=\"${artifacts.getTree().entrySet()}\">","69","                <j:set var=\"f\" value=\"${e.key}\"\/>","70","                var ${f.treeNodeId} = new YAHOO.widget.TextNode(","71","                  '${h.jsStringEscape(f.fileName)}', ${e.value?:'artifactRoot'}, false);","77","              <\/j:forEach>","78","              artifactTree.draw();","79","             });","80","           \/\/ ]]&gt;<\/script>","81","        <\/j:when>","82","        <!-- otherwise just show link to directory browser -->","83","      <\/j:choose>","84","    <\/t:summary>","85","  <\/j:if>"],"delete":["39","\t<j:set var=\"artifacts\" value=\"${build.getArtifactsUpTo(build.TREE_CUTOFF+1)}\" \/>","40","\t<j:if test=\"${!build.building and !empty(artifacts)}\">","41","\t  <t:summary icon=\"package.gif\">","42","\t    <a href=\"${baseURL}artifact\/\">${caption}<\/a>","43","\t    <j:choose>","44","\t      <j:when test=\"${size(artifacts) le build.LIST_CUTOFF}\">","45","\t        <!-- if not too many, just list them -->","46","\t        <ul>","47","\t          <j:forEach var=\"f\" items=\"${artifacts}\">","48","\t            <li>","49","                      <a href=\"${baseURL}artifact\/${f.href}\">${h.xmlEscape(f.displayPath)}<\/a>","52","\t            <\/li>","53","\t          <\/j:forEach>","54","\t        <\/ul>","55","\t      <\/j:when>","56","\t      <j:when test=\"${size(artifacts) le build.TREE_CUTOFF}\">","57","\t          <!-- otherwise (unless way too many) use a tree view -->","58","\t          <l:yui module=\"treeview\"\/>","59","\t          <link rel=\"stylesheet\" href=\"${resURL}\/scripts\/yui\/treeview\/assets\/skins\/sam\/treeview.css\" type=\"text\/css\"\/>","60","\t          <link rel=\"stylesheet\" href=\"${resURL}\/scripts\/yui\/fonts\/fonts-min.css\" type=\"text\/css\"\/>","61","\t          <style type=\"text\/css\">#artifact-tree td { vertical-align:middle; }<\/style>","62","\t          <div id=\"artifact-tree\"><\/div>","63","\t          <script language=\"javascript\">\/\/ &lt;![CDATA[","64","\t           YAHOO.util.Event.onContentReady('artifact-tree', function () {","65","\t            var artifactTree = new YAHOO.widget.TreeView('artifact-tree');","66","\t            var artifactRoot = new YAHOO.widget.TextNode('${h.jsStringEscape('%View')}',","67","\t                                                         artifactTree.getRoot(), false);","68","\t            <j:forEach var=\"e\" items=\"${artifacts.getTree().entrySet()}\">","69","\t              <j:set var=\"f\" value=\"${e.key}\"\/>","70","\t              var ${f.treeNodeId} = new YAHOO.widget.TextNode(","71","\t                '${h.jsStringEscape(f.fileName)}', ${e.value?:'artifactRoot'}, false);","77","\t            <\/j:forEach>","78","\t            artifactTree.draw();","79","\t           });","80","\t          \/\/ ]]&gt;<\/script>","81","\t      <\/j:when>","82","\t      <!-- otherwise just show link to directory browser -->","83","\t    <\/j:choose>","84","\t  <\/t:summary>","85","\t<\/j:if>"]}],"test\/src\/test\/resources\/hudson\/model\/JobTest\/testGetArtifactsUpTo.zip":[{"add":[],"delete":[]}]}},"a0a55d1da6882e8a56d90885e7cd55a22accbfe1":{"changes":{"core\/src\/main\/java\/hudson\/model\/Run.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/Run.java":[{"add":["1700","        OutputStream logger = null;","1719","                    logger = createLogger();","1720","                    listener = createBuildListener(job, logger, charset);","1802","                LOGGER.log(Level.SEVERE, \"Failed to rotate log\",e);","1803","            }","1806","            if (logger != null) {","1807","                try {","1808","                    logger.close();","1809","                } catch (IOException x) {","1810","                    LOGGER.log(Level.WARNING, \"failed to close log for \" + Run.this, x);","1811","                }","1812","            }","1816","    private OutputStream createLogger() throws IOException {","1821","            return Files.newOutputStream(getLogFile().toPath(), StandardOpenOption.CREATE, StandardOpenOption.APPEND);","1825","    }","1826","","1827","    private StreamBuildListener createBuildListener(@Nonnull RunExecution job, OutputStream logger, Charset charset) throws IOException, InterruptedException {","1843","        return new StreamBuildListener(logger,charset);"],"delete":["1718","                    listener = createBuildListener(job, listener, charset);","1800","\t\tLOGGER.log(Level.SEVERE, \"Failed to rotate log\",e);","1801","\t    }","1807","    private StreamBuildListener createBuildListener(@Nonnull RunExecution job, StreamBuildListener listener, Charset charset) throws IOException, InterruptedException {","1811","        OutputStream logger;","1813","            logger = Files.newOutputStream(getLogFile().toPath(), StandardOpenOption.CREATE, StandardOpenOption.APPEND);","1832","        listener = new StreamBuildListener(logger,charset);","1833","        return listener;"]}]}},"b401cf1fbafe50b67d1ed4aebef5bf2909e662e3":{"changes":{"core\/src\/main\/java\/hudson\/tasks\/BuildTrigger.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/tasks\/BuildTrigger.java":[{"add":["251","                        String name = ModelHyperlinkNote.encodeTo(p);"],"delete":["249","                    \/\/ this is not completely accurate, as a new build might be triggered","250","                    \/\/ between these calls","253","                        String name = ModelHyperlinkNote.encodeTo(p) + \" #\" + p.getNextBuildNumber();"]}]}},"9842a2795e81bbdb0aeb5039cd9953bbb0ff2531":{"changes":{"core\/src\/main\/java\/hudson\/model\/queue\/MappingWorksheet.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/Node.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/queue\/MappingWorksheet.java":[{"add":["136","            if (!(item.task instanceof Queue.FlyweightTask) && !nodeAcl.hasPermission(item.authenticate(), Computer.BUILD))"],"delete":["136","            if (!nodeAcl.hasPermission(item.authenticate(), Computer.BUILD))"]}],"core\/src\/main\/java\/hudson\/model\/Node.java":[{"add":["396","        if (!(item.task instanceof Queue.FlyweightTask) && !hasPermission(identity, Computer.BUILD)) {"],"delete":["396","        if (!hasPermission(identity,Computer.BUILD)) {"]}]}},"dd0a559666bdb861efc4727dc002dc8d291a403f":{"changes":{"core\/src\/main\/java\/hudson\/util\/ProcessTreeKiller.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/util\/ProcessTreeKiller.java":[{"add":["205","","206","            \/\/ in case the child enumeration fails for some reasons","207","            \/\/ (like the child process changing environment variables by itself),","208","            \/\/ let's make sure that at least 'proc' is destroyed.","209","            proc.destroy();"],"delete":[]}]}},"68f5a0d23ab4a5631df15b521b8eb71a2a74cc49":{"changes":{"maven-plugin\/src\/main\/java\/hudson\/maven\/ExecutedMojo.java":"MODIFY","maven-plugin\/src\/test\/java\/hudson\/maven\/ExecutedMojoTest.java":"ADD","maven-plugin\/pom.xml":"MODIFY","changelog.html":"MODIFY"},"diff":{"maven-plugin\/src\/main\/java\/hudson\/maven\/ExecutedMojo.java":[{"add":["32","import java.io.FileNotFoundException;","97","            Class<?> clazz = getMojoClass( md, pd );","103","        } catch (FileNotFoundException e) {","104","            \/\/ Maybe mojo was loaded from a classes dir instead of from a jar (JENKINS-5044)","105","            LOGGER.log(Level.WARNING, \"Failed to caculate digest for \"+md.getImplementation(),e);"],"delete":["96","            Class clazz = getMojoClass( md, pd );\/\/ pd.getClassRealm().loadClass(md.getImplementation());"]}],"maven-plugin\/src\/test\/java\/hudson\/maven\/ExecutedMojoTest.java":[{"add":[],"delete":[]}],"maven-plugin\/pom.xml":[{"add":["310","    ","311","    <dependency>","312","        <groupId>junit<\/groupId>","313","        <artifactId>junit<\/artifactId>","314","        <version>4.8.2<\/version>","315","        <scope>test<\/scope>","316","    <\/dependency>"],"delete":[]}],"changelog.html":[{"add":["68","  <li class=bug>","69","    Catch FileNotFoundException in Maven builds if Mojos are executed from a classes directory.","70","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-5044\">issue 5044<\/a>)"],"delete":[]}]}},"98b37699152595f35fce7387be0ee1717596650d":{"changes":{"core\/src\/main\/java\/hudson\/slaves\/JNLPLauncher.java":"MODIFY","test\/src\/test\/java\/hudson\/slaves\/JNLPLauncherTest.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/slaves\/JNLPLauncher.java":[{"add":["40","import org.kohsuke.stapler.DataBoundSetter;","71","    private RemotingWorkDirSettings workDirSettings = RemotingWorkDirSettings.getEnabledDefaults();","82","    @Deprecated","84","        this(tunnel, vmargs);","85","        if (workDirSettings != null) {","86","            setWorkDirSettings(workDirSettings);","87","        }","90","    @DataBoundConstructor","91","    public JNLPLauncher(@CheckForNull String tunnel, @CheckForNull String vmargs) {","92","        this.tunnel = Util.fixEmptyAndTrim(tunnel);","93","        this.vmargs = Util.fixEmptyAndTrim(vmargs);","133","","134","    @DataBoundSetter","135","    public final void setWorkDirSettings(@Nonnull RemotingWorkDirSettings workDirSettings) {","136","        this.workDirSettings = workDirSettings;","137","    }"],"delete":["70","    private RemotingWorkDirSettings workDirSettings;","81","    @DataBoundConstructor","83","        this.tunnel = Util.fixEmptyAndTrim(tunnel);","84","        this.vmargs = Util.fixEmptyAndTrim(vmargs);","85","        this.workDirSettings = workDirSettings != null ? workDirSettings :","86","                RemotingWorkDirSettings.getEnabledDefaults();","89","    @Deprecated","90","    public JNLPLauncher(String tunnel, String vmargs) {","91","        \/\/ TODO: Enable workDir by default in API? Otherwise classes inheriting from JNLPLauncher","92","        \/\/ will need to enable the feature by default as well.","93","        \/\/ https:\/\/github.com\/search?q=org%3Ajenkinsci+%22extends+JNLPLauncher%22&type=Code","94","        this(tunnel, vmargs, RemotingWorkDirSettings.getDisabledDefaults());"]}],"test\/src\/test\/java\/hudson\/slaves\/JNLPLauncherTest.java":[{"add":["150","    @SuppressWarnings(\"deprecation\")","152","        assertTrue(\"Work directory should be disabled for agents created via old API\", new JNLPLauncher().getWorkDirSettings().isDisabled());","287","        j.assertEqualDataBoundBeans(((JNLPLauncher) s.getLauncher()).getWorkDirSettings(), RemotingWorkDirSettings.getEnabledDefaults());","288","        RemotingWorkDirSettings custom = new RemotingWorkDirSettings(false, null, \"custom\", false);","289","        ((JNLPLauncher) s.getLauncher()).setWorkDirSettings(custom);","293","        j.assertEqualDataBoundBeans(((JNLPLauncher) s.getLauncher()).getWorkDirSettings(), custom);"],"delete":["151","        String errorMsg = \"Work directory should be disabled for agents created via old API\";","152","        assertTrue(errorMsg, new JNLPLauncher().getWorkDirSettings().isDisabled());","153","        assertTrue(errorMsg, new JNLPLauncher(null, null).getWorkDirSettings().isDisabled());"]}]}},"d000cd65a7b0152334532bc7abd148095d5cee09":{"changes":{"changelog.html":"MODIFY"},"diff":{"changelog.html":[{"add":["59","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-24453\">issue 24453<\/a>)"],"delete":[]}]}},"c685687e5e2fa4f695846fa91bf38a1786b78737":{"changes":{"core\/src\/main\/resources\/hudson\/maven\/MavenModuleSet\/sidepanel2.jelly":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/maven\/MavenModuleSet\/sidepanel2.jelly":[{"add":["1","  <j:if test=\"${!it.isAggregatorStyleBuild()}\">","2","    <!--","3","      The purpose of showing a build queue here is to know","4","      what modules are scheduled to build. This only makes","5","      sense when modules are built in parallel.","6","      See related HUDSON-1892 for how this confuses users.","7","    -->","8","    <t:queue items=\"${it.queueItems}\"\/>","9","  <\/j:if>"],"delete":["1","  <t:queue items=\"${it.queueItems}\"\/>"]}]}},"eaf30ebed45bb5b9631b4a4204c2705fa32b9e82":{"changes":{"core\/src\/main\/java\/hudson\/model\/Computer.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/Computer.java":[{"add":["476","        return LabelAtom.get(nodeName != null ? nodeName : Jenkins.getInstance().getSelfLabel().toString()).loadStatistics;"],"delete":["476","        return LabelAtom.get(nodeName != null ? nodeName : \"\").loadStatistics;"]}]}},"7fdd27f7bd83a8323e07df304bb4722116d852ff":{"changes":{"core\/src\/main\/java\/hudson\/model\/UpdateSite.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/UpdateSite.java":[{"add":["55","import java.net.URLEncoder;","165","                    URL src = new URL(getUrl() + \"?id=\" + URLEncoder.encode(getId(),\"UTF-8\") ","166","                            + \"&version=\"+URLEncoder.encode(Jenkins.VERSION, \"UTF-8\"));"],"delete":["164","                    URL src = new URL(getUrl());"]}]}},"9912235bec237dbb68100815c7a80f5185c93706":{"changes":{"war\/src\/main\/webapp\/scripts\/hudson-behavior.js":"MODIFY","changelog.html":"MODIFY"},"diff":{"war\/src\/main\/webapp\/scripts\/hudson-behavior.js":[{"add":["796","        \/\/ CodeMirror inserts a wrapper element next to the textarea.","797","        \/\/ textarea.nextSibling may not be the handle.","798","        var handles = findElementsBySelector(textarea.parentNode, \".textarea-handle\");","799","        if(handles.length != 1) return;","800","        var handle = handles[0];","804","        function getCodemirrorScrollerOrTextarea(){","805","            return textarea.codemirrorObject ? textarea.codemirrorObject.getScrollerElement() : textarea;","806","        }","809","            var s = getCodemirrorScrollerOrTextarea();","810","            var offset = s.offsetHeight-Event.getPageY(ev);","811","            s.style.opacity = 0.5;","815","                s.style.height = max(32, offset + Event.getPageY(ev)) + 'px';","821","                var s = getCodemirrorScrollerOrTextarea();","822","                s.style.opacity = 1;","826","            var s = getCodemirrorScrollerOrTextarea();","827","            s.style.height = \"1px\"; \/\/ To get actual height of the textbox, shrink it and show its scrollbar","828","            s.style.height = s.scrollHeight + 'px';"],"delete":["796","        var handle = textarea.nextSibling;","797","        if(handle==null || handle.className!=\"textarea-handle\") return;","803","            var offset = textarea.offsetHeight-Event.getPageY(ev);","804","            textarea.style.opacity = 0.5;","808","                textarea.style.height = max(32, offset + Event.getPageY(ev)) + 'px';","814","                textarea.style.opacity = 1;","818","            textarea.style.height = \"\";","819","            textarea.rows = textarea.value.split(\"\\n\").length;"]}],"changelog.html":[{"add":["60","  <li class=bug>","61","    Resizable textarea handle does not work if CodeMirror is enabled","62","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-11132\">issue 11132<\/a>)"],"delete":[]}]}},"704343f57e01eaca2076a60083348d01af7a6050":{"changes":{"remoting\/src\/main\/java\/hudson\/remoting\/SocketOutputStream.java":"ADD","maven-agent\/src\/main\/java\/hudson\/maven\/agent\/Main.java":"MODIFY","remoting\/src\/main\/java\/hudson\/remoting\/RemoteInputStream.java":"MODIFY","core\/src\/main\/java\/hudson\/maven\/MavenProcessFactory.java":"MODIFY","core\/src\/main\/java\/hudson\/util\/ArgumentListBuilder.java":"MODIFY","remoting\/src\/main\/java\/hudson\/remoting\/SocketInputStream.java":"ADD"},"diff":{"remoting\/src\/main\/java\/hudson\/remoting\/SocketOutputStream.java":[{"add":[],"delete":[]}],"maven-agent\/src\/main\/java\/hudson\/maven\/agent\/Main.java":[{"add":["9","import java.io.FilterInputStream;","10","import java.io.FilterOutputStream;","11","import java.io.IOException;","15","import java.net.Socket;","18","import java.util.Set;","37","        main(new File(args[0]),new File(args[1]),new File(args[2]),Integer.parseInt(args[3]));","40","    \/**","41","     *","42","     * @param m2Home","43","     *      Maven2 installation. This is where we find Maven jars that we'll run.","44","     * @param remotingJar","45","     *      Hudson's remoting.jar that we'll load.","46","     * @param interceptorJar","47","     *      maven-interceptor.jar that we'll load.","48","     * @param tcpPort","49","     *      TCP socket that the launching Hudson will be listening to.","50","     *      This is used for the remoting communication.","51","     *\/","52","    public static void main(File m2Home, File remotingJar, File interceptorJar, int tcpPort) throws Exception {","87","        final Socket s = new Socket((String)null,tcpPort);","90","        remotingLauncher.getMethod(\"main\",new Class[]{InputStream.class,OutputStream.class}).invoke(null,","91","                new Object[]{","92","                        \/\/ do partial close, since socket.getInputStream and getOutputStream doesn't do it by","93","                        new FilterInputStream(s.getInputStream()) {","94","                            public void close() throws IOException {","95","                                s.shutdownInput();","96","                            }","97","                        },","98","                        new FilterOutputStream(s.getOutputStream()) {","99","                            public void close() throws IOException {","100","                                s.shutdownOutput();","101","                            }","102","                        }","103","                });"],"delete":["8","import java.io.ByteArrayInputStream;","12","import java.io.IOException;","15","import java.util.Set;","35","        main(new File(args[0]),new File(args[1]),new File(args[2]));","38","    public static void main(File m2Home, File remotingJar, File interceptorJar) throws Exception {","73","        \/\/ we'll use stdin\/out to talk to the host,","74","        \/\/ so make sure Maven won't touch them later","75","        OutputStream os = System.out;","76","        System.setOut(System.err);","77","        InputStream is = System.in;","78","        System.setIn(new ByteArrayInputStream(new byte[0]));","81","        remotingLauncher.getMethod(\"main\",new Class[]{InputStream.class,OutputStream.class}).invoke(null,new Object[]{is,os});"]}],"remoting\/src\/main\/java\/hudson\/remoting\/RemoteInputStream.java":[{"add":["9"," * Wraps {@link InputStream} so that it can be sent over the remoting channel.","10"," *","11"," * <p>","12"," * Note that this class by itself does not perform buffering.","13"," *"],"delete":[]}],"core\/src\/main\/java\/hudson\/maven\/MavenProcessFactory.java":[{"add":["4","import hudson.Proc;","8","import hudson.model.Computer;","17","import hudson.remoting.RemoteInputStream;","18","import hudson.remoting.RemoteOutputStream;","19","import hudson.remoting.SocketInputStream;","20","import hudson.remoting.SocketOutputStream;","26","import java.io.BufferedInputStream;","27","import java.io.BufferedOutputStream;","31","import java.io.InputStream;","33","import java.io.Serializable;","35","import java.net.ServerSocket;","36","import java.net.Socket;","39","import java.util.Arrays;","41","import java.util.logging.Level;","42","import java.util.logging.Logger;","43","","77","     * Represents a bi-directional connection.","78","     *","79","     * <p>","80","     * This implementation is remoting aware, so it can be safely sent to the remote callable object.","81","     *","82","     * <p>","83","     * When we run Maven on a slave, the master may not have a direct TCP\/IP connectivty to the slave.","84","     * That means the {@link Channel} between the master and the Maven needs to be tunneled through","85","     * the channel between master and the slave, then go to TCP socket to the Maven.","86","     *\/","87","    private static final class Connection implements Serializable {","88","        public InputStream in;","89","        public OutputStream out;","90","","91","        Connection(InputStream in, OutputStream out) {","92","            this.in = in;","93","            this.out = out;","94","        }","95","","96","        private Object writeReplace() {","97","            return new Connection(new RemoteInputStream(in),new RemoteOutputStream(out));","98","        }","99","","100","        private Object readResolve() {","101","            \/\/ ObjectInputStream seems to access data at byte-level and do not do any buffering,","102","            \/\/ so if we are remoted, buffering would be crucial.","103","            this.in = new BufferedInputStream(in);","104","            this.out = new BufferedOutputStream(out);","105","            return this;","106","        }","107","","108","        private static final long serialVersionUID = 1L;","109","    }","110","","111","    interface Acceptor {","112","        Connection accept() throws IOException;","113","        int getPort();","114","    }","115","","116","    static final class AcceptorImpl implements Acceptor, Serializable {","117","        private final ServerSocket serverSocket;","118","        private Socket socket;","119","","120","        AcceptorImpl(ServerSocket serverSocket) {","121","            this.serverSocket = serverSocket;","122","        }","123","","124","        public Connection accept() throws IOException {","125","            socket = serverSocket.accept();","126","            \/\/ we'd only accept one connection","127","            serverSocket.close();","128","","129","            return new Connection(new SocketInputStream(socket),new SocketOutputStream(socket));","130","        }","131","","132","        public int getPort() {","133","            return serverSocket.getLocalPort();","134","        }","135","","136","        \/**","137","         * When sent to the remote node, send a proxy.","138","         *\/","139","        private Object writeReplace() {","140","            return Channel.current().export(Acceptor.class, this);","141","        }","142","    }","143","","144","    \/**","145","     * Opens a server socket and returns {@link Acceptor} so that","146","     * we can accept a connection later on it.","147","     *\/","148","    private static final class SocketHandler implements Callable<Acceptor,IOException> {","149","        public Acceptor call() throws IOException {","150","            \/\/ open a TCP socket to talk to the launched Maven process.","151","            \/\/ let the OS pick up a random open port","152","            ServerSocket ss = new ServerSocket();","153","            ss.bind(null); \/\/ new InetSocketAddress(InetAddress.getLocalHost(),0));","154","","155","            return new AcceptorImpl(ss);","156","        }","157","","158","        private static final long serialVersionUID = 1L;","159","    }","160","","161","    \/**","168","            final Acceptor acceptor = launcher.getChannel().call(new SocketHandler());","169","","170","            final ArgumentListBuilder cmdLine = buildMavenCmdLine(listener,acceptor.getPort());","171","            String[] cmds = cmdLine.toCommandArray();","172","            final Proc proc = launcher.launch(cmds, envVars, out, workDir);","173","","174","            Connection con = acceptor.accept();","175","","176","            return new Channel(\"Channel to Maven \"+ Arrays.toString(cmds),","177","                Computer.threadPoolForRemoting, con.in, con.out) {","178","","179","                \/**","180","                 * Kill the process when the channel is severed.","181","                 *\/","182","                protected synchronized void terminate(IOException e) {","183","                    super.terminate(e);","184","                    try {","185","                        proc.kill();","186","                    } catch (IOException x) {","187","                        \/\/ we are already in the error recovery mode, so just record it and move on","188","                        LOGGER.log(Level.INFO, \"Failed to terminate the severed connection\",x);","189","                    } catch (InterruptedException x) {","190","                        \/\/ process the interrupt later","191","                        Thread.currentThread().interrupt();","192","                    }","193","                }","194","","195","                public synchronized void close() throws IOException {","196","                    super.close();","197","                    \/\/ wait for Maven to complete","198","                    try {","199","                        proc.join();","200","                    } catch (InterruptedException e) {","201","                        \/\/ process the interrupt later","202","                        Thread.currentThread().interrupt();","203","                    }","204","                }","205","            };","206","","207","\/\/            return launcher.launchChannel(buildMavenCmdLine(listener).toCommandArray(),","208","\/\/                out, workDir, envVars);","225","    private ArgumentListBuilder buildMavenCmdLine(BuildListener listener,int tcpPort) throws IOException, InterruptedException {","273","        args.add(tcpPort);","377","","378","    private static final Logger LOGGER = Logger.getLogger(MavenProcessFactory.class.getName());"],"delete":["67","            return launcher.launchChannel(buildMavenCmdLine(listener).toCommandArray(),","68","                out, workDir, envVars);","85","    private ArgumentListBuilder buildMavenCmdLine(BuildListener listener) throws IOException, InterruptedException {"]}],"core\/src\/main\/java\/hudson\/util\/ArgumentListBuilder.java":[{"add":["8","import java.io.Serializable;","15","public class ArgumentListBuilder implements Serializable {","18","    public ArgumentListBuilder add(Object a) {","19","        return add(a.toString());","20","    }","21","","101","","102","    private static final long serialVersionUID = 1L;"],"delete":["14","public class ArgumentListBuilder {"]}],"remoting\/src\/main\/java\/hudson\/remoting\/SocketInputStream.java":[{"add":[],"delete":[]}]}},"c57f9ed577b9635f01aa5affabf1f770b689a115":{"changes":{"core\/pom.xml":"MODIFY","changelog.html":"MODIFY"},"diff":{"core\/pom.xml":[{"add":["44","    <stapler.version>1.229<\/stapler.version>"],"delete":["44","    <stapler.version>1.228<\/stapler.version>"]}],"changelog.html":[{"add":["69","  <li class=bug>","70","    Reduced the logging clutter about the lack of @ExportedBean","71","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-24458\">issue 24458<\/a>)","72","  <li class=bug>","73","    Character encoding problem in form submission when file parameters are present","74","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-11543\">issue 11543<\/a>)"],"delete":[]}]}},"cc1f75cdba5ab33b851c6f5b6f934fd5cadeb9bc":{"changes":{"core\/src\/main\/java\/hudson\/Functions.java":"MODIFY","changelog.html":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/Functions.java":[{"add":["649","        if(! (req.getScheme().equals(\"http\") && req.getLocalPort()==80 || req.getScheme().equals(\"https\") && req.getLocalPort()==443))"],"delete":["649","        if(req.getLocalPort()!=80)"]}],"changelog.html":[{"add":["60","  <li class=bug>","61","    HTTPS on port 80 makes Jenkins infer his URI incorrectly","62","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-11151\">issue 11151<\/a>)"],"delete":[]}]}},"2efa70955299ff7bb5d5bc9a5d12c218f922ab03":{"changes":{"core\/src\/main\/java\/hudson\/model\/ResourceController.java":"MODIFY","changelog.html":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/ResourceController.java":[{"add":["31","import java.util.concurrent.CopyOnWriteArraySet;","41","    private final Set<ResourceActivity> inProgress = new CopyOnWriteArraySet<ResourceActivity>();","127","    public ResourceActivity getBlockingActivity(ResourceActivity activity) {"],"delete":["28","import java.util.HashSet;","41","    private final Set<ResourceActivity> inProgress = new HashSet<ResourceActivity>();","127","    public synchronized ResourceActivity getBlockingActivity(ResourceActivity activity) {"]}],"changelog.html":[{"add":["70","  <li class=bug>","71","    UI waiting on a queue lock to display cause of queue blockage.","72","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-16833\">issue 16833<\/a>)"],"delete":[]}]}},"587c6fe317bfe3560069ceb41495c6f5f5d114d1":{"changes":{"core\/src\/main\/java\/hudson\/Functions.java":"MODIFY","changelog.html":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/Functions.java":[{"add":["152","import java.util.concurrent.atomic.AtomicLong;","167","    private static final AtomicLong iota = new AtomicLong();","176","        return \"id\" + iota.getAndIncrement();"],"delete":["166","    private static volatile int globalIota = 0;","167","    private int iota;","170","        iota = globalIota;","171","        \/\/ concurrent requests can use the same ID --- we are just trying to","172","        \/\/ prevent the same user from seeing the same ID repeatedly.","173","        globalIota+=1000;","180","        return \"id\"+iota++;"]}],"changelog.html":[{"add":["60","  <li class=bug>","61","    Integer overflow could cause JavaScript functions to break in long-running Jenkins processes.","62","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-20085\">issue 20085<\/a>)"],"delete":[]}]}},"4e48eaa05ca3a76fcb0e1eee307fd20f222079bc":{"changes":{"core\/src\/main\/resources\/hudson\/tasks\/Shell\/config.groovy":"MODIFY","core\/src\/main\/resources\/lib\/form\/textarea\/textarea.js":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/tasks\/Shell\/config.groovy":[{"add":["27","    f.textarea(name: \"command\", value: instance?.command, class: \"fixed-width\", 'codemirror-mode': 'shell', 'codemirror-config': \"mode: 'text\/x-sh'\")"],"delete":["27","    \/\/ TODO JENKINS-23151 'codemirror-mode': 'shell' is broken","28","    f.textarea(name: \"command\", value: instance?.command, class: \"fixed-width\")"]}],"core\/src\/main\/resources\/lib\/form\/textarea\/textarea.js":[{"add":["12","        var config = e.getAttribute(\"codemirror-config\");","13","        config += (config ? \", \" : \" \") + \"onBlur: function(editor){editor.save()}\";"],"delete":["12","        var config = e.getAttribute(\"codemirror-config\") || \"\";"]}]}},"f440a54026a53dd9adc957b572019956b7e41f65":{"changes":{"core\/src\/main\/java\/hudson\/widgets\/BuildHistoryWidget.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/widgets\/BuildHistoryWidget.java":[{"add":["64","                list.addFirst(item);"],"delete":["64","                list.push(item);"]}]}},"4f05676c5aa61b2c948aac3d964d652e56e2c777":{"changes":{"core\/src\/main\/resources\/hudson\/model\/Hudson\/_cli.jelly":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/model\/Hudson\/_cli.jelly":[{"add":["33","        ${%blurb('${rootURL}\/jnlpJars\/hudson-cli.jar')}"],"delete":["33","        ${%blurb('jnlpJars\/hudson-cli.jar')}"]}]}},"7af77ee70a60f01fe0e40e028f7c2d1f65835ca8":{"changes":{"core\/src\/main\/java\/hudson\/scm\/SubversionSCM.java":"MODIFY","core\/src\/main\/java\/hudson\/scm\/RepositoryBrowsers.java":"MODIFY","core\/src\/main\/resources\/lib\/form\/dropdownList.jelly":"MODIFY","core\/src\/main\/java\/hudson\/scm\/CVSSCM.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/scm\/SubversionSCM.java":[{"add":["95","import net.sf.json.JSONObject;","96","","1024","        public SCM newInstance(StaplerRequest req, JSONObject formData) throws FormException {","1029","                    RepositoryBrowsers.createInstance(SubversionRepositoryBrowser.class, req, formData, \"browser\"));"],"delete":["1022","        public SCM newInstance(StaplerRequest req) throws FormException {","1027","                    RepositoryBrowsers.createInstance(SubversionRepositoryBrowser.class, req, \"svn.browser\"));"]}],"core\/src\/main\/java\/hudson\/scm\/RepositoryBrowsers.java":[{"add":["10","import net.sf.json.JSONObject;","11","import net.sf.json.JSONArray;","12","","45","     *","46","     * @deprecated","47","     *      Use {@link #createInstance(Class, StaplerRequest, JSONObject, String)}.","58","","59","    \/**","60","     * Creates an instance of {@link RepositoryBrowser} from a form submission.","61","     *","62","     * @since 1.227","63","     *\/","64","    public static <T extends RepositoryBrowser>","65","    T createInstance(Class<T> type, StaplerRequest req, JSONObject parent, String fieldName) throws FormException {","66","        List<Descriptor<RepositoryBrowser<?>>> list = filter(type);","67","","68","        Object o = parent.get(fieldName);","69","        if(o==null) return null;","70","","71","        if(o instanceof String && \"auto\".equals(o))","72","            return null;","73","","74","        if (o instanceof JSONArray) {","75","            JSONArray a = (JSONArray) o;","76","            return type.cast(list.get(a.getInt(0)).newInstance(req,a.getJSONObject(1)));","77","        }","78","","79","        throw new AssertionError(o.getClass());","80","    }"],"delete":[]}],"core\/src\/main\/resources\/lib\/form\/dropdownList.jelly":[{"add":["35","        <table width=\"100%\" name=\"${name}\">"],"delete":["35","        <table width=\"100%\">"]}],"core\/src\/main\/java\/hudson\/scm\/CVSSCM.java":[{"add":["971","            scm.repositoryBrowser = RepositoryBrowsers.createInstance(CVSRepositoryBrowser.class,req,formData,\"browser\");"],"delete":["971","            scm.repositoryBrowser = RepositoryBrowsers.createInstance(CVSRepositoryBrowser.class,req,\"cvs.browser\");"]}]}},"9b36e2ae8dbbd2a7ab0d9d4bc9e24e305e33ecbc":{"changes":{"changelog.html":"MODIFY","core\/src\/main\/java\/hudson\/model\/Queue.java":"MODIFY"},"diff":{"changelog.html":[{"add":["58","    Queue didn't always leave a trail for cancelled items properly","59","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-25314\">issue 25314<\/a>)","60","  <li class=bug>"],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/Queue.java":[{"add":["660","        return item.cancel(this);","1585","         *","1586","         * @return true","1587","         *      if the item was successfully cancelled.","1591","            if (r) {","1592","                future.setAsCancelled();","1593","                LeftItem li = new LeftItem(this);","1594","                li.enter(q);","1595","            }"],"delete":["660","        boolean r = item.cancel(this);","661","","662","        LeftItem li = new LeftItem(item);","663","        li.enter(this);","664","","665","        return r;","1593","            if (r)  future.setAsCancelled();"]}]}},"ae6a7981f0acff3728b1f014a3cb2d0ee5c56856":{"changes":{"core\/src\/main\/java\/hudson\/model\/User.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/User.java":[{"add":["212","        checkPermission(Hudson.ADMINISTER);"],"delete":[]}]}},"b14a7a36e47934375c768d3d317403b01a6982ea":{"changes":{"core\/src\/test\/java\/hudson\/util\/XStream2EncodingTest.java":"ADD","core\/src\/main\/java\/hudson\/model\/View.java":"MODIFY","changelog.html":"MODIFY","core\/src\/main\/java\/hudson\/model\/Computer.java":"MODIFY","core\/src\/main\/java\/hudson\/util\/XStream2.java":"MODIFY"},"diff":{"core\/src\/test\/java\/hudson\/util\/XStream2EncodingTest.java":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/View.java":[{"add":["1018","                    xStream2.toXMLUTF8(this,  rsp.getOutputStream());"],"delete":["1018","                    rsp.getOutputStream().write(\"<?xml version='1.0' encoding='UTF-8'?>\\n\".getBytes(\"UTF-8\"));","1019","                    xStream2.toXML(this,  rsp.getOutputStream());"]}],"changelog.html":[{"add":["58","    Incorrect or missing XML encoding declaration on some REST API pages.","59","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-16881\">issue 16881<\/a>)","60","  <li class=bug>"],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/Computer.java":[{"add":["1179","            Jenkins.XSTREAM2.toXMLUTF8(getNode(), rsp.getOutputStream());"],"delete":["1179","            Jenkins.XSTREAM2.toXML(getNode(), rsp.getOutputStream());"]}],"core\/src\/main\/java\/hudson\/util\/XStream2.java":[{"add":["56","import java.io.IOException;","57","import java.io.OutputStream;","58","import java.io.OutputStreamWriter;","59","import java.io.Writer;","63","import java.nio.charset.Charset;","173","     * @deprecated Uses default encoding yet fails to write an encoding header. Prefer {@link #toXMLUTF8}.","174","     *\/","175","    @Deprecated","176","    @Override public void toXML(Object obj, OutputStream out) {","177","        super.toXML(obj, out);","178","    }","179","","180","    \/**","181","     * Serializes to a byte stream.","182","     * Uses UTF-8 encoding and specifies that in the XML encoding declaration.","183","     * @since 1.504","184","     *\/","185","    public void toXMLUTF8(Object obj, OutputStream out) throws IOException {","186","        Writer w = new OutputStreamWriter(out, Charset.forName(\"UTF-8\"));","187","        w.write(\"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\\n\");","188","        toXML(obj, w);","189","    }","190","","191","    \/**"],"delete":[]}]}},"2f9c983cb67a9a4600c13b2c6eb88ab32aac49d0":{"changes":{"core\/src\/main\/java\/hudson\/model\/Hudson.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/Hudson.java":[{"add":["525","    @Exported","855","    @Exported(name=\"jobs\")","1224","    @Exported"],"delete":["1222","    @Exported(inline=true)"]}]}},"8d55b1f555194be546152a972294f0a64a052da9":{"changes":{"core\/src\/main\/resources\/hudson\/model\/Label\/index.jelly":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/model\/Label\/index.jelly":[{"add":["38","      <j:forEach var=\"a\" items=\"${it.allActions}\">"],"delete":["38","      <j:forEach var=\"a\" items=\"${it.actions}\">"]}]}},"100202cf03db1fc4a0a7365f4ea585ed6ebadbcc":{"changes":{"core\/pom.xml":"MODIFY","war\/pom.xml":"MODIFY"},"diff":{"core\/pom.xml":[{"add":["773","                  <version>2.1.2<\/version>"],"delete":["773","                  <version>2.1.0<\/version>"]}],"war\/pom.xml":[{"add":["116","      <version>1.9.1<\/version>"],"delete":["116","      <version>1.9<\/version>"]}]}},"4cad0b1f29386de28fb53539ba02541a8fdf0dc8":{"changes":{"core\/src\/main\/java\/hudson\/tasks\/junit\/TestObject.java":"MODIFY","core\/src\/main\/resources\/hudson\/tasks\/junit\/MetaTabulatedResult\/body.jelly":"MODIFY","core\/src\/main\/java\/hudson\/tasks\/junit\/TestResult.java":"MODIFY","core\/src\/main\/java\/hudson\/tasks\/junit\/CaseResult.java":"MODIFY","core\/src\/main\/java\/hudson\/tasks\/junit\/TabulatedResult.java":"MODIFY","core\/src\/main\/java\/hudson\/tasks\/junit\/PackageResult.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/tasks\/junit\/TestObject.java":[{"add":["49","     * Replaces URL-unsafe characters.","52","        \/\/ 3 replace calls is still 2-3x faster than a regex replaceAll","53","        return s.replace('\/','_').replace('\\\\', '_').replace(':','_');"],"delete":["49","     * Replaces URL-unasfe characters.","52","        return s.replace('\/','_').replace(':','_');"]}],"core\/src\/main\/resources\/hudson\/tasks\/junit\/MetaTabulatedResult\/body.jelly":[{"add":["40","            <td class=\"pane\"><a href=\"${p.safeName}\/\">${p.name}<\/a><\/td>","55","<\/j:jelly>"],"delete":["40","            <td class=\"pane\"><a href=\"${p.name}\/\">${p.name}<\/a><\/td>","55","<\/j:jelly>"]}],"core\/src\/main\/java\/hudson\/tasks\/junit\/TestResult.java":[{"add":["210","    @Override","211","    public String getName() {","212","        return \"\";","213","    }","214","","258","                String pkg = cr.getPackageName(), spkg = safe(pkg);","259","                PackageResult pr = byPackage(spkg);","261","                    byPackages.put(spkg,pr=new PackageResult(this,pkg));"],"delete":["253","                String pkg = cr.getPackageName();","254","                PackageResult pr = byPackage(pkg);","256","                    byPackages.put(pkg,pr=new PackageResult(this,pkg));"]}],"core\/src\/main\/java\/hudson\/tasks\/junit\/CaseResult.java":[{"add":["260","        StringBuilder buf = new StringBuilder();","264","            buf.insert(0,classResult.getSafeName());","269","                buf.insert(0,pkg.getSafeName());"],"delete":["260","        StringBuffer buf = new StringBuffer();","264","            buf.insert(0,classResult.getName());","269","                buf.insert(0,pkg.getName());"]}],"core\/src\/main\/java\/hudson\/tasks\/junit\/TabulatedResult.java":[{"add":["43","    \/**","44","     * Gets the name of this object.","45","     *\/","46","    public abstract String getName();","47","","48","    \/**","49","     * Gets the version of {@link #getName()} that's URL-safe.","50","     *\/","51","    public String getSafeName() {","52","        return safe(getName());","53","    }"],"delete":[]}],"core\/src\/main\/java\/hudson\/tasks\/junit\/PackageResult.java":[{"add":["102","        String n = r.getSimpleName(), sn = safe(n);","103","        ClassResult c = classes.get(sn);","105","            classes.put(sn,c=new ClassResult(this,n));"],"delete":["102","        String n = r.getSimpleName();","103","        ClassResult c = classes.get(n);","105","            classes.put(n,c=new ClassResult(this,n));"]}]}},"a82c4fcc518b9475aa069ebcd180c0bb646341c8":{"changes":{"core\/src\/main\/java\/hudson\/util\/Secret.java":"MODIFY","core\/src\/test\/java\/hudson\/util\/SecretUtilTest.java":"ADD"},"diff":{"core\/src\/main\/java\/hudson\/util\/Secret.java":[{"add":["167","        if(!isValidData(data))      return null;","217","    private static boolean isValidData(String data) {","218","        if (data == null || \"{}\".equals(data) || \"\".equals(data.trim())) return false;","219","","220","        if (data.startsWith(\"{\") && data.endsWith(\"}\")) {","221","            return !\"\".equals(data.substring(1, data.length()-1).trim());","222","        }","223","","224","        return true;","225","    }","226",""],"delete":["167","        if(data==null)      return null;"]}],"core\/src\/test\/java\/hudson\/util\/SecretUtilTest.java":[{"add":[],"delete":[]}]}},"239b8b0bfd8634a508e9a79ad9663520bb1cac40":{"changes":{"maven-plugin\/src\/main\/java\/hudson\/maven\/RedeployPublisher.java":"MODIFY","maven-plugin\/src\/main\/java\/hudson\/maven\/MavenUtil.java":"MODIFY","maven-plugin\/src\/main\/java\/hudson\/maven\/reporters\/MavenAbstractArtifactRecord.java":"MODIFY"},"diff":{"maven-plugin\/src\/main\/java\/hudson\/maven\/RedeployPublisher.java":[{"add":["98","            ","99","            MavenEmbedder embedder = MavenUtil.createEmbedder(listener,build);"],"delete":["98","            MavenEmbedder embedder = MavenUtil.createEmbedder(listener,build.getProject(),null);"]}],"maven-plugin\/src\/main\/java\/hudson\/maven\/MavenUtil.java":[{"add":["30","import hudson.model.AbstractBuild;","79","    \/**","80","     * This version tries to infer mavenHome and other options by looking at a build.","81","     *","82","     * @see #createEmbedder(TaskListener, File, String)","83","     *\/","84","    public static MavenEmbedder createEmbedder(TaskListener listener, AbstractBuild<?,?> build) throws MavenEmbedderException, IOException, InterruptedException {","85","        MavenInstallation m=null;","86","        File settingsLoc = null;","87","        String profiles = null;","88","        Properties systemProperties = null;","89","        String privateRepository = null;","90","        ","91","        AbstractProject project = build.getProject();","92","        ","93","        if (project instanceof ProjectWithMaven) {","94","            m = ((ProjectWithMaven) project).inferMavenInstallation().forNode(Hudson.getInstance(),listener);","95","        }","96","        if (project instanceof MavenModuleSet) {","97","            String altSet = ((MavenModuleSet) project).getAlternateSettings();","98","            settingsLoc = (altSet == null) ? null ","99","                : new File(build.getWorkspace().child(altSet).getRemote());","100","","101","            if (((MavenModuleSet) project).usesPrivateRepository()) {","102","                privateRepository = build.getWorkspace().child(\".repository\").getRemote();","103","            }","104","","105","            profiles = ((MavenModuleSet) project).getProfiles();","106","            systemProperties = ((MavenModuleSet) project).getMavenProperties();","107","        }","108","        ","109","        return createEmbedder(listener,","110","                              m!=null?m.getHomeDir():null,","111","                              profiles,","112","                              systemProperties,","113","                              privateRepository,","114","                              settingsLoc);","115","    }","116",""],"delete":[]}],"maven-plugin\/src\/main\/java\/hudson\/maven\/reporters\/MavenAbstractArtifactRecord.java":[{"add":["203","                    MavenEmbedder embedder = MavenUtil.createEmbedder(listener,getBuild());"],"delete":["203","                    MavenEmbedder embedder = MavenUtil.createEmbedder(listener,getBuild().getProject(),null);"]}]}},"610e3b537c05c4a8c60b5f0fdf2ddc57c8d6e317":{"changes":{"core\/src\/main\/java\/hudson\/maven\/reporters\/SurefireAggregatedReport.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/maven\/reporters\/SurefireAggregatedReport.java":[{"add":["65","        path.append(it.getOwner().getNumber());"],"delete":["64","        ","66","        path.append(it.getAge());"]}]}},"8eb264ceb1bfdea332009499a06b9faa89dc03e9":{"changes":{"changelog.html":"MODIFY","war\/pom.xml":"MODIFY"},"diff":{"changelog.html":[{"add":["58","    Fixed a thread leak in the embedded servlet container.","59","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-9882\">issue 9882<\/a>)","60","  <li class=bug>"],"delete":[]}],"war\/pom.xml":[{"add":["101","      <version>0.9.10-jenkins-36<\/version>"],"delete":["101","      <version>0.9.10-jenkins-35<\/version>"]}]}},"a6b889b561093a28e356ee6727fbdd738df6e4a8":{"changes":{"core\/src\/main\/java\/hudson\/model\/Hudson.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/Hudson.java":[{"add":["1920","        Level lv;","1921","        if(level.equals(\"inherit\"))","1922","            lv = null;","1923","        else","1924","            lv = Level.parse(level.toUpperCase());","1925","        Logger.getLogger(name).setLevel(lv);"],"delete":["1920","        Logger.getLogger(name).setLevel(Level.parse(level.toUpperCase()));"]}]}},"abeebce2230c37c1ad6bd6b5d5af615859980568":{"changes":{"core\/pom.xml":"MODIFY","maven-plugin\/pom.xml":"MODIFY"},"diff":{"core\/pom.xml":[{"add":["602","","603","      <dependency>","604","        <groupId>com.google.guava<\/groupId>","605","        <artifactId>guava<\/artifactId>","606","      <\/dependency>"],"delete":[]}],"maven-plugin\/pom.xml":[{"add":[],"delete":["205","      <groupId>com.google.guava<\/groupId>","206","      <artifactId>guava<\/artifactId>","207","    <\/dependency>","208","","209","    <dependency>"]}]}},"49b47dc41ea071e293f1974049b126a6817a4f4b":{"changes":{"core\/src\/main\/java\/hudson\/tasks\/MailSender.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/tasks\/MailSender.java":[{"add":["314","                try {","315","                    rcp.add(new InternetAddress(address));","316","                } catch (AddressException e) {","317","                    \/\/ report bad address, but try to send to other addresses","318","                    e.printStackTrace(listener.error(e.getMessage()));","319","                }"],"delete":["314","                rcp.add(new InternetAddress(address));"]}]}},"b5be66014c3c7a99eed1ed7436a0874686e255b5":{"changes":{"core\/src\/test\/java\/jenkins\/model\/CoreEnvironmentContributorTest.java":"MODIFY","core\/src\/main\/java\/hudson\/slaves\/ChannelPinger.java":"MODIFY","core\/src\/test\/java\/hudson\/model\/RunTest.java":"MODIFY","core\/src\/test\/java\/hudson\/slaves\/ChannelPingerTest.java":"MODIFY","core\/pom.xml":"MODIFY","cli\/pom.xml":"MODIFY","cli\/src\/test\/java\/hudson\/cli\/PrivateKeyProviderTest.java":"MODIFY","pom.xml":"MODIFY"},"diff":{"core\/src\/test\/java\/jenkins\/model\/CoreEnvironmentContributorTest.java":[{"add":["56","        verifyStatic(Computer.class, times(0));"],"delete":["56","        verifyStatic(times(0));"]}],"core\/src\/main\/java\/hudson\/slaves\/ChannelPinger.java":[{"add":["36","import org.kohsuke.accmod.Restricted;","37","import org.kohsuke.accmod.restrictions.NoExternalUse;","123","    @Restricted(NoExternalUse.class)","124","    public static class SetUpRemotePing extends MasterToSlaveCallable<Void, IOException> {","131","        public SetUpRemotePing(int pingTimeoutSeconds, int pingIntervalSeconds) {","182","    @Restricted(NoExternalUse.class)","183","    public static void setUpPingForChannel(final Channel channel, final SlaveComputer computer, int timeoutSeconds, int intervalSeconds, final boolean analysis) {"],"delete":["121","    \/*package*\/ static class SetUpRemotePing extends MasterToSlaveCallable<Void, IOException> {","128","        SetUpRemotePing(int pingTimeoutSeconds, int pingIntervalSeconds) {","179","    \/*package*\/ static void setUpPingForChannel(final Channel channel, final SlaveComputer computer, int timeoutSeconds, int intervalSeconds, final boolean analysis) {"]}],"core\/src\/test\/java\/hudson\/model\/RunTest.java":[{"add":["39","","40","import jenkins.model.Jenkins;","220","        final Jenkins group = Mockito.mock(Jenkins.class);","241","        final Jenkins group1 = Mockito.mock(Jenkins.class);","242","        final Jenkins group2 = Mockito.mock(Jenkins.class);"],"delete":["218","        final ItemGroup group = Mockito.mock(ItemGroup.class);","239","        final ItemGroup group1 = Mockito.mock(ItemGroup.class);","240","        final ItemGroup group2 = Mockito.mock(ItemGroup.class);"]}],"core\/src\/test\/java\/hudson\/slaves\/ChannelPingerTest.java":[{"add":["65","        verifyStatic(ChannelPinger.class);","79","        verifyStatic(ChannelPinger.class);","91","        verifyStatic(ChannelPinger.class);","104","        verifyStatic(ChannelPinger.class);"],"delete":["65","        verifyStatic();","79","        verifyStatic();","91","        verifyStatic();","104","        verifyStatic();"]}],"core\/pom.xml":[{"add":["483","      <artifactId>powermock-api-mockito2<\/artifactId>"],"delete":["483","      <artifactId>powermock-api-mockito<\/artifactId>"]}],"cli\/pom.xml":[{"add":["28","      <artifactId>powermock-api-mockito2<\/artifactId>"],"delete":["28","      <artifactId>powermock-api-mockito<\/artifactId>"]}],"cli\/src\/test\/java\/hudson\/cli\/PrivateKeyProviderTest.java":[{"add":["116","            @Override","117","            public boolean matches(Iterable<KeyPair> actual) {"],"delete":["115","            @Override public void describeTo(Description description) {","116","                description.appendText(Arrays.asList(expected).toString());","117","            }","119","            @Override public boolean matches(Object argument) {","120","                if (!(argument instanceof Iterable)) throw new IllegalArgumentException(\"Not an instance of Iterrable\");","121","","122","                @SuppressWarnings(\"unchecked\")","123","                final Iterable<KeyPair> actual = (Iterable<KeyPair>) argument;"]}],"pom.xml":[{"add":["153","        <version>2.22.0<\/version>","159","        <version>2.0.0-beta.5<\/version>","163","        <artifactId>powermock-api-mockito2<\/artifactId>","164","        <version>2.0.0-beta.5<\/version>"],"delete":["153","        <version>1.10.19<\/version>","159","        <version>1.6.6<\/version>","163","        <artifactId>powermock-api-mockito<\/artifactId>","164","        <version>1.6.6<\/version>"]}]}},"8896a3af36b930c1b29f99b9800358558fad85b2":{"changes":{"core\/src\/main\/java\/hudson\/scm\/CVSSCM.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/scm\/CVSSCM.java":[{"add":["1165","            Pattern.compile(\":(ext|extssh|pserver):[^@:]+(:[^@:]+)?@[^:]+:(\\\\d+:)?.+\");"],"delete":["1165","            Pattern.compile(\":(ext|pserver):[^@:]+(:[^@:]+)?@[^:]+:(\\\\d+:)?.+\");"]}]}},"12031d7d59409186c8c36ac791736e475a883dc2":{"changes":{"war\/src\/main\/js\/templates\/firstUserPanel.hbs":"MODIFY","core\/src\/main\/java\/hudson\/security\/HudsonPrivateSecurityRealm.java":"MODIFY","war\/src\/main\/js\/pluginSetupWizardGui.js":"MODIFY","core\/src\/main\/java\/jenkins\/install\/SetupWizard.java":"MODIFY","core\/src\/main\/java\/hudson\/security\/AccountCreationFailedException.java":"ADD"},"diff":{"war\/src\/main\/js\/templates\/firstUserPanel.hbs":[{"add":["5","\t\t<iframe src=\"{{baseUrl}}\/setupWizard\/setupWizardFirstUser\" id=\"setup-first-user\"><\/iframe>"],"delete":["5","\t\t<iframe src=\"{{baseUrl}}\/setupWizard\/setupWizardFirstUser\"><\/iframe>"]}],"core\/src\/main\/java\/hudson\/security\/HudsonPrivateSecurityRealm.java":[{"add":["292","     * Creates a user account. Intended to be called from the setup wizard.","293","     * Note that this method does not check whether it is actually called from","294","     * the setup wizard. This requires the {@link Jenkins#ADMINISTER} permission.","295","     *","296","     * @param req the request to retrieve input data from","297","     * @return the created user account, never null","298","     * @throws AccountCreationFailedException if account creation failed due to invalid form input","299","     *\/","300","    @Restricted(NoExternalUse.class)","301","    public User createAccountFromSetupWizard(StaplerRequest req) throws IOException, AccountCreationFailedException {","302","        checkPermission(Jenkins.ADMINISTER);","303","        SignupInfo si = validateAccountCreationForm(req, false);","304","        if (si.errorMessage != null) {","305","            throw new AccountCreationFailedException(si.errorMessage);","306","        } else {","307","            return createAccount(si);","308","        }","309","    }","310","","311","    \/**","343","     * @param req the request to get the form data from (is also used for redirection)","344","     * @param rsp the response to use for forwarding if the creation fails","345","     * @param validateCaptcha whether to attempt to validate a captcha in the request","346","     * @param formView the view to redirect to if creation fails","347","     *","352","    private User createAccount(StaplerRequest req, StaplerResponse rsp, boolean validateCaptcha, String formView) throws ServletException, IOException {","353","        SignupInfo si = validateAccountCreationForm(req, validateCaptcha);","354","","355","        if (si.errorMessage != null) {","356","            \/\/ failed. ask the user to try again.","357","            req.getView(this, formView).forward(req, rsp);","358","            return null;","359","        }","360","","361","        return createAccount(si);","362","    }","363","","364","    \/**","365","     * @param req              the request to process","366","     * @param validateCaptcha  whether to attempt to validate a captcha in the request","367","     *","368","     * @return a {@link SignupInfo#SignupInfo(StaplerRequest) SignupInfo from given request}, with {@link","369","     * SignupInfo#errorMessage} set to a non-null value if any of the supported fields are invalid","370","     *\/","371","    private SignupInfo validateAccountCreationForm(StaplerRequest req, boolean validateCaptcha) {","376","        if (validateCaptcha && !validateCaptcha(si.captcha)) {","378","        }","380","        if (si.password1 != null && !si.password1.equals(si.password2)) {","382","        }","384","        if (!(si.password1 != null && si.password1.length() != 0)) {","386","        }","388","        if (si.username == null || si.username.length() == 0) {","390","        } else {","392","            User user = User.getById(si.username, false);","399","        if (si.fullname == null || si.fullname.length() == 0) {","401","        }","403","        if (isMailerPluginPresent() && (si.email == null || !si.email.contains(\"@\"))) {","405","        }","407","        if (!User.isIdOrFullnameAllowed(si.username)) {","411","        if (!User.isIdOrFullnameAllowed(si.fullname)) {","414","        req.setAttribute(\"data\", si); \/\/ for error messages in the view","415","        return si;","416","    }","418","    \/**","419","     * Creates a new account from a valid signup info. A signup info is valid if its {@link SignupInfo#errorMessage}","420","     * field is null.","421","     *","422","     * @param si the valid signup info to create an account from","423","     * @return a valid {@link User} object created from given signup info","424","     * @throws IllegalArgumentException if an invalid signup info is passed","425","     *\/","426","    private User createAccount(SignupInfo si) throws IOException {","427","        if (si.errorMessage != null) {","428","            throw new IllegalArgumentException(\"invalid signup info passed to createAccount(si): \" + si.errorMessage);","431","        User user = createAccount(si.username, si.password1);","433","        if (isMailerPluginPresent()) {","438","                user.addProperty((UserProperty) c.newInstance(si.email));","446",""],"delete":["327","    private User createAccount(StaplerRequest req, StaplerResponse rsp, boolean selfRegistration, String formView) throws ServletException, IOException {","332","        if(selfRegistration && !validateCaptcha(si.captcha))","335","        if(si.password1 != null && !si.password1.equals(si.password2))","338","        if(!(si.password1 != null && si.password1.length() != 0))","341","        if(si.username==null || si.username.length()==0)","343","        else {","345","            User user = User.getById(si.username, false); ","352","        if(si.fullname==null || si.fullname.length()==0)","355","        if(isMailerPluginPresent() && (si.email==null || !si.email.contains(\"@\")))","358","        if (! User.isIdOrFullnameAllowed(si.username)) {","362","        if (! User.isIdOrFullnameAllowed(si.fullname)) {","366","        if(si.errorMessage!=null) {","367","            \/\/ failed. ask the user to try again.","368","            req.setAttribute(\"data\",si);","369","            req.getView(this, formView).forward(req,rsp);","370","            return null;","372","","374","        User user = createAccount(si.username,si.password1);","376","        if(isMailerPluginPresent()) {","381","                user.addProperty((UserProperty)c.newInstance(si.email));","389","    "]}],"war\/src\/main\/js\/pluginSetupWizardGui.js":[{"add":["874","","875","\tvar handleFirstUserResponseSuccess = function (data) {","876","\t\tif (data.status === 'ok') {","878","\t\t} else {","879","\t\t\tsetPanel(errorPanel, {errorMessage: 'Error trying to create first user: ' + data.statusText});","882","","883","\tvar handleFirstUserResponseError = function(res) {","884","\t\t\/\/ We're expecting a full HTML page to replace the form","885","\t\t\/\/ We can only replace the _whole_ iframe due to XSS rules","886","\t\t\/\/ https:\/\/stackoverflow.com\/a\/22913801\/1117552","887","\t\tvar responseText = res.responseText;","888","\t\tvar $page = $(responseText);","889","\t\tvar $main = $page.find('#main-panel').detach();","890","\t\tif($main.length > 0) {","891","\t\t\tresponseText = responseText.replace(\/body([^>]*)[>](.|[\\r\\n])+[<][\/]body\/,'body$1>'+$main.html()+'<\/body');","892","\t\t}","893","\t\tvar doc = $('iframe#setup-first-user').contents()[0];","894","\t\tdoc.open();","895","\t\tdoc.write(responseText);","896","\t\tdoc.close();","897","\t\t$('button').prop({disabled:false});","898","\t};","903","\t\tvar $form = $('iframe#setup-first-user').contents().find('form:not(.no-json)');","904","\t\tsecurityConfig.saveFirstUser($form, handleFirstUserResponseSuccess, handleFirstUserResponseError);"],"delete":["874","\t","875","\tvar handleStaplerSubmit = function(data) {","876","\t\tif(data.status && data.status > 200) {","877","\t\t\t\/\/ Nothing we can really do here","878","\t\t\tsetPanel(errorPanel, { errorMessage: data.statusText });","879","\t\t\treturn;","880","\t\t}","881","\t\t","882","\t\ttry {","883","\t\t\tif(JSON.parse(data).status === 'ok') {","884","\t\t\t\tshowStatePanel();","885","\t\t\t\treturn;","886","\t\t\t}","887","\t\t} catch(e) {","888","\t\t\t\/\/ ignore JSON parsing issues, this may be HTML","889","\t\t}","890","\t\t\/\/ we get 200 OK","891","\t\tvar responseText = data.responseText;","892","\t\tvar $page = $(responseText);","893","\t\tvar $errors = $page.find('.error');","894","\t\tif($errors.length > 0) {","895","\t\t\tvar $main = $page.find('#main-panel').detach();","896","\t\t\tif($main.length > 0) {","897","\t\t\t\tresponseText = responseText.replace(\/body([^>]*)[>](.|[\\r\\n])+[<][\/]body\/,'body$1>'+$main.html()+'<\/body');","898","\t\t\t}","899","\t\t\tvar doc = $('iframe[src]').contents()[0];","900","\t\t\tdoc.open();","901","\t\t\tdoc.write(responseText);","902","\t\t\tdoc.close();","903","\t\t}","904","\t\telse {","912","\t\tsecurityConfig.saveFirstUser($('iframe[src]').contents().find('form:not(.no-json)'), handleStaplerSubmit, handleStaplerSubmit);"]}],"core\/src\/main\/java\/jenkins\/install\/SetupWizard.java":[{"add":["41","import hudson.security.AccountCreationFailedException;","243","    @Restricted(NoExternalUse.class)","244","    public HttpResponse doCreateAdminUser(StaplerRequest req, StaplerResponse rsp) throws IOException {","247","","249","        HudsonPrivateSecurityRealm securityRealm = (HudsonPrivateSecurityRealm) j.getSecurityRealm();","250","","253","            if (admin != null) {","256","","257","            User newUser = securityRealm.createAccountFromSetupWizard(req);","258","            if (admin != null) {","259","                admin = null;","261","","262","            \/\/ Success! Delete the temporary password file:","263","            try {","264","                getInitialAdminPasswordFile().delete();","265","            } catch (InterruptedException e) {","266","                throw new IOException(e);","267","            }","268","","269","            InstallUtil.proceedToNextStateFrom(InstallState.CREATE_ADMIN_USER);","270","","271","            \/\/ ... and then login","272","            Authentication auth = new UsernamePasswordAuthenticationToken(newUser.getId(), req.getParameter(\"password1\"));","273","            auth = securityRealm.getSecurityComponents().manager.authenticate(auth);","274","            SecurityContextHolder.getContext().setAuthentication(auth);","275","            CrumbIssuer crumbIssuer = Jenkins.getInstance().getCrumbIssuer();","276","            JSONObject data = new JSONObject();","277","            if (crumbIssuer != null) {","278","                data.accumulate(\"crumbRequestField\", crumbIssuer.getCrumbRequestField()).accumulate(\"crumb\", crumbIssuer.getCrumb(req));","279","            }","280","            return HttpResponses.okJSON(data);","281","        } catch (AccountCreationFailedException e) {","282","            \/*","283","            Return Unprocessable Entity from WebDAV. While this is not technically in the HTTP\/1.1 standard, browsers","284","            seem to accept this. 400 Bad Request is technically inappropriate because that implies invalid *syntax*,","285","            not incorrect data. The client only cares about it being >200 anyways.","286","             *\/","287","            rsp.setStatus(422);","288","            return HttpResponses.forwardToView(securityRealm, \"\/jenkins\/install\/SetupWizard\/setupWizardFirstUser.jelly\");","290","            if (admin != null) {"],"delete":["242","    public HttpResponse doCreateAdminUser(StaplerRequest req, StaplerResponse rsp) throws IOException, ServletException {","245","        ","247","        HudsonPrivateSecurityRealm securityRealm = (HudsonPrivateSecurityRealm)j.getSecurityRealm();","248","        ","251","            if(admin != null) {","254","            ","255","            User u = securityRealm.createAccountByAdmin(req, rsp, \"\/jenkins\/install\/SetupWizard\/setupWizardFirstUser.jelly\", null);","256","            if (u != null) {","257","                if(admin != null) {","258","                    admin = null;","259","                }","260","                ","261","                \/\/ Success! Delete the temporary password file:","262","                try {","263","                    getInitialAdminPasswordFile().delete();","264","                } catch (InterruptedException e) {","265","                    throw new IOException(e);","266","                }","267","                ","268","                InstallUtil.proceedToNextStateFrom(InstallState.CREATE_ADMIN_USER);","269","                ","270","                \/\/ ... and then login","271","                Authentication a = new UsernamePasswordAuthenticationToken(u.getId(),req.getParameter(\"password1\"));","272","                a = securityRealm.getSecurityComponents().manager.authenticate(a);","273","                SecurityContextHolder.getContext().setAuthentication(a);","274","                CrumbIssuer crumbIssuer = Jenkins.getInstance().getCrumbIssuer();","275","                JSONObject data = new JSONObject();","276","                if (crumbIssuer != null) {","277","                    data.accumulate(\"crumbRequestField\", crumbIssuer.getCrumbRequestField()).accumulate(\"crumb\", crumbIssuer.getCrumb(req));","278","                }","279","                return HttpResponses.okJSON(data);","280","            } else {","281","                return HttpResponses.okJSON();","284","            if(admin != null) {"]}],"core\/src\/main\/java\/hudson\/security\/AccountCreationFailedException.java":[{"add":[],"delete":[]}]}},"c31392d1401a45e8e9df4b91b2445cb4b1901f4d":{"changes":{"core\/src\/main\/resources\/hudson\/model\/PasswordParameterDefinition\/index.jelly":"MODIFY","core\/src\/main\/java\/hudson\/Functions.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/PasswordParameterDefinition.java":"MODIFY","test\/src\/test\/java\/hudson\/model\/PasswordParameterDefinitionTest.java":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/model\/PasswordParameterDefinition\/index.jelly":[{"add":["31","\t\t\t<f:password name=\"value\" value=\"${it.DEFAULT_VALUE}\"\/>"],"delete":["31","\t\t\t<f:password name=\"value\" value=\"${it.defaultValueAsSecret}\" \/>"]}],"core\/src\/main\/java\/hudson\/Functions.java":[{"add":["156","import hudson.model.PasswordParameterDefinition;","1782","        if (getIsUnitTest() && !o.equals(PasswordParameterDefinition.DEFAULT_VALUE)) {"],"delete":["1781","        if (getIsUnitTest()) {"]}],"core\/src\/main\/java\/hudson\/model\/PasswordParameterDefinition.java":[{"add":["33","import org.kohsuke.accmod.restrictions.NoExternalUse;","43","    @Restricted(NoExternalUse.class)","44","    public static final String DEFAULT_VALUE = \"<DEFAULT>\";","45","","72","        if (value.getValue().getPlainText().equals(DEFAULT_VALUE)) {","73","            value = new PasswordParameterValue(getName(), getDefaultValue());","74","        }"],"delete":[]}],"test\/src\/test\/java\/hudson\/model\/PasswordParameterDefinitionTest.java":[{"add":["26","import com.gargoylesoftware.htmlunit.html.HtmlForm;","27","import com.gargoylesoftware.htmlunit.html.HtmlPasswordInput;","28","import hudson.Launcher;","29","import java.io.IOException;","30","import jenkins.model.Jenkins;","34","import org.jvnet.hudson.test.Issue;","36","import org.jvnet.hudson.test.MockAuthorizationStrategy;","37","import org.jvnet.hudson.test.TestBuilder;","50","    @Issue(\"JENKINS-36476\")","51","    @Test public void defaultValueAlwaysAvailable() throws Exception {","52","        j.jenkins.setSecurityRealm(j.createDummySecurityRealm());","53","        j.jenkins.setAuthorizationStrategy(new MockAuthorizationStrategy().","54","            grant(Jenkins.ADMINISTER).everywhere().to(\"admin\").","55","            grant(Jenkins.READ, Item.READ, Item.BUILD).everywhere().to(\"dev\"));","56","        FreeStyleProject p = j.createFreeStyleProject();","57","        p.addProperty(new ParametersDefinitionProperty(new PasswordParameterDefinition(\"secret\", \"s3cr3t\", \"\")));","58","        p.getBuildersList().add(new TestBuilder() {","59","            @Override public boolean perform(AbstractBuild<?, ?> build, Launcher launcher, BuildListener listener) throws InterruptedException, IOException {","60","                listener.getLogger().println(\"I heard about a \" + build.getEnvironment(listener).get(\"secret\") + \"!\");","61","                return true;","62","            }","63","        });","64","        JenkinsRule.WebClient wc = j.createWebClient();","65","        wc.getOptions().setThrowExceptionOnFailingStatusCode(false); \/\/ ParametersDefinitionProperty\/index.jelly sends a 405 but really it is OK","66","        \/\/ Control case: admin can use default value.","67","        j.submit(wc.login(\"admin\").getPage(p, \"build?delay=0sec\").getFormByName(\"parameters\"));","68","        j.waitUntilNoActivity();","69","        FreeStyleBuild b1 = p.getLastBuild();","70","        assertEquals(1, b1.getNumber());","71","        j.assertLogContains(\"I heard about a s3cr3t!\", j.assertBuildStatusSuccess(b1));","72","        \/\/ Another control case: anyone can enter a different value.","73","        HtmlForm form = wc.login(\"dev\").getPage(p, \"build?delay=0sec\").getFormByName(\"parameters\");","74","        HtmlPasswordInput input = form.getInputByName(\"value\");","75","        input.setText(\"rumor\");","76","        j.submit(form);","77","        j.waitUntilNoActivity();","78","        FreeStyleBuild b2 = p.getLastBuild();","79","        assertEquals(2, b2.getNumber());","80","        j.assertLogContains(\"I heard about a rumor!\", j.assertBuildStatusSuccess(b2));","81","        \/\/ Test case: anyone can use default value.","82","        j.submit(wc.login(\"dev\").getPage(p, \"build?delay=0sec\").getFormByName(\"parameters\"));","83","        j.waitUntilNoActivity();","84","        FreeStyleBuild b3 = p.getLastBuild();","85","        assertEquals(3, b3.getNumber());","86","        j.assertLogContains(\"I heard about a s3cr3t!\", j.assertBuildStatusSuccess(b3));","87","        \/\/ Another control case: blank values.","88","        form = wc.login(\"dev\").getPage(p, \"build?delay=0sec\").getFormByName(\"parameters\");","89","        input = form.getInputByName(\"value\");","90","        input.setText(\"\");","91","        j.submit(form);","92","        j.waitUntilNoActivity();","93","        FreeStyleBuild b4 = p.getLastBuild();","94","        assertEquals(4, b4.getNumber());","95","        j.assertLogContains(\"I heard about a !\", j.assertBuildStatusSuccess(b4));","96","    }","97",""],"delete":[]}]}},"0763be652a20dc0dce9a833675d6f54e8ca3f784":{"changes":{"core\/src\/main\/java\/hudson\/search\/FixedSet.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/search\/FixedSet.java":[{"add":["52","            if (name != null && (name.equals(token) || (caseInsensitive && name.equalsIgnoreCase(token)))) {","62","            if (name != null && (name.contains(token) || (caseInsensitive && StringUtils.containsIgnoreCase(name, token)))) {"],"delete":["52","            if (name.equals(token) || (caseInsensitive && name.equalsIgnoreCase(token))) {","62","            if (name.contains(token) || (caseInsensitive && StringUtils.containsIgnoreCase(name, token))) {"]}]}},"92496f99e4c941de9d7dab628466cadcde70d808":{"changes":{"changelog.html":"MODIFY","cli\/src\/main\/java\/hudson\/cli\/CLI.java":"MODIFY"},"diff":{"changelog.html":[{"add":["57","  <li class=bug>","58","  java.io.IOException: Unexpected termination of the channel - SEVERE: I\/O error in channel Chunked connection when using jenkins-cli.jar (works on older Hudson version)","59","  (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-11130\">issue 11130<\/a>)"],"delete":[]}],"cli\/src\/main\/java\/hudson\/cli\/CLI.java":[{"add":["124","        new PingThread(ch,15*1000) {"],"delete":["124","        new PingThread(ch,30*1000) {"]}]}},"12e9a55c39b0e8db47578fbc9f7ff87cf25fca93":{"changes":{"core\/src\/main\/java\/hudson\/model\/Job.java":"MODIFY","maven-plugin\/src\/main\/java\/hudson\/maven\/MavenModuleSet.java":"MODIFY","maven-plugin\/src\/main\/java\/hudson\/maven\/MavenModuleSetBuild.java":"MODIFY","test\/src\/test\/java\/hudson\/model\/SimpleJobTest.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/Result.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/Job.java":[{"add":["28","","70","","91","","903","    \/**","904","     * Returns candidate build for calculating the estimated duration of the current run.","905","     * ","906","     * Returns the 3 last successful (stable or unstable) builds, if there are any.","907","     * Failing to find 3 of those, it will return up to 3 last unsuccessful builds.","908","     * ","909","     * In any case it will not go more than 6 builds into the past to avoid costly build loading.","910","     *\/","911","    @SuppressWarnings(\"unchecked\")","912","    protected List<RunT> getEstimatedDurationCandidates() {","913","        List<RunT> candidates = new ArrayList<RunT>(3);","914","        RunT lastSuccessful = (RunT) Permalink.LAST_SUCCESSFUL_BUILD.resolve(this);","915","        int lastSuccessfulNumber = -1;","916","        if (lastSuccessful != null) {","917","            candidates.add(lastSuccessful);","918","            lastSuccessfulNumber = lastSuccessful.getNumber();","919","        }","920","","921","        int i = 0;","922","        RunT r = (RunT) Permalink.LAST_BUILD.resolve(this);","923","        List<RunT> fallbackCandidates = new ArrayList<RunT>(3);","924","        while (r != null && candidates.size() < 3 && i < 6) {","925","            if (!r.isBuilding() && r.getResult() != null && r.getNumber() != lastSuccessfulNumber) {","926","                Result result = r.getResult();","927","                if (result.isBetterOrEqualTo(Result.UNSTABLE)) {","928","                    candidates.add(r);","929","                } else if (result.isCompleteBuild()) {","930","                    fallbackCandidates.add(r);","931","                }","932","            }","933","            i++;","934","            r = r.getPreviousBuild();","935","        }","936","        ","937","        while (candidates.size() < 3) {","938","            if (fallbackCandidates.isEmpty())","939","                break;","940","            RunT run = fallbackCandidates.remove(0);","941","            candidates.add(run);","942","        }","943","        ","944","        return candidates;","945","    }","946","    ","948","        List<RunT> builds = getEstimatedDurationCandidates();"],"delete":["901","        List<RunT> builds = getLastBuildsOverThreshold(3, Result.UNSTABLE);"]}],"maven-plugin\/src\/main\/java\/hudson\/maven\/MavenModuleSet.java":[{"add":["1114","    ","1115","    @Override","1116","    protected List<MavenModuleSetBuild> getEstimatedDurationCandidates() {","1117","        return super.getEstimatedDurationCandidates();","1118","    }"],"delete":[]}],"maven-plugin\/src\/main\/java\/hudson\/maven\/MavenModuleSetBuild.java":[{"add":["335","        List<MavenModuleSetBuild> moduleSetBuilds = getParent().getEstimatedDurationCandidates();"],"delete":["335","        List<MavenModuleSetBuild> moduleSetBuilds = getPreviousBuildsOverThreshold(numberOfBuilds, Result.UNSTABLE);"]}],"test\/src\/test\/java\/hudson\/model\/SimpleJobTest.java":[{"add":["6","import org.junit.Assert;","7","import org.junit.Rule;","8","import org.junit.Test;","9","import org.jvnet.hudson.test.JenkinsRule;","15","public class SimpleJobTest {","17","    @Rule","18","    public JenkinsRule rule = new JenkinsRule();","19","    ","20","    @Test","36","        \/\/ without assuming to know too much about the internal calculation","38","        Assert.assertTrue(\"Expected < 42, but was \"+project.getEstimatedDuration(), project.getEstimatedDuration() < 42);","39","        Assert.assertTrue(\"Expected > 15, but was \"+project.getEstimatedDuration(), project.getEstimatedDuration() > 15);","42","    @Test","67","    @Test","77","    @Test","84","        TestBuild prev5Build = new TestBuild(project, Result.UNSTABLE, 1, null);","85","        runs.put(6, prev5Build);","86","        ","87","        TestBuild prev4Build = new TestBuild(project, Result.SUCCESS, 1, prev5Build);","102","        \/\/ failed builds must not be used, if there are succesfulBuilds available.","103","        Assert.assertEquals(1, project.getEstimatedDuration());","104","    }","105","    ","106","    @Test","107","    public void testGetEstimatedDurationIfNoSuccessfulBuildTakeDurationOfFailedBuild() throws IOException {","108","        ","109","        final SortedMap<Integer, TestBuild> runs = new TreeMap<Integer, TestBuild>();","110","        ","111","        Job project = createMockProject(runs);","112","        ","113","        TestBuild lastBuild = new TestBuild(project, Result.FAILURE, 50, null);","114","        runs.put(1, lastBuild);","115","","116","        Assert.assertEquals(50, project.getEstimatedDuration());","150","    @SuppressWarnings(\"unchecked\")","157","            super(rule.jenkins, \"name\");"],"delete":["6","import junit.framework.Assert;","7","import org.jvnet.hudson.test.HudsonTestCase;","13","public class SimpleJobTest extends HudsonTestCase {","30","        \/\/ without assuming to know to much about the internal calculation","32","        Assert.assertTrue(project.getEstimatedDuration() < 42);","33","        Assert.assertTrue(project.getEstimatedDuration() > 15);","75","        TestBuild prev4Build = new TestBuild(project, Result.SUCCESS, 1, null);","90","        \/\/ failed builds must not be used. Instead the last successful builds before them","91","        \/\/ must be used","92","        Assert.assertEquals(project.getEstimatedDuration(), 1);","132","            super(SimpleJobTest.this.jenkins, \"name\");"]}],"core\/src\/main\/java\/hudson\/model\/Result.java":[{"add":["50","    public static final Result SUCCESS = new Result(\"SUCCESS\",BallColor.BLUE,0,true);","55","    public static final Result UNSTABLE = new Result(\"UNSTABLE\",BallColor.YELLOW,1,true);","59","    public static final Result FAILURE = new Result(\"FAILURE\",BallColor.RED,2,true);","66","    public static final Result NOT_BUILT = new Result(\"NOT_BUILT\",BallColor.NOTBUILT,3,false);","73","    public static final Result ABORTED = new Result(\"ABORTED\",BallColor.ABORTED,4,false);","86","    ","87","    \/**","88","     * Is this a complete build - i.e. did it run to the end (not aborted)?","89","     *\/","90","    public final boolean completeBuild;","92","    private Result(String name, BallColor color, int ordinal, boolean complete) {","96","        this.completeBuild = complete;","124","    ","125","    \/**","126","     * Is this a complete build - i.e. did it run to the end (not aborted)?","127","     * ","128","     * @since TODO","129","     *\/","130","    public boolean isCompleteBuild() {","131","        return this.completeBuild;","132","    }"],"delete":["50","    public static final Result SUCCESS = new Result(\"SUCCESS\",BallColor.BLUE,0);","55","    public static final Result UNSTABLE = new Result(\"UNSTABLE\",BallColor.YELLOW,1);","59","    public static final Result FAILURE = new Result(\"FAILURE\",BallColor.RED,2);","66","    public static final Result NOT_BUILT = new Result(\"NOT_BUILT\",BallColor.NOTBUILT,3);","73","    public static final Result ABORTED = new Result(\"ABORTED\",BallColor.ABORTED,4);","87","    private Result(String name, BallColor color, int ordinal) {"]}]}},"7c23884c5979c9bebb4bbb7bfa64726bd05c163b":{"changes":{"core\/src\/main\/java\/hudson\/Functions.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/Functions.java":[{"add":["1381","        if (s == null) return null;"],"delete":[]}]}},"25f0b30611d88a4dcb6ec375b74f1a3f88c12194":{"changes":{"maven-plugin\/src\/main\/java\/hudson\/maven\/AbstractMavenBuild.java":"MODIFY","maven-plugin\/src\/main\/java\/hudson\/maven\/AbstractMavenProject.java":"MODIFY"},"diff":{"maven-plugin\/src\/main\/java\/hudson\/maven\/AbstractMavenBuild.java":[{"add":["83","                    listener.getLogger().println(\" -> No, because downstream is already in queue\");\r","85","            } \r","86","            \/\/ Check to see if any of its upstream dependencies are already building or in queue.\r","87","            else if (areUpstreamsBuilding(down, getParent())) {\r","88","                if(debug)\r","89","                    listener.getLogger().println(\" -> No, because downstream has dependencies already building or in queue\");\r","90","                trigger = false;\r","91","            }\r","92","            \/\/ Check to see if any of its upstream dependencies are in this list of downstream projects.\r","93","            else if (inDownstreamProjects(down)) {\r","94","                if(debug)\r","95","                    listener.getLogger().println(\" -> No, because downstream has dependencies in the downstream projects list\");\r","96","                trigger = false;\r","97","            }\r","98","            else {\r","138","\r","139","    private boolean inDownstreamProjects(AbstractProject downstreamProject) {\r","140","        DependencyGraph graph = Hudson.getInstance().getDependencyGraph();\r","141","        Set<AbstractProject> tups = graph.getTransitiveUpstream(downstreamProject);\r","142","        \r","143","        for (AbstractProject tup : tups) {\r","144","            for (AbstractProject<?,?> dp : getParent().getDownstreamProjects()) {\r","145","                if(dp!=getParent() && dp!=downstreamProject && dp==tup) \r","146","                    return true;\r","147","            }\r","148","        }\r","149","        return false;\r","150","    }\r","151","\r","152","\r","153","   \/**\r","154","     * Determines whether any of the upstream project are either\r","155","     * building or in the queue.\r","156","     *\r","159","     *\r","160","     * @param downstreamProject\r","161","     *      The AbstractProject we want to build.\r","162","     * @param excludeProject\r","163","     *      An AbstractProject to exclude - if we see this in the transitive\r","164","     *      dependencies, we're not going to bother checking to see if it's\r","165","     *      building. For example, pass the current parent project to be sure\r","166","     *      that it will be ignored when looking for building dependencies.\r","167","     * @return\r","168","     *      True if any upstream projects are building or in queue, false otherwise.\r","170","    private boolean areUpstreamsBuilding(AbstractProject downstreamProject,\r","171","                                                   AbstractProject excludeProject) {\r","172","        DependencyGraph graph = Hudson.getInstance().getDependencyGraph();\r","173","        Set<AbstractProject> tups = graph.getTransitiveUpstream(downstreamProject);\r","175","            if(tup!=excludeProject && (tup.isBuilding() || tup.isInQueue()))\r","176","                return true;\r","178","        return false;\r"],"delete":["73","        DependencyGraph graph = Hudson.getInstance().getDependencyGraph();\r","75","            \r","85","                    listener.getLogger().println(\" -> No, because dependency is already in queue\");\r","87","            } else {\r","127","    \/**\r","128","     * Returns the project if any of the upstream project (or itself) is either\r","129","     * building or is in the queue.\r","130","     * <p>\r","134","    private AbstractProject getBuildingUpstream(DependencyGraph graph, AbstractProject project) {\r","135","        Set<AbstractProject> tups = graph.getTransitiveUpstream(project);\r","136","        tups.add(project);\r","138","            if(tup!=getProject() && (tup.isBuilding() || tup.isInQueue()))\r","139","                return tup;\r","141","        return null;\r"]}],"maven-plugin\/src\/main\/java\/hudson\/maven\/AbstractMavenProject.java":[{"add":[],"delete":["90","            DependencyGraph graph = Hudson.getInstance().getDependencyGraph();"]}]}},"a00166bfd58ac0e8fec1ae2b0733f12d11f75d7f":{"changes":{"core\/src\/main\/java\/hudson\/model\/View.java":"MODIFY","core\/src\/main\/resources\/hudson\/model\/View\/configure.jelly":"MODIFY","test\/src\/test\/java\/hudson\/model\/ViewDescriptorTest.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/View.java":[{"add":["324","     * Returns all the {@link ViewPropertyDescriptor}s that can be potentially configured","325","     * on this view. Returns both {@link ViewPropertyDescriptor}s visible and invisible for user, see","326","     * {@link View#getVisiblePropertyDescriptors} to filter invisible one.","337","    \/**","338","     * @return all the {@link ViewPropertyDescriptor}s that can be potentially configured on this View and are visible","339","     * for the user. Use {@link DescriptorVisibilityFilter} to make a View property invisible for users.","340","     * @since 2.214","341","     *\/","342","    public List<ViewPropertyDescriptor> getVisiblePropertyDescriptors() {","343","        return DescriptorVisibilityFilter.apply(this, getApplicablePropertyDescriptors());","344","    }","345",""],"delete":["324","     * Returns all the {@link LabelAtomPropertyDescriptor}s that can be potentially configured","325","     * on this label."]}],"core\/src\/main\/resources\/hudson\/model\/View\/configure.jelly":[{"add":["54","        <f:descriptorList descriptors=\"${it.getVisiblePropertyDescriptors()}\" instances=\"${it.properties}\" \/>"],"delete":["54","        <f:descriptorList descriptors=\"${it.getApplicablePropertyDescriptors()}\" instances=\"${it.properties}\" \/>"]}],"test\/src\/test\/java\/hudson\/model\/ViewDescriptorTest.java":[{"add":["28","import java.util.concurrent.TimeUnit;","29","","30","import com.gargoylesoftware.htmlunit.html.HtmlForm;","31","import com.gargoylesoftware.htmlunit.html.HtmlPage;","32","","35","","36","import org.awaitility.Awaitility;","39","import org.jvnet.hudson.test.Issue;","43","import org.kohsuke.stapler.StaplerRequest;","44","import net.sf.json.JSONObject;","87","","88","    @Test","89","    @Issue(\"JENKINS-60579\")","90","    public void invisiblePropertiesOnViewShoudBePersisted() throws Exception {","91","","92","        \/\/GIVEN a listView that have an invisible property","93","        ListView myListView = new ListView(\"Rock\");","94","        myListView.setRecurse(true);","95","        myListView.setIncludeRegex(\".*\");","96","","97","        CustomInvisibleProperty invisibleProperty = new CustomInvisibleProperty();","98","        invisibleProperty.setSomeProperty(\"You cannot see me.\");","99","        invisibleProperty.setView(myListView);","100","        myListView.getProperties().add(invisibleProperty);","101","","102","        r.jenkins.addView(myListView);","103","","104","        assertEquals(r.jenkins.getView(\"Rock\").getProperties().get(CustomInvisibleProperty.class).getSomeProperty(),","105","                     \"You cannot see me.\");","106","","107","        \/\/WHEN the users goes with \"Edit View\" on the configure page","108","        JenkinsRule.WebClient webClient = r.createWebClient();","109","        HtmlPage editViewPage = webClient.getPage(myListView, \"configure\");","110","","111","        \/\/THEN the invisible property is not displayed on page","112","        assertFalse(\"CustomInvisibleProperty should not be displayed on the View edition page UI.\",","113","                    editViewPage.asText().contains(\"CustomInvisibleProperty\"));","114","","115","","116","        HtmlForm editViewForm = editViewPage.getFormByName(\"viewConfig\");","117","        editViewForm.getTextAreaByName(\"description\").type(\"This list view is awesome !\");","118","        r.submit(editViewForm);","119","","120","        \/\/Check that the description is updated on view","121","        Awaitility.waitAtMost(3, TimeUnit.SECONDS).until(() -> webClient.getPage(myListView)","122","                                                                        .asText()","123","                                                                        .contains(\"This list view is awesome !\"));","124","","125","","126","        \/\/AND THEN after View save, the invisible property is still persisted with the View.","127","        assertNotNull(\"The CustomInvisibleProperty should be persisted on the View.\",","128","                      r.jenkins.getView(\"Rock\").getProperties().get(CustomInvisibleProperty.class));","129","        assertEquals(r.jenkins.getView(\"Rock\").getProperties().get(CustomInvisibleProperty.class).getSomeProperty(),","130","                     \"You cannot see me.\");","131","","132","    }","133","","134","    private static class CustomInvisibleProperty extends ViewProperty {","135","","136","        private String someProperty;","137","","138","        public void setSomeProperty(String someProperty) {","139","            this.someProperty = someProperty;","140","        }","141","","142","        public String getSomeProperty() {","143","            return this.someProperty;","144","        }","145","","146","        public CustomInvisibleProperty() {","147","            this.someProperty = \"undefined\";","148","        }","149","","150","        @Override","151","        public ViewProperty reconfigure(StaplerRequest req, JSONObject form) {","152","            return this;","153","        }","154","","155","        @TestExtension","156","        public static final class CustomInvisibleDescriptorImpl extends ViewPropertyDescriptor {","157","","158","            @Override","159","            public String getId() {","160","                return \"CustomInvisibleDescriptorImpl\";","161","            }","162","","163","            @Override","164","            public boolean isEnabledFor(View view) {","165","                return true;","166","            }","167","        }","168","","169","        @TestExtension","170","        public static final class CustomInvisibleDescriptorVisibilityFilterImpl extends DescriptorVisibilityFilter {","171","","172","            @Override","173","            public boolean filter(Object context, Descriptor descriptor) {","174","                return false;","175","            }","176","        }","177","    }","178",""],"delete":[]}]}},"9769092ee0980fc78cf69d0c2cac067e0807c080":{"changes":{"core\/src\/main\/java\/hudson\/ProxyConfiguration.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/ProxyConfiguration.java":[{"add":["398","                method.getParams().setParameter(\"http.socket.timeout\", DEFAULT_CONNECT_TIMEOUT_MILLIS > 0 ? DEFAULT_CONNECT_TIMEOUT_MILLIS : (int)TimeUnit.SECONDS.toMillis(30));"],"delete":["398","                method.getParams().setParameter(\"http.socket.timeout\", DEFAULT_CONNECT_TIMEOUT_MILLIS > 0 ? DEFAULT_CONNECT_TIMEOUT_MILLIS : TimeUnit.SECONDS.toMillis(30));"]}]}},"57f34037d217760c8695759eb180d40b8816b0c8":{"changes":{"core\/src\/main\/java\/hudson\/model\/Node.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/Node.java":[{"add":["199","            \/\/ Filter out any bad(null) results from plugins","200","            for (Label label : labeler.findLabels(this))","201","                if (label != null) result.add(label);"],"delete":["199","            result.addAll(labeler.findLabels(this));"]}]}},"39a9b8fe3c00c5d03d1905b6f7087bb5cbf4cacd":{"changes":{"changelog.html":"MODIFY","core\/src\/main\/java\/hudson\/XmlFile.java":"MODIFY"},"diff":{"changelog.html":[{"add":["60","  <li class=bug>","61","    Fixed a file handle leak in <tt>GET config.xml<\/tt> API call","62","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-8042\">issue 8042<\/a>)"],"delete":[]}],"core\/src\/main\/java\/hudson\/XmlFile.java":[{"add":["33","import hudson.util.IOUtils;","36","import org.xml.sax.InputSource;","238","        InputSource input = new InputSource(file.toURI().toASCIIString());","239","        input.setByteStream(new FileInputStream(file));","240","","242","            JAXP.newSAXParser().parse(input,new DefaultHandler() {","282","        } finally {","283","            \/\/ some JAXP implementations appear to leak the file handle if we just call parse(File,DefaultHandler)","284","            input.getByteStream().close();"],"delete":["237","            JAXP.newSAXParser().parse(file,new DefaultHandler() {"]}]}},"568f906964bb3aaa09d6e7d2fb054256b75262cd":{"changes":{"changelog.html":"MODIFY"},"diff":{"changelog.html":[{"add":["70","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-26201\">issue 26201<\/a>)"],"delete":["70","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-23568\">issue 23568<\/a>)"]}]}},"7984e31026a05a2585a149bc6ad55158e0ea6a6b":{"changes":{"remoting\/src\/main\/java\/hudson\/remoting\/jnlp\/Main.java":"MODIFY","remoting\/src\/main\/java\/hudson\/remoting\/Launcher.java":"MODIFY","changelog.html":"MODIFY"},"diff":{"remoting\/src\/main\/java\/hudson\/remoting\/jnlp\/Main.java":[{"add":["25","import hudson.remoting.Launcher;"],"delete":[]}],"remoting\/src\/main\/java\/hudson\/remoting\/Launcher.java":[{"add":["440","    private static String computeVersion() {","449","        return props.getProperty(\"version\", \"?\");","455","    public static final String VERSION = computeVersion();"],"delete":["161","        computeVersion();","441","    private static void computeVersion() {","450","        VERSION = props.getProperty(\"version\", \"?\");","456","    public static String VERSION = \"?\";"]}],"changelog.html":[{"add":["47","  <li class=bug>","48","    Slaves launched by JNLP fail to reprot their version numbers.","49","    (<a href=\"http:\/\/issues.hudson-ci.org\/browse\/HUDSON-8060\">issue 8060<\/a>)"],"delete":[]}]}},"25f6c2cf6d771668fe1caae1c11c82a2b80284e7":{"changes":{"test\/src\/test\/java\/hudson\/model\/UpdateCenterConnectionStatusTest.java":"MODIFY"},"diff":{"test\/src\/test\/java\/hudson\/model\/UpdateCenterConnectionStatusTest.java":[{"add":["69","        Assert.assertEquals(\"Cannot check connection status of the update site with ID='blahblah'. This update center cannot be resolved\", response.getString(\"message\"));"],"delete":["69","        Assert.assertEquals(\"Unknown site 'blahblah'.\", response.getString(\"message\"));"]}]}},"97366bffe3a7235f8bcd9dfdd30412854ea8308e":{"changes":{"core\/src\/main\/java\/hudson\/diagnosis\/ReverseProxySetupMonitor.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/diagnosis\/ReverseProxySetupMonitor.java":[{"add":["76","        if (rest.startsWith(inferred)) { \/\/ not using equals due to JENKINS-24014"],"delete":["76","        if (rest.equals(inferred)) {"]}]}},"6cefcf17a8d92b43b738ec6cd5a2cf298cc1156e":{"changes":{"core\/src\/test\/java\/hudson\/util\/AtomicFileWriterTest.java":"MODIFY"},"diff":{"core\/src\/test\/java\/hudson\/util\/AtomicFileWriterTest.java":[{"add":["4","import org.junit.BeforeClass;","5","import org.junit.ClassRule;","11","import javax.annotation.Nullable;","22","import static org.hamcrest.CoreMatchers.equalTo;","24","import static org.hamcrest.core.StringContains.containsString;","34","    \/**","35","     * Provides access to the default permissions given to a new file. (i.e. indirect way to get umask settings).","36","     * <p><strong>BEWARE: null on non posix systems<\/strong><\/p>","37","     *\/","38","    @Nullable","39","    private static Set<PosixFilePermission> DEFAULT_GIVEN_PERMISSIONS;","40","    @ClassRule","41","    public static TemporaryFolder tmp = new TemporaryFolder();","46","    @BeforeClass","47","    public static void computePermissions() throws IOException {","48","        final File tempDir = tmp.newFolder();","49","        final File newFile = new File(tempDir, \"blah\");","50","        assertThat(newFile.createNewFile(), is(true));","51","        if (!isPosixSupported(newFile)) {","52","            return;","53","        }","54","        DEFAULT_GIVEN_PERMISSIONS = Files.getPosixFilePermissions(newFile.toPath());","55","    }","56","","57","    private static boolean isPosixSupported(File newFile) throws IOException {","58","        \/\/ Check Posix calls are supported (to avoid running this test on Windows for instance)","59","        boolean posixSupported = true;","60","        try {","61","            Files.getPosixFilePermissions(newFile.toPath());","62","        } catch (UnsupportedOperationException e) {","63","            posixSupported = false;","64","        }","65","        return posixSupported;","66","    }","67","","166","    public void checkPermissionsRespectUmask() throws IOException, InterruptedException {","169","        boolean posixSupported = isPosixSupported(newFile);","185","        assertThat(Files.getPosixFilePermissions(filePath), equalTo(DEFAULT_GIVEN_PERMISSIONS));"],"delete":["3","import org.hamcrest.core.StringContains;","5","import org.junit.Ignore;","19","import java.util.EnumSet;","22","import static org.hamcrest.core.StringContains.*;","23","import static java.nio.file.attribute.PosixFilePermission.GROUP_EXECUTE;","24","import static java.nio.file.attribute.PosixFilePermission.GROUP_READ;","25","import static java.nio.file.attribute.PosixFilePermission.GROUP_WRITE;","26","import static java.nio.file.attribute.PosixFilePermission.OTHERS_EXECUTE;","27","import static java.nio.file.attribute.PosixFilePermission.OTHERS_READ;","28","import static java.nio.file.attribute.PosixFilePermission.OTHERS_WRITE;","29","import static java.nio.file.attribute.PosixFilePermission.OWNER_EXECUTE;","30","import static java.nio.file.attribute.PosixFilePermission.OWNER_READ;","31","import static java.nio.file.attribute.PosixFilePermission.OWNER_WRITE;","42","    @Rule","43","    public TemporaryFolder tmp = new TemporaryFolder();","144","    @Ignore \/\/ Need to fix the testing done here, since it assumes umask=002, which is wrong... Including on Kohsuke's release envt :-\\.","147","    public void checkPermissions() throws IOException, InterruptedException {","151","        \/\/ Check Posix calls are supported (to avoid running this test on Windows for instance)","152","        boolean posixSupported = true;","153","        try {","154","            Files.getPosixFilePermissions(newFile.toPath());","155","        } catch (UnsupportedOperationException e) {","156","            posixSupported = false;","157","        }","161","        final Set<PosixFilePermission> givenPermissions = EnumSet.of(OWNER_READ,","162","                                                                     OWNER_WRITE,","163","                                                                     GROUP_READ,","164","                                                                     GROUP_WRITE,","165","                                                                     OTHERS_READ","166","        );","167","","168","        final Set<PosixFilePermission> notGivenPermissions = EnumSet.of(OWNER_EXECUTE,","169","                                                                        GROUP_EXECUTE,","170","                                                                        OTHERS_WRITE,","171","                                                                        OTHERS_EXECUTE);","172","","173","        Files.setPosixFilePermissions(newFile.toPath(), givenPermissions);","185","        final Set<PosixFilePermission> posixFilePermissions = Files.getPosixFilePermissions(filePath);","186","","187","        for (PosixFilePermission perm : givenPermissions) {","188","            assertTrue(\"missing: \" + perm, posixFilePermissions.contains(perm));","189","        }","190","","191","        for (PosixFilePermission perm : notGivenPermissions) {","192","            assertFalse(\"should not be allowed: \" + perm, posixFilePermissions.contains(perm));","193","        }"]}]}},"6a0393997f4464ee9272da8cb17ffda2c50b17c7":{"changes":{"core\/src\/main\/java\/hudson\/model\/View.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/ListView.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/View.java":[{"add":["199","        \/\/ readResolve was the best place to do this, but for compatibility reasons,","200","        \/\/ this class can no longer have readResolve() (the mechanism itself isn't suitable for class hierarchy)","201","        \/\/ see JENKINS-9431","202","        \/\/","203","        \/\/ until we have that, putting this logic here.","204","        synchronized (this) {","205","            if (properties == null) {","206","                properties = new PropertyList(this);","207","            } else {","208","                properties.setOwner(this);","209","            }","210","        }","211","","242","        return getProperties().toList();","643","        getProperties().rebuild(req, req.getSubmittedForm(), getApplicablePropertyDescriptors());"],"delete":["131","    protected Object readResolve() {","132","        if (properties == null) {","133","            properties = new PropertyList(this);","134","        } else {","135","            properties.setOwner(this);","136","        }","137","        return this;","138","    }","139","","238","        return properties.toList();","639","        properties.rebuild(req, req.getSubmittedForm(), getApplicablePropertyDescriptors());"]}],"core\/src\/main\/java\/hudson\/model\/ListView.java":[{"add":["93","    private Object readResolve() {"],"delete":["93","    protected Object readResolve() {","94","        super.readResolve();"]}]}},"89a24abcb0eabc36c7281979d1620c92b6a128a9":{"changes":{"core\/src\/main\/resources\/jenkins\/install\/UpgradeWizard\/client-scripts_lt.properties":"ADD","core\/src\/main\/java\/jenkins\/install\/InstallUtil.java":"MODIFY","core\/src\/main\/resources\/jenkins\/install\/UpgradeWizard\/client-scripts.jelly":"ADD","war\/src\/test\/js\/pluginSetupWizard-spec.js":"MODIFY","test\/src\/test\/java\/jenkins\/util\/SystemPropertiesTest.java":"MODIFY","war\/src\/main\/js\/templates\/upgradePanel.hbs":"ADD","war\/src\/main\/js\/templates\/upgradeSkippedPanel.hbs":"ADD","test\/src\/test\/java\/jenkins\/install\/UpgradeWizardTest.java":"MODIFY","core\/src\/main\/resources\/hudson\/security\/GlobalSecurityConfiguration\/index.groovy":"MODIFY","core\/src\/main\/java\/jenkins\/model\/Jenkins.java":"MODIFY","war\/gulpfile.js":"MODIFY","core\/src\/main\/java\/jenkins\/install\/InstallState.java":"MODIFY","core\/src\/main\/java\/jenkins\/install\/InstallStateFilter.java":"ADD","core\/src\/main\/resources\/jenkins\/install\/SetupWizard\/authenticate-security-token.jelly":"MODIFY","war\/src\/main\/js\/templates\/pluginSelectionPanel.hbs":"MODIFY","core\/src\/main\/resources\/jenkins\/install\/UpgradeWizard\/client-scripts.properties":"ADD","core\/src\/main\/resources\/jenkins\/model\/Jenkins\/login.jelly":"MODIFY","test\/src\/test\/java\/jenkins\/install\/SetupWizardTest.java":"MODIFY","war\/src\/main\/js\/templates\/upgradeSuccessPanel.hbs":"ADD","war\/src\/main\/js\/pluginSetupWizardGui.js":"MODIFY","war\/src\/main\/webapp\/css\/style.css":"MODIFY","war\/src\/main\/less\/pluginSetupWizard.less":"MODIFY","war\/src\/main\/js\/templates\/pluginSelectList.hbs":"ADD","war\/src\/main\/webapp\/WEB-INF\/web.xml":"MODIFY","core\/src\/main\/java\/hudson\/PluginManager.java":"MODIFY","\/dev\/null":"DELETE","war\/src\/main\/js\/util\/jenkins.js":"MODIFY","war\/src\/main\/js\/api\/pluginManager.js":"MODIFY","core\/src\/main\/resources\/jenkins\/install\/SetupWizard\/wizard-ui.jelly":"ADD","core\/src\/main\/resources\/lib\/layout\/html.jelly":"MODIFY","core\/src\/main\/resources\/jenkins\/install\/UpgradeWizard\/client-scripts_fr.properties":"ADD","core\/src\/main\/resources\/jenkins\/install\/SetupWizard\/index.jelly":"MODIFY","core\/src\/main\/resources\/jenkins\/install\/SetupWizard\/footer.jelly":"ADD","core\/src\/main\/resources\/jenkins\/install\/pluginSetupWizard.properties":"MODIFY","war\/src\/main\/js\/upgradeWizard.js":"ADD","core\/src\/main\/java\/jenkins\/install\/SetupWizard.java":"MODIFY","core\/src\/main\/java\/jenkins\/install\/UpgradeWizard.java":"MODIFY","core\/src\/main\/resources\/jenkins\/install\/SetupWizard\/client-scripts.jelly":"ADD","test\/src\/test\/java\/jenkins\/install\/InstallUtilTest.java":"MODIFY","war\/src\/main\/js\/templates\/successPanel.hbs":"MODIFY","core\/src\/main\/resources\/jenkins\/model\/Jenkins\/loginError.jelly":"MODIFY"},"diff":{"core\/src\/main\/resources\/jenkins\/install\/UpgradeWizard\/client-scripts_lt.properties":[{"add":[],"delete":[]}],"core\/src\/main\/java\/jenkins\/install\/InstallUtil.java":[{"add":["30","import java.util.ArrayList;","32","import java.util.Iterator;","39","import javax.inject.Provider;","45","import com.google.common.base.Function;","49","import hudson.Main;","56","import hudson.security.csrf.DefaultCrumbIssuer;","78","     * Simple chain pattern using iterator.next()","80","    private static class ProviderChain<T> implements Provider<T> {","81","        private final Iterator<Function<Provider<T>,T>> functions;","82","        public ProviderChain(Iterator<Function<Provider<T>,T>> functions) {","83","            this.functions = functions;","84","        }","85","        @Override","86","        public T get() {","87","            return functions.next().apply(this);","88","        }","89","    }","90","    ","91","    \/**","92","     * Proceed to the state following the provided one","93","     *\/","94","    public static void proceedToNextStateFrom(InstallState prior) {","95","        InstallState current = Jenkins.getInstance().getInstallState();","96","        if (!current.equals(prior)) {","97","            if (Main.isDevelopmentMode) LOGGER.warning(\"Transitioning state from: \" + prior + \", but current is: \" + current);","98","        }","99","        InstallState next = getNextInstallState(prior);","100","        if (Main.isDevelopmentMode) LOGGER.info(\"Install state tranisitioning from: \" + prior + \" to: \" + next);","101","        if (next != null) {","102","            Jenkins.getInstance().setInstallState(next);","103","        }","104","    }","105","    ","106","    \/**","107","     * Returns the next state during a transition from the current install state","108","     *\/","109","    \/*package*\/ static InstallState getNextInstallState(final InstallState current) {","110","        List<Function<Provider<InstallState>,InstallState>> installStateFilterChain = new ArrayList<>();","111","        for (final InstallStateFilter setupExtension : InstallStateFilter.all()) {","112","            installStateFilterChain.add(new Function<Provider<InstallState>, InstallState>() {","113","                @Override","114","                public InstallState apply(Provider<InstallState> next) {","115","                    return setupExtension.getNextInstallState(current, next);","116","                }","117","            });","118","        }","119","        \/\/ Terminal condition: getNextState() on the current install state","120","        installStateFilterChain.add(new Function<Provider<InstallState>, InstallState>() {","121","            @Override","122","            public InstallState apply(Provider<InstallState> input) {","123","                \/\/ Initially, install state is unknown and ","124","                \/\/ needs to be determined","125","                if (current == null || InstallState.UNKNOWN.equals(current)) {","126","                    return getDefaultInstallState();","127","                }","128","                final Map<InstallState, InstallState> states = new HashMap<InstallState, InstallState>();","129","                {","130","                    states.put(InstallState.CREATE_ADMIN_USER, InstallState.INITIAL_SETUP_COMPLETED);","131","                    states.put(InstallState.INITIAL_PLUGINS_INSTALLING, InstallState.CREATE_ADMIN_USER);","132","                    states.put(InstallState.INITIAL_SECURITY_SETUP, InstallState.NEW);","133","                    states.put(InstallState.RESTART, InstallState.RUNNING);","134","                    states.put(InstallState.UPGRADE, InstallState.INITIAL_SETUP_COMPLETED);","135","                    states.put(InstallState.DOWNGRADE, InstallState.INITIAL_SETUP_COMPLETED);","136","                    states.put(InstallState.INITIAL_SETUP_COMPLETED, InstallState.RUNNING);","137","                }","138","                return states.get(current);","139","            }","140","        });","141","        ","142","        ProviderChain<InstallState> chain = new ProviderChain<>(installStateFilterChain.iterator());","143","        return chain.get();","144","    }","145","    ","146","    private static InstallState getDefaultInstallState() {","148","        String stateOverride = System.getProperty(\"jenkins.install.state\", System.getenv(\"jenkins.install.state\"));","183","                    InstallState.INITIAL_SETUP_COMPLETED.initializeState();","195","            if (!j.getItemMap().isEmpty() || !mayBeJenkins2SecurityDefaults(j) || !j.getNodes().isEmpty()) {","198","            ","199","            return InstallState.INITIAL_SECURITY_SETUP;","220","        \/\/ may be called before security set up first","221","        if(j.getSecurityRealm() == SecurityRealm.NO_AUTHENTICATION && !(j.getCrumbIssuer() instanceof DefaultCrumbIssuer)) { "],"delete":["72","     * Get the current installation state.","73","     * @return The type of \"startup\" currently under way in Jenkins.","75","    public static InstallState getInstallState() {","77","        String stateOverride = System.getenv(\"jenkins.install.state\");","112","                    SetupWizard.completeSetup(j);","113","                    UpgradeWizard.completeUpgrade(j);","125","            if (!j.getItemMap().isEmpty() || !mayBeJenkins2SecurityDefaults(j)) {","128","            return InstallState.NEW;","149","        if(j.getSecurityRealm() == SecurityRealm.NO_AUTHENTICATION) { \/\/ called before security set up first"]}],"core\/src\/main\/resources\/jenkins\/install\/UpgradeWizard\/client-scripts.jelly":[{"add":[],"delete":[]}],"war\/src\/test\/js\/pluginSetupWizard-spec.js":[{"add":["368","                    state: 'NEW',","369","                    jobs: []","370","                }","371","            },","372","            {","373","                status: 'ok',","374","                data: {","375","                    state: 'INITIAL_PLUGINS_INSTALLING',","385","            }","386","            ])","393","            setTimeout(function() {","396","                expect($('.installing-panel').is(':visible')).toBe(true);","399","            }, 1);"],"delete":["368","                    state: 'INSTALLING_PLUGINS',","378","            }])","385","        setTimeout(function() {","388","                expect($('.save-first-user').is(':visible')).toBe(true);","391","        }, 500);"]}],"test\/src\/test\/java\/jenkins\/util\/SystemPropertiesTest.java":[{"add":[],"delete":["63","    public void shouldInitializeFromContext() throws Exception {","64","        ServletContext c = j.jenkins.servletContext;","65","        assertThat(\"System property should assign the value\", ","66","                SystemProperties.getString(\"install-wizard-path\"), equalTo(\"jsbundles\/pluginSetupWizard\"));","67","    }","68","    ","69","    @Test"]}],"war\/src\/main\/js\/templates\/upgradePanel.hbs":[{"add":[],"delete":[]}],"war\/src\/main\/js\/templates\/upgradeSkippedPanel.hbs":[{"add":[],"delete":[]}],"test\/src\/test\/java\/jenkins\/install\/UpgradeWizardTest.java":[{"add":["2","import jenkins.model.Jenkins;","3","import net.sf.json.JSONArray;","4","","6","import org.junit.After;","12","import hudson.Main;","14","import java.io.File;","16","import java.lang.reflect.Field;","18","import java.util.concurrent.TimeUnit;","28","    ","29","    private JSONArray platformPluginUpdates;","30","    ","31","    private void rmStateFile() {","32","        File f = SetupWizard.getUpdateStateFile();","33","        if(f != null && f.exists()) {","34","            f.delete();","35","        }","37","    ","38","    private void setSetupWizard(SetupWizard wiz) throws Exception {","39","        Field f = Jenkins.class.getDeclaredField(\"setupWizard\");","40","        f.setAccessible(true);","41","        f.set(Jenkins.getInstance(), wiz);","42","    }","43","    ","44","    @Before","45","    public void setSetupWizard() throws Exception {","46","        rmStateFile();","47","        platformPluginUpdates = JSONArray.fromObject(\"[{name:'test-plugin',since:'2.1'}]\");","48","        setSetupWizard(new SetupWizard() {","49","            @Override","50","            public JSONArray getPlatformPluginUpdates() {","51","                return platformPluginUpdates;","52","            }","53","        });","54","        \/\/ Disable the unit test flag.","55","        Main.isUnitTest = false;","56","    }","57","    ","58","    @After","59","    public void restoreSetupWizard() throws Exception {","60","        rmStateFile();","61","        setSetupWizard(new SetupWizard());","62","        \/\/ Disable the unit test flag.","63","        Main.isUnitTest = true;","64","    }","65","    ","71","                writeVersion(\"1.5\");","72","                UpgradeWizard uw = getInstance();","91","                writeVersion(\"1.5\");","92","                assertTrue(getInstance().isDue());","107","        j.executeOnServer(new Callable<Void>() {","108","            @Override","109","            public Void call() throws Exception {","110","                platformPluginUpdates = new JSONArray();","111","                assertFalse(getInstance().isDue());","112","                return null;","113","            }","114","        });","122","                InstallState prior = j.jenkins.getInstallState();","123","                try {","124","                    UpgradeWizard uw = getInstance();","125","                    assertTrue(uw.isDue()); \/\/ there are platform plugin updates","126","                    j.jenkins.getSetupWizard().completeSetup();","127","                    assertFalse(uw.isDue());","128","                    return null;","129","                } finally {","130","                    j.jenkins.setInstallState(prior);","131","                }","139","    private UpgradeWizard getInstance() throws Exception {","140","        try {","141","            UpgradeWizard uw = UpgradeWizard.get();","142","            uw.initializeState();","143","            return uw;","144","        } catch(Exception e) {","145","            e.printStackTrace();","146","            throw e;","147","        }","148","    }","149","","150","    \/**","151","     * Write a version to the update file, update last modified to > 24h","152","     * @param s","153","     * @throws IOException","154","     *\/","155","    private static void writeVersion(String s) throws IOException {","156","        File f = SetupWizard.getUpdateStateFile();","157","        FileUtils.writeStringToFile(f, s);","158","        f.setLastModified(System.currentTimeMillis() - TimeUnit.DAYS.toMillis(1));"],"delete":["2","import hudson.util.VersionNumber;","9","import javax.inject.Inject;","22","","23","    @Inject","24","    UpgradeWizard uw;","25","","26","    @Before","27","    public void setup() {","28","        j.jenkins.getInjector().injectMembers(this);","30","","54","                assertTrue(newInstance().isDue());","55","                assertNotSame(UpgradeWizard.NOOP, uw.doUpgrade());","70","        FileUtils.writeStringToFile(uw.getStateFile(), \"2.0\");","71","        assertFalse(newInstance().isDue());","72","        assertSame(UpgradeWizard.NOOP, uw.doUpgrade());","73","    }","74","","75","    \/**","76","     * If downgraded from future version, don't prompt upgrade wizard.","77","     *\/","78","    @Test","79","    public void downgradeFromFuture() throws Exception {","80","        FileUtils.writeStringToFile(uw.getStateFile(), \"3.0\");","81","        assertFalse(newInstance().isDue());","82","        assertSame(UpgradeWizard.NOOP, uw.doUpgrade());","90","                assertTrue(uw.isDue());","91","                uw.setCurrentLevel(new VersionNumber(\"2.0\"));","92","                assertFalse(uw.isDue());","93","","94","                return null;","102","    private UpgradeWizard newInstance() throws IOException {","103","        UpgradeWizard uw2 = new UpgradeWizard();","104","        j.jenkins.getInjector().injectMembers(uw2);","105","        return uw2;"]}],"core\/src\/main\/resources\/hudson\/security\/GlobalSecurityConfiguration\/index.groovy":[{"add":["13","l.layout(norefresh:true, permission:app.ADMINISTER, title:my.displayName, cssclass:request.getParameter('decorate')) {"],"delete":["13","l.layout(norefresh:true, permission:app.ADMINISTER, title:my.displayName) {"]}],"core\/src\/main\/java\/jenkins\/model\/Jenkins.java":[{"add":["48","import hudson.Main;","214","import jenkins.util.xml.XMLUtils;","886","            setupWizard = new SetupWizard();","887","            InstallUtil.proceedToNextStateFrom(InstallState.UNKNOWN);","959","     * Update the current install state. This will invoke state.initializeState() ","960","     * when the state has been transitioned.","964","        InstallState prior = installState;","966","        if (!prior.equals(newState)) {","967","            newState.initializeState();","968","        }","4594","        if(Main.isDevelopmentMode && \"${build.version}\".equals(ver)) {","4595","            \/\/ in dev mode, unable to get version (ahem Eclipse)","4596","            try {","4597","                File dir = new File(\".\").getAbsoluteFile();","4598","                while(dir != null) {","4599","                    File pom = new File(dir, \"pom.xml\");","4600","                    if (pom.exists() && \"pom\".equals(XMLUtils.getValue(\"\/project\/artifactId\", pom))) {","4601","                        pom =  pom.getCanonicalFile();","4602","                        LOGGER.info(\"Reading version from: \" + pom.getAbsolutePath());","4603","                        ver = XMLUtils.getValue(\"\/project\/version\", pom);","4604","                        break;","4605","                    }","4606","                    dir = dir.getParentFile();","4607","                }","4608","                LOGGER.info(\"Jenkins is in dev mode, using version: \" + ver);","4609","            } catch (Exception e) {","4610","                LOGGER.log(Level.WARNING, \"Unable to read Jenkins version: \" + e.getMessage(), e);","4611","            }","4612","        }","4613","        "],"delete":["884","            installState = InstallUtil.getInstallState();","885","            if (installState == InstallState.RESTART || installState == InstallState.DOWNGRADE) {","886","                InstallUtil.saveLastExecVersion();","887","            }","888","            ","889","            if(!installState.isSetupComplete()) {","890","                \/\/ Start immediately with the setup wizard for new installs","891","                setupWizard = new SetupWizard(this);","892","            }","964","     * Update the current install state.","969","    }","970","","971","    \/**","972","     * Get the URL path to the Install Wizard JavaScript.","973","     * @return The URL path to the Install Wizard JavaScript.","974","     *\/","975","    @Restricted(NoExternalUse.class)","976","    public String getInstallWizardPath() {","977","        return servletContext.getInitParameter(\"install-wizard-path\");","4286","     * Sets the setup wizard","4287","     *","4288","     * @since 2.0","4289","     *\/","4290","    @Restricted(NoExternalUse.class)","4291","    public void setSetupWizard(SetupWizard setupWizard) {","4292","        this.setupWizard = setupWizard;","4293","    }","4294","","4295","    \/**"]}],"war\/gulpfile.js":[{"add":["28","\/\/Bundle the Upgrade Wizard.","29","\/\/","30","builder.bundle('src\/main\/js\/upgradeWizard.js')","31"," .withExternalModuleMapping('jquery-detached', 'core-assets\/jquery-detached:jquery2')","32"," .withExternalModuleMapping('bootstrap', 'core-assets\/bootstrap:bootstrap3')","33"," .withExternalModuleMapping('handlebars', 'core-assets\/handlebars:handlebars3')","34"," .inDir('src\/main\/webapp\/jsbundles');","35","","36","\/\/"],"delete":[]}],"core\/src\/main\/java\/jenkins\/install\/InstallState.java":[{"add":["26","import javax.annotation.Nonnull;","28","import hudson.Extension;","29","import hudson.ExtensionList;","30","import hudson.ExtensionPoint;","31","import jenkins.model.Jenkins;","36"," * In order to hook into the setup wizard lifecycle, you should","37"," * include something in a script that call","38"," * to `onSetupWizardInitialized` with a callback, for example:","39"," * ","40"," * See <em><code>upgradeWizard.js<\/code><\/em> for an example","41"," * ","44","public class InstallState implements ExtensionPoint {","48","    @Extension","49","    public static final InstallState UNKNOWN = new InstallState(\"UNKNOWN\", true);","50","    ","51","    \/**","52","     * After any setup \/ restart \/ etc. hooks are done, states hould be running","53","     *\/","54","    @Extension","55","    public static final InstallState RUNNING = new InstallState(\"RUNNING\", true);","56","    ","60","    @Extension","61","    public static final InstallState INITIAL_SETUP_COMPLETED = new InstallState(\"INITIAL_SETUP_COMPLETED\", true) {","62","        public void initializeState() {","63","            Jenkins j = Jenkins.getInstance();","64","            try {","65","                j.getSetupWizard().completeSetup();","66","            } catch (Exception e) {","67","                throw new RuntimeException(e);","68","            }","69","            j.setInstallState(RUNNING);","70","        }","71","    };","72","    ","76","    @Extension","77","    public static final InstallState CREATE_ADMIN_USER = new InstallState(\"CREATE_ADMIN_USER\", false);","78","    ","83","    @Extension","84","    public static final InstallState INITIAL_PLUGINS_INSTALLING = new InstallState(\"INITIAL_PLUGINS_INSTALLING\", false);","85","    ","86","    \/**","87","     * Security setup for a new Jenkins install.","88","     *\/","89","    @Extension","90","    public static final InstallState INITIAL_SECURITY_SETUP = new InstallState(\"INITIAL_SECURITY_SETUP\", false) {","91","        public void initializeState() {","92","            try {","93","                Jenkins.getInstance().getSetupWizard().init(true);","94","            } catch (Exception e) {","95","                throw new RuntimeException(e);","96","            }","97","            ","98","            InstallUtil.proceedToNextStateFrom(INITIAL_SECURITY_SETUP);","99","        }","100","    };","101","    ","105","    @Extension","106","    public static final InstallState NEW = new InstallState(\"NEW\", false);","107","    ","111","    @Extension","112","    public static final InstallState RESTART = new InstallState(\"RESTART\", true) {","113","        public void initializeState() {","114","            InstallUtil.saveLastExecVersion();","115","        }","116","    };","117","    ","121","    @Extension","122","    public static final InstallState UPGRADE = new UpgradeWizard();","123","    ","127","    @Extension","128","    public static final InstallState DOWNGRADE = new InstallState(\"DOWNGRADE\", true) {","129","        public void initializeState() {","130","            InstallUtil.saveLastExecVersion();","131","        }","132","    };","133","    ","137","    public static final InstallState TEST = new InstallState(\"TEST\", true);","138","    ","143","    public static final InstallState DEVELOPMENT = new InstallState(\"DEVELOPMENT\", true);","146","    private final String name;","148","    public InstallState(@Nonnull String name, boolean isSetupComplete) {","149","        this.name = name;","151","    }","152","    ","153","    \/**","154","     * Process any initialization this install state requires","155","     *\/","156","    public void initializeState() {","166","    public String name() {","167","        return name;","168","    }","169","    ","170","    @Override","171","    public int hashCode() {","172","        return name.hashCode();","173","    }","174","    ","175","    @Override","176","    public boolean equals(Object obj) {","177","        if(obj instanceof InstallState) {","178","            return name.equals(((InstallState)obj).name());","179","        }","180","        return false;","181","    }","182","    ","183","    @Override","184","    public String toString() {","185","        return \"InstallState (\" + name + \")\";","186","    }","187","","189","     * Find an install state by name","190","     * @param name","191","     * @return","194","    public static InstallState valueOf(@Nonnull String name) {","195","        for (InstallState state : all()) {","196","            if (name.equals(state.name)) {","197","                return state;","198","            }","199","        }","200","        return null;","201","    }","202","","203","    \/**","204","     * Returns all install states in the system","205","     *\/","206","    static ExtensionList<InstallState> all() {","207","        return ExtensionList.lookup(InstallState.class);"],"delete":["27","import org.kohsuke.accmod.Restricted;","28","import org.kohsuke.accmod.restrictions.NoExternalUse;","35","@Restricted(NoExternalUse.class)","36","public enum InstallState {","40","    UNKNOWN(true, null),","44","    INITIAL_SETUP_COMPLETED(true, null),","48","    CREATE_ADMIN_USER(false, INITIAL_SETUP_COMPLETED),","53","    INITIAL_PLUGINS_INSTALLING(false, CREATE_ADMIN_USER),","57","    NEW(false, INITIAL_PLUGINS_INSTALLING),","61","    RESTART(true, INITIAL_SETUP_COMPLETED),","65","    UPGRADE(true, INITIAL_SETUP_COMPLETED),","69","    DOWNGRADE(true, INITIAL_SETUP_COMPLETED),","73","    TEST(true, INITIAL_SETUP_COMPLETED),","78","    DEVELOPMENT(true, INITIAL_SETUP_COMPLETED);","81","    private final InstallState nextState;","83","    private InstallState(boolean isSetupComplete, InstallState nextState) {","85","        this.nextState = nextState;","96","     * Gets the next state","99","    public InstallState getNextState() {","100","        return nextState;"]}],"core\/src\/main\/java\/jenkins\/install\/InstallStateFilter.java":[{"add":[],"delete":[]}],"core\/src\/main\/resources\/jenkins\/install\/SetupWizard\/authenticate-security-token.jelly":[{"add":["2","    <l:main-panel>","3","    <st:include page=\"client-scripts\" \/>","30","                    <input name=\"j_username\" value=\"${app.setupWizard.initialSetupAdminUserName}\" type=\"hidden\"\/>"],"delete":["2","  <l:main-panel>","29","                    <input name=\"j_username\" value=\"${j.setupWizard.initialSetupAdminUserName}\" type=\"hidden\"\/>"]}],"war\/src\/main\/js\/templates\/pluginSelectionPanel.hbs":[{"add":["1","  <h4 class=\"modal-title\">{{translations.installWizard_installCustom_title}}<\/h4>","4","  <div class=\"categories col-sm-3\">","5","  <ul class=\"nav\">","6","    {{#each categories}}","7","    <li><a href=\"#{{id this}}\" class=\"select-category\">{{this}}<\/a><\/li>","8","    {{\/each}}","9","  <\/ul>","10","  <\/div>","11","  <div class=\"plugins col-sm-9\">","12","    <div class=\"plugin-select-controls\">","13","      <span class=\"plugin-select-actions\">","14","        <a href=\"#\" class=\"plugin-select-all\">{{translations.installWizard_installCustom_selectAll}}<\/a>","15","        <a href=\"#\" class=\"plugin-select-none\">{{translations.installWizard_installCustom_selectNone}}<\/a>","16","        <a href=\"#\" class=\"plugin-select-recommended\">{{translations.installWizard_installCustom_selectRecommended}}<\/a>","17","      <\/span>","18","      <span class=\"plugin-search-controls\">","19","        <input type=\"text\" name=\"searchbox\" class=\"form-control\" \/>","20","        <a href=\"#\" class=\"clear-search\">&times;<\/a>","21","      <\/span>","22","      <span id=\"plugin-selected-info\" class=\"plugin-selected-info\" data-selected-plugins=\"{{#each selectedPlugins}}{{this}},{{\/each}}\">","23","        <a href=\"#\" class=\"plugin-show-selected\">{{translations.installWizard_installCustom_selected}}<\/a> {{totalPluginCount}}","24","      <\/span>","25","    <\/div>","26","        <div class=\"plugin-list\">","27","            <div class=\"plugin-list-description\">{{{translations.installWizard_installCustom_pluginListDesc}}}<\/div>","28","        {{> pluginSelectList}}","29","    <\/div>","30","  <\/div>","33","  <button type=\"button\" class=\"btn btn-link install-home\">","34","    {{translations.installWizard_goBack}}","35","  <\/button>","36","  <button type=\"button\" class=\"btn btn-primary install-selected\">","37","    {{translations.installWizard_goInstall}}","38","  <\/button>"],"delete":["1","\t<h4 class=\"modal-title\">{{translations.installWizard_installCustom_title}}<\/h4>","4","\t<div class=\"categories col-sm-3\">","5","\t<ul class=\"nav\">","6","\t  {{#each categories}}","7","\t  <li><a href=\"#{{id this}}\" class=\"select-category\">{{this}}<\/a><\/li>","8","\t  {{\/each}}","9","\t<\/ul>","10","\t<\/div>","11","\t<div class=\"plugins col-sm-9\">","12","\t\t<div class=\"plugin-select-controls\">","13","\t\t\t<span class=\"plugin-select-actions\">","14","\t\t\t\t<a href=\"#\" class=\"plugin-select-all\">{{translations.installWizard_installCustom_selectAll}}<\/a>","15","\t\t\t\t<a href=\"#\" class=\"plugin-select-none\">{{translations.installWizard_installCustom_selectNone}}<\/a>","16","\t\t\t\t<a href=\"#\" class=\"plugin-select-recommended\">{{translations.installWizard_installCustom_selectRecommended}}<\/a>","17","\t\t\t<\/span>","18","\t\t\t<span class=\"plugin-search-controls\">","19","\t\t\t\t<input type=\"text\" name=\"searchbox\" class=\"form-control\" \/>","20","\t\t\t\t<a href=\"#\" class=\"clear-search\">&times;<\/a>","21","\t\t\t<\/span>","22","\t\t\t<span id=\"plugin-selected-info\" class=\"plugin-selected-info\" data-selected-plugins=\"{{#each selectedPlugins}}{{this}},{{\/each}}\">","23","\t\t\t\t<a href=\"#\" class=\"plugin-show-selected\">{{translations.installWizard_installCustom_selected}}<\/a> {{totalPluginCount}}","24","\t\t\t<\/span>","25","\t\t<\/div>","26","\t\t<div class=\"plugin-list\">","27","\t\t\t<div class=\"plugin-list-description\">{{{translations.installWizard_installCustom_pluginListDesc}}}<\/div>","28","\t\t\t{{#each categorizedPlugins}}","29","\t\t\t<h2 id=\"{{id @key}}\" class=\"expanded\">{{@key}} {{pluginCountForCategory @key}}<\/h2>","30","\t\t\t<div class=\"plugins-for-category\">","31","\t\t\t\t{{#each this}}","32","\t\t\t\t<div class=\"plugin {{#inSelectedPlugins plugin.name}}selected{{\/inSelectedPlugins}} {{#ifVisibleDependency plugin.name}}show-dependencies{{\/ifVisibleDependency}}\" id=\"row-{{plugin.name}}\">","33","\t\t\t\t\t{{#hasDependencies plugin.name}}","34","\t\t\t\t\t\t<div class=\"btn btn-link toggle-dependency-list\" type=\"button\" data-plugin-name=\"{{..\/plugin.name}}\">","35","\t\t\t\t\t\t\t{{..\/..\/..\/translations.installWizard_installIncomplete_dependenciesLabel}}<span class=\"badge\">{{dependencyCount ..\/plugin.name}}<\/span>","36","\t\t\t\t\t\t<\/div>","37","\t\t\t\t\t{{\/hasDependencies}}","38","\t\t\t\t\t<label>","39","\t\t\t\t\t\t<span class=\"title\">","40","\t\t\t\t\t\t\t<input type=\"checkbox\" id=\"chk-{{plugin.name}}\" name=\"{{plugin.name}}\" value=\"{{searchTerm}}\" {{#inSelectedPlugins plugin.name}}checked=\"checked\"{{\/inSelectedPlugins}}\/>","41","\t\t\t\t\t\t\t{{plugin.title}}","42","\t\t\t\t\t\t\t<a href=\"{{plugin.website}}\" target=\"_blank\">{{..\/..\/translations.installWizard_websiteLinkLabel}}<\/a>","43","\t\t\t\t\t\t<\/span>","44","\t\t\t\t\t\t<span class=\"description\">","45","\t\t\t\t\t\t\t{{{plugin.excerpt}}}","46","\t\t\t\t\t\t<\/span>","47","\t\t\t\t\t\t{{#hasDependencies plugin.name}}","48","\t\t\t\t\t\t\t<div class=\"dep-list\">","49","\t\t\t\t\t\t\t\t{{#eachDependency ..\/plugin.name}}","50","\t\t\t\t\t\t\t\t<a class=\"dep badge\" href=\"{{website}}\" target=\"_blank\">","51","\t\t\t\t\t\t\t\t{{title}}","52","\t\t\t\t\t\t\t\t<\/a>","53","\t\t\t\t\t\t\t\t{{\/eachDependency}}","54","\t\t\t\t\t\t\t<\/div>","55","\t\t\t\t\t\t{{\/hasDependencies}}","56","\t\t\t\t\t<\/label>","57","\t\t\t\t<\/div>","58","\t\t\t\t{{\/each}}","59","\t\t\t<\/div>","60","\t\t\t{{\/each}}","61","\t\t<\/div>","62","\t<\/div>","65","\t<button type=\"button\" class=\"btn btn-link install-home\">","66","\t\t{{translations.installWizard_goBack}}","67","\t<\/button>","68","\t<button type=\"button\" class=\"btn btn-primary install-selected\">","69","\t\t{{translations.installWizard_goInstall}}","70","\t<\/button>"]}],"core\/src\/main\/resources\/jenkins\/install\/UpgradeWizard\/client-scripts.properties":[{"add":[],"delete":[]}],"core\/src\/main\/resources\/jenkins\/model\/Jenkins\/login.jelly":[{"add":["27","  <j:when test=\"${it.setupWizard.isUsingSecurityToken()}\">"],"delete":["27","  <j:when test=\"${it.setupWizard != null and it.setupWizard.useGeneratedPassword()}\">"]}],"test\/src\/test\/java\/jenkins\/install\/SetupWizardTest.java":[{"add":["67","        final SetupWizard wizard = j.jenkins.getSetupWizard();","68","        wizard.init(true);"],"delete":["67","        final SetupWizard wizard = new SetupWizard(j.jenkins);","68","        j.jenkins.setSetupWizard(wizard);"]}],"war\/src\/main\/js\/templates\/upgradeSuccessPanel.hbs":[{"add":[],"delete":[]}],"war\/src\/main\/js\/pluginSetupWizardGui.js":[{"add":["119","\tvar pluginSelectList = require('.\/templates\/pluginSelectList.hbs');","120","\t","121","\tHandlebars.registerPartial('pluginSelectList', pluginSelectList);","156","\t","157","\tvar self = this;","158","\t","195","\t","196","\tvar getJenkinsVersionFull = function() {","197","\t\tvar version = $('body').attr('data-version');","198","\t\tif(!version) {","199","\t\t\treturn '';","200","\t\t}","201","\t\treturn version;","202","\t};","203","","204","\tvar getJenkinsVersion = function() {","205","\t\treturn getJenkinsVersionFull().replace(\/(\\d[.]\\d).*\/,'$1');","206","\t};","209","\tvar setPanel = function(panel, data, onComplete) {","215","\t\tvar oncomplete = function() {","216","\t\t\tvar $content = $('*[data-load-content]');","217","\t\t\tif($content.length > 0) {","218","\t\t\t\t$content.each(function() {","219","\t\t\t\t\tvar $el = $(this);","220","\t\t\t\t\tjenkins.get($el.attr('data-load-content'), function(data) {","221","\t\t\t\t\t\t$el.html(data);","222","\t\t\t\t\t\tif(onComplete) {","223","\t\t\t\t\t\t\tonComplete();","224","\t\t\t\t\t\t}","225","\t\t\t\t\t}, { dataType: 'html' });","226","\t\t\t\t});","227","\t\t\t} else {","228","\t\t\t\tif(onComplete) {","229","\t\t\t\t\tonComplete();","230","\t\t\t\t}","231","\t\t\t}","232","\t\t};","233","\t\tvar html = panel($.extend({translations: translations, baseUrl: jenkins.baseUrl, jenkinsVersion: getJenkinsVersion() }, data));","247","\t\t\toncomplete();","267","\t\t\t\t\t$modalFooter.prepend('<div class=\"jenkins-version\">'+translations.installWizard_jenkinsVersionTitle+' '+getJenkinsVersionFull()+'<\/div>');","270","\t\t\t\toncomplete();","362","\t\t\tshowStatePanel();","391","\t","392","\tvar enableButtonsAfterFrameLoad = function() {","393","\t\t$('iframe[src]').load(function() {","394","\t\t\t$('button').prop({disabled:false});","395","\t\t});","396","\t};","397","\t","398","\tvar setupFirstUser = function() {","399","\t\tsetPanel(firstUserPanel, {}, enableButtonsAfterFrameLoad);","400","\t};","401","\t","402","\t\/\/ used to handle displays based on current Jenkins install state","403","\tvar stateHandlers = {","404","\t\tDEFAULT: function() {","405","\t\t\tsetPanel(welcomePanel);","406","\t\t\t\/\/ focus on default","407","\t\t\t$('.install-recommended').focus();","408","\t\t},","409","\t\tCREATE_ADMIN_USER: function() { setupFirstUser(); },","410","\t\tRUNNING: function() { setPanel(setupCompletePanel); },","411","\t\tINITIAL_SETUP_COMPLETED: function() { setPanel(setupCompletePanel); },","412","\t\tINITIAL_PLUGINS_INSTALLING: function() { showInstallProgress(); }","413","\t};","414","\tvar showStatePanel = function(state) {","415","\t\tif (!state) {","416","\t\t\tpluginManager.installStatus(handleGenericError(function(data) {","417","\t\t\t\tshowStatePanel(data.state);","418","\t\t\t}));","419","\t\t\treturn;","420","\t\t}","421","\t\tif(state in stateHandlers) {","422","\t\t\tstateHandlers[state]();","423","\t\t} else {","424","\t\t\tstateHandlers.DEFAULT();","425","\t\t}","426","\t};","427","\t","527","\t\t\t\tif(complete < total || data.state == 'INITIAL_PLUGINS_INSTALLING') {","535","\t\t\t\t\tshowStatePanel(data.state);","564","\t","565","\tvar loadPluginCategories = function(oncomplete) {","592","\t\t\toncomplete();","593","\t\t});","594","\t};","595","","596","\t\/\/ load the custom plugin panel, will result in an AJAX call to get the plugin data","597","\tvar loadCustomPluginPanel = function() {","598","\t\tloadPluginCategories(function(){","630","\t\tsetPanel(currentPanel, pluginSelectionPanelData());","789","\tvar handleStaplerSubmit = function(data) {","790","\t\tif(data.status && data.status > 200) {","791","\t\t\t\/\/ Nothing we can really do here","792","\t\t\tsetPanel(errorPanel, { errorMessage: data.statusText });","793","\t\t\treturn;","794","\t\t}","795","\t\t","796","\t\ttry {","797","\t\t\tif(JSON.parse(data).status == 'ok') {","798","\t\t\t\tshowStatePanel();","799","\t\t\t\treturn;","800","\t\t\t}","801","\t\t} catch(e) {","802","\t\t\t\/\/ ignore JSON parsing issues, this may be HTML","803","\t\t}","804","\t\t\/\/ we get 200 OK","805","\t\tvar $page = $(data);","806","\t\tvar $errors = $page.find('.error');","807","\t\tif($errors.length > 0) {","808","\t\t\tvar $main = $page.find('#main-panel').detach();","809","\t\t\tif($main.length > 0) {","810","\t\t\t\tdata = data.replace(\/body([^>]*)[>](.|[\\r\\n])+[<][\/]body\/,'body$1>'+$main.html()+'<\/body');","811","\t\t\t}","812","\t\t\tvar doc = $('iframe[src]').contents()[0];","813","\t\t\tdoc.open();","814","\t\t\tdoc.write(data);","815","\t\t\tdoc.close();","816","\t\t}","817","\t\telse {","818","\t\t\tshowStatePanel();","819","\t\t}","825","\t\tsecurityConfig.saveFirstUser($('iframe[src]').contents().find('form:not(.no-json)'), handleStaplerSubmit, handleStaplerSubmit);","827","","845","\t","858","\t\t\t\tshowStatePanel(data.state);","925","\t\t'.install-home': function() { showStatePanel(); },","949","\t","950","\t\/\/ Process extensions","951","\tvar extensionTranslationOverrides = [];","952","\tif ('undefined' != typeof(setupWizardExtensions)) {","953","\t\t$.each(setupWizardExtensions, function() {","954","\t\t\tthis.call(self, {","955","\t\t\t\t'$': $,","956","\t\t\t\t'$wizard': $wizard,","957","\t\t\t\tjenkins: jenkins,","958","\t\t\t\tpluginManager: pluginManager,","959","\t\t\t\tsetPanel: setPanel,","960","\t\t\t\taddActions: function(pluginActions) { $.extend(actions, pluginActions); },","961","\t\t\t\taddStateHandlers: function(pluginStateHandlers) { $.extend(stateHandlers, pluginStateHandlers); },","962","\t\t\t\ttranslationOverride: function(it) { extensionTranslationOverrides.push(it); },","963","\t\t\t\tsetSelectedPluginNames: function(pluginNames) { selectedPluginNames = pluginNames.slice(0); },","964","\t\t\t\tshowStatePanel: showStatePanel,","965","\t\t\t\tinstallPlugins: installPlugins,","966","\t\t\t\tpluginSelectionPanelData: pluginSelectionPanelData,","967","\t\t\t\tloadPluginCategories: loadPluginCategories","968","\t\t\t});","969","\t\t});","970","\t}","971","\t","972","\tfor(var cls in actions) {","973","\t\tbindClickHandler(cls, actions[cls]);","974","\t}","975","\t","976","\tvar showInitialSetupWizard = function() {","990","\t\t\t\/\/ Initialize the plugin manager after connectivity checks","991","\t\t\tpluginManager.init(handleGenericError(function() {","992","\t\t\t\tpluginList = pluginManager.plugins();","993","\t\t\t\tallPluginNames = pluginManager.pluginNames();","994","\t\t\t\tselectedPluginNames = pluginManager.recommendedPluginNames();","995","","1016","\t\t\t\t\t\t\tshowStatePanel(data.state);","1019","\t\t\t\t\t\tshowStatePanel(data.state);","1072","\t\t\t\t\tshowStatePanel();","1074","\t\t\t\t}));","1078","\t};","1079","\t","1080","\t\/\/ kick off to get resource bundle","1081","\tjenkins.loadTranslations('jenkins.install.pluginSetupWizard', handleGenericError(function(localizations) {","1082","\t\ttranslations = localizations;","1083","\t\t","1084","\t\t\/\/ process any translation overrides","1085","\t\t$.each(extensionTranslationOverrides, function() {","1086","\t\t\tthis(translations);","1087","\t\t});","1088","\t\t","1089","\t\tshowInitialSetupWizard();"],"delete":["3","","143","\t\/\/ Initialize the plugin manager after connectivity checks","144","\tpluginManager.init(handleGenericError(function() {","145","\t  pluginList = pluginManager.plugins();","146","\t  allPluginNames = pluginManager.pluginNames();","147","\t  selectedPluginNames = pluginManager.recommendedPluginNames();","148","\t}));","149","","161","","200","\tvar setPanel = function(panel, data, oncomplete) {","206","\t\tvar html = panel($.extend({translations: translations, baseUrl: jenkins.baseUrl}, data));","220","\t\t\tif(oncomplete) {","221","\t\t\t\toncomplete();","222","\t\t\t}","242","\t\t\t\t\t$modalFooter.prepend('<div class=\"jenkins-version\">'+translations.installWizard_jenkinsVersionTitle+' '+$('body').attr('data-version')+'<\/div>');","245","\t\t\t\tif(oncomplete) {","246","\t\t\t\t\toncomplete();","247","\t\t\t\t}","339","\t\t\tshowInstallProgress();","368","","376","\t\t","377","\t\tif(state) {","378","\t\t\tif(\/CREATE_ADMIN_USER\/.test(state)) {","379","\t\t\t\tsetupFirstUser();","380","\t\t\t\treturn;","381","\t\t\t}","382","\t\t}","475","\t\t\t\tif(complete < total) {","483","\t\t\t\t\tshowInstallProgress('CREATE_ADMIN_USER'); \/\/ this temporary, changed in another PR","512","","513","\t\/\/ load the custom plugin panel, will result in an AJAX call to get the plugin data","514","\tvar loadCustomPluginPanel = function() {","572","\t\tsetPanel(pluginSelectionPanel, pluginSelectionPanelData());","731","\tvar enableButtonsAfterFrameLoad = function() {","732","\t\t$('iframe[src]').load(function() {","733","\t\t\t$('button').prop({disabled:false});","734","\t\t});","735","\t};","736","\t","737","\tvar setupFirstUser = function() {","738","\t\tsetPanel(firstUserPanel, {}, enableButtonsAfterFrameLoad);","744","\t\tvar handleSubmit = function(data) {","745","\t\t\tif(data.status && data.status > 200) {","746","\t\t\t\t\/\/ Nothing we can really do here","747","\t\t\t\tsetPanel(errorPanel, { errorMessage: data.statusText });","748","\t\t\t\treturn;","749","\t\t\t}","750","\t\t\t\/\/ we get 200 OK","751","\t\t\tvar $page = $(data);","752","\t\t\tvar $errors = $page.find('.error');","753","\t\t\tif($errors.length > 0) {","754","\t\t\t\tvar $main = $page.find('#main-panel').detach();","755","\t\t\t\tif($main.length > 0) {","756","\t\t\t\t\tdata = data.replace(\/body([^>]*)[>](.|[\\r\\n])+[<][\/]body\/,'body$1>'+$main.html()+'<\/body');","757","\t\t\t\t}","758","\t\t\t\tvar doc = $('iframe[src]').contents()[0];","759","\t\t\t\tdoc.open();","760","\t\t\t\tdoc.write(data);","761","\t\t\t\tdoc.close();","762","\t\t\t}","763","\t\t\telse {","764","\t\t\t\tsetPanel(setupCompletePanel);","765","\t\t\t}","766","\t\t};","767","\t\tsecurityConfig.saveFirstUser($('iframe[src]').contents().find('form:not(.no-json)'), handleSubmit, handleSubmit);","769","\t","799","\t\t\t\tshowInstallProgress(data.state);","866","\t\t'.install-home': function() { setPanel(welcomePanel); },","887","\tfor(var cls in actions) {","888","\t\tbindClickHandler(cls, actions[cls]);","889","\t}","893","","894","\t\/\/ kick off to get resource bundle","895","\tjenkins.loadTranslations('jenkins.install.pluginSetupWizard', handleGenericError(function(localizations) {","896","\t\ttranslations = localizations;","897","","931","\t\t\t\t\t\t\tshowInstallProgress(data.state);","934","\t\t\t\t\t\tshowInstallProgress(data.state);","987","\t\t\t\t\tsetPanel(welcomePanel);","989","\t\t\t\t\t\/\/ focus on default","990","\t\t\t\t\t$('.install-recommended').focus();","991",""]}],"war\/src\/main\/webapp\/css\/style.css":[{"add":["1861","body.no-decoration #main-panel {","1862","    margin: 0 auto !important;","1863","}","1864","body.no-decoration #page-head,","1865","body.no-decoration #side-panel,","1866","body.no-decoration footer {","1867","    display: none;","1868","}","1869","body.no-sticker #bottom-sticker {","1870","    display: none;","1871","}","1872",""],"delete":[]}],"war\/src\/main\/less\/pluginSetupWizard.less":[{"add":["4",".bootstrap-3 * {","5","    \/\/ simple reset","6","    margin: initial;","7","    padding: initial;","8","}","9","","479","              margin:5px 0px;","771","    ","772","    .alert {","773","        font-size: initial;","774","    }"],"delete":["278","                margin: 0 -15px;","474","              margin:5px -5px;"]}],"war\/src\/main\/js\/templates\/pluginSelectList.hbs":[{"add":[],"delete":[]}],"war\/src\/main\/webapp\/WEB-INF\/web.xml":[{"add":[],"delete":["47","  <context-param>","48","      <param-name>install-wizard-path<\/param-name>","49","      <param-value>jsbundles\/pluginSetupWizard<\/param-value>","50","  <\/context-param>","51",""]}],"core\/src\/main\/java\/hudson\/PluginManager.java":[{"add":["672","        if (InstallState.UPGRADE.equals(installState)) {","1201","        InstallUtil.proceedToNextStateFrom(InstallState.INITIAL_PLUGINS_INSTALLING);","1313","        trackInitialPluginInstall(installJobs);","1319","        final Jenkins jenkins = Jenkins.getInstance();","1322","        if (!Jenkins.getInstance().getInstallState().isSetupComplete()) {","1324","            updateCenter.persistInstallStatus();","1350","                        InstallUtil.proceedToNextStateFrom(InstallState.INITIAL_PLUGINS_INSTALLING);"],"delete":["672","        if (installState == InstallState.UPGRADE) {","1201","        if(InstallState.INITIAL_PLUGINS_INSTALLING.equals(j.getInstallState())) {","1202","            Jenkins.getInstance().setInstallState(InstallState.INITIAL_PLUGINS_INSTALLING.getNextState());","1203","        }","1315","        if (Jenkins.getActiveInstance().getInstallState() == InstallState.NEW) {","1316","            trackInitialPluginInstall(installJobs);","1317","        }","1323","        final Jenkins jenkins = Jenkins.getActiveInstance();","1326","        updateCenter.persistInstallStatus();","1327","        if (jenkins.getInstallState() == InstallState.NEW) {","1354","                        jenkins.setInstallState(InstallState.INITIAL_PLUGINS_INSTALLING.getNextState());"]}],"\/dev\/null":[{"add":[],"delete":[]}],"war\/src\/main\/js\/util\/jenkins.js":[{"add":["171","\tHandlebars.registerHelper('replace', function() {","172","\t\tvar val = arguments[0];","173","\t\t\/\/ second, through second to last - options is last","174","\t\tfor (var i = 1; i < arguments.length - 1; i++) {","175","\t\t\tval = val.replace('{' + (i-1) + '}', arguments[i]);","176","\t\t}","177","\t\treturn val;","178","\t});","179","","195","\t\t","196","\t\tvar translations = res.data;","197","\t\t","198","\t\tif('undefined' !== typeof(Proxy)) {","199","\t\t\ttranslations = new Proxy(translations, {","200","\t\t\t\tget: function(target, property, receiver) {","201","\t\t\t\t\tif(property in target) {","202","\t\t\t\t\t\treturn target[property];","203","\t\t\t\t\t}","204","\t\t\t\t\tif(debug) {","205","\t\t\t\t\t\tconsole.log('\"' + property + '\" not found in translation bundle.');","206","\t\t\t\t\t}","207","\t\t\t\t\treturn property;","208","\t\t\t\t}","209","\t\t\t});","210","\t\t}","212","\t\thandler(translations);","260","\t\t$f.each(function() {","261","\t\t\tif($form[0] === this) {","262","\t\t\t\twnd = windowFrame;","263","\t\t\t}","264","\t\t});"],"delete":["187","\t\thandler(res.data);","235","\t\tif($f.length > 0 && $form[0] === $f[0]) {","236","\t\t\twnd = windowFrame;","237","\t\t}"]}],"war\/src\/main\/js\/api\/pluginManager.js":[{"add":[],"delete":["6","\/\/ TODO: Get plugin info (plugins + recommended plugin list) from update center.","7","\/\/ For now, we statically store them in the wizard.","8","","233",""]}],"core\/src\/main\/resources\/jenkins\/install\/SetupWizard\/wizard-ui.jelly":[{"add":[],"delete":[]}],"core\/src\/main\/resources\/lib\/layout\/html.jelly":[{"add":["156","    "],"delete":["156","","157","    <j:invokeStatic var=\"j\" className=\"jenkins.model.Jenkins\" method=\"getInstance\" \/>","158","    <j:if test=\"${!j.installState.setupComplete}\">","159","      <script src=\"${resURL}\/${j.installWizardPath}.js\" type=\"text\/javascript\"\/>","160","      <link rel=\"stylesheet\" href=\"${resURL}\/${j.installWizardPath}.css\" type=\"text\/css\" \/>","161","    <\/j:if>","162",""]}],"core\/src\/main\/resources\/jenkins\/install\/UpgradeWizard\/client-scripts_fr.properties":[{"add":[],"delete":[]}],"core\/src\/main\/resources\/jenkins\/install\/SetupWizard\/index.jelly":[{"add":["4","    <st:include page=\"wizard-ui\"\/>"],"delete":["4","    <script src=\"${resURL}\/${j.installWizardPath}.js\" type=\"text\/javascript\"\/>","5","    <link rel=\"stylesheet\" href=\"${resURL}\/${j.installWizardPath}.css\" type=\"text\/css\" \/>"]}],"core\/src\/main\/resources\/jenkins\/install\/SetupWizard\/footer.jelly":[{"add":[],"delete":[]}],"core\/src\/main\/resources\/jenkins\/install\/pluginSetupWizard.properties":[{"add":["21","installWizard_installCustom_selectRecommended=Suggested","49","installWizard_gettingStarted_title=Getting Started","50","installWizard_saveSecurity=Save and Continue","60","installWizard_upgradePanel_title=Upgrade","61","installWizard_upgradePanel_banner=Welcome to Jenkins {0}!","62","installWizard_upgradePanel_message=Jenkins {0} includes some great new features that we think you'll love, install these additional plugins to take advantage of them!","63","installWizard_upgradePanel_skipRecommendedPlugins=No thanks","64","installWizard_upgradeComplete_title=Upgrade","65","installWizard_pluginsInstalled_banner=Welcome to Jenkins {0}!","66","installWizard_upgradeComplete_message=Congratulations! You have upgraded to Jenkins {0}.<\/p><p>To learn more about its great new features, visit <a target=\"_blank\" href=\"https:\/\/jenkins.io\/2.0\/\">the Jenkins website<\/a>!","67","installWizard_upgradeSkipped_title=Upgrade","68","installWizard_upgradeSkipped_banner=Features Not Installed","69","installWizard_upgradeSkipped_message=<div class=\"alert alert-warning fade in\">Suggested plugins will not be installed.<\/div> \\","70","<p style=\"padding: 0 4px\">You can also install new features from the Plugin Manager, if you change your mind.<\/p> \\","71","<p style=\"padding: 0 4px\">Learn how these new features can improve your Jenkins experience by \\","72","<a target=\"_blank\" href=\"https:\/\/jenkins.io\/2.0\/\">visiting the homepage<\/a>.<\/p>","73","installWizard_upgrading_title=Installing plugins","74","installWizard_upgradeComplete_finishButtonLabel=Finish"],"delete":["21","installWizard_installCustom_selectRecommended=Recommended"]}],"war\/src\/main\/js\/upgradeWizard.js":[{"add":[],"delete":[]}],"core\/src\/main\/java\/jenkins\/install\/SetupWizard.java":[{"add":["2","import static org.apache.commons.io.FileUtils.readFileToString;","3","import static org.apache.commons.lang.StringUtils.defaultIfBlank;","4","","11","import javax.annotation.CheckForNull;","31","import hudson.Extension;","34","import hudson.model.PageDecorator;","51","import java.util.List;","52","","68","@Extension","69","public class SetupWizard extends PageDecorator {","75","    private static final Logger LOGGER = Logger.getLogger(SetupWizard.class.getName());","76","    ","77","    \/**","78","     * Used to determine if this was a new install (vs. an upgrade, restart, or otherwise)","79","     *\/","80","    private static boolean isUsingSecurityToken = false;","82","    \/**","83","     * Initialize the setup wizard, this will process any current state initializations","84","     *\/","85","    \/*package*\/ void init(boolean newInstall) throws IOException, InterruptedException {","86","        Jenkins jenkins = Jenkins.getInstance();","88","        if(newInstall) {","89","            \/\/ this was determined to be a new install, don't run the update wizard here","90","            setCurrentLevel(Jenkins.getVersion());","92","            \/\/ Create an admin user by default with a ","93","            \/\/ difficult password","94","            FilePath iapf = getInitialAdminPasswordFile();","95","            if(jenkins.getSecurityRealm() == null || jenkins.getSecurityRealm() == SecurityRealm.NO_AUTHENTICATION) { \/\/ this seems very fragile","96","                BulkChange bc = new BulkChange(jenkins);","97","                try{","98","                    HudsonPrivateSecurityRealm securityRealm = new HudsonPrivateSecurityRealm(false, false, null);","99","                    jenkins.setSecurityRealm(securityRealm);","100","                    String randomUUID = UUID.randomUUID().toString().replace(\"-\", \"\").toLowerCase(Locale.ENGLISH);","101","    ","102","                    \/\/ create an admin user","103","                    securityRealm.createAccount(SetupWizard.initialSetupAdminUserName, randomUUID);","104","    ","105","                    \/\/ JENKINS-33599 - write to a file in the jenkins home directory","106","                    \/\/ most native packages of Jenkins creates a machine user account 'jenkins' to run Jenkins,","107","                    \/\/ and use group 'jenkins' for admins. So we allow groups to read this file","108","                    iapf.touch(System.currentTimeMillis());","109","                    iapf.chmod(0640);","110","                    iapf.write(randomUUID + System.lineSeparator(), \"UTF-8\");","111","                    ","112","    ","113","                    \/\/ Lock Jenkins down:","114","                    FullControlOnceLoggedInAuthorizationStrategy authStrategy = new FullControlOnceLoggedInAuthorizationStrategy();","115","                    authStrategy.setAllowAnonymousRead(false);","116","                    jenkins.setAuthorizationStrategy(authStrategy);","117","    ","118","                    \/\/ Shut down all the ports we can by default:","119","                    jenkins.setSlaveAgentPort(-1); \/\/ -1 to disable","120","    ","121","                    \/\/ require a crumb issuer","122","                    jenkins.setCrumbIssuer(new DefaultCrumbIssuer(false));","123","    ","124","                    \/\/ set master -> slave security:","125","                    jenkins.getInjector().getInstance(AdminWhitelistRule.class)","126","                        .setMasterKillSwitch(false);","127","                ","128","                    jenkins.save(); \/\/ !!","129","                    bc.commit();","130","                } finally {","131","                    bc.abort();","132","                }","134","    ","135","            if(iapf.exists()) {","136","                String setupKey = iapf.readToString().trim();","137","                String ls = System.lineSeparator();","138","                LOGGER.info(ls + ls + \"*************************************************************\" + ls","139","                        + \"*************************************************************\" + ls","140","                        + \"*************************************************************\" + ls","141","                        + ls","142","                        + \"Jenkins initial setup is required. An admin user has been created and \"","143","                        + \"a password generated.\" + ls","144","                        + \"Please use the following password to proceed to installation:\" + ls","145","                        + ls","146","                        + setupKey + ls","147","                        + ls","148","                        + \"This may also be found at: \" + iapf.getRemote() + ls","149","                        + ls","150","                        + \"*************************************************************\" + ls","151","                        + \"*************************************************************\" + ls","152","                        + \"*************************************************************\" + ls);","153","            }","154","            ","155","            try {","156","                PluginServletFilter.addFilter(FORCE_SETUP_WIZARD_FILTER);","157","                isUsingSecurityToken = true;","158","            } catch (ServletException e) {","159","                throw new RuntimeException(\"Unable to add PluginServletFilter for the SetupWizard\", e);","160","            }","174","    public boolean isUsingSecurityToken() {","176","            return isUsingSecurityToken \/\/ only ever show this if using the security token","177","                    && !Jenkins.getInstance().getInstallState().isSetupComplete()","178","                    && getInitialAdminPasswordFile().exists();","214","                InstallUtil.proceedToNextStateFrom(InstallState.CREATE_ADMIN_USER);","228","    \/*package*\/ void setCurrentLevel(VersionNumber v) throws IOException {","248","    public VersionNumber getCurrentLevel() {","290","    public JSONArray getPlatformPluginUpdates() {","350","        Jenkins jenkins = Jenkins.getInstance();","367","                                    \/\/ This plugin is valid, we'll leave \"suggested\" state","368","                                    \/\/ to match the experience during install","369","                                    \/\/ but only add it if it's currently uninstalled","370","                                    String pluginName = plugin.getString(\"name\");","371","                                    if (null == jenkins.getPluginManager().getPlugin(pluginName)) {","372","                                        \/\/ Also check that a compatible version exists in an update site","373","                                        boolean foundCompatibleVersion = false;","374","                                        for (UpdateSite site : jenkins.getUpdateCenter().getSiteList()) {","375","                                            UpdateSite.Plugin sitePlug = site.getPlugin(pluginName);","376","                                            if (sitePlug != null","377","                                                    && !sitePlug.isForNewerHudson()","378","                                                    && !sitePlug.isNeededDependenciesForNewerJenkins()) {","379","                                                foundCompatibleVersion = true;","380","                                                break;","381","                                            }","382","                                        }","383","                                        if (foundCompatibleVersion) {","384","                                            continue nextPlugin;","385","                                        }","386","                                    }","407","        return Jenkins.getInstance().getRootPath().child(\"secrets\/initialAdminPassword\");","414","        completeSetup();","418","    \/*package*\/ void completeSetup() throws IOException, ServletException {","419","        Jenkins.getInstance().checkPermission(Jenkins.ADMINISTER);","421","        setCurrentLevel(Jenkins.getVersion());","422","        PluginServletFilter.removeFilter(FORCE_SETUP_WIZARD_FILTER);","423","        isUsingSecurityToken = false; \/\/ this should not be considered new anymore","424","        InstallUtil.proceedToNextStateFrom(InstallState.INITIAL_SETUP_COMPLETED);","425","    }","426","    ","427","    \/**","428","     * Gets all the install states","429","     *\/","430","    public List<InstallState> getInstallStates() {","431","        return InstallState.all();","432","    }","433","    ","434","    \/**","435","     * Returns an installState by name","436","     *\/","437","    public InstallState getInstallState(String name) {","438","        if (name == null) {","439","            return null;","441","        return InstallState.valueOf(name);"],"delete":["2","import edu.umd.cs.findbugs.annotations.CheckForNull;","51","import static org.apache.commons.io.FileUtils.readFileToString;","53","import static org.apache.commons.lang.StringUtils.defaultIfBlank;","63","public class SetupWizard {","69","    private final static Logger LOGGER = Logger.getLogger(SetupWizard.class.getName());","71","    private final Jenkins jenkins;","72","","73","    public SetupWizard(Jenkins j) throws IOException, InterruptedException {","74","        this.jenkins = j;","75","","76","        UpgradeWizard.completeUpgrade(j);","78","        \/\/ Create an admin user by default with a ","79","        \/\/ difficult password","80","        FilePath iapf = getInitialAdminPasswordFile();","81","        if(j.getSecurityRealm() == null || j.getSecurityRealm() == SecurityRealm.NO_AUTHENTICATION) { \/\/ this seems very fragile","82","            BulkChange bc = new BulkChange(j);","83","            try{","84","                HudsonPrivateSecurityRealm securityRealm = new HudsonPrivateSecurityRealm(false, false, null);","85","                j.setSecurityRealm(securityRealm);","86","                String randomUUID = UUID.randomUUID().toString().replace(\"-\", \"\").toLowerCase(Locale.ENGLISH);","87","","88","                \/\/ create an admin user","89","                securityRealm.createAccount(SetupWizard.initialSetupAdminUserName, randomUUID);","90","","91","                \/\/ JENKINS-33599 - write to a file in the jenkins home directory","92","                \/\/ most native packages of Jenkins creates a machine user account 'jenkins' to run Jenkins,","93","                \/\/ and use group 'jenkins' for admins. So we allo groups to read this file","94","                iapf.touch(System.currentTimeMillis());","95","                iapf.chmod(0640);","96","                iapf.write(randomUUID + System.lineSeparator(), \"UTF-8\");","97","                ","98","","99","                \/\/ Lock Jenkins down:","100","                FullControlOnceLoggedInAuthorizationStrategy authStrategy = new FullControlOnceLoggedInAuthorizationStrategy();","101","                authStrategy.setAllowAnonymousRead(false);","102","                j.setAuthorizationStrategy(authStrategy);","103","","104","                \/\/ Shut down all the ports we can by default:","105","                j.setSlaveAgentPort(-1); \/\/ -1 to disable","106","","107","                \/\/ require a crumb issuer","108","                j.setCrumbIssuer(new DefaultCrumbIssuer(false));","109","","110","                \/\/ set master -> slave security:","111","                j.getInjector().getInstance(AdminWhitelistRule.class)","112","                    .setMasterKillSwitch(false);","114","                j.save(); \/\/ !!","115","                bc.commit();","116","            } finally {","117","                bc.abort();","119","        }","120","","121","        if(iapf.exists()) {","122","            String setupKey = iapf.readToString().trim();","123","            String ls = System.lineSeparator();","124","            LOGGER.info(ls + ls + \"*************************************************************\" + ls","125","                    + \"*************************************************************\" + ls","126","                    + \"*************************************************************\" + ls","127","                    + ls","128","                    + \"Jenkins initial setup is required. An admin user has been created and \"","129","                    + \"a password generated.\" + ls","130","                    + \"Please use the following password to proceed to installation:\" + ls","131","                    + ls","132","                    + setupKey + ls","133","                    + ls","134","                    + \"This may also be found at: \" + iapf.getRemote() + ls","135","                    + ls","136","                    + \"*************************************************************\" + ls","137","                    + \"*************************************************************\" + ls","138","                    + \"*************************************************************\" + ls);","139","        }","140","        ","141","        try {","142","            PluginServletFilter.addFilter(FORCE_SETUP_WIZARD_FILTER);","143","        } catch (ServletException e) {","144","            throw new AssertionError(e);","158","    public boolean useGeneratedPassword() {","160","            return getInitialAdminPasswordFile().exists();","196","                j.setInstallState(InstallState.CREATE_ADMIN_USER.getNextState());","210","    \/*package*\/ static void completeUpgrade(Jenkins jenkins) throws IOException {","211","        setCurrentLevel(Jenkins.getVersion());","212","        \/\/TODO: restore when https:\/\/github.com\/jenkinsci\/jenkins\/pull\/2281 gets merged","213","        \/\/ jenkins.getInstallState().proceedToNextState();","214","    }","215","    ","216","    \/*package*\/ static void setCurrentLevel(VersionNumber v) throws IOException {","236","    public static VersionNumber getCurrentLevel() {","278","    \/*package*\/ JSONArray getPlatformPluginUpdates() {","354","                                    plugin.put(\"suggested\", false);","355","                                    continue nextPlugin;","376","        return jenkins.getRootPath().child(\"secrets\/initialAdminPassword\");","383","        completeSetup(jenkins);","384","        PluginServletFilter.removeFilter(FORCE_SETUP_WIZARD_FILTER);","388","    static void completeSetup(Jenkins jenkins) {","389","        jenkins.setInstallState(InstallState.INITIAL_SETUP_COMPLETED);","391","        try {","392","            completeUpgrade(jenkins);","393","        } catch(IOException ex) {","394","            LOGGER.log(Level.SEVERE, \"Cannot update the upgrade status\", ex);","396","        \/\/ Also, clean up the setup wizard if it's completed","397","        jenkins.setSetupWizard(null);"]}],"core\/src\/main\/java\/jenkins\/install\/UpgradeWizard.java":[{"add":["2","import static java.util.logging.Level.FINE;","3","","4","import java.io.File;","5","import java.io.IOException;","6","import java.util.concurrent.TimeUnit;","7","import java.util.logging.Level;","8","import java.util.logging.Logger;","9","","10","import javax.inject.Provider;","11","import javax.servlet.http.HttpSession;","12","","17","import org.kohsuke.stapler.Stapler;","21","import hudson.Extension;","22","import hudson.util.HttpResponses;","23","import jenkins.model.Jenkins;","24","import net.sf.json.JSONArray;","27"," * This class is responsible for specific upgrade behaviors in the Jenkins UI.","28"," * ","29"," * Note an instance of this class is already an @Extension in {@link InstallState#UPGRADE}","31"," * @author Kohsuke Kawaguchi, Keith Zantow","34","public class UpgradeWizard extends InstallState {","38","    private volatile boolean isUpToDate = true;","39","    ","41","     * Whether to show the upgrade wizard","43","    private static final String SHOW_UPGRADE_WIZARD_FLAG = UpgradeWizard.class.getName() + \".show\";","45","    \/*package*\/ UpgradeWizard() {","46","        super(\"UPGRADE\", false);","49","    \/**","50","     * Get the upgrade wizard instance","51","     *\/","52","    public static UpgradeWizard get() {","53","        return (UpgradeWizard)InstallState.UPGRADE;","54","    }","55","    ","56","    @Override","57","    public void initializeState() {","58","        \/\/ Initializing this state is directly related to ","59","        \/\/ running the detached plugin checks, these should be consolidated somehow","60","        updateUpToDate();","61","        ","62","        \/\/ If there are no platform updates, proceed to running","63","        if (isUpToDate) {","64","            if (Jenkins.getInstance().getSetupWizard().getPlatformPluginUpdates().isEmpty()) {","65","                Jenkins.getInstance().setInstallState(InstallState.RUNNING);","66","            }","67","        }","68","    }","69","    ","70","    @Override","71","    public boolean isSetupComplete() {","72","        return !isDue();","73","    }","74","    ","75","    private void updateUpToDate() {","76","        \/\/ If we don't have any platform plugins, it's considered 'up to date' in terms","77","        \/\/ of the updater","78","        try {","79","            JSONArray platformPlugins = Jenkins.getInstance().getSetupWizard().getPlatformPluginUpdates();","80","            isUpToDate = platformPlugins.isEmpty();","81","        } catch(Exception e) {","82","            LOGGER.log(Level.WARNING, \"Unable to get the platform plugin update list.\", e);","83","        }","90","        if (isUpToDate)","94","        if (!Jenkins.getInstance().hasPermission(Jenkins.ADMINISTER))","102","        return System.currentTimeMillis() > SetupWizard.getUpdateStateFile().lastModified();","103","    }","104","    ","105","    \/**","106","     * Whether to show the upgrade wizard","107","     *\/","108","    public boolean isShowUpgradeWizard() {","109","        HttpSession session = Stapler.getCurrentRequest().getSession(false);","110","        if(session != null) {","111","            return Boolean.TRUE.equals(session.getAttribute(SHOW_UPGRADE_WIZARD_FLAG));","112","        }","113","        return false;","114","    }","115","    \/**","116","     * Call this to show the upgrade wizard","117","     *\/","118","    public HttpResponse doShowUpgradeWizard() throws Exception {","119","        Jenkins.getInstance().checkPermission(Jenkins.ADMINISTER);","120","        HttpSession session = Stapler.getCurrentRequest().getSession(true);","121","        session.setAttribute(SHOW_UPGRADE_WIZARD_FLAG, true);","122","        return HttpResponses.redirectToContextRoot();","123","    }","124","    ","125","    \/**","126","     * Call this to hide the upgrade wizard","127","     *\/","128","    public HttpResponse doHideUpgradeWizard() {","129","        Jenkins.getInstance().checkPermission(Jenkins.ADMINISTER);","130","        HttpSession session = Stapler.getCurrentRequest().getSession(false);","131","        if(session != null) {","132","            session.removeAttribute(SHOW_UPGRADE_WIZARD_FLAG);","133","        }","134","        return HttpResponses.redirectToContextRoot();","142","        Jenkins.getInstance().checkPermission(Jenkins.ADMINISTER);","143","        File f = SetupWizard.getUpdateStateFile();","149","    ","150","    @Extension","151","    public static class ListenForInstallComplete extends InstallStateFilter {","152","        @Override","153","        public InstallState getNextInstallState(InstallState current, Provider<InstallState> proceed) {","154","            InstallState next = proceed.get();","155","            if (InstallState.INITIAL_SETUP_COMPLETED.equals(current)) {","156","                UpgradeWizard.get().isUpToDate = true;","158","            return next;"],"delete":["2","import hudson.Extension;","3","import hudson.model.PageDecorator;","4","import hudson.model.UpdateSite.Plugin;","5","import hudson.util.HttpResponses;","6","import hudson.util.VersionNumber;","7","import jenkins.model.Jenkins;","15","import javax.inject.Inject;","16","import java.io.File;","17","import java.io.IOException;","18","import java.util.Arrays;","19","import java.util.concurrent.TimeUnit;","20","import java.util.logging.Logger;","21","","22","import static java.util.logging.Level.*;","23","import static org.apache.commons.io.FileUtils.*;","24","import static org.apache.commons.lang.StringUtils.*;","27"," * This is a stop-gap measure until JENKINS-33663 comes in.","28"," * This call may go away. Please don't use it from outside.","30"," * @author Kohsuke Kawaguchi","33","@Extension","34","public class UpgradeWizard extends PageDecorator {","35","    @Inject","36","    private Jenkins jenkins;","37","","41","    private volatile boolean upToDate;","42","","44","     * File that captures the state of upgrade.","45","     *","46","     * This file records the vesrion number that the installation has upgraded to.","48","    \/*package*\/ File getStateFile() {","49","        return new File(Jenkins.getInstance().getRootDir(),\"jenkins.install.UpgradeWizard.state\");","50","    }","52","    public UpgradeWizard() throws IOException {","53","        updateUpToDate();","54","    }","55","","56","    private void updateUpToDate() throws IOException {","57","        upToDate = new VersionNumber(\"2.0\").compareTo(getCurrentLevel()) <= 0;","58","    }","59","","60","    \/**","61","     * What is the version the upgrade wizard has run the last time and upgraded to?","62","     *\/","63","    private VersionNumber getCurrentLevel() throws IOException {","64","        VersionNumber from = new VersionNumber(\"1.0\");","65","        File state = getStateFile();","66","        if (state.exists()) {","67","            from = new VersionNumber(defaultIfBlank(readFileToString(state), \"1.0\").trim());","68","        }","69","        return from;","70","    }","71","","72","    \/*package*\/","73","    void setCurrentLevel(VersionNumber v) throws IOException {","74","        FileUtils.writeStringToFile(getStateFile(), v.toString());","75","        updateUpToDate();","78","    static void completeUpgrade(Jenkins jenkins) throws IOException {","79","        \/\/ this was determined to be a new install, don't run the update wizard here","80","        UpgradeWizard uw = jenkins.getInjector().getInstance(UpgradeWizard.class);","81","        if (uw!=null)","82","            uw.setCurrentLevel(new VersionNumber(\"2.0\"));","89","        if (upToDate)","93","        if (!jenkins.hasPermission(Jenkins.ADMINISTER))","101","        return System.currentTimeMillis() > getStateFile().lastModified();","109","        jenkins.checkPermission(Jenkins.ADMINISTER);","110","        File f = getStateFile();","116","","117","    \/**","118","     * Performs the upgrade activity.","119","     *\/","120","    @RequirePOST","121","    public HttpResponse doUpgrade() throws IOException {","122","        jenkins.checkPermission(Jenkins.ADMINISTER);","123","        try {","124","            if (new VersionNumber(\"2.0\").compareTo(getCurrentLevel())>0) {","125","                \/\/ 1.0 -> 2.0 upgrade","126","                LOGGER.log(WARNING, \"Performing 1.0 to 2.0 upgrade\");","127","","128","                for (String shortName : Arrays.asList(\"workflow-aggregator\", \"pipeline-stage-view\", \"github-organization-folder\")) {","129","                    Plugin p = jenkins.getUpdateCenter().getPlugin(shortName);","130","                    if (p==null) {","131","                        LOGGER.warning(\"Plugin not found in the update center: \" + shortName);","132","                    } else {","133","                        p.deploy(true);","134","                    }","135","                }","136","","137","                \/\/ upgrade to 2.0 complete (if plugin installations fail, that's too bad)","138","                FileUtils.writeStringToFile(getStateFile(),\"2.0\");","139","","140","                \/\/ send the user to the update center so that people can see the installation & restart if need be.","141","                return HttpResponses.redirectViaContextPath(\"updateCenter\/\");","143","","144","\/\/      in the future...","145","\/\/        if (new VersionNumber(\"3.0\").compareTo(getCurrentLevel())>0) {","146","\/\/","147","\/\/        }","148","","149","            return NOOP;","150","        } finally {","151","            updateUpToDate();","155","    \/*package*\/ static final HttpResponse NOOP = HttpResponses.redirectToContextRoot();","156","","157",""]}],"core\/src\/main\/resources\/jenkins\/install\/SetupWizard\/client-scripts.jelly":[{"add":[],"delete":[]}],"test\/src\/test\/java\/jenkins\/install\/InstallUtilTest.java":[{"add":["83","        \/\/ A new test instance sets up security first","84","        Assert.assertEquals(InstallState.INITIAL_SECURITY_SETUP, InstallUtil.getNextInstallState(InstallState.UNKNOWN));","85","","86","        \/\/ And proceeds to the new state","87","        Assert.assertEquals(InstallState.NEW, InstallUtil.getNextInstallState(InstallState.INITIAL_SECURITY_SETUP));","100","        Assert.assertEquals(InstallState.RESTART, InstallUtil.getNextInstallState(InstallState.UNKNOWN));","104","        Assert.assertEquals(InstallState.UPGRADE, InstallUtil.getNextInstallState(InstallState.UNKNOWN));","108","        Assert.assertEquals(InstallState.DOWNGRADE, InstallUtil.getNextInstallState(InstallState.UNKNOWN));"],"delete":["38","import org.junit.rules.TemporaryFolder;","84","        \/\/ A new test instance","85","        Assert.assertEquals(InstallState.NEW, InstallUtil.getInstallState());","98","        Assert.assertEquals(InstallState.RESTART, InstallUtil.getInstallState());","102","        Assert.assertEquals(InstallState.UPGRADE, InstallUtil.getInstallState());","106","        Assert.assertEquals(InstallState.DOWNGRADE, InstallUtil.getInstallState());"]}],"war\/src\/main\/js\/templates\/successPanel.hbs":[{"add":["22","    {{#if failedPlugins}}"],"delete":["22","\t{{#if failedPlugins}}"]}],"core\/src\/main\/resources\/jenkins\/model\/Jenkins\/loginError.jelly":[{"add":["29","    <j:when test=\"${app.setupWizard.isUsingSecurityToken()}\">"],"delete":["29","    <j:when test=\"${app.setupWizard != null and app.setupWizard.useGeneratedPassword()}\">"]}]}},"066d5637fa97b73c785ba5be44488b48533e9728":{"changes":{"core\/src\/main\/java\/hudson\/model\/Job.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/Job.java":[{"add":["305","     * {@link #getLastBuild()} returns. Otherwise it'll be no-op.","310","        RunT lb = getLastBuild();","311","        if (lb!=null ?  next>lb.getNumber() : next>0) {"],"delete":["305","     * {@link #getNextBuildNumber()} returns. Otherwise it'll be no-op.","310","        if (next > nextBuildNumber) {"]}]}},"f34e35e245be26071c98b9c9d925c68eade32c3c":{"changes":{"core\/src\/main\/java\/hudson\/Functions.java":"MODIFY","core\/src\/main\/java\/hudson\/PluginManager.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/Functions.java":[{"add":["32","import hudson.util.Iterators;","453","     * This version is so that the 'checkPermission' on <tt>layout.jelly<\/tt>","454","     * degrades gracefully if \"it\" is not an {@link AccessControlled} object.","455","     * Otherwise it will perform no check and that problem is hard to notice.","456","     *\/","457","    public static void checkPermission(Object object, Permission permission) throws IOException, ServletException {","458","        if (object instanceof AccessControlled)","459","            checkPermission((AccessControlled) object,permission);","460","        else {","461","            List<Ancestor> ancs = Stapler.getCurrentRequest().getAncestors();","462","            for(Ancestor anc : Iterators.reverse(ancs)) {","463","                Object o = anc.getObject();","464","                if (o instanceof AccessControlled) {","465","                    checkPermission((AccessControlled) o,permission);","466","                    return;","467","                }","468","            }","469","            throw new AssertionError(); \/\/ ancestor must include Hudson, which is AccessControlled.","470","        }","471","    }","472","","473","    \/**"],"delete":[]}],"core\/src\/main\/java\/hudson\/PluginManager.java":[{"add":["188","        Hudson.getInstance().checkPermission(Hudson.ADMINISTER);","189",""],"delete":[]}]}},"3c10f1f7b905feb5b1f7c4b3a1d98048defda3a3":{"changes":{"core\/src\/main\/java\/hudson\/init\/impl\/InstallUncaughtExceptionHandler.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/init\/impl\/InstallUncaughtExceptionHandler.java":[{"add":["13","import java.util.logging.Level;","14","import java.util.logging.Logger;","15","","42","        Thread.setDefaultUncaughtExceptionHandler(new DefaultUncaughtExceptionHandler());","43","    }","44","","45","    \/** An UncaughtExceptionHandler that just logs the exception *\/","46","    private static class DefaultUncaughtExceptionHandler implements Thread.UncaughtExceptionHandler {","47","","48","        private static final Logger LOGGER = Logger.getLogger(InstallUncaughtExceptionHandler.class.getName());","49","","50","        @Override","51","        public void uncaughtException(Thread t, Throwable ex) {","52","            \/\/ if this was an OutOfMemoryError then all bets about logging are off - but in the absence of anything else...","53","            LOGGER.log(Level.SEVERE,","54","                       \"A thread (\" + t.getName() + '\/' + t.getId()","55","                                     + \") died unexepectedly due to an uncaught exception, this may leave your Jenkins in a bad way and is usually indicitive of a bug in the code.\",","56","                       ex);","57","        }","58",""],"delete":[]}]}},"58af1d629a8b1eb9c088b15621b35a22cd770663":{"changes":{"changelog.html":"MODIFY","war\/pom.xml":"MODIFY"},"diff":{"changelog.html":[{"add":["57","  <li class='rfe'>","58","    Upgrade bundled plugin versions: ssh-slaves to 1.5, and credentials to 1.9.1","59","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-20071\">issue 20071<\/a>)"],"delete":["57","  <li class=>"]}],"war\/pom.xml":[{"add":["271","                  <version>1.5<\/version>","277","                  <version>1.9.1<\/version>"],"delete":["271","                  <version>1.4<\/version>","277","                  <version>1.8.3<\/version>"]}]}},"aded9afbe6155b60a757828b19a34895e37c732e":{"changes":{"core\/src\/main\/java\/hudson\/model\/Hudson.java":"MODIFY","core\/src\/main\/java\/hudson\/init\/InitializerFinder.java":"MODIFY","core\/src\/main\/java\/hudson\/PluginManager.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/Hudson.java":[{"add":[],"delete":["628","                    new InitializerFinder(),        \/\/ misc. stuff"]}],"core\/src\/main\/java\/hudson\/init\/InitializerFinder.java":[{"add":["39","import java.util.HashSet;","41","import java.util.Set;","56","    private final Set<Method> discovered = new HashSet<Method>();","57","","69","            if (!discovered.add(e))","70","                continue;   \/\/ already reported once","71",""],"delete":[]}],"core\/src\/main\/java\/hudson\/PluginManager.java":[{"add":["31","import hudson.init.InitializerFinder;","252","        final InitializerFinder initializerFinder = new InitializerFinder(uberClassLoader);        \/\/ misc. stuff","253","","255","        return TaskBuilder.union(initializerFinder, \/\/ this scans @Initializer in the core once","256","            builder,new TaskGraphBuilder() {{","298","                    g.followedBy().attains(PLUGINS_STARTED).add(\"Discovering plugin initialization tasks\", new Executable() {","299","                        public void run(Reactor reactor) throws Exception {","300","                            \/\/ rescan to find plugin-contributed @Initializer","301","                            reactor.addAll(initializerFinder.discoverTasks(reactor));","302","                        }","303","                    });","304",""],"delete":["252","        return TaskBuilder.union(builder,new TaskGraphBuilder() {{"]}]}},"be0238644911948da4123b5338f0299198dcc048":{"changes":{"test\/src\/test\/java\/hudson\/model\/QueueTest.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/Queue.java":"MODIFY"},"diff":{"test\/src\/test\/java\/hudson\/model\/QueueTest.java":[{"add":["71","import jenkins.model.BlockedBecauseOfBuildInProgress;","532","        private final boolean isBlocked;","533","","535","            this(cnt, false);","537","","538","        TestTask(AtomicInteger cnt, boolean isBlocked) {","539","            this.cnt = cnt;","540","            this.isBlocked = isBlocked;","541","        }","542","","549","        @Override public boolean isBuildBlocked() {return isBlocked;}","782","","989","","990","    @Test","991","    public void testDefaultImplementationOfGetCauseOfBlockageForBlocked() throws Exception {","992","        Queue queue = r.getInstance().getQueue();","993","        queue.schedule2(new TestTask(new AtomicInteger(0), true), 0);","994","","995","        queue.maintain();","996","","997","        assertEquals(1, r.jenkins.getQueue().getBlockedItems().size());","998","        CauseOfBlockage actual = r.jenkins.getQueue().getBlockedItems().get(0).getCauseOfBlockage();","999","        CauseOfBlockage expected = CauseOfBlockage.fromMessage(Messages._Queue_Unknown());","1000","","1001","        assertEquals(expected.getShortDescription(), actual.getShortDescription());","1002","    }","1003","","1004","    @Test","1005","    public void testGetCauseOfBlockageForNonConcurrentFreestyle() throws Exception {","1006","        Queue queue = r.getInstance().getQueue();","1007","        FreeStyleProject t1 = r.createFreeStyleProject(\"project\");","1008","        t1.getBuildersList().add(new SleepBuilder(TimeUnit.SECONDS.toMillis(30)));","1009","        t1.setConcurrentBuild(false);","1010","","1011","        t1.scheduleBuild2(0).waitForStart();","1012","        t1.scheduleBuild2(0);","1013","","1014","        queue.maintain();","1015","","1016","        assertEquals(1, r.jenkins.getQueue().getBlockedItems().size());","1017","        CauseOfBlockage actual = r.jenkins.getQueue().getBlockedItems().get(0).getCauseOfBlockage();","1018","        CauseOfBlockage expected = new BlockedBecauseOfBuildInProgress(t1.getFirstBuild());","1019","","1020","        assertEquals(expected.getShortDescription(), actual.getShortDescription());","1021","    }"],"delete":["532","            this.cnt = cnt;","540","        @Override public boolean isBuildBlocked() {return false;}","773","        "]}],"core\/src\/main\/java\/hudson\/model\/Queue.java":[{"add":["1177","     *","1178","     * @return the reason of blockage if it exists null otherwise.","1180","    @CheckForNull","1181","    private CauseOfBlockage getCauseOfBlockageForItem(Item i) {","1182","        CauseOfBlockage causeOfBlockage = getCauseOfBlockageForTask(i.task);","1183","        if (causeOfBlockage != null) {","1184","            return causeOfBlockage;","1187","        for (QueueTaskDispatcher d : QueueTaskDispatcher.all()) {","1188","            causeOfBlockage = d.canRun(i);","1189","            if (causeOfBlockage != null)","1190","                return causeOfBlockage;","1191","        }","1192","","1193","        if(!(i instanceof BuildableItem)) {","1194","            \/\/ Make sure we don't queue two tasks of the same project to be built","1195","            \/\/ unless that project allows concurrent builds. Once item is buildable it's ok.","1196","            \/\/","1197","            \/\/ This check should never pass. And must be remove once we can completely rely on `getCauseOfBlockage`.","1198","            \/\/ If `task.isConcurrentBuild` returns `false`,","1199","            \/\/ it should also return non-null value for `task.getCauseOfBlockage` in case of on-going execution.","1200","            \/\/ But both are public non-final methods, so, we need to keep backward compatibility here.","1201","            \/\/ And check one more time across all `buildables` and `pendings` for O(N) each.","1202","            if (!i.task.isConcurrentBuild() && (buildables.containsKey(i.task) || pendings.containsKey(i.task))) {","1203","                return CauseOfBlockage.fromMessage(Messages._Queue_InProgress());","1204","            }","1205","        }","1206","","1207","        return null;","1211","     *","1212","     * Checks if the given task knows the reasons to be blocked or it needs some unavailable resources","1213","     *","1214","     * @param task the task.","1215","     * @return the reason of blockage if it exists null otherwise.","1217","    @CheckForNull","1218","    private CauseOfBlockage getCauseOfBlockageForTask(Task task) {","1219","        CauseOfBlockage causeOfBlockage = task.getCauseOfBlockage();","1220","        if (causeOfBlockage != null) {","1221","            return task.getCauseOfBlockage();","1223","","1224","        if (!canRun(task.getResourceList())) {","1225","            ResourceActivity r = getBlockingActivity(task);","1226","            if (r != null) {","1227","                if (r == task) \/\/ blocked by itself, meaning another build is in progress","1228","                    return CauseOfBlockage.fromMessage(Messages._Queue_InProgress());","1229","                return CauseOfBlockage.fromMessage(Messages._Queue_BlockedBy(r.getDisplayName()));","1230","            }","1231","        }","1232","","1233","        return null;","1509","                    CauseOfBlockage causeOfBlockage = getCauseOfBlockageForItem(p);","1510","                    if (causeOfBlockage == null) {","1525","                    } else {","1526","                        p.setCauseOfBlockage(causeOfBlockage);","1541","                CauseOfBlockage causeOfBlockage = getCauseOfBlockageForItem(top);","1542","                if (causeOfBlockage == null) {","1551","                        new BlockedItem(top, CauseOfBlockage.fromMessage(Messages._Queue_HudsonIsAboutToShutDown())).enter(this);","1556","                    new BlockedItem(top, causeOfBlockage).enter(this);","1570","                CauseOfBlockage causeOfBlockage = getCauseOfBlockageForItem(p);","1571","                if (causeOfBlockage != null) {","1573","                    new BlockedItem(p, causeOfBlockage).enter(this);","1637","                    \/\/ of getCauseOfBlockageForItem(p) will become a bottleneck before updateSnapshot() will. Additionally","1818","         * Short-hand for {@code getCauseOfBlockageForItem()!=null}.","1843","            if (isBuildBlocked()) {","1844","                return CauseOfBlockage.fromMessage(Messages._Queue_Unknown());","1845","            }","2498","        private transient CauseOfBlockage causeOfBlockage = null;","2499","","2500","        \/**","2501","         * @deprecated Use {@link #BlockedItem(WaitingItem, CauseOfBlockage)} instead","2502","         *\/","2503","        @Deprecated","2505","            this(wi, null);","2508","        \/**","2509","         * @deprecated Use {@link #BlockedItem(NotWaitingItem, CauseOfBlockage)} instead","2510","         *\/","2511","        @Deprecated","2513","            this(ni, null);","2514","        }","2515","","2516","        public BlockedItem(WaitingItem wi, CauseOfBlockage causeOfBlockage) {","2517","            super(wi);","2518","            this.causeOfBlockage = causeOfBlockage;","2519","        }","2520","","2521","        public BlockedItem(NotWaitingItem ni, CauseOfBlockage causeOfBlockage) {","2523","            this.causeOfBlockage = causeOfBlockage;","2524","        }","2525","","2526","        public void setCauseOfBlockage(CauseOfBlockage causeOfBlockage) {","2527","            this.causeOfBlockage = causeOfBlockage;","2531","            if (causeOfBlockage != null) {","2532","                return causeOfBlockage;","2535","            \/\/ fallback for backward compatibility","2536","            return getCauseOfBlockageForItem(this);"],"delete":["1178","    private boolean isBuildBlocked(Item i) {","1179","        if (i.task.isBuildBlocked() || !canRun(i.task.getResourceList()))","1180","            return true;","1181","","1182","        for (QueueTaskDispatcher d : QueueTaskDispatcher.all()) {","1183","            if (d.canRun(i)!=null)","1184","                return true;","1187","        return false;","1191","     * Make sure we don't queue two tasks of the same project to be built","1192","     * unless that project allows concurrent builds.","1194","    private boolean allowNewBuildableTask(Task t) {","1195","        if (t.isConcurrentBuild()) {","1196","            return true;","1198","        return !buildables.containsKey(t) && !pendings.containsKey(t);","1474","                    if (!isBuildBlocked(p) && allowNewBuildableTask(p.task)) {","1503","                Task p = top.task;","1504","                if (!isBuildBlocked(top) && allowNewBuildableTask(p)) {","1513","                        new BlockedItem(top).enter(this);","1518","                    new BlockedItem(top).enter(this);","1532","                if (isBuildBlocked(p)) {","1534","                    new BlockedItem(p).enter(this);","1598","                    \/\/ of isBuildBlocked(p) will become a bottleneck before updateSnapshot() will. Additionally","1779","         * Short-hand for {@code getCauseOfBlockage()!=null}.","2457","            super(wi);","2465","            ResourceActivity r = getBlockingActivity(task);","2466","            if (r != null) {","2467","                if (r == task) \/\/ blocked by itself, meaning another build is in progress","2468","                    return CauseOfBlockage.fromMessage(Messages._Queue_InProgress());","2469","                return CauseOfBlockage.fromMessage(Messages._Queue_BlockedBy(r.getDisplayName()));","2472","            for (QueueTaskDispatcher d : QueueTaskDispatcher.all()) {","2473","                CauseOfBlockage cause = d.canRun(this);","2474","                if (cause != null)","2475","                    return cause;","2476","            }","2477","","2478","            return task.getCauseOfBlockage();"]}]}},"fd2009a9712b8b0a8c310d687df07df60edbc8ad":{"changes":{"core\/src\/main\/java\/hudson\/model\/AllView.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/MyViewsProperty.java":"MODIFY","core\/src\/main\/java\/jenkins\/model\/Jenkins.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/ViewGroupMixIn.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/AllView.java":[{"add":["120","     * its name is one of the localized forms of {@link Messages#_Hudson_ViewName()} and the user has not opted out of","121","     * fixing the view name by setting the system property {@code hudson.mode.AllView.JENKINS-38606} to {@code false}.","128","     * its {@code \/view\/_name_} url which will then fall back to the primary view)","137","    public static String migrateLegacyPrimaryAllViewLocalizedName(@Nonnull List<View> views,","138","                                                                  @Nonnull String primaryView) {","143","        if (SystemProperties.getBoolean(AllView.class.getName()+\".JENKINS-38606\", true)) {"],"delete":["120","     * its name is one of the localized forms of {@link Messages#_Hudson_ViewName()} and the user has opted in to","121","     * fixing the view name by setting the system property {@code hudson.mode.AllView.JENKINS-38606} to {@code true}.","128","     * its {@code \/view\/_name_} url which is why users need to opt-in to this fix.","137","    public static String applyJenkins38606Fixup(@Nonnull List<View> views, @Nonnull String primaryView) {","142","        if (SystemProperties.getBoolean(AllView.class.getName()+\".JENKINS-38606\")) {"]}],"core\/src\/main\/java\/hudson\/model\/MyViewsProperty.java":[{"add":["89","        primaryViewName = AllView.migrateLegacyPrimaryAllViewLocalizedName(views, primaryViewName);"],"delete":["89","        primaryViewName = AllView.applyJenkins38606Fixup(views, primaryViewName);"]}],"core\/src\/main\/java\/jenkins\/model\/Jenkins.java":[{"add":["3059","                primaryView = AllView.migrateLegacyPrimaryAllViewLocalizedName(views, primaryView);"],"delete":["3059","                primaryView =AllView.applyJenkins38606Fixup(views, primaryView);"]}],"core\/src\/main\/java\/hudson\/model\/ViewGroupMixIn.java":[{"add":["28","import java.util.Locale;","29","import java.util.logging.Level;","103","            if (pv instanceof AllView && AllView.DEFAULT_VIEW_NAME.equals(pv.name)) {","104","                \/\/ JENKINS-38606: primary view is the default AllView, is somebody using an old link to localized form?","105","                for (Locale l : Locale.getAvailableLocales()) {","106","                    if (name.equals(Messages._Hudson_ViewName().toString(l))) {","107","                        \/\/ why yes they are, let's keep that link working","108","                        return pv;","109","                    }","110","                }","111","            }"],"delete":[]}]}},"d425d2f79d6bfbbf3c89c37b748aa8028dda9ed9":{"changes":{"test\/src\/main\/java\/org\/jvnet\/hudson\/test\/HudsonHomeLoader.java":"MODIFY"},"diff":{"test\/src\/main\/java\/org\/jvnet\/hudson\/test\/HudsonHomeLoader.java":[{"add":["84","                File src = new File(source.toURI());","118","            File home = new File(res.toURI());"],"delete":["84","                File src = new File(source.toURI().getPath());","118","            File home = new File(res.toURI().getPath());"]}]}},"1ac77750e93f9a1970fecbecdf7f84279d0a62b9":{"changes":{"core\/src\/main\/java\/hudson\/model\/DownloadService.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/UpdateCenter.java":"MODIFY","core\/src\/main\/java\/hudson\/PluginManager.java":"MODIFY","core\/src\/main\/resources\/jenkins\/security\/DownloadSettings\/config.groovy":"ADD","core\/src\/main\/java\/jenkins\/security\/DownloadSettings.java":"ADD","core\/src\/main\/java\/hudson\/util\/FormValidation.java":"MODIFY","core\/src\/main\/resources\/jenkins\/security\/Messages.properties":"MODIFY","test\/src\/test\/java\/hudson\/model\/DownloadServiceTest.java":"MODIFY","core\/src\/main\/resources\/hudson\/PluginManager\/advanced.jelly":"MODIFY","core\/src\/main\/resources\/jenkins\/security\/DownloadSettings\/help-checkSignature.html":"ADD","core\/src\/main\/resources\/hudson\/model\/UpdateCenter\/PageDecoratorImpl\/footer.jelly":"MODIFY","core\/src\/main\/resources\/jenkins\/security\/DownloadSettings\/help-useBrowser.html":"ADD","core\/src\/main\/java\/hudson\/model\/UpdateSite.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/DownloadService.java":[{"add":["28","import hudson.ProxyConfiguration;","34","import static hudson.util.TimeUnit2.DAYS;","35","import java.io.File;","36","import java.io.IOException;","37","import java.io.InputStream;","38","import java.net.URL;","39","import java.net.URLEncoder;","40","import java.util.logging.Logger;","41","import jenkins.security.DownloadSettings;","46","import org.kohsuke.accmod.Restricted;","47","import org.kohsuke.accmod.restrictions.NoExternalUse;","48","import org.kohsuke.stapler.Stapler;","68","        if (!DownloadSettings.get().isUseBrowser()) {","69","            return \"\";","70","        }","145","     * Loads JSON from a JSONP URL.","146","     * Metadata for downloadables and update centers is offered in two formats, both designed for download from the browser (predating {@link DownloadSettings}):","147","     * HTML using {@code postMessage} for newer browsers, and JSONP as a fallback.","148","     * Confusingly, the JSONP files are given the {@code *.json} file extension, when they are really JavaScript and should be {@code *.js}.","149","     * This method extracts the JSON from a JSONP URL, since that is what we actually want when we download from the server.","150","     * (Currently the true JSON is not published separately, and extracting from the {@code *.json.html} is more work.)","151","     * @param src a URL to a JSONP file (typically including {@code id} and {@code version} query parameters)","152","     * @return the embedded JSON text","153","     * @throws IOException if either downloading or processing failed","154","     *\/","155","    @Restricted(NoExternalUse.class)","156","    public static String loadJSON(URL src) throws IOException {","157","        InputStream is = ProxyConfiguration.open(src).getInputStream();","158","        try {","159","            String jsonp = IOUtils.toString(is, \"UTF-8\");","160","            int start = jsonp.indexOf('{');","161","            int end = jsonp.lastIndexOf('}');","162","            if (start >= 0 && end > start) {","163","                return jsonp.substring(start, end + 1);","164","            } else {","165","                throw new IOException(\"Could not find JSON in \" + src);","166","            }","167","        } finally {","168","            is.close();","169","        }","170","    }","171","","172","    \/**","285","            if (!DownloadSettings.get().isUseBrowser()) {","286","                throw new IOException(\"not allowed\");","287","            }","292","            FormValidation e = load(json, dataTimestamp);","293","            if (e.kind != Kind.OK) {","294","                LOGGER.severe(e.renderHtml());","295","                throw e;","296","            }","297","            rsp.setContentType(\"text\/plain\");  \/\/ So browser won't try to parse response","298","        }","299","","300","        private FormValidation load(String json, long dataTimestamp) throws IOException {","303","            if (DownloadSettings.get().isCheckSignature()) {","306","                    return e;","314","            return FormValidation.ok();","315","        }","317","        @Restricted(NoExternalUse.class)","318","        public FormValidation updateNow() throws IOException {","319","            return load(loadJSON(new URL(getUrl() + \"?id=\" + URLEncoder.encode(getId(), \"UTF-8\") + \"&version=\" + URLEncoder.encode(Jenkins.VERSION, \"UTF-8\"))), System.currentTimeMillis());","347","    \/** @deprecated Use {@link DownloadSettings#setIgnoreSignature} instead. *\/"],"delete":["36","import org.kohsuke.stapler.Stapler;","37","","38","import java.io.File;","39","import java.io.IOException;","40","import java.util.logging.Logger;","41","","46","import static hudson.util.TimeUnit2.DAYS;","47","","256","            if (signatureCheck) {","259","                    LOGGER.severe(e.renderHtml());","260","                    throw e;","269","            rsp.setContentType(\"text\/plain\");  \/\/ So browser won't try to parse response","297","    \/**","298","     * Off by default until we know this is reasonably working.","299","     *\/"]}],"core\/src\/main\/java\/hudson\/model\/UpdateCenter.java":[{"add":["90","import jenkins.security.DownloadSettings;","633","            Future<FormValidation> future = site.updateDirectly(DownloadSettings.get().isCheckSignature());"],"delete":["632","            Future<FormValidation> future = site.updateDirectly(true);"]}],"core\/src\/main\/java\/hudson\/PluginManager.java":[{"add":["110","import hudson.model.DownloadService;","111","import hudson.util.FormValidation;","113","import jenkins.security.DownloadSettings;","114","import org.kohsuke.accmod.Restricted;","115","import org.kohsuke.accmod.restrictions.NoExternalUse;","782","    @Restricted(NoExternalUse.class)","783","    @RequirePOST public HttpResponse doCheckUpdatesServer() throws IOException {","784","        for (UpdateSite site : Jenkins.getInstance().getUpdateCenter().getSites()) {","785","            FormValidation v = site.updateDirectlyNow(DownloadSettings.get().isCheckSignature());","786","            if (v.kind != FormValidation.Kind.OK) {","787","                \/\/ TODO crude but enough for now","788","                return v;","789","            }","790","        }","791","        for (DownloadService.Downloadable d : DownloadService.Downloadable.all()) {","792","            FormValidation v = d.updateNow();","793","            if (v.kind != FormValidation.Kind.OK) {","794","                return v;","795","            }","796","        }","797","        return HttpResponses.forwardToPreviousPage();","798","    }","799",""],"delete":[]}],"core\/src\/main\/resources\/jenkins\/security\/DownloadSettings\/config.groovy":[{"add":[],"delete":[]}],"core\/src\/main\/java\/jenkins\/security\/DownloadSettings.java":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/util\/FormValidation.java":[{"add":["241","                StaplerRequest req = Stapler.getCurrentRequest();","242","                if (req == null) { \/\/ being called from some other context","243","                    return message;","244","                }","247","                        req.getContextPath()+ Jenkins.RESOURCE_PATH+\"\/images\/none.gif' height=16 width=1>\"+"],"delete":["243","                        Stapler.getCurrentRequest().getContextPath()+ Jenkins.RESOURCE_PATH+\"\/images\/none.gif' height=16 width=1>\"+"]}],"core\/src\/main\/resources\/jenkins\/security\/Messages.properties":[{"add":["24","DownloadSettings.disabling_signature_checks_for_in_browse=Disabling signature checks for in-browser downloads is <em>very dangerous<\/em> as unprivileged users could submit spoofed metadata!","25","DownloadSettings.disabling_signature_checks_is_not_recomm=Disabling signature checks is not recommended except as a temporary measure when upstream metadata is broken, such as due to expired certificates.","26","RekeySecretAdminMonitor.DisplayName=Re-keying"],"delete":["24","RekeySecretAdminMonitor.DisplayName=Re-keying"]}],"test\/src\/test\/java\/hudson\/model\/DownloadServiceTest.java":[{"add":["9","import jenkins.security.DownloadSettings;","43","        DownloadSettings.get().setCheckSignature(false);","49","            DownloadSettings.get().setCheckSignature(true);"],"delete":["42","        DownloadService.signatureCheck = false;","48","            DownloadService.signatureCheck = true;"]}],"core\/src\/main\/resources\/hudson\/PluginManager\/advanced.jelly":[{"add":["98","      <j:invokeStatic var=\"ds\" className=\"jenkins.security.DownloadSettings\" method=\"get\"\/>","99","      <form method=\"post\" action=\"${ds.useBrowser ? 'checkUpdates' : 'checkUpdatesServer'}\">"],"delete":["98","      <form method=\"post\" action=\"checkUpdates\">"]}],"core\/src\/main\/resources\/jenkins\/security\/DownloadSettings\/help-checkSignature.html":[{"add":[],"delete":[]}],"core\/src\/main\/resources\/hudson\/model\/UpdateCenter\/PageDecoratorImpl\/footer.jelly":[{"add":["33","  <j:invokeStatic var=\"ds\" className=\"jenkins.security.DownloadSettings\" method=\"get\"\/>","34","  <j:if test=\"${ds.useBrowser}\">","49","  <\/j:if>"],"delete":[]}],"core\/src\/main\/resources\/jenkins\/security\/DownloadSettings\/help-useBrowser.html":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/UpdateSite.java":[{"add":["36","import static hudson.util.TimeUnit2.*;","55","import javax.annotation.CheckForNull;","56","import javax.annotation.Nonnull;","57","import jenkins.model.Jenkins;","58","import jenkins.security.DownloadSettings;","59","import jenkins.util.JSONSignatureValidator;","60","import net.sf.json.JSONException;","61","import net.sf.json.JSONObject;","62","import org.apache.commons.lang.StringUtils;","63","import org.kohsuke.accmod.Restricted;","64","import org.kohsuke.accmod.restrictions.NoExternalUse;","65","import org.kohsuke.stapler.DataBoundConstructor;","66","import org.kohsuke.stapler.HttpResponse;","67","import org.kohsuke.stapler.StaplerRequest;","68","import org.kohsuke.stapler.export.Exported;","69","import org.kohsuke.stapler.export.ExportedBean;","70","import org.kohsuke.stapler.interceptor.RequirePOST;","155","    public @CheckForNull Future<FormValidation> updateDirectly(final boolean signatureCheck) {","158","                @Override public FormValidation call() throws Exception {","159","                    return updateDirectlyNow(signatureCheck);","162","        } else {","164","        }","165","    }","166","","167","    @Restricted(NoExternalUse.class)","168","    public @Nonnull FormValidation updateDirectlyNow(boolean signatureCheck) throws IOException {","169","        return updateData(DownloadService.loadJSON(new URL(getUrl() + \"?id=\" + URLEncoder.encode(getId(), \"UTF-8\") + \"&version=\" + URLEncoder.encode(Jenkins.VERSION, \"UTF-8\"))), signatureCheck);","176","        if (!DownloadSettings.get().isUseBrowser()) {","177","            throw new IOException(\"not allowed\");","178","        }"],"delete":["29","import hudson.ProxyConfiguration;","38","import jenkins.model.Jenkins;","39","import jenkins.util.JSONSignatureValidator;","40","import net.sf.json.JSONException;","41","import net.sf.json.JSONObject;","42","import org.apache.commons.lang.StringUtils;","43","import org.kohsuke.stapler.DataBoundConstructor;","44","import org.kohsuke.stapler.HttpResponse;","45","import org.kohsuke.stapler.StaplerRequest;","46","import org.kohsuke.stapler.export.Exported;","47","import org.kohsuke.stapler.export.ExportedBean;","48","import org.kohsuke.stapler.interceptor.RequirePOST;","49","","52","import java.io.InputStream;","55","import java.net.URLConnection;","69","","70","import static hudson.util.TimeUnit2.*;","71","","156","    public Future<FormValidation> updateDirectly(final boolean signatureCheck) {","159","                ","160","                public FormValidation call() throws Exception {","161","                    URL src = new URL(getUrl() + \"?id=\" + URLEncoder.encode(getId(),\"UTF-8\") ","162","                            + \"&version=\"+URLEncoder.encode(Jenkins.VERSION, \"UTF-8\"));","163","                    URLConnection conn = ProxyConfiguration.open(src);","164","                    InputStream is = conn.getInputStream();","165","                    try {","166","                        String uncleanJson = IOUtils.toString(is,\"UTF-8\");","167","                        int jsonStart = uncleanJson.indexOf(\"{\\\"\");","168","                        if (jsonStart >= 0) {","169","                            uncleanJson = uncleanJson.substring(jsonStart);","170","                            int end = uncleanJson.lastIndexOf('}');","171","                            if (end>0)","172","                                uncleanJson = uncleanJson.substring(0,end+1);","173","                            return updateData(uncleanJson, signatureCheck);","174","                        } else {","175","                            throw new IOException(\"Could not find json in content of \" +","176","                            \t\t\"update center from url: \"+src.toExternalForm());","177","                        }","178","                    } finally {","179","                        if (is != null)","180","                            is.close();","181","                    }","184","        }"]}]}},"774fa7c0909a12caa4e64ea4efd782e9a55bc0a0":{"changes":{"core\/src\/test\/resources\/hudson\/tasks\/junit\/junit-report-1463.xml":"ADD","core\/src\/test\/resources\/hudson\/tasks\/junit\/junit-report-1233.xml":"ADD","core\/src\/main\/java\/hudson\/tasks\/junit\/SuiteResult.java":"MODIFY","core\/src\/test\/java\/hudson\/tasks\/junit\/SuiteResultTest.java":"ADD"},"diff":{"core\/src\/test\/resources\/hudson\/tasks\/junit\/junit-report-1463.xml":[{"add":[],"delete":[]}],"core\/src\/test\/resources\/hudson\/tasks\/junit\/junit-report-1233.xml":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/tasks\/junit\/SuiteResult.java":[{"add":["74","                ","78","","79","                \/\/ https:\/\/hudson.dev.java.net\/issues\/show_bug.cgi?id=1463 indicates that","80","                \/\/ @classname may not exist in individual testcase elements. We now","81","                \/\/ also test if the testsuite element has a package name that can be used","82","                \/\/ as the class name instead of the file name which is default.","83","                ","84","                String classname = e.attributeValue(\"classname\");","85","                if (classname == null) {","86","                    classname = suite.attributeValue(\"name\");","87","                }","88","                ","89","                if (classname == null) {","90","                    addCase(new CaseResult(this,e));","91","                } else {","92","                    addCase(new CaseResult(this,classname,e));","93","                }"],"delete":["77","                addCase(new CaseResult(this,e.attributeValue(\"classname\"),e));"]}],"core\/src\/test\/java\/hudson\/tasks\/junit\/SuiteResultTest.java":[{"add":[],"delete":[]}]}},"efc1285d67fb7a8e3df2cd1d499a15edc6641d02":{"changes":{"core\/src\/main\/java\/hudson\/cli\/DeleteBuildsCommand.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/cli\/DeleteBuildsCommand.java":[{"add":["31","import java.util.HashSet;","57","        final HashSet<Integer> hsBuilds = new HashSet<Integer>();","59","        for (AbstractBuild build : builds) {","60","            if (!hsBuilds.contains(build.number)) {","61","                build.delete();","62","                hsBuilds.add(build.number);","63","            }","64","        }","65","","66","        stdout.println(\"Deleted \"+hsBuilds.size()+\" builds\");"],"delete":["56","        for (AbstractBuild build : builds)","57","            build.delete();","59","        stdout.println(\"Deleted \"+builds.size()+\" builds\");"]}]}},"245a8bf2c60a63ec1c99bb7833358581ee220b5b":{"changes":{"core\/src\/main\/resources\/hudson\/views\/BuildButtonColumn\/column.jelly":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/views\/BuildButtonColumn\/column.jelly":[{"add":["33","                          <j:set var=\"onclick\" value=\"${null}\"\/>","37","                          <j:set var=\"onclick\" value=\"return build_${id}(this)\"\/>","43","                         onclick=\"${onclick}\""],"delete":["41","                         onclick=\"return build_${id}(this)\""]}]}},"eb18f080bb7e1842ee8031c6a8e6c665e527badf":{"changes":{"changelog.html":"MODIFY","core\/src\/main\/java\/hudson\/PluginManager.java":"MODIFY"},"diff":{"changelog.html":[{"add":["64","  <li class=bug>","65","    NPE from <code>PluginManager<\/code>.","66","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-15511\">issue 15511<\/a>)"],"delete":[]}],"core\/src\/main\/java\/hudson\/PluginManager.java":[{"add":["347","                                if (!activePlugins.contains(p)) {","348","                                    return;","349","                                }"],"delete":[]}]}},"fcf4ca7697b4a5293c95b221669f202621b178f7":{"changes":{"test\/src\/test\/java\/hudson\/model\/ViewTest.java":"MODIFY","core\/src\/main\/resources\/hudson\/model\/View\/main.groovy":"MODIFY","core\/src\/main\/resources\/hudson\/model\/View\/main.properties":"ADD"},"diff":{"test\/src\/test\/java\/hudson\/model\/ViewTest.java":[{"add":["55","import java.util.List;","56","import java.util.logging.Level;","57","import java.util.logging.LogRecord;","66","import org.jvnet.hudson.test.LoggerRule;","79","    @Rule","80","    public LoggerRule logging = new LoggerRule();","514","","515","    @Issue(\"JENKINS-41825\")","516","    @Test","517","    public void brokenGetItems() throws Exception {","518","        logging.capture(100).record(\"\", Level.INFO);","519","        j.jenkins.addView(new BrokenView());","520","        j.createWebClient().goTo(\"view\/broken\/\");","521","        boolean found = false;","522","        LOGS: for (LogRecord record : logging.getRecords()) {","523","            for (Throwable t = record.getThrown(); t != null; t = t.getCause()) {","524","                if (t instanceof IllegalStateException && BrokenView.ERR.equals(t.getMessage())) {","525","                    found = true;","526","                    break LOGS;","527","                }","528","            }","529","        }","530","        assertTrue(found);","531","    }","532","    private static class BrokenView extends ListView {","533","        static final String ERR = \"oops I cannot retrieve items\";","534","        BrokenView() {","535","            super(\"broken\");","536","        }","537","        @Override","538","        public List<TopLevelItem> getItems() {","539","            throw new IllegalStateException(ERR);","540","        }","541","    }"],"delete":["508","    "]}],"core\/src\/main\/resources\/hudson\/model\/View\/main.groovy":[{"add":["5","if (items == null) {","6","    p(_('broken'))","7","} else if (items.isEmpty()) {"],"delete":["5","if (items.isEmpty()) {"]}],"core\/src\/main\/resources\/hudson\/model\/View\/main.properties":[{"add":[],"delete":[]}]}},"47fde3be8f621c93db7291fcfd34d101daab50f7":{"changes":{"core\/src\/main\/java\/hudson\/model\/ListView.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/ListView.java":[{"add":["331","        setIncludeRegex(req.getParameter(\"useincluderegex\") != null ? req.getParameter(\"includeRegex\") : null);","348","        this.includeRegex = Util.nullify(includeRegex);","349","        if (this.includeRegex == null)","351","        else","352","            this.includePattern = Pattern.compile(includeRegex);"],"delete":["331","        setIncludeRegex(req.getParameter(\"useincluderegex\"));","348","        if (includeRegex != null) {","349","            this.includeRegex = Util.nullify(includeRegex);","350","            if (this.includeRegex == null)","351","                this.includePattern = null;","352","            else","353","                this.includePattern = Pattern.compile(includeRegex);","354","        } else {","355","            this.includeRegex = null;","357","        }"]}]}},"d5b716625cd128cd84ad82d618f02b516521cda5":{"changes":{"core\/src\/main\/java\/jenkins\/security\/seed\/UserSeedSecurityListener.java":"MODIFY","test\/src\/test\/java\/jenkins\/security\/seed\/UserSeedSecurityListenerTest.java":"ADD"},"diff":{"core\/src\/main\/java\/jenkins\/security\/seed\/UserSeedSecurityListener.java":[{"add":["46","        putUserSeedInSession(username, true);","51","        putUserSeedInSession(details.getUsername(), false);","54","    private static void putUserSeedInSession(String username, boolean overwriteSessionSeed) {","69","            if (!overwriteSessionSeed && session.getAttribute(UserSeedProperty.USER_SESSION_SEED) != null) {","70","                return;","71","            }","72",""],"delete":["46","        putUserSeedInSession(username);","51","        putUserSeedInSession(details.getUsername());","54","    private void putUserSeedInSession(String username) {"]}],"test\/src\/test\/java\/jenkins\/security\/seed\/UserSeedSecurityListenerTest.java":[{"add":[],"delete":[]}]}},"46d3f2e1d0bee7098e630d9c6913fe25bb2b3753":{"changes":{"test\/src\/test\/java\/jenkins\/security\/Security218CliTest.java":"MODIFY","core\/pom.xml":"MODIFY"},"diff":{"test\/src\/test\/java\/jenkins\/security\/Security218CliTest.java":[{"add":["59","        probe(Payload.CommonsCollections1, 1);","75","        probe(Payload.CommonsCollections3, 1);","89","        probe(Payload.CommonsCollections5, 1);","96","        probe(Payload.CommonsCollections6, 1);"],"delete":["59","        probe(Payload.CommonsCollections1, PayloadCaller.EXIT_CODE_REJECTED);","75","        probe(Payload.CommonsCollections3, PayloadCaller.EXIT_CODE_REJECTED);","89","        probe(Payload.CommonsCollections5, PayloadCaller.EXIT_CODE_REJECTED);","96","        probe(Payload.CommonsCollections6, PayloadCaller.EXIT_CODE_REJECTED);"]}],"core\/pom.xml":[{"add":["493","      <version>3.2.2<\/version>"],"delete":["493","      <version>3.2.1<\/version>"]}]}},"481fd5ab2eee2277d6c6f535eb4c1fbc4b155a5c":{"changes":{"core\/src\/main\/java\/hudson\/Proc.java":"MODIFY","core\/src\/main\/java\/hudson\/maven\/MavenProcessFactory.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/Proc.java":[{"add":["52","     * Checks if the process is still alive.","53","     *\/","54","    public abstract boolean isAlive() throws IOException, InterruptedException;","55","","56","    \/**","184","        public boolean isAlive() throws IOException, InterruptedException {","185","            try {","186","                proc.exitValue();","187","                return false;","188","            } catch (IllegalThreadStateException e) {","189","                return true;","190","            }","191","        }","192","","193","        @Override","271","","272","        @Override","273","        public boolean isAlive() throws IOException, InterruptedException {","274","            return !process.isDone();","275","        }"],"delete":[]}],"core\/src\/main\/java\/hudson\/maven\/MavenProcessFactory.java":[{"add":["28","import hudson.AbortException;","63","import java.net.SocketTimeoutException;","200","            Connection con;","201","            try {","202","                con = acceptor.accept();","203","            } catch (SocketTimeoutException e) {","204","                \/\/ failed to connect. Is the process dead?","205","                \/\/ if so, the error should have been provided by the launcher already.","206","                \/\/ so abort gracefully without a stack trace.","207","                if(!proc.isAlive()) {","208","                    listener.getLogger().println(\"Failed to launch Maven. Exit code = \"+proc.join());","209","                    throw new AbortException();","210","                }","211","                throw e;","212","            }"],"delete":["198","            Connection con = acceptor.accept();"]}]}},"ce94579c50621990517c86120236ee9a1d0490da":{"changes":{"core\/src\/main\/java\/jenkins\/model\/lazy\/AbstractLazyLoadRunMap.java":"MODIFY","test\/src\/test\/java\/hudson\/model\/RunMapTest.java":"MODIFY","changelog.html":"MODIFY"},"diff":{"core\/src\/main\/java\/jenkins\/model\/lazy\/AbstractLazyLoadRunMap.java":[{"add":["748","        return old != null;"],"delete":["748","        return unwrap(old)!=null;"]}],"test\/src\/test\/java\/hudson\/model\/RunMapTest.java":[{"add":["72","    @Issue(\"JENKINS-25788\")","73","    @Test public void remove() throws Exception {","74","        FreeStyleProject p = r.createFreeStyleProject();","75","        FreeStyleBuild b1 = r.buildAndAssertSuccess(p);","76","        FreeStyleBuild b2 = r.buildAndAssertSuccess(p);","77","        RunMap<FreeStyleBuild> runs = p._getRuns();","78","        assertEquals(2, runs.size());","79","        assertTrue(runs.remove(b1));","80","        assertEquals(1, runs.size());","81","        assertFalse(runs.remove(b1));","82","        assertEquals(1, runs.size());","83","        assertTrue(runs.remove(b2));","84","        assertEquals(0, runs.size());","85","        assertFalse(runs.remove(b2));","86","        assertEquals(0, runs.size());","87","    }","88",""],"delete":["11","\/**","12"," * @author Kohsuke Kawaguchi","13"," *\/"]}],"changelog.html":[{"add":["58","    Spurious warnings in the log after deleting builds.","59","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-25788\">issue 25788<\/a>)","60","  <li class=bug>"],"delete":[]}]}},"96c97860b0f018094c20283b15f3ddb3bdd9effe":{"changes":{"core\/src\/test\/java\/hudson\/PluginManagerTest.java":"MODIFY","core\/src\/main\/java\/hudson\/Util.java":"MODIFY","core\/src\/main\/java\/hudson\/PluginManager.java":"MODIFY"},"diff":{"core\/src\/test\/java\/hudson\/PluginManagerTest.java":[{"add":["26","import java.io.File;","27","import java.io.FileOutputStream;","32","import java.io.InputStream;","33","import java.net.JarURLConnection;","34","import java.net.MalformedURLException;","35","import java.net.URL;","36","import java.util.jar.Attributes;","37","import java.util.jar.Manifest;","38","import java.util.zip.ZipEntry;","39","import java.util.zip.ZipFile;","40","import java.util.zip.ZipOutputStream;","41","import org.apache.commons.io.FileUtils;","42","import static org.hamcrest.CoreMatchers.*;","49"," ","50","\/**","51"," * Tests of {@link PluginManager}.","52"," *\/","86","    ","87","    @Test","88","    public void shouldProperlyParseManifestFromJar() throws IOException {","89","        File jar = createHpiWithManifest();","90","        final Manifest manifest = PluginManager.parsePluginManifest(jar.toURI().toURL());","91","        ","92","        assertThat(\"manifest should have been read from the sample\", manifest, notNullValue());","93","        assertAttribute(manifest, \"Created-By\", \"Apache Maven\");","94","        assertAttribute(manifest, \"Short-Name\", \"matrix-auth\");","95","        ","96","        \/\/ Multi-line entries","97","        assertAttribute(manifest, \"Specification-Title\", \"Offers matrix-based security authorization strategies (global and per-project).\");","98","        assertAttribute(manifest, \"Url\", \"http:\/\/wiki.jenkins-ci.org\/display\/JENKINS\/Matrix+Authorization+Strategy+Plugin\");","99","    ","100","        \/\/ Empty field","101","        assertAttribute(manifest, \"Plugin-Developers\", null);","102","    }","103","    ","104","    @Test","105","    public void shouldProperlyRetrieveModificationDate() throws IOException {","106","        File jar = createHpiWithManifest();","107","        URL url = toManifestUrl(jar);","108","        assertThat(\"Manifest last modified date should be equal to the file date\", ","109","                PluginManager.getModificationDate(url), ","110","                equalTo(jar.lastModified()));","111","    }","112","    ","113","    private static void assertAttribute(Manifest manifest, String attributeName, String value) throws AssertionError {","114","        Attributes attributes = manifest.getMainAttributes();","115","        assertThat(\"Main attributes must not be empty\", attributes, notNullValue());","116","        assertThat(\"Attribute '\" + attributeName + \"' does not match the sample\", ","117","                attributes.getValue(attributeName), ","118","                equalTo(value));","119","        ","120","    }","121","    ","122","    private static final String SAMPLE_MANIFEST_FILE = \"Manifest-Version: 1.0\\n\" +","123","                \"Archiver-Version: Plexus Archiver\\n\" +","124","                \"Created-By: Apache Maven\\n\" +","125","                \"Built-By: jglick\\n\" +","126","                \"Build-Jdk: 1.8.0_92\\n\" +","127","                \"Extension-Name: matrix-auth\\n\" +","128","                \"Specification-Title: \\n\" +","129","                \" Offers matrix-based security \\n\" +","130","                \" authorization strate\\n\" +","131","                \" gies (global and per-project).\\n\" +","132","                \"Implementation-Title: matrix-auth\\n\" +","133","                \"Implementation-Version: 1.4\\n\" +","134","                \"Group-Id: org.jenkins-ci.plugins\\n\" +","135","                \"Short-Name: matrix-auth\\n\" +","136","                \"Long-Name: Matrix Authorization Strategy Plugin\\n\" +","137","                \"Url: http:\/\/wiki.jenkins-ci.org\/display\/JENKINS\/Matrix+Authorization+S\\n\" +","138","                \" trategy+Plugin\\n\" +","139","                \"Plugin-Version: 1.4\\n\" +","140","                \"Hudson-Version: 1.609.1\\n\" +","141","                \"Jenkins-Version: 1.609.1\\n\" +","142","                \"Plugin-Dependencies: icon-shim:2.0.3,cloudbees-folder:5.2.2;resolution\\n\" +","143","                \" :=optional\\n\" +","144","                \"Plugin-Developers: \";","145","    ","146","    private File createHpiWithManifest() throws IOException {","147","        File newFolder = tmp.newFolder(\"myJar\");","148","        String manifestPath = \"META-INF\/MANIFEST.MF\";","149","        new File(\"META-INF\").mkdir();","150","        FileUtils.write(new File(newFolder, manifestPath), SAMPLE_MANIFEST_FILE);","151","        ","152","        final File f = new File(tmp.getRoot(), \"my.hpi\");","153","        try(ZipOutputStream out = new ZipOutputStream(new FileOutputStream(f))) {","154","            ZipEntry e = new ZipEntry(manifestPath);","155","            out.putNextEntry(e);","156","            byte[] data = SAMPLE_MANIFEST_FILE.getBytes();","157","            out.write(data, 0, data.length);","158","            out.closeEntry();","159","        }","160","        return f;","161","    }","162","        ","163","    ","164","    private URL toManifestUrl(File jarFile) throws MalformedURLException {","165","        final String manifestPath = \"META-INF\/MANIFEST.MF\";","166","        return new URL(\"jar:\" + jarFile.toURI().toURL() + \"!\/\" + manifestPath);","167","    }  "],"delete":["36",""]}],"core\/src\/main\/java\/hudson\/Util.java":[{"add":["1621","    ","1622","    \/**","1623","     * Closes the item and logs error to the log in the case of error.","1624","     * Logging will be performed on the {@code WARNING} level.","1625","     * @param toClose Item to close. Nothing will happen if it is {@code null}","1626","     * @param logger Logger, which receives the error","1627","     * @param closeableName Name of the closeable item","1628","     * @param closeableOwner String representation of the closeable holder","1629","     * @since TODO once merged to the master and un-restricted","1630","     *\/","1631","    @Restricted(NoExternalUse.class)","1632","    public static void closeAndLogFailures(@CheckForNull Closeable toClose, @Nonnull Logger logger, ","1633","            @Nonnull String closeableName, @Nonnull String closeableOwner) {","1634","        if (toClose == null) {","1635","            return;","1636","        }","1637","        try {","1638","            toClose.close();","1639","        } catch(IOException ex) {","1640","            logger.log(Level.WARNING, String.format(\"Failed to close %s of %s\", closeableName, closeableOwner), ex);","1641","        }","1642","    }"],"delete":[]}],"core\/src\/main\/java\/hudson\/PluginManager.java":[{"add":["143","import java.io.ByteArrayInputStream;","144","import java.net.JarURLConnection;","145","import java.net.URLConnection;","146","import java.util.jar.JarEntry;","954","        long lastModified = getModificationDate(src);","965","            file.setLastModified(getModificationDate(src));","976","    \/*package*\/ static @CheckForNull Manifest parsePluginManifest(URL bundledJpi) {","983","                    in = getBundledJpiManifestStream(res);","988","                Util.closeAndLogFailures(in, LOGGER, PluginWrapper.MANIFEST_FILENAME, bundledJpi.toString());","997","    ","998","    \/**","999","     * Retrieves input stream for the Manifest url.","1000","     * The method intelligently handles the case of {@link JarURLConnection} pointing to files within JAR.","1001","     * @param url Url of the manifest file","1002","     * @return Input stream, which allows to retrieve manifest. This stream must be closed outside","1003","     * @throws IOException Operation error","1004","     *\/","1005","    @Nonnull","1006","    \/*package*\/ static InputStream getBundledJpiManifestStream(@Nonnull URL url) throws IOException {","1007","        URLConnection uc = url.openConnection();","1008","        InputStream in = null;","1009","        \/\/ Magic, which allows to avoid using stream generated for JarURLConnection.","1010","        \/\/ It prevents getting into JENKINS-37332 due to the file desciptor leak ","1011","        if (uc instanceof JarURLConnection) {","1012","            final JarURLConnection jarURLConnection = (JarURLConnection) uc;","1013","            final String entryName = jarURLConnection.getEntryName();","1014","            ","1015","            try(final JarFile jarFile = jarURLConnection.getJarFile()) {","1016","                final JarEntry entry = (entryName != null && jarFile != null) ? jarFile.getJarEntry(entryName) : null;","1017","                if (entry != null && jarFile != null) {","1018","                    try(InputStream i = jarFile.getInputStream(entry)) {","1019","                        byte[] manifestBytes = IOUtils.toByteArray(i);","1020","                        in = new ByteArrayInputStream(manifestBytes);","1021","                    }","1022","                } else {","1023","                    LOGGER.log(Level.WARNING, \"Failed to locate the JAR file for {0}\"","1024","                            + \"The default URLConnection stream access will be used, file descriptor may be leaked.\",","1025","                               url);","1026","                }","1027","            }","1028","        } ","1029","","1030","        \/\/ If input stream is undefined, use the default implementation","1031","        if (in == null) {","1032","            in = url.openStream();","1033","        }","1034","        ","1035","        return in;","1036","    }","1037","    ","1038","    \/**","1039","     * Retrieves modification date of the specified file.","1040","     * The method intelligently handles the case of {@link JarURLConnection} pointing to files within JAR.","1041","     * @param url Url of the file","1042","     * @return Modification date","1043","     * @throws IOException Operation error","1044","     *\/","1045","    @Nonnull","1046","    \/*package*\/ static long getModificationDate(@Nonnull URL url) throws IOException {","1047","        URLConnection uc = url.openConnection();","1048","        ","1049","        \/\/ It prevents file desciptor leak if the URL references a file within JAR","1050","        \/\/ See JENKINS-37332  for more info","1051","        \/\/ The code idea is taken from https:\/\/github.com\/jknack\/handlebars.java\/pull\/394","1052","        if (uc instanceof JarURLConnection) {","1053","            final JarURLConnection connection = (JarURLConnection) uc;","1054","            final URL jarURL = connection.getJarFileURL();","1055","            if (jarURL.getProtocol().equals(\"file\")) {","1056","                uc = null;","1057","                String file = jarURL.getFile();","1058","                return new File(file).lastModified();","1059","            } else {","1060","                \/\/ We access the data without file protocol","1061","                if (connection.getEntryName() != null) {","1062","                    LOGGER.log(WARNING, \"Accessing modification date of {0} file, which is an entry in JAR file. \"","1063","                        + \"The access protocol is not file:, falling back to the default logic (risk of file descriptor leak).\",","1064","                            url);","1065","                }","1066","            }","1067","        }","1068","        ","1069","        \/\/ Fallbak to the default implementation","1070","        return uc.getLastModified();","1071","    }"],"delete":["950","        long lastModified = src.openConnection().getLastModified();","961","            file.setLastModified(src.openConnection().getLastModified());","972","    private static @CheckForNull Manifest parsePluginManifest(URL bundledJpi) {","979","                    in = res.openStream();","984","                IOUtils.closeQuietly(in);"]}]}},"543b947e79d862149a1e52a529c1944e53943b25":{"changes":{"core\/src\/main\/java\/hudson\/WebAppMain.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/WebAppMain.java":[{"add":["29","import hudson.security.ACL;","247","            e.publish(context, home);","367","            ACL.impersonate(ACL.SYSTEM, new Runnable() {","368","                @Override","369","                public void run() {","370","                    terminated = true;","371","                    Jenkins instance = Jenkins.getInstanceOrNull();","372","                    if (instance != null)","373","                        instance.cleanUp();","374","                    Thread t = initThread;","375","                    if (t != null && t.isAlive()) {","376","                        LOGGER.log(Level.INFO, \"Shutting down a Jenkins instance that was still starting up\", new Throwable(\"reason\"));","377","                        t.interrupt();","378","                    }","380","                    \/\/ Logger is in the system classloader, so if we don't do this","381","                    \/\/ the whole web app will never be undepoyed.","382","                    Logger.getLogger(\"\").removeHandler(handler);","383","                }","384","            });"],"delete":["246","            e.publish(context,home);","366","            terminated = true;","367","            Jenkins instance = Jenkins.getInstanceOrNull();","368","            if(instance!=null)","369","                instance.cleanUp();","370","            Thread t = initThread;","371","            if (t != null && t.isAlive()) {","372","                LOGGER.log(Level.INFO, \"Shutting down a Jenkins instance that was still starting up\", new Throwable(\"reason\"));","373","                t.interrupt();","374","            }","376","            \/\/ Logger is in the system classloader, so if we don't do this","377","            \/\/ the whole web app will never be undepoyed.","378","            Logger.getLogger(\"\").removeHandler(handler);"]}]}},"8affa6d912f2f0777487990f2d7ef2813a19b04c":{"changes":{"core\/src\/main\/java\/hudson\/model\/Job.java":"MODIFY","changelog.html":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/Job.java":[{"add":["25","import com.google.common.base.Function;","26","import com.google.common.collect.Collections2;","82","import java.io.*;","84","import java.util.*;","162","                \/\/ try to infer the value of the next build number from the existing build records. See JENKINS-11563","163","                File[] folders = this.getBuildDir().listFiles(new FileFilter() {","164","                    public boolean accept(File file) {","165","                        return file.isDirectory() && file.getName().matches(\"[0-9]+\");","166","                    }","167","                });","168","","169","                if (folders == null || folders.length == 0) {","170","                    this.nextBuildNumber = 1;","171","                } else {","172","                    Collection<Integer> foldersInt = Collections2.transform(Arrays.asList(folders), new Function<File, Integer>() {","173","                        public Integer apply(File file) {","174","                            return Integer.parseInt(file.getName());","175","                        }","176","                    });","177","                    this.nextBuildNumber = Collections.max(foldersInt) + 1;","178","                }","179","                saveNextBuildNumber();"],"delete":["80","import java.io.File;","81","import java.io.IOException;","82","import java.io.PrintWriter;","83","import java.io.StringWriter;","85","import java.util.ArrayList;","86","import java.util.Collection;","87","import java.util.Collections;","88","import java.util.LinkedList;","90","import java.util.Map;","91","import java.util.SortedMap;","168","                throw new IOException2(f + \" doesn't contain a number\", e);"]}],"changelog.html":[{"add":["69","    Improve the resilience to the missing 'nextBuildNumber' file.","70","  (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-11563\">issue 11563<\/a>)","71","  <li class=bug>"],"delete":[]}]}},"6508275d66437b014af2f1c5e3e99a6a72621da9":{"changes":{"core\/src\/main\/java\/hudson\/model\/AbstractProject.java":"MODIFY","test\/src\/test\/java\/hudson\/model\/FreeStyleProjectTest.java":"MODIFY","core\/src\/main\/resources\/lib\/hudson\/project\/config-upstream-pseudo-trigger.jelly":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/AbstractProject.java":[{"add":["831","            BuildTrigger buildTrigger = (BuildTrigger)ap.getPublishersList().get(BuildTrigger.DESCRIPTOR);","832","            if (buildTrigger != null)","833","                if (buildTrigger.getChildProjects().contains(this))","834","                    result.add(ap);"],"delete":["831","            if (ap instanceof Project) {","832","                Project p = (Project) ap;","833","                BuildTrigger buildTrigger = (BuildTrigger)p.getPublisher(BuildTrigger.DESCRIPTOR);","834","                if (buildTrigger != null) {","835","                    if (buildTrigger.getChildProjects().contains(this)) {","836","                        result.add(p);","837","                    }","838","                }                ","839","            }"]}],"test\/src\/test\/java\/hudson\/model\/FreeStyleProjectTest.java":[{"add":["6","import org.jvnet.hudson.test.Bug;","38","","39","    \/**","40","     * Make sure that the pseudo trigger configuration works.","41","     *\/","42","    @Bug(2778)","43","    public void testUpstreamPseudoTrigger() throws Exception {","44","        pseudoTriggerTest(createMavenProject(), createFreeStyleProject());","45","    }","46","","47","    @Bug(2778)","48","    public void testUpstreamPseudoTrigger2() throws Exception {","49","        pseudoTriggerTest(createFreeStyleProject(), createFreeStyleProject());","50","    }","51","","52","    @Bug(2778)","53","    public void testUpstreamPseudoTrigger3() throws Exception {","54","        pseudoTriggerTest(createMatrixProject(), createFreeStyleProject());","55","    }","56","","57","    private void pseudoTriggerTest(AbstractProject up, AbstractProject down) throws Exception {","58","        HtmlForm form = new WebClient().getPage(down, \"configure\").getFormByName(\"config\");","59","        form.getInputByName(\"pseudoUpstreamTrigger\").setChecked(true);","60","        form.getInputByName(\"upstreamProjects\").setValueAttribute(up.getName());","61","        submit(form);","62","","63","        \/\/ make sure this took effect","64","        assertTrue(up.getDownstreamProjects().contains(down));","65","        assertTrue(down.getUpstreamProjects().contains(up));","66","","67","        \/\/ round trip again and verify that the configuration is still intact.","68","        submit(new WebClient().getPage(down, \"configure\").getFormByName(\"config\"));","69","        assertTrue(up.getDownstreamProjects().contains(down));","70","        assertTrue(down.getUpstreamProjects().contains(up));","71","    }"],"delete":[]}],"core\/src\/main\/resources\/lib\/hudson\/project\/config-upstream-pseudo-trigger.jelly":[{"add":["10","                   title=\"${%Build after other projects are built} ${it.buildTriggerUpstreamProjects}\""],"delete":["10","                   title=\"${%Build after other projects are built}\""]}]}},"3cef8497b7ef18558030284adca4f09d6d9c0cf6":{"changes":{"core\/src\/main\/java\/hudson\/maven\/reporters\/MavenAbstractArtifactRecord.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/maven\/reporters\/MavenAbstractArtifactRecord.java":[{"add":["145","        if (records != null) {","146","            for (final Record record : records) {","147","                if (Result.SUCCESS.equals(record.result)) ","148","                    return true;","149","            }","150","        }","151","        return false;"],"delete":["145","        return records!=null && !records.isEmpty();"]}]}},"760436d4e4ce1a0789026931d104ab50e9fbfbfe":{"changes":{"core\/src\/main\/java\/hudson\/model\/Run.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/RunMap.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/Run.java":[{"add":["190","    \/*package*\/ static long parseTimestampFromBuildDir(File buildDir) throws IOException {"],"delete":["190","    private static long parseTimestampFromBuildDir(File buildDir) throws IOException {"]}],"core\/src\/main\/java\/hudson\/model\/RunMap.java":[{"add":["12","import java.util.logging.Logger;","13","import java.text.SimpleDateFormat;","14","import java.text.ParseException;","162","        final SimpleDateFormat formatter = Run.ID_FORMATTER.get();","163","","169","                \/\/ HUDSON-1461 sometimes create bogus data directories with impossible dates, such as year 0, April 31st,","170","                \/\/ or August 0th. Date object doesn't roundtrip those, so we eventually fail to load this data.","171","                \/\/ Don't even bother trying.","172","                if (!isCorrectDate(name)) {","173","                    LOGGER.fine(\"Skipping \"+new File(dir,name));","174","                    return false;","175","                }","178","","179","            private boolean isCorrectDate(String name) {","180","                try {","181","                    if(formatter.format(formatter.parse(name)).equals(name))","182","                        return true;","183","                } catch (ParseException e) {","184","                    \/\/ fall through","185","                }","186","                return false;","187","            }","207","","208","    private static final Logger LOGGER = Logger.getLogger(RunMap.class.getName());"],"delete":["164","                \/\/ HUDSON-1461 sometimes create bogus data directories with impossible dates, such as year 0.","165","                \/\/ Date object doesn't roundtrip year 0 (year is -2,-1,+1,+2,... and there's no zero),","166","                \/\/ so we eventually fail to load this data.","167","                \/\/ so don't even bother trying.k"]}]}},"be9a29007ee24b003bb28be65acb07701dbcb4d5":{"changes":{"core\/src\/main\/java\/hudson\/matrix\/MatrixProject.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/matrix\/MatrixProject.java":[{"add":["27","import hudson.tasks.BuildStepDescriptor;","423","        buildWrappers = buildDescribable(req, BuildWrappers.getFor(this), \"wrapper\");","424","        builders = buildDescribable(req, BuildStepDescriptor.filter(BuildStep.BUILDERS,getClass()), \"builder\");","425","        publishers = buildDescribable(req, BuildStepDescriptor.filter(BuildStep.PUBLISHERS,getClass()), \"publisher\");"],"delete":["422","        buildWrappers = buildDescribable(req, BuildWrappers.WRAPPERS, \"wrapper\");","423","        builders = buildDescribable(req, BuildStep.BUILDERS, \"builder\");","424","        publishers = buildDescribable(req, BuildStep.PUBLISHERS, \"publisher\");"]}]}},"7921599c5ff0dab420248053eed8b22a1da2781b":{"changes":{"core\/src\/main\/java\/hudson\/tasks\/junit\/TestResult.java":"MODIFY","core\/src\/test\/java\/hudson\/tasks\/junit\/TestResultTest.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/tasks\/junit\/TestResult.java":[{"add":["187","    \tduration += sr.getDuration();"],"delete":["206","        duration += sr.getDuration();"]}],"core\/src\/test\/java\/hudson\/tasks\/junit\/TestResultTest.java":[{"add":["127","        ","128","        \/\/ check duration: 157.980 (TestSuite_a1.xml) and 15.000 (TestSuite_a2.xml) = 172.98 ","129","        assertEquals(\"Wrong duration for test result\", 172.98, testResult.getDuration(), 0.1);"],"delete":[]}]}},"9bd13323c84c38f98091e2deffed0b7ae1cc5d68":{"changes":{"core\/src\/main\/java\/hudson\/ClassicPluginStrategy.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/ClassicPluginStrategy.java":[{"add":["27","","28","import java.io.FileNotFoundException;","114","        if (!archive.exists()) {","115","            throw new FileNotFoundException(\"Failed to load \" + archive + \". The file does not exist\");","116","        } else if (!archive.isFile()) {","117","            throw new FileNotFoundException(\"Failed to load \" + archive + \". It is not a file\");","118","        }","119","","125","            } catch (IOException ex) {","126","                \/\/ Mention file name in the exception","127","                throw new IOException(\"Failed to load \" + archive, ex);"],"delete":[]}]}},"2c5d33cb796d56a7e3606311af337ccbfe450b14":{"changes":{"core\/src\/main\/java\/hudson\/maven\/ModuleName.java":"MODIFY","core\/src\/main\/java\/hudson\/maven\/ModuleDependency.java":"ADD","core\/src\/main\/java\/hudson\/maven\/MavenModule.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/Items.java":"MODIFY","core\/src\/main\/java\/hudson\/maven\/PomInfo.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/maven\/ModuleName.java":[{"add":["14"," * @see ModuleDependency"],"delete":[]}],"core\/src\/main\/java\/hudson\/maven\/ModuleDependency.java":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/maven\/MavenModule.java":[{"add":["34","import java.util.HashSet;","73","    private volatile Set<ModuleDependency> dependencies;","159","        else {","160","            \/\/ Until 1.207, we used to have ModuleName in dependencies. So convert.","161","            Set<ModuleDependency> deps = new HashSet<ModuleDependency>(dependencies.size());","162","            for (Object d : (Set)dependencies) {","163","                if (d instanceof ModuleDependency) {","164","                    deps.add((ModuleDependency) d);","165","                } else {","166","                    deps.add(new ModuleDependency((ModuleName)d, ModuleDependency.UNKNOWN));","167","                }","168","            }","169","            dependencies = deps;","170","        }","241","    \/**","242","     * Gets groupId+artifactId+version as {@link ModuleDependency}.","243","     *\/","244","    public ModuleDependency asDependency() {","245","        return new ModuleDependency(moduleName,version);","246","    }","247","","320","        Map<ModuleDependency,MavenModule> modules = new HashMap<ModuleDependency,MavenModule>();","321","","322","        \/\/ when we load old data that doesn't record version in dependency, we'd like","323","        \/\/ to emulate the old behavior that it tries to identify the upstream by ignoring the version.","324","        \/\/ do this by always putting groupId:artifactId:UNKNOWN to the modules list.","328","            modules.put(m.asDependency(),m);","329","            modules.put(m.asDependency().withUnknownVersion(),m);","332","        \/\/ in case two modules with the same name is defined, modules in the same MavenModuleSet","333","        \/\/ takes precedence.","337","            modules.put(m.asDependency(),m);","338","            modules.put(m.asDependency().withUnknownVersion(),m);","345","        for (ModuleDependency d : dependencies) {"],"delete":["72","    private volatile Set<ModuleName> dependencies;","300","        Map<ModuleName,MavenModule> modules = new HashMap<ModuleName,MavenModule>();","304","            modules.put(m.getModuleName(),m);","307","        \/\/ in case two modules with the same name is defined, modules in this MavenModuleSet","308","        \/\/ takes precedence","312","            modules.put(m.getModuleName(),m);","319","        for (ModuleName d : dependencies) {"]}],"core\/src\/main\/java\/hudson\/model\/Items.java":[{"add":["8","import hudson.maven.ModuleDependency;","109","        XSTREAM.alias(\"dependency\", ModuleDependency.class);"],"delete":[]}],"core\/src\/main\/java\/hudson\/maven\/PomInfo.java":[{"add":["57","    public final Set<ModuleDependency> dependencies = new HashSet<ModuleDependency>();","87","            dependencies.add(new ModuleDependency(dep));","91","            dependencies.add(new ModuleDependency(parentProject));","93","            dependencies.add(parent.asDependency());","101","                dependencies.add(new ModuleDependency(ext));","105","        dependencies.remove(asDependency());","121","    \/**","122","     * Creates {@link ModuleDependency} that represents this {@link PomInfo}.","123","     *\/","124","    private ModuleDependency asDependency() {","125","        return new ModuleDependency(name,version);","128","    private void addPluginsAsDependencies(List<Plugin> plugins, Set<ModuleDependency> dependencies) {","129","        if(plugins==null)   return;","130","        for (Plugin p : plugins)","131","            dependencies.add(new ModuleDependency(p));","132","    }","133","","134","    private void addReportPluginsAsDependencies(List<ReportPlugin> plugins, Set<ModuleDependency> dependencies) {","137","            dependencies.add(new ModuleDependency(p));","149","        ModuleDependency dep = asDependency();","151","            if(p.dependencies.contains(dep))","152","                p.dependencies.remove(dep);"],"delete":["57","    public final Set<ModuleName> dependencies = new HashSet<ModuleName>();","87","            dependencies.add(new ModuleName(dep));","91","            dependencies.add(new ModuleName(parentProject));","93","            dependencies.add(parent.name);","101","                dependencies.add(new ModuleName(ext));","105","        dependencies.remove(name);","121","    private void addPluginsAsDependencies(List<Plugin> plugins, Set<ModuleName> dependencies) {","122","        if(plugins==null)   return;","123","        for (Plugin p : plugins)","124","            dependencies.add(new ModuleName(p));","127","    private void addReportPluginsAsDependencies(List<ReportPlugin> plugins, Set<ModuleName> dependencies) {","130","            dependencies.add(new ModuleName(p));","143","            if(p.dependencies.contains(name))","144","                p.dependencies.remove(name);"]}]}},"d6298979581da67336f077cda9fd218eb790bdb3":{"changes":{"test\/src\/test\/java\/jenkins\/install\/LoadDetachedPluginsTest.java":"MODIFY","test\/src\/test\/resources\/jenkins\/install\/LoadDetachedPluginsTest\/upgradeFromJenkins2WithNewerPlugin.zip":"ADD","core\/src\/main\/java\/hudson\/PluginManager.java":"MODIFY"},"diff":{"test\/src\/test\/java\/jenkins\/install\/LoadDetachedPluginsTest.java":[{"add":["122","    @Issue(\"JENKINS-48899\")","123","    @Test","124","    @LocalData","125","    public void upgradeFromJenkins2WithNewerPlugin() {","126","        \/\/ @LocalData has command-launcher 1.2 installed, which should not be downgraded to the detached version: 1.0.","127","        VersionNumber since = new VersionNumber(\"2.0\");","128","        rr.then(r -> {","129","            List<DetachedPlugin> detachedPlugins = ClassicPluginStrategy.getDetachedPlugins(since);","130","            assertThat(\"Plugins have been detached since the pre-upgrade version\",","131","                    detachedPlugins.size(), greaterThan(1));","132","            assertThat(\"Plugins detached between the pre-upgrade version and the current version should be installed\",","133","                    getInstalledDetachedPlugins(r, detachedPlugins).size(), equalTo(detachedPlugins.size()));","134","            Plugin commandLauncher = r.jenkins.getPlugin(\"command-launcher\");","135","            assertThat(\"Installed detached plugins should not be overwritten by older versions\",","136","                    commandLauncher.getWrapper().getVersionNumber(), equalTo(new VersionNumber(\"1.2\")));","137","            assertNoFailedPlugins(r);","138","        });","139","    }","140",""],"delete":[]}],"test\/src\/test\/resources\/jenkins\/install\/LoadDetachedPluginsTest\/upgradeFromJenkins2WithNewerPlugin.zip":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/PluginManager.java":[{"add":["710","                        \/\/ If the plugin is already installed, we need to decide whether to replace it with the bundled version.","711","                        if (installedVersion != null && bundledVersion != null) {","712","                            \/\/ If the installed version is older than the bundled version, then it MUST be upgraded.","713","                            \/\/ If the installed version is newer than the bundled version, then it MUST NOT be upgraded.","714","                            \/\/ If the versions are equal we just keep the installed version.","715","                            return installedVersion.isOlderThan(bundledVersion);"],"delete":["708","                        \/\/ If it's already installed and the installed version is older","709","                        \/\/ than the bundled version, then we upgrade. The bundled version is the min required version","710","                        \/\/ for \"this\" version of Jenkins, so we must upgrade.","713","                        if (installedVersion != null && bundledVersion != null && installedVersion.isOlderThan(bundledVersion)) {","714","                            return true;"]}]}},"496703d0fe133445e10c7d8d07fa7afd351c8854":{"changes":{"core\/src\/main\/java\/hudson\/security\/BasicAuthenticationFilter.java":"MODIFY","core\/src\/main\/java\/hudson\/slaves\/ComputerLauncher.java":"MODIFY","core\/src\/main\/java\/hudson\/util\/IOUtils.java":"MODIFY","test\/src\/test\/java\/jenkins\/security\/Security218CliTest.java":"MODIFY","test\/src\/test\/java\/hudson\/model\/WorkspaceCleanupThreadTest.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/Actionable.java":"MODIFY","test\/src\/test\/java\/hudson\/model\/NodeTest.java":"MODIFY","core\/src\/main\/resources\/lib\/form\/expandableTextbox.jelly":"MODIFY","core\/src\/main\/java\/hudson\/WebAppMain.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/Queue.java":"MODIFY","war\/src\/test\/js\/widgets\/config\/scrollspy-spec.js":"MODIFY","core\/src\/main\/java\/hudson\/slaves\/NodeDescriptor.java":"MODIFY","core\/src\/main\/java\/hudson\/util\/spring\/RuntimeSpringConfiguration.java":"MODIFY","core\/src\/main\/java\/hudson\/tasks\/Publisher.java":"MODIFY","core\/src\/main\/java\/hudson\/util\/DescribableList.java":"MODIFY","core\/src\/main\/java\/hudson\/security\/Permission.java":"MODIFY","core\/src\/main\/java\/hudson\/LocalPluginManager.java":"MODIFY","core\/src\/main\/resources\/hudson\/model\/AbstractProject\/help-concurrentBuild.html":"MODIFY","core\/src\/main\/java\/jenkins\/model\/Jenkins.java":"MODIFY","core\/src\/main\/resources\/testng-1.0.dtd":"MODIFY","core\/src\/main\/java\/hudson\/model\/ParameterValue.java":"MODIFY","core\/src\/main\/java\/hudson\/init\/package-info.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/Descriptor.java":"MODIFY","core\/pom.xml":"MODIFY","core\/src\/main\/java\/hudson\/model\/Label.java":"MODIFY","core\/src\/main\/java\/hudson\/tasks\/Maven.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/Computer.java":"MODIFY","war\/src\/main\/webapp\/WEB-INF\/web.xml":"MODIFY","core\/src\/main\/java\/hudson\/model\/PermalinkProjectAction.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/listeners\/SCMListener.java":"MODIFY","core\/src\/main\/resources\/lib\/form\/hetero-list\/hetero-list.js":"MODIFY","core\/src\/main\/resources\/lib\/form\/optionalProperty.jelly":"MODIFY","test\/src\/test\/java\/hudson\/model\/AbstractBuildTest.java":"MODIFY","test\/src\/test\/java\/hudson\/tasks\/MavenTest.java":"MODIFY","test\/src\/test\/resources\/hudson\/model\/node.xml":"MODIFY","core\/src\/main\/java\/hudson\/init\/impl\/InstallUncaughtExceptionHandler.java":"MODIFY","core\/src\/main\/java\/jenkins\/security\/UserDetailsCache.java":"MODIFY","core\/src\/main\/java\/hudson\/util\/SequentialExecutionQueue.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/Job.java":"MODIFY","test\/src\/test\/java\/jenkins\/I18nTest.java":"MODIFY","core\/src\/test\/java\/hudson\/FunctionsTest.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/Run.java":"MODIFY","pom.xml":"MODIFY","test\/src\/test\/java\/hudson\/model\/ViewTest.java":"MODIFY","core\/src\/main\/java\/hudson\/FilePath.java":"MODIFY","core\/src\/main\/java\/hudson\/util\/DoubleLaunchChecker.java":"MODIFY","licenseCompleter.groovy":"MODIFY","test\/src\/test\/java\/hudson\/scm\/ChangeLogSetTest.java":"MODIFY","test\/src\/test\/groovy\/hudson\/cli\/BuildCommandTest.groovy":"MODIFY","core\/src\/main\/java\/hudson\/slaves\/RetentionStrategy.java":"MODIFY","core\/src\/main\/java\/hudson\/util\/ChunkedInputStream.java":"MODIFY","core\/src\/main\/java\/hudson\/tools\/DownloadFromUrlInstaller.java":"MODIFY","test\/src\/test\/java\/jenkins\/security\/security218\/ysoserial\/payloads\/FileUpload1.java":"MODIFY","core\/src\/main\/java\/hudson\/util\/spring\/BeanBuilder.java":"MODIFY","core\/src\/main\/java\/hudson\/slaves\/SlaveComputer.java":"MODIFY","core\/src\/main\/resources\/hudson\/PluginManager\/installed.jelly":"MODIFY","core\/src\/main\/java\/hudson\/util\/CompressedFile.java":"MODIFY","core\/src\/main\/resources\/hudson\/TcpSlaveAgentListener\/index.jelly":"MODIFY","test\/src\/test\/java\/hudson\/model\/QueueTest.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/ChoiceParameterDefinition.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/AbstractProject.java":"MODIFY","core\/src\/main\/java\/hudson\/triggers\/SCMTrigger.java":"MODIFY","core\/src\/main\/java\/hudson\/cli\/BuildCommand.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/TaskAction.java":"MODIFY","core\/src\/main\/java\/hudson\/ProxyConfiguration.java":"MODIFY","core\/src\/main\/resources\/hudson\/tasks\/BatchFile\/help-unstableReturn.html":"MODIFY","core\/src\/main\/java\/hudson\/util\/CharacterEncodingFilter.java":"MODIFY","war\/pom.xml":"MODIFY","test\/src\/test\/java\/hudson\/model\/MyViewTest.java":"MODIFY","core\/src\/main\/java\/hudson\/org\/apache\/tools\/tar\/TarInputStream.java":"MODIFY","core\/src\/main\/java\/jenkins\/mvn\/GlobalSettingsProvider.java":"MODIFY","core\/src\/main\/java\/jenkins\/install\/InstallUtil.java":"MODIFY","core\/src\/main\/java\/hudson\/util\/DescriptorList.java":"MODIFY","test\/src\/test\/java\/jenkins\/model\/JenkinsTest.java":"MODIFY","war\/src\/main\/js\/widgets\/variables.less":"MODIFY","core\/src\/main\/java\/hudson\/model\/UpdateCenter.java":"MODIFY","core\/src\/test\/java\/hudson\/UtilTest.java":"MODIFY","core\/src\/main\/java\/hudson\/node_monitors\/AbstractAsyncNodeMonitorDescriptor.java":"MODIFY","core\/src\/main\/java\/hudson\/util\/RunList.java":"MODIFY","war\/images\/readme.txt":"MODIFY","test\/src\/test\/java\/hudson\/model\/MyViewsPropertyTest.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/Slave.java":"MODIFY","core\/src\/main\/java\/hudson\/util\/PersistedList.java":"MODIFY","core\/src\/main\/resources\/hudson\/Messages.properties":"MODIFY","core\/src\/main\/resources\/lib\/hudson\/propertyTable.jelly":"MODIFY","core\/src\/main\/java\/hudson\/node_monitors\/AbstractNodeMonitorDescriptor.java":"MODIFY","core\/src\/main\/java\/hudson\/util\/ListBoxModel.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/UsageStatistics.java":"MODIFY","core\/src\/main\/resources\/jenkins\/model\/GlobalQuietPeriodConfiguration\/help-quietPeriod.html":"MODIFY","core\/src\/main\/resources\/hudson\/model\/EnvironmentContributor\/EnvVarsHtml\/index.groovy":"MODIFY","core\/src\/test\/java\/hudson\/model\/FileParameterValueTest.java":"MODIFY","war\/src\/main\/webapp\/css\/style.css":"MODIFY","core\/src\/main\/java\/hudson\/search\/Search.java":"MODIFY","core\/src\/main\/java\/jenkins\/security\/s2m\/AdminCallableMonitor.java":"MODIFY","test\/src\/test\/java\/hudson\/model\/UserTest.java":"MODIFY","changelog.html":"MODIFY","core\/src\/main\/java\/hudson\/PluginManager.java":"MODIFY","core\/src\/main\/java\/jenkins\/util\/SystemProperties.java":"MODIFY","core\/src\/main\/java\/jenkins\/model\/lazy\/AbstractLazyLoadRunMap.java":"MODIFY","test\/src\/test\/java\/hudson\/model\/FingerprintTest.java":"MODIFY","core\/src\/main\/java\/hudson\/util\/FormFieldValidator.java":"MODIFY","core\/src\/main\/java\/hudson\/cli\/CLICommand.java":"MODIFY","core\/src\/main\/resources\/hudson\/slaves\/Messages.properties":"MODIFY","core\/src\/main\/java\/hudson\/tasks\/UserNameResolver.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/AbstractBuild.java":"MODIFY","core\/src\/test\/java\/hudson\/model\/UserTest.java":"MODIFY","war\/src\/main\/webapp\/scripts\/combobox.js":"MODIFY","core\/src\/main\/java\/hudson\/model\/UpdateSite.java":"MODIFY","core\/src\/main\/java\/hudson\/scheduler\/BaseParser.java":"MODIFY","core\/src\/main\/java\/hudson\/util\/ProcessTree.java":"MODIFY","core\/src\/test\/java\/hudson\/model\/AbstractItemTest.java":"MODIFY","war\/src\/main\/js\/widgets\/config\/tabbar.less":"MODIFY","test\/src\/test\/java\/hudson\/ExtensionListTest.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/PageDecorator.java":"MODIFY","core\/src\/test\/java\/hudson\/PluginWrapperTest.java":"MODIFY","war\/src\/main\/webapp\/scripts\/hudson-behavior.js":"MODIFY","core\/src\/main\/java\/hudson\/util\/ByteArrayOutputStream2.java":"MODIFY","core\/src\/main\/java\/hudson\/util\/FormValidation.java":"MODIFY","test\/src\/test\/java\/hudson\/model\/LabelLoadStatisticsQueueLengthTest.java":"MODIFY","core\/src\/main\/resources\/hudson\/scm\/SCM\/project-changes.jelly":"MODIFY","core\/src\/main\/java\/hudson\/Plugin.java":"MODIFY","core\/src\/main\/java\/hudson\/os\/SU.java":"MODIFY","core\/src\/main\/resources\/hudson\/slaves\/JNLPLauncher\/help.properties":"MODIFY","core\/src\/main\/java\/hudson\/FileSystemProvisionerDescriptor.java":"MODIFY","test\/src\/test\/java\/hudson\/model\/ProjectTest.java":"MODIFY","core\/src\/main\/java\/jenkins\/install\/InstallState.java":"MODIFY","translation-tool.pl":"MODIFY","core\/src\/main\/java\/hudson\/views\/ListViewColumn.java":"MODIFY","core\/src\/main\/java\/hudson\/Functions.java":"MODIFY","core\/src\/main\/java\/hudson\/BulkChange.java":"MODIFY","core\/src\/main\/java\/hudson\/cli\/handlers\/ViewOptionHandler.java":"MODIFY","test\/src\/test\/java\/hudson\/cli\/DeleteViewCommandTest.java":"MODIFY","test\/src\/test\/java\/hudson\/search\/SearchTest.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/ParameterDefinition.java":"MODIFY","core\/src\/main\/resources\/lib\/layout\/html.jelly":"MODIFY","core\/src\/test\/java\/hudson\/util\/FormValidationTest.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/JobPropertyDescriptor.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/User.java":"MODIFY","core\/src\/main\/java\/hudson\/Launcher.java":"MODIFY","core\/src\/main\/java\/jenkins\/install\/SetupWizard.java":"MODIFY","test\/src\/test\/java\/hudson\/diagnosis\/OldDataMonitorTest.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/listeners\/ItemListener.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/security\/BasicAuthenticationFilter.java":[{"add":["45"," * Implements the dual authentication mechanism.","50"," * because the servlet spec does not allow us to programmatically authenticate users,"],"delete":["45"," * Implements the dual authentcation mechanism.","50"," * because the servlet spec does not allow us to programatically authenticate users,"]}],"core\/src\/main\/java\/hudson\/slaves\/ComputerLauncher.java":[{"add":["84","     *      of this method doesn't have to diligently catch those exceptions.","199","        logger.println(Messages.ComputerLauncher_UnknownJavaVersion(javaCommand));","200","        throw new IOException(Messages.ComputerLauncher_UnknownJavaVersion(javaCommand));"],"delete":["84","     *      of this method doesn't have to dilligently catch those exceptions.","199","        logger.println(Messages.ComputerLauncher_UknownJavaVersion(javaCommand));","200","        throw new IOException(Messages.ComputerLauncher_UknownJavaVersion(javaCommand));"]}],"core\/src\/main\/java\/hudson\/util\/IOUtils.java":[{"add":["73","     * it doesn't let us reliably differentiate \"hit EOF\" case vs \"inputstream just returning 0 since there's no data"],"delete":["73","     * it doesn't let us reliably differentiate \"hit EOF\" case vs \"inpustream just returning 0 since there's no data"]}],"test\/src\/test\/java\/jenkins\/security\/Security218CliTest.java":[{"add":["143","    \/\/ with newer libs. SECURITY-218 does not appear in this case in manual tests anyway","254","                    \/\/ It should happen if the remote channel reject a class.","268","                    \/\/ CommonsCollections1, CommonsCollections2 and Groovy1 fail with this error,"],"delete":["143","    \/\/ with newer libs. SECURITY-218 does not apper in this case in manual tests anyway","254","                    \/\/ It should happen if the remote chanel reject a class.","268","                    \/\/ CommonsCollections1, CommonsCollections2 and Groovy1 fail witth this error,"]}],"test\/src\/test\/java\/hudson\/model\/WorkspaceCleanupThreadTest.java":[{"add":["151","    @Test @WithoutJenkins public void recurrencePeriodIsInHours() {"],"delete":["151","    @Test @WithoutJenkins public void reocurencePeriodIsInhours() {"]}],"core\/src\/main\/java\/hudson\/model\/Actionable.java":[{"add":["167","     * and there is a desire to elide unnecessary persistence of unmodified objects."],"delete":["167","     * and there is a desire to elide unneccessary persistence of unmodified objects."]}],"test\/src\/test\/java\/hudson\/model\/NodeTest.java":[{"add":["183","        assertTrue(\"Node should have dynamically added dynamicLabel.\", node.getAssignedLabels().contains(j.jenkins.getLabelAtom(\"dynamicLabel\")));","206","        assertNotNull(\"Node should not take project which has null label because it is in exclusive mode.\", node.canTake(item2));","231","        String absolutePath = ((Slave)node).remoteFS;","232","        FilePath path = node.createPath(absolutePath);","236","        path = node2.createPath(absolutePath);"],"delete":["183","        assertTrue(\"Node should have dynamicly added dynamicLabel.\", node.getAssignedLabels().contains(j.jenkins.getLabelAtom(\"dynamicLabel\")));","206","        assertNotNull(\"Node should not take project which has null label bacause it is in exclusive mode.\", node.canTake(item2));","231","        String absolutPath = ((Slave)node).remoteFS;","232","        FilePath path = node.createPath(absolutPath);","236","        path = node2.createPath(absolutPath);"]}],"core\/src\/main\/resources\/lib\/form\/expandableTextbox.jelly":[{"add":["32","    This control is useful for a field that expects multiple whitespace-separated tokens"],"delete":["32","    This control is useful for a field that expects multiple whitespaec-separated tokens"]}],"core\/src\/main\/java\/hudson\/WebAppMain.java":[{"add":["388","            \/\/ the whole web app will never be undeployed."],"delete":["388","            \/\/ the whole web app will never be undepoyed."]}],"core\/src\/main\/java\/hudson\/model\/Queue.java":[{"add":["555","     *      added to the {@link Run} object, and hence available to everyone.","2824","                              + \"FindBugs recommends suppressing warnings in such case\")"],"delete":["555","     *      added to the {@link Run} object, and hence avaialable to everyone.","2824","                              + \"FindBugs recommends suppresing warnings in such case\")"]}],"war\/src\/test\/js\/widgets\/config\/scrollspy-spec.js":[{"add":["70","            \/\/ Now, manually activate the \"General\" section i.e. \"activate\" it."],"delete":["70","            \/\/ Now, manually activate the the \"General\" section i.e. \"activate\" it."]}],"core\/src\/main\/java\/hudson\/slaves\/NodeDescriptor.java":[{"add":["101","            return FormValidation.error(Messages.NodeDescriptor_CheckName_Mandatory());"],"delete":["101","            return FormValidation.error(Messages.NodeDescripter_CheckName_Mandatory());"]}],"core\/src\/main\/java\/hudson\/util\/spring\/RuntimeSpringConfiguration.java":[{"add":["173","     * Creates and returns the BeanDefinition that is registered within the given name or returns null"],"delete":["173","     * Creates and returns the BeanDefinition that is regsitered within the given name or returns null"]}],"core\/src\/main\/java\/hudson\/tasks\/Publisher.java":[{"add":["103","     * So normally, that is the preferable behavior, but in a few cases"],"delete":["103","     * So normally, that is the preferrable behavior, but in a few cases"]}],"core\/src\/main\/java\/hudson\/util\/DescribableList.java":[{"add":["202","     * This version works with the &lt;f:hetero-list> UI tag, where the user","251","     * Serialization form is compatible with plain {@link List}."],"delete":["202","     * This version works with the the &lt;f:hetero-list> UI tag, where the user","251","     * Serializaion form is compatible with plain {@link List}."]}],"core\/src\/main\/java\/hudson\/security\/Permission.java":[{"add":["316","\/\/ These permissions are meant to be used as the 'impliedBy' permission for other more specific permissions."],"delete":["316","\/\/ These permisisons are meant to be used as the 'impliedBy' permission for other more specific permissions."]}],"core\/src\/main\/java\/hudson\/LocalPluginManager.java":[{"add":["72","     *      File names of the bundled plugins. Like {\"ssh-slaves.jpi\",\"subversion.jpi\"}"],"delete":["72","     *      File names of the bundled plugins. Like {\"ssh-slaves.jpi\",\"subvesrion.jpi\"}"]}],"core\/src\/main\/resources\/hudson\/model\/AbstractProject\/help-concurrentBuild.html":[{"add":["20","  This feature is also useful for parameterized projects, whose individual build"],"delete":["20","  This feature is also useful for parameterised projects, whose individual build"]}],"core\/src\/main\/java\/jenkins\/model\/Jenkins.java":[{"add":["1439","     *      UI method. Not meant to be used programmatically.","1458","        \/\/ legacy descriptors that are registered manually doesn't show up in getExtensionList, so check them explicitly.","2344","            \/\/ Nginx uses the same spec as for the Host header, i.e. hostname:port","3889","            rsp.sendRedirect2(from);    \/\/ I'm bit uncomfortable letting users redirected to other sites, make sure the URL falls into this domain"],"delete":["1439","     *      UI method. Not meant to be used programatically.","1458","        \/\/ legacy descriptors that are reigstered manually doesn't show up in getExtensionList, so check them explicitly.","2344","            \/\/ Nginx uses the same spec as for the Host header, i.e. hostanme:port","3889","            rsp.sendRedirect2(from);    \/\/ I'm bit uncomfortable letting users redircted to other sites, make sure the URL falls into this domain"]}],"core\/src\/main\/resources\/testng-1.0.dtd":[{"add":["139","<!-- The list of methods to include\/exclude from this test                 -->"],"delete":["139","<!-- The list of methodes to include\/exclude from this test                 -->"]}],"core\/src\/main\/java\/hudson\/model\/ParameterValue.java":[{"add":["278","     * new line. No HTML allowed (the caller will perform necessary HTML escapes, so any text can be returned.)"],"delete":["278","     * new line. No HTML allowed (the caller will perform necessary HTML escapes, so any text can be returend.)"]}],"core\/src\/main\/java\/hudson\/init\/package-info.java":[{"add":["35"," * via <tt>Session<\/tt>. During execution of the reactor, additional tasks can be discovered and added to"],"delete":["35"," * via <tt>Session<\/tt>. During execution of the reactor, additional tasks can be discovred and added to"]}],"core\/src\/main\/java\/hudson\/model\/Descriptor.java":[{"add":["458","     * Used by Jelly to abstract away the handling of global.jelly vs config.jelly databinding difference.","794","     * Can be overridden to store descriptor-specific information."],"delete":["458","     * Used by Jelly to abstract away the handlign of global.jelly vs config.jelly databinding difference.","794","     * Can be overriden to store descriptor-specific information."]}],"core\/pom.xml":[{"add":["863","              generate jelly taglib docs from src\/main\/resources."],"delete":["863","              generate jelly taglib docs from src\/main\/resoruces."]}],"core\/src\/main\/java\/hudson\/model\/Label.java":[{"add":["576","     * Convert a whitespace-separate list of tokens into a set of {@link Label}s."],"delete":["576","     * Convers a whitespace-separate list of tokens into a set of {@link Label}s."]}],"core\/src\/main\/java\/hudson\/tasks\/Maven.java":[{"add":["300","            \/\/ split targets into multiple invocations of maven separated by |"],"delete":["300","            \/\/ split targets into multiple invokations of maven separated by |"]}],"core\/src\/main\/java\/hudson\/model\/Computer.java":[{"add":["192","     * Keeps track of stack traces to track the termination requests for this computer.","1276","         * Instead we just use a logger based on this class name and prevent any references to"],"delete":["192","     * Keeps track of stack traces to track the tremination requests for this computer.","1276","         * Instead we just use a loger based on this class name and prevent any references to"]}],"war\/src\/main\/webapp\/WEB-INF\/web.xml":[{"add":["84","\tThe Headers filter allows us to override headers sent by the container"],"delete":["84","\tThe Headers filter allows us to to override headers sent by the container"]}],"core\/src\/main\/java\/hudson\/model\/PermalinkProjectAction.java":[{"add":["51","     * this method should normally return a pre-initialized"],"delete":["51","     * this method should normally return a pre-initialzied"]}],"core\/src\/main\/java\/hudson\/model\/listeners\/SCMListener.java":[{"add":["53"," * Once instantiated, use the {@link #register()} method to start receiving events. "],"delete":["53"," * Once instanciated, use the {@link #register()} method to start receiving events. "]}],"core\/src\/main\/resources\/lib\/form\/hetero-list\/hetero-list.js":[{"add":["123","            \/\/ does this container already has a configured instance of the specified descriptor ID?"],"delete":["123","            \/\/ does this container already has a ocnfigured instance of the specified descriptor ID?"]}],"core\/src\/main\/resources\/lib\/form\/optionalProperty.jelly":[{"add":["37","    Without @checked, optionalBlock will try to coarse an object to a boolean, which fails,"],"delete":["37","    Without @checked, optionalBlock will try to coarse an obejct to a boolean, which fails,"]}],"test\/src\/test\/java\/hudson\/model\/AbstractBuildTest.java":[{"add":["62","        ErroneousJobProperty erroneousJobProperty = new ErroneousJobProperty();","63","        prj.addProperty(erroneousJobProperty);"],"delete":["62","        ErroneousJobProperty errorneousJobProperty = new ErroneousJobProperty();","63","        prj.addProperty(errorneousJobProperty);"]}],"test\/src\/test\/java\/hudson\/tasks\/MavenTest.java":[{"add":["174","        \/\/ another submission and verify it survives a roundtrip","257","            globalMavenConfig.setSettingsProvider(new FilePathSettingsProvider(\"\/tmp\/settings.xml\"));","258","            globalMavenConfig.setGlobalSettingsProvider(new FilePathGlobalSettingsProvider(\"\/tmp\/global-settings.xml\"));","265","            assertEquals(\"\/tmp\/settings.xml\", ((FilePathSettingsProvider)m.getSettings()).getPath());","266","            assertEquals(\"\/tmp\/global-settings.xml\", ((FilePathGlobalSettingsProvider)m.getGlobalSettings()).getPath());","288","                new StringParameterDefinition(\"dollar\", \"$\"),"],"delete":["174","        \/\/ another submission and verfify it survives a roundtrip","257","            globalMavenConfig.setSettingsProvider(new FilePathSettingsProvider(\"\/tmp\/settigns.xml\"));","258","            globalMavenConfig.setGlobalSettingsProvider(new FilePathGlobalSettingsProvider(\"\/tmp\/global-settigns.xml\"));","265","            assertEquals(\"\/tmp\/settigns.xml\", ((FilePathSettingsProvider)m.getSettings()).getPath());","266","            assertEquals(\"\/tmp\/global-settigns.xml\", ((FilePathGlobalSettingsProvider)m.getGlobalSettings()).getPath());","288","                new StringParameterDefinition(\"dolar\", \"$\"),"]}],"test\/src\/test\/resources\/hudson\/model\/node.xml":[{"add":["4","  <remoteFS>\/user\/hudson\/workspace<\/remoteFS>"],"delete":["4","  <remoteFS>\/user\/hudson\/wokspace<\/remoteFS>"]}],"core\/src\/main\/java\/hudson\/init\/impl\/InstallUncaughtExceptionHandler.java":[{"add":["47","                                                       \"It is highly recommended that you consult the documentation that comes with you servlet container on how to allow the \" + "],"delete":["47","                                                       \"It is highly recomended that you consult the documentation that comes with you servlet container on how to allow the \" + "]}],"core\/src\/main\/java\/jenkins\/security\/UserDetailsCache.java":[{"add":["61","    private final Cache<String, Boolean> existenceCache;","77","        existenceCache = newBuilder().softValues().expireAfterWrite(EXPIRE_AFTER_WRITE_SEC, TimeUnit.SECONDS).build();","99","        Boolean exists = existenceCache.getIfPresent(idOrFullName);","121","        Boolean exists = existenceCache.getIfPresent(idOrFullName);","143","        existenceCache.invalidateAll();","152","        existenceCache.invalidate(idOrFullName);","173","                    existenceCache.put(this.idOrFullName, Boolean.FALSE);","177","                existenceCache.put(this.idOrFullName, Boolean.TRUE);","180","                existenceCache.put(this.idOrFullName, Boolean.FALSE);","183","                existenceCache.invalidate(this.idOrFullName);"],"delete":["61","    private final Cache<String, Boolean> existanceCache;","77","        existanceCache = newBuilder().softValues().expireAfterWrite(EXPIRE_AFTER_WRITE_SEC, TimeUnit.SECONDS).build();","99","        Boolean exists = existanceCache.getIfPresent(idOrFullName);","121","        Boolean exists = existanceCache.getIfPresent(idOrFullName);","143","        existanceCache.invalidateAll();","152","        existanceCache.invalidate(idOrFullName);","173","                    existanceCache.put(this.idOrFullName, Boolean.FALSE);","177","                existanceCache.put(this.idOrFullName, Boolean.TRUE);","180","                existanceCache.put(this.idOrFullName, Boolean.FALSE);","183","                existanceCache.invalidate(this.idOrFullName);"]}],"core\/src\/main\/java\/hudson\/util\/SequentialExecutionQueue.java":[{"add":["25","     * Access is synchronized by {@code Queue.this}"],"delete":["25","     * Access is sycnhronized by {@code Queue.this}"]}],"core\/src\/main\/java\/hudson\/model\/Job.java":[{"add":["570","     * Gets the specific property, or null if the property is not configured for"],"delete":["570","     * Gets the specific property, or null if the propert is not configured for"]}],"test\/src\/test\/java\/jenkins\/I18nTest.java":[{"add":["89","    @Test \/\/country testing with delimiter '-' instead of '_'"],"delete":["89","    @Test \/\/country testing with delimeter '-' instead of '_'"]}],"core\/src\/test\/java\/hudson\/FunctionsTest.java":[{"add":["275","    public void testGetActionUrl_unparseable() throws Exception{"],"delete":["275","    public void testGetActionUrl_unparsable() throws Exception{"]}],"core\/src\/main\/java\/hudson\/model\/Run.java":[{"add":["690","        \/\/ Could not find a preferred truncatable index, force a trunc at maxTruncLength","1215","\/\/                \/\/ this n successfully disambiguates"],"delete":["690","        \/\/ Could not find a preferred truncable index, force a trunc at maxTruncLength","1215","\/\/                \/\/ this n successfully diambiguates"]}],"pom.xml":[{"add":["81","    <!-- *.html files are in UTF-8, and *.properties are in iso-8859-1, so this configuration is actually incorrect,"],"delete":["81","    <!-- *.html files are in UTF-8, and *.properties are in iso-8859-1, so this configuration is acturally incorrect,"]}],"test\/src\/test\/java\/hudson\/model\/ViewTest.java":[{"add":["419","        assertNotNull(\"View should contain ViewPropertyImpl property.\", view.getProperties().get(PropertyImpl.class));"],"delete":["419","        assertNotNull(\"View should contains ViewPropertyImpl property.\", view.getProperties().get(PropertyImpl.class));"]}],"core\/src\/main\/java\/hudson\/FilePath.java":[{"add":["1204","            \/\/ it allows others to create new files, causing problems like JENKINS-10113","2385","                            return Messages.FilePath_validateAntFileMask_whitespaceSeparator();"],"delete":["1204","            \/\/ it allows others to create new files, causing problemsl ike JENKINS-10113","2385","                            return Messages.FilePath_validateAntFileMask_whitespaceSeprator();"]}],"core\/src\/main\/java\/hudson\/util\/DoubleLaunchChecker.java":[{"add":["63"," * there's no reliable way to obtain PID."],"delete":["63"," * there's no reliabe way to obtain PID."]}],"licenseCompleter.groovy":[{"add":["1","    This script augments the missing license information in our dependencies."],"delete":["1","    This script auguments the missing license information in our dependencies."]}],"test\/src\/test\/java\/hudson\/scm\/ChangeLogSetTest.java":[{"add":["24","        change.setParent(ChangeLogSet.createEmpty(null)); \/\/ otherwise test would actually test only NPE thrown when accessing parent.build"],"delete":["24","        change.setParent(ChangeLogSet.createEmpty(null)); \/\/ otherwise test would actually test only NPE thrown when accessing paret.build"]}],"test\/src\/test\/groovy\/hudson\/cli\/BuildCommandTest.groovy":[{"add":["207","    @Test void refuseToBuildNewlyCopiedProject() {"],"delete":["207","    @Test void refuseToBuildNewlyCoppiedProject() {"]}],"core\/src\/main\/java\/hudson\/slaves\/RetentionStrategy.java":[{"add":["183","         * The delay (in minutes) for which the agent must be in demand before trying to launch it."],"delete":["183","         * The delay (in minutes) for which the agent must be in demand before tring to launch it."]}],"core\/src\/main\/java\/hudson\/util\/ChunkedInputStream.java":[{"add":["69","    \/** True if we're at the beginning of stream *\/","103","     * <p> Trailer headers are read automatically at the end of the stream and"],"delete":["69","    \/** True if we'are at the beginning of stream *\/","103","     * <p> Trailer headers are read automcatically at the end of the stream and"]}],"core\/src\/main\/java\/hudson\/tools\/DownloadFromUrlInstaller.java":[{"add":["39","     * This check needs to run fairly efficiently. The current implementation uses the source URL of {@link Installable},"],"delete":["39","     * This check needs to run fairly efficiently. The current implementation uses the souce URL of {@link Installable},"]}],"test\/src\/test\/java\/jenkins\/security\/security218\/ysoserial\/payloads\/FileUpload1.java":[{"add":["54"," * - copy an arbitrary file to an arbitrary directory (source file is deleted if possible)"],"delete":["54"," * - copy an arbitraty file to an arbitrary directory (source file is deleted if possible)"]}],"core\/src\/main\/java\/hudson\/util\/spring\/BeanBuilder.java":[{"add":["149","\t * Retrieves the RuntimeSpringConfiguration instance used by the BeanBuilder","200","\t * that point of assignment, but may later hence it would need to be managed"],"delete":["149","\t * Retrieves the RuntimeSpringConfiguration instance used the the BeanBuilder","200","\t * that point of asignment, but may later hence it would need to be managed"]}],"core\/src\/main\/java\/hudson\/slaves\/SlaveComputer.java":[{"add":["559","                \/\/ check again. we used to have this entire method in a big synchronization block,"],"delete":["559","                \/\/ check again. we used to have this entire method in a big sycnhronization block,"]}],"core\/src\/main\/resources\/hudson\/PluginManager\/installed.jelly":[{"add":["148","                    <div style=\"padding-left: 1em\">"],"delete":["148","                    <div stlyle=\"padding-left: 1em\">"]}],"core\/src\/main\/java\/hudson\/util\/CompressedFile.java":[{"add":["46"," * Represents write-once read-many file that can be optionally compressed","53"," * <li>Compressed, in which case the gzip-compressed data is available in the specified file name + \".gz\" extension."],"delete":["46"," * Represents write-once read-many file that can be optiionally compressed","53"," * <li>Compressed, in which case the gzip-compressed data is available in the specifiled file name + \".gz\" extension."]}],"core\/src\/main\/resources\/hudson\/TcpSlaveAgentListener\/index.jelly":[{"add":["28","    Publicize the TCP port number for JNLP agents so that they know where to connect.","34","    if the host name is overridden, advertise that as well"],"delete":["28","    Publicize the TCP port number for JNLP agents so that they know where to conenct.","34","    if the host name is overriden, advertise that as well"]}],"test\/src\/test\/java\/hudson\/model\/QueueTest.java":[{"add":["878","    \/\/let's make sure that the downstream project is not started before the upstream --> we want to simulate"],"delete":["878","    \/\/let's make sure that the downstram project is not started before the upstream --> we want to simulate"]}],"core\/src\/main\/java\/hudson\/model\/ChoiceParameterDefinition.java":[{"add":["107","         * Checks if parameterized build choices are valid."],"delete":["107","         * Checks if parameterised build choices are valid."]}],"core\/src\/main\/java\/hudson\/model\/AbstractProject.java":[{"add":["1153","                \/\/ Another cause may be an API implementation glit?h in the implementation for AbstractProject. ","1620","     * Gets the specific trigger, or null if the property is not configured for this job."],"delete":["1153","                \/\/ Another cause may be an API implemetation glit?h in the implementation for AbstractProject. ","1620","     * Gets the specific trigger, or null if the propert is not configured for this job."]}],"core\/src\/main\/java\/hudson\/triggers\/SCMTrigger.java":[{"add":["162","     * to trigger a build at a specific revision number.","599","            \/\/ we can preemptively check the SCMDecisionHandler instances here"],"delete":["162","     * to trigger a build at a specific revisionn number.","599","            \/\/ we can pre-emtively check the SCMDecisionHandler instances here"]}],"core\/src\/main\/java\/hudson\/cli\/BuildCommand.java":[{"add":["149","            \/\/ preemptively check for a polling veto"],"delete":["149","            \/\/ pre-emtively check for a polling veto"]}],"core\/src\/main\/java\/hudson\/model\/TaskAction.java":[{"add":["51","     * If non-null, that means either the activity is in progress"],"delete":["51","     * If non-null, that means either the activitiy is in progress"]}],"core\/src\/main\/java\/hudson\/ProxyConfiguration.java":[{"add":["207","            \/\/ backward compatibility : get scrambled password and store it encrypted"],"delete":["207","            \/\/ backward compatibility : get crambled password and store it encrypted"]}],"core\/src\/main\/resources\/hudson\/tasks\/BatchFile\/help-unstableReturn.html":[{"add":["6","    of Windows use 2 bytes. DOS like systems use single byte, yielding errorlevels between 0-255."],"delete":["6","    of Windows use 2 bytes. DOS like systems use single byte, yelding errorlevels between 0-255."]}],"core\/src\/main\/java\/hudson\/util\/CharacterEncodingFilter.java":[{"add":["92","        \/\/ but doing this for config.xml submission could potentially overwrite valid"],"delete":["92","        \/\/ but doing this for config.xml submission could potentiall overwrite valid"]}],"war\/pom.xml":[{"add":["469","            <!-- load resources straight from source -->"],"delete":["469","            <!-- load resoures straight from source -->"]}],"test\/src\/test\/java\/hudson\/model\/MyViewTest.java":[{"add":["103","        assertTrue(\"View \" + view.getDisplayName() + \" should contain job \" + job.getDisplayName(), view.getItems().contains(job));","104","        assertTrue(\"View \" + view.getDisplayName() + \" should contain job \" + job2.getDisplayName(), view.getItems().contains(job2));"],"delete":["103","        assertTrue(\"View \" + view.getDisplayName() + \" should contains job \" + job.getDisplayName(), view.getItems().contains(job));","104","        assertTrue(\"View \" + view.getDisplayName() + \" should contains job \" + job2.getDisplayName(), view.getItems().contains(job2));"]}],"core\/src\/main\/java\/hudson\/org\/apache\/tools\/tar\/TarInputStream.java":[{"add":["55","     * it is only here to avoid repeated object creation during calls","128","     * Integer.MAX_VALUE is returned in case more than Integer.MAX_VALUE","248","                System.err.println(\"TarInputStream: SET currENTRY '\""],"delete":["55","     * it is only here to avoid repreated object creation during calls","128","     * Integer.MAX_VALUE is returen in case more than Integer.MAX_VALUE","248","                System.err.println(\"TarInputStream: SET CURRENTRY '\""]}],"core\/src\/main\/java\/jenkins\/mvn\/GlobalSettingsProvider.java":[{"add":["26","     *            the build to provide the settings for"],"delete":["26","     *            the build to provide the settigns for"]}],"core\/src\/main\/java\/jenkins\/install\/InstallUtil.java":[{"add":["93","        if (Main.isDevelopmentMode) LOGGER.info(\"Install state transitioning from: \" + prior + \" to: \" + next);"],"delete":["93","        if (Main.isDevelopmentMode) LOGGER.info(\"Install state tranisitioning from: \" + prior + \" to: \" + next);"]}],"core\/src\/main\/java\/hudson\/util\/DescriptorList.java":[{"add":["56"," * bi-directional interoperability &mdash; both descriptors registered automatically and descriptors registered"],"delete":["56"," * bi-directional interoperability &mdash; both descriptors registred automatically and descriptors registered"]}],"test\/src\/test\/java\/jenkins\/model\/JenkinsTest.java":[{"add":["612","        assertThat(protocolToDisable1 + \" must be disabled after the roundtrip\", ","614","        assertThat(protocolToDisable2 + \" must be disabled after the roundtrip\", "],"delete":["612","        assertThat(protocolToDisable1 + \" must be disaabled after the roundtrip\", ","614","        assertThat(protocolToDisable2 + \" must be disaabled after the roundtrip\", "]}],"war\/src\/main\/js\/widgets\/variables.less":[{"add":["16","@light-background: #eee;"],"delete":["16","@light-backgrond: #eee;"]}],"core\/src\/main\/java\/hudson\/model\/UpdateCenter.java":[{"add":["257","            \/\/ Use the default Update Center"],"delete":["257","            \/\/ Use the defaul Update Center"]}],"core\/src\/test\/java\/hudson\/UtilTest.java":[{"add":["443","            Thread deleteToBeInterrupted = new Thread(\"deleteToBeInterrupted\") {","449","            deleteToBeInterrupted.start();","450","            deleteToBeInterrupted.interrupt();","451","            deleteToBeInterrupted.join(500);","452","            assertFalse(\"deletion stopped\", deleteToBeInterrupted.isAlive());"],"delete":["443","            Thread deleteToBeInterupted = new Thread(\"deleteToBeInterupted\") {","449","            deleteToBeInterupted.start();","450","            deleteToBeInterupted.interrupt();","451","            deleteToBeInterupted.join(500);","452","            assertFalse(\"deletion stopped\", deleteToBeInterupted.isAlive());"]}],"core\/src\/main\/java\/hudson\/node_monitors\/AbstractAsyncNodeMonitorDescriptor.java":[{"add":["25"," *     represents the result of the monitoring."],"delete":["25"," *     represents the the result of the monitoring."]}],"core\/src\/main\/java\/hudson\/util\/RunList.java":[{"add":["79","     * Creates a a {@link RunList} combining all the runs of the supplied jobs."],"delete":["79","     * Createsa a {@link RunList} combining all the runs of the supplied jobs."]}],"war\/images\/readme.txt":[{"add":["1","These images are generated into PNGs and then copied manually over to the resources\/image directory"],"delete":["1","These images are generated into PNGs and then copied manually over to the resouces\/image directory"]}],"test\/src\/test\/java\/hudson\/model\/MyViewsPropertyTest.java":[{"add":["53","        assertNotNull(\"Property should contain \" + AllView.DEFAULT_VIEW_NAME + \" by default.\", property.getView(AllView.DEFAULT_VIEW_NAME));","84","        assertTrue(\"Property should contain \" + AllView.DEFAULT_VIEW_NAME, property.getViews().contains(property.getView(AllView.DEFAULT_VIEW_NAME)));","87","        assertTrue(\"Property should contain \" + view.name, property.getViews().contains(view));","96","        assertNotNull(\"Property should contain \" + AllView.DEFAULT_VIEW_NAME, property.getView(","100","        assertEquals(\"Property should contain \" + view.name, view, property.getView(view.name));","189","        assertTrue(\"Property should contain view \" + view.name, property.getViews().contains(view));"],"delete":["53","        assertNotNull(\"Property should contains \" + AllView.DEFAULT_VIEW_NAME + \" defaultly.\", property.getView(AllView.DEFAULT_VIEW_NAME));","84","        assertTrue(\"Property should contains \" + AllView.DEFAULT_VIEW_NAME, property.getViews().contains(property.getView(AllView.DEFAULT_VIEW_NAME)));","87","        assertTrue(\"Property should contains \" + view.name, property.getViews().contains(view));","96","        assertNotNull(\"Property should contains \" + AllView.DEFAULT_VIEW_NAME, property.getView(","100","        assertEquals(\"Property should contains \" + view.name, view, property.getView(view.name));","189","        assertTrue(\"Property should contains view \" + view.name, property.getViews().contains(view));"]}],"core\/src\/main\/java\/hudson\/model\/Slave.java":[{"add":["86"," * On February, 2016 a general renaming was done internally: the \"slave\" term was replaced by","125","     * Agent availability strategy.","498","        @Restricted(NoExternalUse.class) \/\/ intended for use by Jelly EL only (plus hack in DelegatingComputerLauncher)"],"delete":["86"," * On Febrary, 2016 a general renaming was done internally: the \"slave\" term was replaced by","125","     * Agent availablility strategy.","498","        @Restricted(NoExternalUse.class) \/\/ intedned for use by Jelly EL only (plus hack in DelegatingComputerLauncher)"]}],"core\/src\/main\/java\/hudson\/util\/PersistedList.java":[{"add":["219","     * Serialization form is compatible with plain {@link List}."],"delete":["219","     * Serializaion form is compatible with plain {@link List}."]}],"core\/src\/main\/resources\/hudson\/Messages.properties":[{"add":["23","FilePath.validateAntFileMask.whitespaceSeparator=\\"],"delete":["23","FilePath.validateAntFileMask.whitespaceSeprator=\\"]}],"core\/src\/main\/resources\/lib\/hudson\/propertyTable.jelly":[{"add":["27","    Display sortable table of properties."],"delete":["27","    Dispaly sortable table of properties."]}],"core\/src\/main\/java\/hudson\/node_monitors\/AbstractNodeMonitorDescriptor.java":[{"add":["51"," *     represents the result of the monitoring."],"delete":["51"," *     represents the the result of the monitoring."]}],"core\/src\/main\/java\/hudson\/util\/ListBoxModel.java":[{"add":["52"," *   <option>Fetching values...<\/option>"],"delete":["52"," *   <option>Fetching values...<\/optoin>"]}],"core\/src\/main\/java\/hudson\/model\/UsageStatistics.java":[{"add":["208","     * Asymmetric cipher is slow and in case of Sun RSA implementation it can only encrypt the first block."],"delete":["208","     * Asymmetric cipher is slow and in case of Sun RSA implementation it can only encyrypt the first block."]}],"core\/src\/main\/resources\/jenkins\/model\/GlobalQuietPeriodConfiguration\/help-quietPeriod.html":[{"add":["17","  this project is parameterized and the build has different parameters to the"],"delete":["17","  this project is parameterised and the build has different parameters to the"]}],"core\/src\/main\/resources\/hudson\/model\/EnvironmentContributor\/EnvVarsHtml\/index.groovy":[{"add":["19","            \/\/ allow SCM classes to have buildEnv.groovy since SCM can contribute environment variables"],"delete":["19","            \/\/ allow SCM classes to have buildEnv.groovy since SCM can contirbute environment variables"]}],"core\/src\/test\/java\/hudson\/model\/FileParameterValueTest.java":[{"add":["45","        assertNotEquals(\"Files with same locations should be considered as different\", param1, param2);","46","        assertNotEquals(\"Files with same locations should be considered as different\", param2, param1);"],"delete":["45","        assertNotEquals(\"Files with same locations shoud be considered as different\", param1, param2);","46","        assertNotEquals(\"Files with same locations shoud be considered as different\", param2, param1);"]}],"war\/src\/main\/webapp\/css\/style.css":[{"add":["652","  box-shadow:#fff 0 0 0 10px","1390","\/* == nested repeatable elements \/ 2 deep == *\/","1400","\/* == nested repeatable elements \/ 3 deep == *\/","1411","    <DIV>s marked with to-be-removed is used in conjunction with repeatable.jelly and hetero-list.jelly"],"delete":["652","  box-shaodw:#fff 0 0 0 10px","1390","\/* == nested erpeatable elements \/ 2 deep == *\/","1400","\/* == nested erpeatable elements \/ 3 deep == *\/","1411","    <DIV>s marked with to-be-removed is used in conjunction with repetable.jelly and hetero-list.jelly"]}],"core\/src\/main\/java\/hudson\/search\/Search.java":[{"add":["213","     * When there are multiple suggested items, this method can narrow down the resultset","326","         * returns the concatenation of [token_start,...,token_end]"],"delete":["213","     * When there are mutiple suggested items, this method can narrow down the resultset","326","         * returns the concatanation of [token_start,...,token_end]"]}],"core\/src\/main\/java\/jenkins\/security\/s2m\/AdminCallableMonitor.java":[{"add":["51","     * Depending on whether the user said \"examine\" or \"dismiss\", send him to the right place."],"delete":["51","     * Depending on whether the user said \"examin\" or \"dismiss\", send him to the right place."]}],"test\/src\/test\/java\/hudson\/model\/UserTest.java":[{"add":["254","        assertTrue(\"User should should contain SomeUserProperty.\", user.getAllProperties().contains(prop));","404","            fail(\"User should not have permission to configure another user.\");","442","            fail(\"User should not have permission to delete another user.\");"],"delete":["254","        assertTrue(\"User should should contains SomeUserProperty.\", user.getAllProperties().contains(prop));","404","            fail(\"User should not have permission to configure antoher user.\");","442","            fail(\"User should not have permission to delete antoher user.\");"]}],"changelog.html":[{"add":["213","    Fix names of item loading and cleanup Jenkins initialization stages.","508","    Performance: Update <code>XStream<\/code> driver to improve performance of XML serialization\/deserialization.","543","    Internal: Invoke <code>hpi:record-core-location<\/code> during the build in order to enabled coordinated run across repositories.","582","    Added Serbian localization.","588","    Prevent instantiation of <code>jenkins.model.Jenkins<\/code> on agents in the <code>ProcessKillingVeto<\/code> extension point.","648","    when Jenkins initialization does not reach the final milestone.","653","    overridden and used in plugins.","730","    Incorrect formatting of messages in the Update Center and Setup Wizard.","772","    Add diagnostic HTTP response to TCP agent listener.","1027","    Cleanup of Javascript issues discovered by the JSHint static analysis tool.","1040","    Internal: NodeJS build was malfunctioning on Win x64.","1052","    (<a href=\"https:\/\/github.com\/jenkinsci\/jenkins\/pull\/2281\">PR 2281<\/a> as supplementary change for ","1081","    Do not show warnings about a missing Tool Installer if it is present in at least one Update Site.","1860","    Preemptively break memory cycles causing excessive live-set retention in remoting layer.","2781","    Fixed <code>NullPointerException<\/code> when <code>ArtifactArchiver<\/code> is called for a build with the undefined status.","2784","    Allow disabling use of default exclude patterns in <code>ArtifactArchiver<\/code> (.git, .svn, etc.)."],"delete":["213","    Fix names of item loading and cleanup Jenkins initializatiion stages.","508","    Performance: Update <code>XStream<\/code> driver to improve performance of XML serilization\/deserialization.","543","    Internal: Invoke <code>hpi:record-core-location<\/code> during the build in order to enabled coordinated run accross repositories.","582","    Added Serbian locatization.","588","    Prevent instatination of <code>jenkins.model.Jenkins<\/code> on agents in the <code>ProcessKillingVeto<\/code> extension point.","648","    when Jenkins initializarion does not reach the final milestone.","653","    overriden and used in plugins.","730","    Incorrect formatting of messages in the Upate Center and Setup Wizard.","772","    Add dagnostic HTTP response to TCP agent listener.","1027","    Cleanup of Javascript issues discovered by the JSHint static analyis tool.","1040","    Internal: NodeJS build was malfunctional on Win x64.","1052","    (<a href=\"https:\/\/github.com\/jenkinsci\/jenkins\/pull\/2281\">PR 2281<\/a> as supplimentary change for ","1081","    Do not show warnings abot a missing Tool Installer if it is present in at least one Update Site.","1860","    Pre-emptively break memory cycles causing excessive live-set retention in remoting layer.","2781","    Fixed <code>NullPointerException<\/code> when <code>ArctifactArchiver<\/code> is called for a build with the undefined status.","2784","    Allow disabling use of default exclude patterns in <code>ArctifactArchiver<\/code> (.git, .svn, etc.)."]}],"core\/src\/main\/java\/hudson\/PluginManager.java":[{"add":["944","     *      File names of the bundled plugins. Like {\"ssh-slaves.hpi\",\"subversion.jpi\"}","1013","        \/\/ It prevents getting into JENKINS-37332 due to the file descriptor leak ","1052","        \/\/ It prevents file descriptor leak if the URL references a file within JAR","1227","                    return null;    \/\/ ambiguous","1421","                    \/\/ 'plugin' @ 'ambiguous.updatesite' and 'plugin.ambiguous' @ 'updatesite' resolve to valid plugins"],"delete":["944","     *      File names of the bundled plugins. Like {\"ssh-slaves.hpi\",\"subvesrion.jpi\"}","1013","        \/\/ It prevents getting into JENKINS-37332 due to the file desciptor leak ","1052","        \/\/ It prevents file desciptor leak if the URL references a file within JAR","1227","                    return null;    \/\/ ambigious","1421","                    \/\/ 'plugin' @ 'ambigiuous.updatesite' and 'plugin.ambiguous' @ 'updatesite' resolve to valid plugins"]}],"core\/src\/main\/java\/jenkins\/util\/SystemProperties.java":[{"add":["142","     *             or {@code null} if the property is missing and the default value is {@code null}.","160","     *             or {@code null} if the property is missing and the default value is {@code null}."],"delete":["142","     *             or {@code null} if the the property is missing and the default value is {@code null}.","160","     *             or {@code null} if the the property is missing and the default value is {@code null}."]}],"core\/src\/main\/java\/jenkins\/model\/lazy\/AbstractLazyLoadRunMap.java":[{"add":["295","     * Checks if the specified build exists."],"delete":["295","     * Checks if the the specified build exists."]}],"test\/src\/test\/java\/hudson\/model\/FingerprintTest.java":[{"add":["271","            assertThat(\"Job has been deleted, so Job reference should return null\", fingerprint.getOriginal().getJob(), nullValue());"],"delete":["271","            assertThat(\"Job has been deleted, so Job reference shoud return null\", fingerprint.getOriginal().getJob(), nullValue());"]}],"core\/src\/main\/java\/hudson\/util\/FormFieldValidator.java":[{"add":["135","                \/\/ if the user has hudson-wide admin permission, all checks are allowed","483","                ok(); \/\/ couldn't check"],"delete":["135","                \/\/ if the user has hudson-wisde admin permission, all checks are allowed","483","                ok(); \/\/ coundn't check"]}],"core\/src\/main\/java\/hudson\/cli\/CLICommand.java":[{"add":["403","     *      If the execution can't continue due to an incorrect state of Jenkins, job, build etc.","407","     *      If the caller doesn't have sufficient rights for requested action"],"delete":["403","     *      If the execution can't continue due to an incorect state of Jenkins, job, build etc.","407","     *      If the caller doesn't have sufficent rights for requested action"]}],"core\/src\/main\/resources\/hudson\/slaves\/Messages.properties":[{"add":["39","NodeDescriptor.CheckName.Mandatory=Name is mandatory","42","ComputerLauncher.UnknownJavaVersion=Couldn\\u2019t figure out the Java version of {0}"],"delete":["39","NodeDescripter.CheckName.Mandatory=Name is mandatory","42","ComputerLauncher.UknownJavaVersion=Couldn\\u2019t figure out the Java version of {0}"]}],"core\/src\/main\/java\/hudson\/tasks\/UserNameResolver.java":[{"add":["60","     * the search will be over when a name is found by someone."],"delete":["60","     * the search will be over when a name is found by someoene."]}],"core\/src\/main\/java\/hudson\/model\/AbstractBuild.java":[{"add":["855","     * No need to lock the entire AbstractBuild on change set calculation"],"delete":["855","     * No need to to lock the entire AbstractBuild on change set calculcation"]}],"core\/src\/test\/java\/hudson\/model\/UserTest.java":[{"add":["47","    public void shouldNotAllowIllegalRestrictedNamesInWrongCase() {","57","    public void shouldNotAllowIllegalRestrictedNamesEvenIfTrimmed() {"],"delete":["47","    public void shoudNotAllowIllegalRestrictedNamesInWrongCase() {","57","    public void shoudNotAllowIllegalRestrictedNamesEvenIfTrimmed() {"]}],"war\/src\/main\/webapp\/scripts\/combobox.js":[{"add":["53"," * are for the containing DIV, the individual item DIVs, and for the"],"delete":["53"," * are for the containing DIV, the individial item DIVs, and for the"]}],"core\/src\/main\/java\/hudson\/model\/UpdateSite.java":[{"add":["111","     * until we get the data back, so this variable is used to avoid asking too many browsers"],"delete":["111","     * until we get the data back, so this variable is used to avoid asking too many browseres"]}],"core\/src\/main\/java\/hudson\/scheduler\/BaseParser.java":[{"add":["39","    \/\/ lower\/upper bounds of fields (inclusive)"],"delete":["39","    \/\/ lower\/uppser bounds of fields (inclusive)"]}],"core\/src\/main\/java\/hudson\/util\/ProcessTree.java":[{"add":["1112","                        throw new IOException(\"Failed to get kern.argmax: \"+LIBC.strerror(Native.getLastError()));"],"delete":["1112","                        throw new IOException(\"Failed to get kernl.argmax: \"+LIBC.strerror(Native.getLastError()));"]}],"core\/src\/test\/java\/hudson\/model\/AbstractItemTest.java":[{"add":["23","            super(null, \"StubAbstractItem\");"],"delete":["23","            super(null, \"StubAbatractItem\");"]}],"war\/src\/main\/js\/widgets\/config\/tabbar.less":[{"add":["8","  background:@light-background;","24","    color:@light-background;","156","            background:@light-background;","316","          color: @light-background;","353","  background:@light-background;"],"delete":["8","  background:@light-backgrond;","24","    color:@light-backgrond;","156","            background:@light-backgrond;","316","          color: @light-backgrond;","353","  background:@light-backgrond;"]}],"test\/src\/test\/java\/hudson\/ExtensionListTest.java":[{"add":["144","        \/\/ all 3 should be visible from LIST, too"],"delete":["144","        \/\/ all 3 should be visisble from LIST, too"]}],"core\/src\/main\/java\/hudson\/model\/PageDecorator.java":[{"add":["37"," * This class provides a few hooks to augment the HTML generation process of Hudson, across"],"delete":["37"," * This class provides a few hooks to augument the HTML generation process of Hudson, across"]}],"core\/src\/test\/java\/hudson\/PluginWrapperTest.java":[{"add":["56","            assertContains(ex, \"fake v42 failed to load\", \"update Jenkins from v2.0 to v3.0\");","67","            assertContains(ex, \"dependee v42 failed to load\", \"dependency v42 is missing. To fix, install v42 or later\");","79","            assertContains(ex, \"dependee v42 failed to load\", \"dependency v3 is older than required. To fix, install v5 or later\");","91","            assertContains(ex, \"dependee v42 failed to load\", \"dependency v5 failed to load. Fix this plugin first\");","95","    private void assertContains(Throwable ex, String... patterns) {"],"delete":["56","            assertContians(ex, \"fake v42 failed to load\", \"update Jenkins from v2.0 to v3.0\");","67","            assertContians(ex, \"dependee v42 failed to load\", \"dependency v42 is missing. To fix, install v42 or later\");","79","            assertContians(ex, \"dependee v42 failed to load\", \"dependency v3 is older than required. To fix, install v5 or later\");","91","            assertContians(ex, \"dependee v42 failed to load\", \"dependency v5 failed to load. Fix this plugin first\");","95","    private void assertContians(Throwable ex, String... patterns) {"]}],"war\/src\/main\/webapp\/scripts\/hudson-behavior.js":[{"add":["966","            makeOuterVisible : function(b) {","977","            makeInnerVisible : function(b) {","989","                        e.rowVisibilityGroup.makeOuterVisible(this.innerVisible);","1039","        \/\/ can sandwich row-set-end","1110","                f.rowVisibilityGroup.makeInnerVisible(show);","1359","    vg.rowVisibilityGroup.makeInnerVisible(checked);"],"delete":["966","            makeOuterVisisble : function(b) {","977","            makeInnerVisisble : function(b) {","989","                        e.rowVisibilityGroup.makeOuterVisisble(this.innerVisible);","1039","        \/\/ can sandwitch row-set-end","1110","                f.rowVisibilityGroup.makeInnerVisisble(show);","1359","    vg.rowVisibilityGroup.makeInnerVisisble(checked);"]}],"core\/src\/main\/java\/hudson\/util\/ByteArrayOutputStream2.java":[{"add":["28","                \/\/ reallocate"],"delete":["28","                \/\/ realllocate"]}],"core\/src\/main\/java\/hudson\/util\/FormValidation.java":[{"add":["513","         * Implement the actual form validation logic, by using other convenience methods defined in this class."],"delete":["513","         * Implement the actual form validation logic, by using other convenience methosd defined in this class."]}],"test\/src\/test\/java\/hudson\/model\/LabelLoadStatisticsQueueLengthTest.java":[{"add":["190","        \/\/ parameterized."],"delete":["190","        \/\/ parameterised."]}],"core\/src\/main\/resources\/hudson\/scm\/SCM\/project-changes.jelly":[{"add":["28","  subclass may provide different implementation to present implementation-specific"],"delete":["28","  subclass may provide diffent implementation to present implementation-specific"]}],"core\/src\/main\/java\/hudson\/Plugin.java":[{"add":["282","     * This method can be also overridden if the plugin wants to"],"delete":["282","     * This method can be also overriden if the plugin wants to"]}],"core\/src\/main\/java\/hudson\/os\/SU.java":[{"add":["154","            else \/\/ in production code this never happens, but during debugging this is convenient    "],"delete":["154","            else \/\/ in production code this never happens, but during debugging this is convenientud    "]}],"core\/src\/main\/resources\/hudson\/slaves\/JNLPLauncher\/help.properties":[{"add":["27","  the <i>Configure Global Security<\/i> page, you can customize the port on \\"],"delete":["27","  the <i>Configure Global Security<\/i> page, you can customise the port on \\"]}],"core\/src\/main\/java\/hudson\/FileSystemProvisionerDescriptor.java":[{"add":["65","     *      true if this {@link FileSystemProvisionerDescriptor} is responsible for de-allocating the workspace."],"delete":["65","     *      true if this {@link FileSystemProvisionerDescriptor} is responsible for de-alocating the workspace."]}],"test\/src\/test\/java\/hudson\/model\/ProjectTest.java":[{"add":["340","        assertTrue(\"Project did not save block if upstream is building.\", p.blockBuildWhenUpstreamBuilding());"],"delete":["340","        assertTrue(\"Project did not save block if upstream is buildidng.\", p.blockBuildWhenUpstreamBuilding());"]}],"core\/src\/main\/java\/jenkins\/install\/InstallState.java":[{"add":["54","     * After any setup \/ restart \/ etc. hooks are done, states should be running","153","     * Jenkins started in development mode: Boolean.getBoolean(\"hudson.Main.development\")."],"delete":["54","     * After any setup \/ restart \/ etc. hooks are done, states hould be running","153","     * Jenkins started in development mode: Bolean.getBoolean(\"hudson.Main.development\")."]}],"translation-tool.pl":[{"add":["29","# 1.- It recursively looks for files in a folder, and analyzes them to extract the","413","     --counter=true       -> to each translated key, unique value is added to easily identify match missing translation"],"delete":["29","# 1.- It recursively looks for files in a folder, and analizes them to extract the","413","     --counter=true       -> to each translated key, unique value is added to easily identyfy match missing translation"]}],"core\/src\/main\/java\/hudson\/views\/ListViewColumn.java":[{"add":["56"," * This object may have an additional <tt>columnHeader.jelly<\/tt>. The default ColumnHeader"],"delete":["56"," * This object may have an additional <tt>columHeader.jelly<\/tt>. The default ColmnHeader"]}],"core\/src\/main\/java\/hudson\/Functions.java":[{"add":["1396","     * Resource path prefix."],"delete":["1396","     * Resoruce path prefix."]}],"core\/src\/main\/java\/hudson\/BulkChange.java":[{"add":["56"," * Mutator methods should invoke {@code this.save()} so that if the method is called outside","80","        \/\/ remember who allocated this object in case"],"delete":["56"," * Mutater methods should invoke {@code this.save()} so that if the method is called outside","80","        \/\/ rememeber who allocated this object in case"]}],"core\/src\/main\/java\/hudson\/cli\/handlers\/ViewOptionHandler.java":[{"add":["90","     *      If user doesn't have a READ permission for the view"],"delete":["90","     *      If user doens't have a READ permission for the view"]}],"test\/src\/test\/java\/hudson\/cli\/DeleteViewCommandTest.java":[{"add":["128","    @Test public void deleteViewShouldFailIfViewNameIsEmpty() {","139","    @Test public void deleteViewShouldFailIfViewNameIsSpace() {"],"delete":["128","    @Test public void deleteViewShoudlFailIfViewNameIsEmpty() {","139","    @Test public void deleteViewShoudlFailIfViewNameIsSpace() {"]}],"test\/src\/test\/java\/hudson\/search\/SearchTest.java":[{"add":["253","        boolean foundDisplayName = false;","262","                foundDisplayName = true;","267","        assertTrue(foundDisplayName);"],"delete":["253","        boolean foundDispayName = false;","262","                foundDispayName = true;","267","        assertTrue(foundDispayName);"]}],"core\/src\/main\/java\/hudson\/model\/ParameterDefinition.java":[{"add":["81"," * <h2>Associated Views<\/h2>"],"delete":["81"," * <h2>Assocaited Views<\/h2>"]}],"core\/src\/main\/resources\/lib\/layout\/html.jelly":[{"add":["41","      path is interpreted as relative to the context root. e.g.,","46","      *the use of this attribute is discouraged now.*"],"delete":["41","      path is interprted as relative to the context root. e.g.,","46","      *the use of thie attribute is discouraged now.*"]}],"core\/src\/test\/java\/hudson\/util\/FormValidationTest.java":[{"add":["101","        final FormValidation warning_error = aggregate(warning, error);","102","        assertEquals(FormValidation.Kind.ERROR, warning_error.kind);","103","        assertTrue(warning_error.renderHtml().contains(error.getMessage()));","104","        assertTrue(warning_error.renderHtml().contains(warning.getMessage()));"],"delete":["101","        final FormValidation warninig_error = aggregate(warning, error);","102","        assertEquals(FormValidation.Kind.ERROR, warninig_error.kind);","103","        assertTrue(warninig_error.renderHtml().contains(error.getMessage()));","104","        assertTrue(warninig_error.renderHtml().contains(warning.getMessage()));"]}],"core\/src\/main\/java\/hudson\/model\/JobPropertyDescriptor.java":[{"add":["93","            throw new AssertionError(clazz+\" doesn't properly parameterize JobProperty. The isApplicable() method must be overridden.\");"],"delete":["93","            throw new AssertionError(clazz+\" doesn't properly parameterize JobProperty. The isApplicable() method must be overriden.\");"]}],"core\/src\/main\/java\/hudson\/model\/User.java":[{"add":["130","    private static final String UNKNOWN_USERNAME = \"unknown\";","137","            ACL.SYSTEM_USERNAME, UNKNOWN_USERNAME};","355","        return getById(UNKNOWN_USERNAME, true);","722","        \/\/TODO: StringUtils.isBlank() checks the null value, but FindBugs is not smart enough. Remove it later","1017","         * context key for realm (domain) where idOrFullName has been retrieved from."],"delete":["130","    private static final String UKNOWN_USERNAME = \"unknown\";","137","            ACL.SYSTEM_USERNAME, UKNOWN_USERNAME};","355","        return getById(UKNOWN_USERNAME, true);","722","        \/\/TODO: StringUtils.isBlank() checks the null falue, but FindBugs is not smart enough. Remove it later","1017","         * context key for realm (domain) where idOrFullName has been retreived from."]}],"core\/src\/main\/java\/hudson\/Launcher.java":[{"add":["301","         * In addition to what the current process"],"delete":["301","         * In adition to what the current process"]}],"core\/src\/main\/java\/jenkins\/install\/SetupWizard.java":[{"add":["341","     * @return JSON array with the categorized plugin list"],"delete":["341","     * @return JSON array with the categorized plugon list"]}],"test\/src\/test\/java\/hudson\/diagnosis\/OldDataMonitorTest.java":[{"add":["141","        File xml = File.createTempFile(\"OldDataMonitorTest.slowDiscard\", \"xml\");"],"delete":["141","        File xml = File.createTempFile(\"OldDataMontiorTest.slowDiscard\", \"xml\");"]}],"core\/src\/main\/java\/hudson\/model\/listeners\/ItemListener.java":[{"add":["138","     *      Called at the beginning of the orderly shutdown sequence to"],"delete":["138","     *      Called at the begenning of the orderly shutdown sequence to"]}]}},"bc52cae16a4fa8b5c76fbd1c08429592751a6cd1":{"changes":{"core\/src\/main\/java\/hudson\/util\/ProcessTree.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/util\/ProcessTree.java":[{"add":["583","            return env;"],"delete":["583","            return null;"]}]}},"cb174607b348636eeaf27c6b0eab502ec1f2f3a6":{"changes":{"test\/src\/test\/java\/hudson\/search\/SearchTest.java":"MODIFY"},"diff":{"test\/src\/test\/java\/hudson\/search\/SearchTest.java":[{"add":["34","import java.net.URL;","35","","112","        FreeStyleProject myFreeStyleProject = j.createFreeStyleProject(\"testSearchByProjectName\");","113","        MockFolder myMockFolder = j.createFolder(\"my-folder-1\");","115","        Page result = j.createWebClient().goTo(myMockFolder.getUrl() + \"search?q=\"+ myFreeStyleProject.getName());","120","        URL resultUrl = result.getWebResponse().getUrl();","121","        assertTrue(resultUrl.toString().equals(j.getInstance().getRootUrl() + myFreeStyleProject.getUrl()));","128","        MockFolder myMockFolder = j.createFolder(\"my-folder-1\");","129","        FreeStyleProject myFreeStyleProject = myMockFolder.createProject(FreeStyleProject.class, \"my-job-1\");","130","","131","        Page result = j.createWebClient().goTo(myMockFolder.getUrl() + \"search?q=\" + myFreeStyleProject.getFullName());","136","        URL resultUrl = result.getWebResponse().getUrl();","137","        assertTrue(resultUrl.toString().equals(j.getInstance().getRootUrl() + myFreeStyleProject.getUrl()));"],"delete":["110","        final String projectName = \"testSearchByProjectName\";","111","        j.createFreeStyleProject(projectName);","112","        j.createFolder(\"my-folder-1\").createProject(FreeStyleProject.class, \"my-job-1\");","114","        Page result = j.createWebClient().goTo(\"job\/my-folder-1\/search?q=\"+ projectName);","119","        \/\/ make sure we've fetched the testSearchByDisplayName project page","120","        String contents = result.getWebResponse().getContentAsString();","121","        assertTrue(contents.contains(String.format(\"<title>%s [Jenkins]<\/title>\", projectName)));","127","        final String projectName = \"testSearchByProjectName\";","128","        j.createFreeStyleProject(projectName);","129","        j.createFolder(\"my-folder-1\").createProject(FreeStyleProject.class, \"my-job-1\");","131","        Page result = j.createWebClient().goTo(\"job\/my-folder-1\/search?q=\"+ \"my-folder-1\/my-job-1\");","136","        \/\/ make sure we've fetched the testSearchByDisplayName project page","137","        String contents = result.getWebResponse().getContentAsString();","138","        assertTrue(contents.contains(String.format(\"<title>%s [Jenkins]<\/title>\", \"my-job-1 [my-folder-1]\")));","295","            if(projectName1.equals(name)) {","296","                foundProjectName = true;","297","            }","303","        assertTrue(foundProjectName);"]}]}},"a79fdaa4b34b8f7fddb39bed3eabf4763940d11b":{"changes":{"test\/src\/test\/java\/jenkins\/triggers\/ReverseBuildTriggerTest.java":"MODIFY","test\/src\/test\/java\/jenkins\/model\/JenkinsTest.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/ItemGroupMixIn.java":"MODIFY","core\/src\/main\/java\/jenkins\/model\/Jenkins.java":"MODIFY","test\/src\/test\/java\/hudson\/model\/ItemGroupMixInTest.java":"MODIFY"},"diff":{"test\/src\/test\/java\/jenkins\/triggers\/ReverseBuildTriggerTest.java":[{"add":["99","        String upstreamName = \"upstr3@m\"; \/\/ do not clash with English messages!"],"delete":["99","        String upstreamName = \"upstr3am\"; \/\/ do not clash with English messages!"]}],"test\/src\/test\/java\/jenkins\/model\/JenkinsTest.java":[{"add":[],"delete":["74","import org.jvnet.hudson.test.WithoutJenkins;","686","","687","    @Issue(\"JENKINS-46911\")","688","    @WithoutJenkins","689","    @Test","690","    public void testCheckGoodName() throws Exception{","691","        String[] illegalNames = {\"ab\\\\c\", \"abc\/\", \"ab\/c\", \" \", \"   \", \"\", \"..\", \".\", \"?\", \"*\", \"6%\",","692","                \"x!\", \"-@\", \"#\", \"$\", \"^\", \"&\", \"|\", \"<\", \">\", \"[\", \"]\", \":\", \";\", \"..\/.\", null};","693","        String[] legalNames = {\"abc\", \"a bc\", \"abc \", \" abc\", \"a.bc\", \". .\"};","694","        String msg = \"checkGoodNameTest found a legal name. Please check.\";","695","        int exceptions = 0;","696","        int goodNames = 0;","697","","698","        for (String name : illegalNames){","699","            try {","700","                Jenkins.checkGoodName(name);","701","                goodNames++;","702","            } catch (Failure e){","703","                exceptions++;","704","            }","705","        }","706","        assertEquals(msg, illegalNames.length, exceptions);","707","        assertEquals(0, goodNames);","708","","709","        exceptions = 0;","710","        goodNames = 0;","711","        for (String name : legalNames){","712","            try {","713","                Jenkins.checkGoodName(name);","714","                goodNames++;","715","            } catch (Failure e){","716","                exceptions++;","717","            }","718","        }","719","        assertEquals(msg, 0, exceptions);","720","        \/\/ TODO: store the name in an list and then assert the size of that list is zero and get a view of what failed. rather than 2 things failed.","721","        assertEquals(legalNames.length, goodNames);","722","    }"]}],"core\/src\/main\/java\/hudson\/model\/ItemGroupMixIn.java":[{"add":[],"delete":["260","        try {","261","            Jenkins.checkGoodName(name);","262","        } catch (Failure e){","263","            throw new IOException(\"Not a valid project name\", e);","264","        }","265","","317","        try {","318","            Jenkins.checkGoodName(name);","319","        } catch (Failure e){","320","            throw new IOException(\"Not a valid project name\", e);","321","        }","322",""]}],"core\/src\/main\/java\/jenkins\/model\/Jenkins.java":[{"add":["3844","        if(name==null || name.length()==0)"],"delete":["3812","     * Creates a new project from the given xml.","3813","     *","3814","     * @param name The name of new project.","3815","     * @param xml Projects xml.","3816","     *","3817","     * @throws IOException if the given name is not good or could not create project.","3818","     *","3819","     * @see #checkGoodName(String)","3852","        if(name==null || name.trim().length()==0)"]}],"test\/src\/test\/java\/hudson\/model\/ItemGroupMixInTest.java":[{"add":[],"delete":["35","import jenkins.model.Jenkins;","52","import java.io.InputStream;","211","    @Issue(\"JENKINS-46911\")","212","    @Test","213","    public void testCreateProjectCheckGoodName() throws Exception{","214","        String xmlFile = \"<?xml version='1.0' encoding='UTF-8'?>\\n\" +","215","                \"<project>\\n\" +","216","                \"<description><\/description>\\n\" +","217","                \"<keepDependencies>false<\/keepDependencies>\\n\" +","218","                \"<properties\/>\\n\" +","219","                \"<triggers\/>\\n\" +","220","                \"<concurrentBuild>false<\/concurrentBuild>\\n\" +","221","                \"<builders\/>\\n\" +","222","                \"<publishers\/>\\n\" +","223","                \"<buildWrappers\/>\\n\" +","224","                \"<\/project>\";","225","        String[] illegalNames = {\"ab\\\\c\", \"abc\/\", \"ab\/c\", \"\", \" \", \"   \", \"..\", \".\", \"?\", \"*\", \"6%\",","226","                \"x!\", \"-@\", \"#\", \"$\", \"^\", \"&\", \"|\", \"<\", \">\", \"[\", \"]\", \":\", \";\", \"..\/.\", null};","227","        Jenkins j = Jenkins.getInstance();","228","","229","        int created = 0;","230","        for (String name : illegalNames){","231","            try{","232","                InputStream is = new ByteArrayInputStream(xmlFile.getBytes());","233","                j.createProjectFromXML(name, is);","234","                created++;","235","            } catch (IOException e){}","236","        }","237","","238","        for (String name : illegalNames){","239","            try{","240","                j.createProject(FreeStyleProject.class, name);","241","                created++;","242","            } catch (IOException e){}","243","        }","244","        \/\/ Checks that no illegal named project has been created.","245","        assertEquals(0, created);","246","    }","247",""]}]}},"a976bdcf64a8795289129e20b0244e10edbdea6b":{"changes":{"core\/src\/main\/resources\/hudson\/views\/JobColumn\/column.jelly":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/views\/JobColumn\/column.jelly":[{"add":["27","        <!-- TODO consider using ${rootURL}\/${job.url} instead (also in other column.jelly) -->"],"delete":[]}]}},"5c8c64be06a804ef24805e4db31efbf5963fc66c":{"changes":{"core\/pom.xml":"MODIFY"},"diff":{"core\/pom.xml":[{"add":["43","    <groovy.version>2.4.8<\/groovy.version>"],"delete":["43","    <groovy.version>2.4.7<\/groovy.version>"]}]}},"534328b264f9338e48418d2bcc0d28daaf48b3a0":{"changes":{"core\/src\/main\/java\/hudson\/util\/FormFieldValidator.java":"MODIFY","changelog.html":"MODIFY","core\/src\/main\/java\/hudson\/tasks\/ArtifactArchiver.java":"MODIFY","core\/src\/test\/java\/hudson\/FilePathTest.java":"MODIFY","core\/src\/main\/java\/hudson\/FilePath.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/util\/FormFieldValidator.java":[{"add":["380","                String msg = ws.validateAntFileMask(value, FilePath.VALIDATE_ANT_FILE_MASK_BOUND);"],"delete":["380","                String msg = ws.validateAntFileMask(value, 10000);"]}],"changelog.html":[{"add":["57","  <li class=bug>","58","    Performance problems on large workspaces associated with validating file include patterns.","59","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-25759\">issue 25759<\/a>)"],"delete":["57","  <li class=>"]}],"core\/src\/main\/java\/hudson\/tasks\/ArtifactArchiver.java":[{"add":["229","                    \tmsg = ws.validateAntFileMask(artifacts, FilePath.VALIDATE_ANT_FILE_MASK_BOUND);"],"delete":["229","                    \tmsg = ws.validateAntFileMask(artifacts);"]}],"core\/src\/test\/java\/hudson\/FilePathTest.java":[{"add":["58","import org.jvnet.hudson.test.Issue;","499","    @SuppressWarnings(\"deprecation\")","504","    @Issue(\"JENKINS-7214\")","505","    @SuppressWarnings(\"deprecation\")"],"delete":["502","    @Bug(7214)"]}],"core\/src\/main\/java\/hudson\/FilePath.java":[{"add":["2326","     * @deprecated use {@link #validateAntFileMask(String, int)} instead","2333","     * Default bound for {@link #validateAntFileMask(String, int)}.","2334","     * @since 1.592","2335","     *\/","2336","    public static int VALIDATE_ANT_FILE_MASK_BOUND = Integer.getInteger(FilePath.class.getName() + \".VALIDATE_ANT_FILE_MASK_BOUND\", 10000);","2337","","2338","    \/**","2347","     * @param bound a maximum number of negative operations (deliberately left vague) to perform before giving up on a precise answer; try {@link #VALIDATE_ANT_FILE_MASK_BOUND}","2455","                    long start = System.currentTimeMillis();","2457","                        if (!filesIncluded.isEmpty() || !dirsIncluded.isEmpty() || ticks++ > bound || System.currentTimeMillis() - start > 5000) {","2460","                        filesNotIncluded.clear();","2461","                        dirsNotIncluded.clear();","2462","                        \/\/ notFollowedSymlinks might be large, but probably unusual","2463","                        \/\/ scannedDirs will typically be largish, but seems to be needed","2526","            String msg = validateAntFileMask(value, VALIDATE_ANT_FILE_MASK_BOUND);"],"delete":["2340","     * @param bound a maximum number of negative operations (deliberately left vague) to perform before giving up on a precise answer; 10_000 is a reasonable pick","2449","                        if (!filesIncluded.isEmpty() || !dirsIncluded.isEmpty() || ticks++ > bound) {","2514","            String msg = validateAntFileMask(value, 10000);"]}]}},"a43b96341410e9095ccd70f35cb658cc6e3f7112":{"changes":{"war\/images\/makeFlash.sh":"MODIFY"},"diff":{"war\/images\/makeFlash.sh":[{"add":["32","  convert $src -alpha off -fill white -colorize ${p}% -transparent-color white -alpha on $t.$p.gif"],"delete":["32","  convert $src -fill white -colorize ${p}% -transparent-color white $t.$p.gif"]}]}},"65c5b0d6d43caeca3620df061285acc8fa1a938c":{"changes":{"test\/src\/test\/resources\/hudson\/maven\/HUDSON-4192.zip":"ADD","maven-plugin\/src\/main\/java\/hudson\/maven\/MavenModuleSetBuild.java":"MODIFY","maven-plugin\/src\/main\/java\/hudson\/maven\/MavenBuild.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/AbstractBuild.java":"MODIFY","test\/src\/test\/resources\/hudson\/maven\/MavenBuildTest.java":"ADD"},"diff":{"test\/src\/test\/resources\/hudson\/maven\/HUDSON-4192.zip":[{"add":[],"delete":[]}],"maven-plugin\/src\/main\/java\/hudson\/maven\/MavenModuleSetBuild.java":[{"add":["429","","430","                            MavenBuild mb = m.newBuild();","431","                            mb.setWorkspace(getModuleRoot().child(m.getRelativePath()));","432","                            proxies.put(m.getModuleName(), mb.new ProxyImpl2(MavenModuleSetBuild.this,slistener));"],"delete":["429","                            ","430","                            proxies.put(m.getModuleName(),m.newBuild().new ProxyImpl2(MavenModuleSetBuild.this,slistener));"]}],"maven-plugin\/src\/main\/java\/hudson\/maven\/MavenBuild.java":[{"add":["226","     * Backdoor for {@link MavenModuleSetBuild} to assign workspaces for modules.","227","     *\/","228","    protected void setWorkspace(FilePath path) {","229","        super.setWorkspace(path);","230","    }","231","","232","    \/**"],"delete":["26","import hudson.Util;","31","import hudson.model.AbstractBuild;","32","import hudson.model.AbstractProject;","34","import hudson.model.DependencyGraph;","35","import hudson.model.Hudson;","38","import hudson.model.Cause.UpstreamCause;","68","import java.util.HashSet;","71","import java.util.Set;"]}],"core\/src\/main\/java\/hudson\/model\/AbstractBuild.java":[{"add":["207","     * Normally, a workspace is assigned by {@link Runner}, but this lets you set the workspace in case","208","     * {@link AbstractBuild} is created without a build.","209","     *\/","210","    protected void setWorkspace(FilePath ws) {","211","        this.workspace = ws.getRemote();","212","    }","213","","214","    \/**"],"delete":[]}],"test\/src\/test\/resources\/hudson\/maven\/MavenBuildTest.java":[{"add":[],"delete":[]}]}},"b50034c9bffb704acfce0bc49d99855b689eace6":{"changes":{"core\/src\/main\/java\/hudson\/cli\/OnlineNodeCommand.java":"MODIFY","core\/src\/main\/java\/hudson\/cli\/QuietDownCommand.java":"MODIFY","test\/src\/test\/java\/hudson\/cli\/DeleteNodeCommandTest.java":"MODIFY","core\/src\/main\/java\/hudson\/cli\/DisconnectNodeCommand.java":"MODIFY","core\/src\/main\/java\/hudson\/cli\/DeleteNodeCommand.java":"MODIFY","core\/src\/main\/java\/hudson\/cli\/ReloadConfigurationCommand.java":"MODIFY","test\/src\/test\/java\/hudson\/cli\/OnlineNodeCommandTest.java":"MODIFY","core\/src\/main\/java\/hudson\/cli\/ClearQueueCommand.java":"MODIFY","core\/src\/main\/java\/hudson\/cli\/DeleteJobCommand.java":"MODIFY","core\/src\/main\/java\/hudson\/cli\/DeleteViewCommand.java":"MODIFY","test\/src\/test\/java\/hudson\/cli\/DeleteViewCommandTest.java":"MODIFY","test\/src\/test\/java\/hudson\/cli\/DeleteJobCommandTest.java":"MODIFY","test\/src\/test\/java\/hudson\/cli\/ConnectNodeCommandTest.java":"MODIFY","core\/src\/main\/java\/hudson\/cli\/ConnectNodeCommand.java":"MODIFY","core\/src\/main\/java\/hudson\/cli\/WaitNodeOnlineCommand.java":"MODIFY","test\/src\/test\/java\/hudson\/cli\/DisconnectNodeCommandTest.java":"MODIFY","core\/src\/main\/java\/hudson\/cli\/CancelQuietDownCommand.java":"MODIFY","core\/src\/main\/java\/hudson\/cli\/ReloadJobCommand.java":"MODIFY","core\/src\/main\/java\/hudson\/cli\/WaitNodeOfflineCommand.java":"MODIFY","test\/src\/test\/java\/hudson\/cli\/ReloadJobCommandTest.java":"MODIFY","core\/src\/main\/java\/hudson\/cli\/CLICommand.java":"MODIFY","core\/src\/main\/java\/hudson\/cli\/OfflineNodeCommand.java":"MODIFY","test\/src\/test\/java\/hudson\/cli\/OfflineNodeCommandTest.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/cli\/OnlineNodeCommand.java":[{"add":["39"," * CLI Command, which moves the node to the online state.","41"," * @since 1.642","89","            throw new AbortException(CLI_LISTPARAM_SUMMARY_ERROR_TEXT);"],"delete":["40"," * @since TODO","88","            throw new AbortException(\"Error occured while performing this command, see previous stderr output.\");"]}],"core\/src\/main\/java\/hudson\/cli\/QuietDownCommand.java":[{"add":["36"," * @since 2.14"],"delete":["36"," * @since TODO"]}],"test\/src\/test\/java\/hudson\/cli\/DeleteNodeCommandTest.java":[{"add":["120","        assertThat(result.stderr(), containsString(\"ERROR: \" + CLICommand.CLI_LISTPARAM_SUMMARY_ERROR_TEXT));","139","        assertThat(result.stderr(), containsString(\"ERROR: \" + CLICommand.CLI_LISTPARAM_SUMMARY_ERROR_TEXT));","158","        assertThat(result.stderr(), containsString(\"ERROR: \" + CLICommand.CLI_LISTPARAM_SUMMARY_ERROR_TEXT));","178","        assertThat(result.stderr(), containsString(\"ERROR: \" + CLICommand.CLI_LISTPARAM_SUMMARY_ERROR_TEXT));"],"delete":["120","        assertThat(result.stderr(), containsString(\"ERROR: Error occured while performing this command, see previous stderr output.\"));","139","        assertThat(result.stderr(), containsString(\"ERROR: Error occured while performing this command, see previous stderr output.\"));","158","        assertThat(result.stderr(), containsString(\"ERROR: Error occured while performing this command, see previous stderr output.\"));","178","        assertThat(result.stderr(), containsString(\"ERROR: Error occured while performing this command, see previous stderr output.\"));"]}],"core\/src\/main\/java\/hudson\/cli\/DisconnectNodeCommand.java":[{"add":["39"," * CLI Command, which disconnects nodes.","41"," * @since 2.14","45","    @Argument(metaVar = \"NAME\", usage = \"Slave name, or empty string for master; comma-separated list is supported\", required = true, multiValued = true)","97","            throw new AbortException(CLI_LISTPARAM_SUMMARY_ERROR_TEXT);"],"delete":["40"," * @since TODO","44","    @Argument(metaVar = \"NAME\", usage = \"Slave name, or empty string for master; comama-separated list is supported\", required = true, multiValued = true)","96","            throw new AbortException(\"Error occured while performing this command, see previous stderr output.\");"]}],"core\/src\/main\/java\/hudson\/cli\/DeleteNodeCommand.java":[{"add":["36"," * CLI command, which deletes Jenkins nodes.","38"," * @since 1.618","43","    @Argument(usage=\"Names of nodes to delete\", required=true, multiValued=true)","85","            throw new AbortException(CLI_LISTPARAM_SUMMARY_ERROR_TEXT);"],"delete":["37"," * @since TODO","42","    @Argument(usage=\"Nodes name to delete\", required=true, multiValued=true)","84","            throw new AbortException(\"Error occured while performing this command, see previous stderr output.\");"]}],"core\/src\/main\/java\/hudson\/cli\/ReloadConfigurationCommand.java":[{"add":["30"," * Reload everything from the file system.","33"," * @since 2.4"],"delete":["30"," * Reload everything from file system","33"," * @since TODO"]}],"test\/src\/test\/java\/hudson\/cli\/OnlineNodeCommandTest.java":[{"add":["255","        assertThat(result.stderr(), containsString(\"ERROR: \" + CLICommand.CLI_LISTPARAM_SUMMARY_ERROR_TEXT));"],"delete":["255","        assertThat(result.stderr(), containsString(\"ERROR: Error occured while performing this command, see previous stderr output.\"));"]}],"core\/src\/main\/java\/hudson\/cli\/ClearQueueCommand.java":[{"add":["36"," * @since 1.654"],"delete":["36"," * @since TODO"]}],"core\/src\/main\/java\/hudson\/cli\/DeleteJobCommand.java":[{"add":["36"," * CLI command, which deletes a job or multiple jobs.","38"," * @since 1.649","86","            throw new AbortException(CLI_LISTPARAM_SUMMARY_ERROR_TEXT);"],"delete":["37"," * @since TODO","85","            throw new AbortException(\"Error occured while performing this command, see previous stderr output.\");"]}],"core\/src\/main\/java\/hudson\/cli\/DeleteViewCommand.java":[{"add":["97","            throw new AbortException(CLI_LISTPARAM_SUMMARY_ERROR_TEXT);"],"delete":["97","            throw new AbortException(\"Error occured while performing this command, see previous stderr output.\");"]}],"test\/src\/test\/java\/hudson\/cli\/DeleteViewCommandTest.java":[{"add":["177","        assertThat(result.stderr(), containsString(\"ERROR: \" + CLICommand.CLI_LISTPARAM_SUMMARY_ERROR_TEXT));","196","        assertThat(result.stderr(), containsString(\"ERROR: \" + CLICommand.CLI_LISTPARAM_SUMMARY_ERROR_TEXT));","215","        assertThat(result.stderr(), containsString(\"ERROR: \" + CLICommand.CLI_LISTPARAM_SUMMARY_ERROR_TEXT));","235","        assertThat(result.stderr(), containsString(\"ERROR: \" + CLICommand.CLI_LISTPARAM_SUMMARY_ERROR_TEXT));","269","        assertThat(result.stderr(), containsString(\"ERROR: \" + CLICommand.CLI_LISTPARAM_SUMMARY_ERROR_TEXT));"],"delete":["177","        assertThat(result.stderr(), containsString(\"ERROR: Error occured while performing this command, see previous stderr output.\"));","196","        assertThat(result.stderr(), containsString(\"ERROR: Error occured while performing this command, see previous stderr output.\"));","215","        assertThat(result.stderr(), containsString(\"ERROR: Error occured while performing this command, see previous stderr output.\"));","235","        assertThat(result.stderr(), containsString(\"ERROR: Error occured while performing this command, see previous stderr output.\"));","269","        assertThat(result.stderr(), containsString(\"ERROR: Error occured while performing this command, see previous stderr output.\"));"]}],"test\/src\/test\/java\/hudson\/cli\/DeleteJobCommandTest.java":[{"add":["133","        assertThat(result.stderr(), containsString(\"ERROR: \" + CLICommand.CLI_LISTPARAM_SUMMARY_ERROR_TEXT));","152","        assertThat(result.stderr(), containsString(\"ERROR: \" + CLICommand.CLI_LISTPARAM_SUMMARY_ERROR_TEXT));","171","        assertThat(result.stderr(), containsString(\"ERROR: \" + CLICommand.CLI_LISTPARAM_SUMMARY_ERROR_TEXT));","191","        assertThat(result.stderr(), containsString(\"ERROR: \" + CLICommand.CLI_LISTPARAM_SUMMARY_ERROR_TEXT));"],"delete":["133","        assertThat(result.stderr(), containsString(\"ERROR: Error occured while performing this command, see previous stderr output.\"));","152","        assertThat(result.stderr(), containsString(\"ERROR: Error occured while performing this command, see previous stderr output.\"));","171","        assertThat(result.stderr(), containsString(\"ERROR: Error occured while performing this command, see previous stderr output.\"));","191","        assertThat(result.stderr(), containsString(\"ERROR: Error occured while performing this command, see previous stderr output.\"));"]}],"test\/src\/test\/java\/hudson\/cli\/ConnectNodeCommandTest.java":[{"add":["66","        assertThat(result.stderr(), not(containsString(\"ERROR: \" + CLICommand.CLI_LISTPARAM_SUMMARY_ERROR_TEXT)));","76","        assertThat(result.stderr(), not(containsString(\"ERROR: \" + CLICommand.CLI_LISTPARAM_SUMMARY_ERROR_TEXT)));","158","        assertThat(result.stderr(), containsString(\"ERROR: \" + CLICommand.CLI_LISTPARAM_SUMMARY_ERROR_TEXT));"],"delete":["66","        assertThat(result.stderr(), not(containsString(\"ERROR: Error occured while performing this command, see previous stderr output.\")));","76","        assertThat(result.stderr(), not(containsString(\"ERROR: Error occured while performing this command, see previous stderr output.\")));","158","        assertThat(result.stderr(), containsString(\"ERROR: Error occured while performing this command, see previous stderr output.\"));"]}],"core\/src\/main\/java\/hudson\/cli\/ConnectNodeCommand.java":[{"add":["39"," * Reconnect to a node or nodes.","41"," * @since 2.6","46","    @Argument(metaVar=\"NAME\", usage=\"Slave name, or empty string for master; comma-separated list is supported\", required=true, multiValued=true)","99","            throw new AbortException(CLI_LISTPARAM_SUMMARY_ERROR_TEXT);"],"delete":["40"," * @since TODO","45","    @Argument(metaVar=\"NAME\", usage=\"Slave name, or empty string for master; comama-separated list is supported\", required=true, multiValued=true)","98","            throw new AbortException(\"Error occured while performing this command, see previous stderr output.\");"]}],"core\/src\/main\/java\/hudson\/cli\/WaitNodeOnlineCommand.java":[{"add":["30"," * CLI command, which waits till the node switches to the online state.","32"," * @since 2.16"],"delete":["31"," * @since TODO"]}],"test\/src\/test\/java\/hudson\/cli\/DisconnectNodeCommandTest.java":[{"add":["70","        assertThat(result.stderr(), not(containsString(\"ERROR: \" + CLICommand.CLI_LISTPARAM_SUMMARY_ERROR_TEXT)));","81","        assertThat(result.stderr(), not(containsString(\"ERROR: \" + CLICommand.CLI_LISTPARAM_SUMMARY_ERROR_TEXT)));","235","        assertThat(result.stderr(), containsString(\"ERROR: \" + CLICommand.CLI_LISTPARAM_SUMMARY_ERROR_TEXT));"],"delete":["70","        assertThat(result.stderr(), not(containsString(\"ERROR: Error occured while performing this command, see previous stderr output.\")));","81","        assertThat(result.stderr(), not(containsString(\"ERROR: Error occured while performing this command, see previous stderr output.\")));","235","        assertThat(result.stderr(), containsString(\"ERROR: Error occured while performing this command, see previous stderr output.\"));"]}],"core\/src\/main\/java\/hudson\/cli\/CancelQuietDownCommand.java":[{"add":["35"," * @since 2.14"],"delete":["35"," * @since TODO"]}],"core\/src\/main\/java\/hudson\/cli\/ReloadJobCommand.java":[{"add":["40"," * Reloads job from the disk.","42"," * @since 1.633","103","            throw new AbortException(CLI_LISTPARAM_SUMMARY_ERROR_TEXT);"],"delete":["41"," * @since TODO","102","            throw new AbortException(\"Error occured while performing this command, see previous stderr output.\");"]}],"core\/src\/main\/java\/hudson\/cli\/WaitNodeOfflineCommand.java":[{"add":["30"," * CLI command, which waits till the node switches to the offline state.","32"," * @since 2.16"],"delete":["31"," * @since TODO"]}],"test\/src\/test\/java\/hudson\/cli\/ReloadJobCommandTest.java":[{"add":["183","        assertThat(result.stderr(), containsString(\"ERROR: \" + CLICommand.CLI_LISTPARAM_SUMMARY_ERROR_TEXT));","209","        assertThat(result.stderr(), containsString(\"ERROR: \" + CLICommand.CLI_LISTPARAM_SUMMARY_ERROR_TEXT));","235","        assertThat(result.stderr(), containsString(\"ERROR: \" + CLICommand.CLI_LISTPARAM_SUMMARY_ERROR_TEXT));","262","        assertThat(result.stderr(), containsString(\"ERROR: \" + CLICommand.CLI_LISTPARAM_SUMMARY_ERROR_TEXT));"],"delete":["183","        assertThat(result.stderr(), containsString(\"ERROR: Error occured while performing this command, see previous stderr output.\"));","209","        assertThat(result.stderr(), containsString(\"ERROR: Error occured while performing this command, see previous stderr output.\"));","235","        assertThat(result.stderr(), containsString(\"ERROR: Error occured while performing this command, see previous stderr output.\"));","262","        assertThat(result.stderr(), containsString(\"ERROR: Error occured while performing this command, see previous stderr output.\"));"]}],"core\/src\/main\/java\/hudson\/cli\/CLICommand.java":[{"add":["127","     * Shared text, which is reported back to CLI if an error happens in commands ","128","     * taking lists of parameters.","129","     * @since TODO","130","     *\/","131","    static final String CLI_LISTPARAM_SUMMARY_ERROR_TEXT = \"Error occurred while performing this command, see previous stderr output.\";","132","    ","133","    \/**"],"delete":[]}],"core\/src\/main\/java\/hudson\/cli\/OfflineNodeCommand.java":[{"add":["41"," * CLI Command, which puts the Jenkins node offline.","43"," * @since 2.15","91","            throw new AbortException(CLI_LISTPARAM_SUMMARY_ERROR_TEXT);"],"delete":["42"," * @since TODO","90","            throw new AbortException(\"Error occured while performing this command, see previous stderr output.\");"]}],"test\/src\/test\/java\/hudson\/cli\/OfflineNodeCommandTest.java":[{"add":["76","        assertThat(result.stderr(), not(containsString(\"ERROR: \" + CLICommand.CLI_LISTPARAM_SUMMARY_ERROR_TEXT)));","87","        assertThat(result.stderr(), not(containsString(\"ERROR: \" + CLICommand.CLI_LISTPARAM_SUMMARY_ERROR_TEXT)));","373","        assertThat(result.stderr(), containsString(\"ERROR: \" + CLICommand.CLI_LISTPARAM_SUMMARY_ERROR_TEXT));","399","        assertThat(result.stderr(), containsString(\"ERROR: \" + CLICommand.CLI_LISTPARAM_SUMMARY_ERROR_TEXT));"],"delete":["76","        assertThat(result.stderr(), not(containsString(\"ERROR: Error occured while performing this command, see previous stderr output.\")));","87","        assertThat(result.stderr(), not(containsString(\"ERROR: Error occured while performing this command, see previous stderr output.\")));","373","        assertThat(result.stderr(), containsString(\"ERROR: Error occured while performing this command, see previous stderr output.\"));","399","        assertThat(result.stderr(), containsString(\"ERROR: Error occured while performing this command, see previous stderr output.\"));"]}]}},"4add69ad0a788391145f46121dfe8fdba12bc73e":{"changes":{"core\/src\/main\/java\/hudson\/util\/QueryParameterMap.java":"ADD"},"diff":{"core\/src\/main\/java\/hudson\/util\/QueryParameterMap.java":[{"add":[],"delete":[]}]}},"3ade716f416ad13904b212c8164c9d4f3e2f2e7d":{"changes":{"core\/src\/main\/java\/hudson\/model\/Job.java":"MODIFY","test\/src\/test\/java\/hudson\/model\/RSSTest.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/View.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/RSS.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/User.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/Computer.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/Job.java":[{"add":["1568","        RSS.rss(req, rsp, getDisplayName() + \" all builds\", getUrl(), getBuilds().newBuilds());","1573","        RSS.rss(req, rsp, getDisplayName() + \" failed builds\", getUrl(), getBuilds().failureOnly().newBuilds());"],"delete":["1568","        rss(req, rsp, \" all builds\", getBuilds());","1573","        rss(req, rsp, \" failed builds\", getBuilds().failureOnly());","1574","    }","1575","","1576","    private void rss(StaplerRequest req, StaplerResponse rsp, String suffix,","1577","            RunList runs) throws IOException, ServletException {","1578","        RSS.forwardToRss(getDisplayName() + suffix, getUrl(), runs.newBuilds(),","1579","                Run.FEED_ADAPTER, req, rsp);"]}],"test\/src\/test\/java\/hudson\/model\/RSSTest.java":[{"add":["33","import java.util.ArrayList;","34","import java.util.List;","35","","36","import static org.hamcrest.Matchers.containsInAnyOrder;","49","        XmlPage page = getRssAllPage();","58","        page = getRssAllPage();","65","    private XmlPage getRssAllPage() throws Exception {","80","        XmlPage page = getRssAllAtomPage();","89","        page = getRssAllAtomPage();","96","    private XmlPage getRssAllAtomPage() throws Exception {","108","","109","    @Issue(\"JENKINS-60577\")","110","    @Test","111","    public void latestBuilds() throws Exception {","112","        XmlPage page = getRssLatestPage();","113","        NodeList allLinks = page.getXmlDocument().getElementsByTagName(\"link\");","114","","115","        assertEquals(1, allLinks.getLength());","116","","117","        FreeStyleProject p = j.createFreeStyleProject(\"test1\");","118","        j.assertBuildStatusSuccess(p.scheduleBuild2(0));","119","        j.assertBuildStatusSuccess(p.scheduleBuild2(0));","120","","121","        p = j.createFreeStyleProject(\"test2\");","122","        j.assertBuildStatusSuccess(p.scheduleBuild2(0));","123","        j.assertBuildStatusSuccess(p.scheduleBuild2(0));","124","        j.assertBuildStatusSuccess(p.scheduleBuild2(0));","125","","126","        page = getRssLatestPage();","127","        allLinks = page.getXmlDocument().getElementsByTagName(\"link\");","128","","129","        assertEquals(3, allLinks.getLength());","130","        assertLatestRSSLinks(allLinks);","131","","132","        page = getRssAllPage();","133","        allLinks = page.getXmlDocument().getElementsByTagName(\"link\");","134","        assertEquals(6, allLinks.getLength());","135","    }","136","","137","    private XmlPage getRssLatestPage() throws Exception {","138","        return (XmlPage) j.createWebClient().goTo(\"rssLatest?flavor=rss20\", \"text\/xml\");","139","    }","140","","141","    private void assertLatestRSSLinks(NodeList allLinks) throws Exception {","142","        List<String> urls = new ArrayList<>(allLinks.getLength());","143","        for (int i = 0; i < allLinks.getLength(); i++) {","144","            Node item = allLinks.item(i);","145","            String url = item.getTextContent();","146","            urls.add(url);","147","        }","148","","149","        assertThat(urls, containsInAnyOrder(","150","                j.getURL().toString(),","151","                j.getURL().toString() + \"job\/test1\/2\/\",","152","                j.getURL().toString() + \"job\/test2\/3\/\"","153","        ));","154","    }"],"delete":["45","        XmlPage page = getRssPage();","54","        page = getRssPage();","61","    private XmlPage getRssPage() throws Exception {","76","        XmlPage page = getAtomPage();","85","        page = getAtomPage();","92","    private XmlPage getAtomPage() throws Exception {"]}],"core\/src\/main\/java\/hudson\/model\/View.java":[{"add":["1146","        RSS.rss(req, rsp, getDisplayName() + \" all builds\", getUrl(), getBuilds().newBuilds());","1150","        RSS.rss(req, rsp, getDisplayName() + \" failed builds\", getUrl(), getBuilds().failureOnly().newBuilds());","1170","        RSS.rss(req, rsp, getDisplayName() + \" last builds only\", getUrl(), RunList.fromRuns(lastBuilds), Run.FEED_ADAPTER_LATEST);"],"delete":["1146","        rss(req, rsp, \" all builds\", getBuilds());","1150","        rss(req, rsp, \" failed builds\", getBuilds().failureOnly());","1161","    private void rss(StaplerRequest req, StaplerResponse rsp, String suffix, RunList runs) throws IOException, ServletException {","1162","        RSS.forwardToRss(getDisplayName()+ suffix, getUrl(),","1163","            runs.newBuilds(), Run.FEED_ADAPTER, req, rsp );","1164","    }","1165","","1175","        RSS.forwardToRss(getDisplayName()+\" last builds only\", getUrl(),","1176","            lastBuilds, Run.FEED_ADAPTER_LATEST, req, rsp );"]}],"core\/src\/main\/java\/hudson\/model\/RSS.java":[{"add":["26","import hudson.util.RunList;","93","","94","    \/**","95","     * Sends the RSS feed to the client using a default feed adapter.","96","     *","97","     * @param title","98","     *      Title of the feed.","99","     * @param url","100","     *      URL of the model object that owns this feed. Relative to the context root.","101","     * @param runList","102","     *      Entries to be listed in the RSS feed.","103","     * @since TODO","104","     *\/","105","    public static void rss(StaplerRequest req, StaplerResponse rsp, String title, String url, RunList runList) throws IOException, ServletException {","106","        rss(req, rsp, title, url, runList, null);","107","    }","108","","109","    \/**","110","     * Sends the RSS feed to the client using a specific feed adapter.","111","     *","112","     * @param title","113","     *      Title of the feed.","114","     * @param url","115","     *      URL of the model object that owns this feed. Relative to the context root.","116","     * @param runList","117","     *      Entries to be listed in the RSS feed.","118","     * @param feedAdapter","119","     *      Controls how to render entries to RSS.","120","     * @since TODO","121","     *\/","122","    public static void rss(StaplerRequest req, StaplerResponse rsp, String title, String url, RunList runList, FeedAdapter<Run> feedAdapter) throws IOException, ServletException {","123","        final FeedAdapter<Run> feedAdapter_ = feedAdapter == null ? Run.FEED_ADAPTER : feedAdapter;","124","        forwardToRss(title, url, runList, feedAdapter_, req, rsp);","125","    }"],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/User.java":[{"add":["874","        RSS.rss(req, rsp, getDisplayName() + \" all builds\", getUrl(), getBuilds().newBuilds());","878","        RSS.rss(req, rsp, getDisplayName() + \" regression builds\", getUrl(), getBuilds().regressionOnly());","894","        RSS.rss(req, rsp, getDisplayName() + \" latest build\", getUrl(), RunList.fromRuns(lastBuilds), Run.FEED_ADAPTER_LATEST);"],"delete":["874","        rss(req, rsp, \" all builds\", getBuilds(), Run.FEED_ADAPTER);","878","        rss(req, rsp, \" regression builds\", getBuilds().regressionOnly(), Run.FEED_ADAPTER);","894","        rss(req, rsp, \" latest build\", RunList.fromRuns(lastBuilds), Run.FEED_ADAPTER_LATEST);","895","    }","896","","897","    private void rss(StaplerRequest req, StaplerResponse rsp, String suffix, RunList runs, FeedAdapter adapter)","898","            throws IOException, ServletException {","899","        RSS.forwardToRss(getDisplayName() + suffix, getUrl(), runs.newBuilds(), adapter, req, rsp);"]}],"core\/src\/main\/java\/hudson\/model\/Computer.java":[{"add":["1370","    @Restricted(DoNotUse.class)","1372","        RSS.rss(req, rsp, getDisplayName() + \" all builds\", getUrl(), getBuilds());","1375","    @Restricted(DoNotUse.class)","1377","        RSS.rss(req, rsp, getDisplayName() + \" failed builds\", getUrl(), getBuilds().failureOnly());","1379","","1380","    \/**","1381","     * Retrieve the RSS feed for the last build for each project executed in this computer.","1382","     * Only the information from {@link AbstractProject} is displayed since there isn't a proper API to gather","1383","     * information about the node where the builds are executed for other sorts of projects such as Pipeline","1384","     * @since TODO","1385","     *\/","1386","    @Restricted(DoNotUse.class)","1387","    public void doRssLatest( StaplerRequest req, StaplerResponse rsp ) throws IOException, ServletException {","1388","        final List<Run> lastBuilds = new ArrayList<>();","1389","        for (AbstractProject<?, ?> p : Jenkins.get().allItems(AbstractProject.class)) {","1390","            if (p.getLastBuild() != null) {","1391","                for (AbstractBuild<?, ?> b = p.getLastBuild(); b != null; b = b.getPreviousBuild()) {","1392","                    if (b.getBuiltOn() == getNode()) {","1393","                        lastBuilds.add(b);","1394","                        break;","1395","                    }","1396","                }","1397","            }","1398","        }","1399","        RSS.rss(req, rsp, getDisplayName() + \" last builds only\", getUrl(), RunList.fromRuns(lastBuilds));"],"delete":["1371","        rss(req, rsp, \" all builds\", getBuilds());","1375","        rss(req, rsp, \" failed builds\", getBuilds().failureOnly());","1377","    private void rss(StaplerRequest req, StaplerResponse rsp, String suffix, RunList runs) throws IOException, ServletException {","1378","        RSS.forwardToRss(getDisplayName() + suffix, getUrl(),","1379","                runs.newBuilds(), Run.FEED_ADAPTER, req, rsp);"]}]}},"fc6b7d391f01203cdcdc41c395336531543d2fc2":{"changes":{"core\/src\/main\/resources\/hudson\/model\/View\/sidepanel.jelly":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/model\/View\/sidepanel.jelly":[{"add":["53","        <l:task icon=\"images\/24x24\/edit-delete.gif\" href=\"delete\" title=\"${%Delete View}\" permission=\"${it.DELETE}\" \/>"],"delete":["53","        <l:task icon=\"images\/24x24\/edit-delete.gif\" href=\"delete\" title=\"${%Delete View}\" permission=\"${it.CONFIGURE}\" \/>"]}]}},"6126c5911df85d0c4bfe971fc61c0419f80343a2":{"changes":{"core\/src\/main\/java\/hudson\/model\/AbstractProject.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/AbstractProject.java":[{"add":["533","            \/\/ Don't consider child projects such as MatrixConfiguration:","534","            if (!p.isConfigurable()) continue;"],"delete":[]}]}},"5905b8fcd5ad11fb22af04f273d35f0e85fafc7e":{"changes":{"core\/src\/main\/resources\/hudson\/model\/Job\/_api.jelly":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/model\/Job\/_api.jelly":[{"add":["10","    To programmatically schedule a new build, post to <a href=\"..\/build\">this URL<\/a>. ","11","    If the build has parameters, post to <a href=\"..\/buildWithParameters\">this URL<\/a> and provide the parameters as form data.","12","  <\/p>","13","  <p>","14","  \tTo programmatically schedule SCM polling, post to <a href=\"..\/polling\">this URL<\/a>.","15","  <\/p>","16","  <p>","17","  \tIf security is enabled, a build authorization token must be provided as a parameter called <i>token<\/i>. The value of the token ","18","  \tcan be specified on the job configuration page in the 'Trigger builds remotely' section."],"delete":["10","    To programmatically schedule a new build, post to <a href=\"..\/build\">this URL<\/a>."]}]}},"06e1bd0179753ca41676857d0f184a0b1311e7ad":{"changes":{"core\/src\/main\/resources\/hudson\/model\/ListView\/noJob.jelly":"MODIFY","core\/src\/main\/resources\/hudson\/model\/ListView\/sidepanel2.jelly":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/model\/ListView\/noJob.jelly":[{"add":["0","<j:jelly xmlns:j=\"jelly:core\">","2","  This view has no jobs associated with it. ","3","  <j:if test=\"${h.hasPermission(it.CONFIGURE)}\">","4","      Please <a href=\"configure\">add some<\/a>","5","  <\/j:if>","6","<\/div>","7","<\/j:jelly>"],"delete":["1","  This view has no jobs associated with it. Please <a href=\"configure\">add some<\/a>","2","<\/div>"]}],"core\/src\/main\/resources\/hudson\/model\/ListView\/sidepanel2.jelly":[{"add":["1","\t<l:task icon=\"images\/24x24\/gear.gif\" href=\"configure\" title=\"${%Edit View}\"  permission=\"${it.CONFIGURE}\" \/>","2","\t<l:task icon=\"images\/24x24\/edit-delete.gif\" href=\"delete\" title=\"${%Delete View}\"  permission=\"${it.CONFIGURE}\" \/>"],"delete":["1","\t<l:task icon=\"images\/24x24\/gear.gif\" href=\"configure\" title=\"${%Edit View}\" \/>","2","\t<l:task icon=\"images\/24x24\/edit-delete.gif\" href=\"delete\" title=\"${%Delete View}\" \/>"]}]}},"2a8a0bf7fae1aa1bbbe7a7a2a6fd9384d341609c":{"changes":{"core\/src\/main\/resources\/lib\/form\/repeatable.jelly":"MODIFY","maven-plugin\/src\/main\/java\/hudson\/maven\/MavenProcessFactory.java":"MODIFY","core\/src\/main\/resources\/lib\/form\/hetero-list.jelly":"MODIFY","core\/src\/main\/java\/hudson\/tasks\/Ant.java":"MODIFY","core\/src\/main\/java\/hudson\/tools\/ToolLocationTranslator.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/ExternalRun.java":"MODIFY","war\/resources\/scripts\/hudson-behavior.js":"MODIFY","maven-plugin\/src\/main\/java\/hudson\/maven\/MavenModuleSetBuild.java":"MODIFY","core\/src\/main\/resources\/hudson\/tools\/ZipExtractionInstaller\/help-url.html":"ADD","core\/src\/main\/resources\/lib\/form\/rowSet.jelly":"MODIFY","war\/resources\/css\/style.css":"MODIFY","core\/src\/main\/java\/hudson\/tools\/ToolInstallation.java":"MODIFY","core\/src\/main\/resources\/lib\/form\/optionalBlock.jelly":"MODIFY","core\/src\/main\/resources\/hudson\/tools\/Messages.properties":"MODIFY","core\/src\/main\/resources\/hudson\/tools\/CommandInstaller\/config.jelly":"ADD","core\/src\/main\/java\/hudson\/model\/JDK.java":"MODIFY","core\/src\/main\/resources\/hudson\/model\/JDK\/config_ja.properties":"ADD","core\/src\/main\/resources\/lib\/form\/descriptorList.jelly":"MODIFY","core\/src\/main\/java\/hudson\/tools\/ToolProperty.java":"ADD","core\/src\/main\/java\/hudson\/tools\/ToolPropertyDescriptor.java":"ADD","core\/src\/main\/resources\/hudson\/model\/JDK\/config_fr.properties":"ADD","core\/src\/main\/java\/hudson\/slaves\/NodeSpecific.java":"MODIFY","core\/src\/main\/java\/hudson\/tools\/JDKInstaller.java":"ADD","core\/src\/main\/java\/hudson\/model\/Descriptor.java":"MODIFY","core\/src\/main\/resources\/hudson\/tools\/CommandInstaller\/help-command.html":"ADD","core\/pom.xml":"MODIFY","core\/src\/main\/java\/hudson\/model\/DownloadService.java":"ADD","core\/src\/main\/java\/hudson\/tools\/ToolInstallerDescriptor.java":"ADD","core\/src\/main\/java\/hudson\/tasks\/Maven.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/Node.java":"MODIFY","core\/src\/main\/resources\/hudson\/model\/JDK\/config_pt_BR.properties":"ADD","core\/src\/main\/resources\/hudson\/model\/JDK\/config.jelly":"ADD","core\/src\/main\/resources\/hudson\/tools\/ZipExtractionInstaller\/help.html":"ADD","test\/src\/test\/java\/hudson\/tasks\/MavenTest.java":"MODIFY","core\/src\/main\/resources\/lib\/form\/option.jelly":"MODIFY","maven-plugin\/src\/main\/java\/hudson\/maven\/MavenBuild.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/AbstractBuild.java":"MODIFY","core\/src\/main\/resources\/lib\/layout\/layout.jelly":"MODIFY","core\/src\/main\/resources\/hudson\/model\/JDK\/config_de.properties":"ADD","core\/src\/main\/resources\/hudson\/tools\/CommandInstaller\/help.html":"ADD","core\/src\/main\/resources\/hudson\/tools\/ZipExtractionInstaller\/help-subdir.html":"ADD","core\/src\/main\/java\/hudson\/model\/PageDecorator.java":"MODIFY","core\/src\/main\/resources\/hudson\/tools\/label.jelly":"ADD","core\/src\/main\/java\/hudson\/model\/Run.java":"MODIFY","core\/src\/main\/resources\/hudson\/model\/Hudson\/configure.jelly":"MODIFY","core\/src\/main\/java\/hudson\/slaves\/NodeProperty.java":"MODIFY","core\/src\/main\/java\/hudson\/FilePath.java":"MODIFY","core\/src\/main\/java\/hudson\/tools\/PropertyDescriptor.java":"ADD","core\/src\/main\/java\/hudson\/model\/Hudson.java":"MODIFY","war\/resources\/help\/tools\/help-label.html":"ADD","core\/src\/main\/java\/hudson\/util\/FormValidation.java":"MODIFY","core\/src\/main\/java\/hudson\/tools\/InstallerTranslator.java":"ADD","core\/src\/main\/resources\/hudson\/tools\/taglib":"ADD","core\/src\/main\/java\/hudson\/Plugin.java":"MODIFY","core\/src\/main\/resources\/hudson\/model\/JDK\/config_tr.properties":"ADD","core\/src\/main\/resources\/hudson\/tools\/InstallSourceProperty\/help.html":"ADD","core\/src\/main\/java\/hudson\/tasks\/CommandInterpreter.java":"MODIFY","core\/src\/main\/resources\/hudson\/tools\/InstallSourceProperty\/config.jelly":"ADD","core\/src\/main\/resources\/lib\/form\/checkbox.jelly":"MODIFY","core\/src\/main\/resources\/hudson\/model\/JDK\/config_nl.properties":"ADD","core\/src\/main\/java\/hudson\/tools\/InstallSourceProperty.java":"ADD","core\/src\/main\/java\/hudson\/tools\/ToolDescriptor.java":"MODIFY","core\/src\/main\/java\/hudson\/tools\/ZipExtractionInstaller.java":"ADD","core\/src\/main\/java\/hudson\/Functions.java":"MODIFY","core\/src\/main\/resources\/hudson\/model\/DownloadService\/footer.jelly":"ADD","core\/src\/main\/java\/hudson\/slaves\/NodePropertyDescriptor.java":"MODIFY","core\/src\/main\/java\/hudson\/tools\/ToolInstaller.java":"ADD","core\/src\/main\/java\/hudson\/util\/LogTaskListener.java":"ADD","test\/src\/main\/java\/org\/jvnet\/hudson\/test\/CaptureEnvironmentBuilder.java":"MODIFY","core\/src\/main\/java\/hudson\/tools\/ToolLocationNodeProperty.java":"MODIFY","maven-plugin\/src\/main\/java\/hudson\/maven\/ProcessCache.java":"MODIFY","core\/src\/main\/java\/hudson\/tools\/CommandInstaller.java":"ADD","core\/src\/main\/resources\/hudson\/tools\/JDKInstaller\/config.jelly":"ADD","test\/src\/test\/java\/hudson\/tasks\/EnvVarsInConfigTasksTest.java":"MODIFY","test\/src\/test\/java\/hudson\/tools\/JDKInstallerTest.java":"ADD","core\/src\/main\/resources\/hudson\/tools\/ZipExtractionInstaller\/config.jelly":"ADD","test\/src\/test\/java\/hudson\/model\/HudsonTest.java":"MODIFY","war\/pom.xml":"MODIFY"},"diff":{"core\/src\/main\/resources\/lib\/form\/repeatable.jelly":[{"add":["83","    <st:attribute name=\"add\">","84","      If specified, this text will replace the standard \"Add\" text.","85","    <\/st:attribute>","112","    <div class=\"repeated-chunk to-be-removed\" name=\"${name}\">","135","      <input type=\"button\" value=\"${attrs.add?:'%Add'}\" class=\"repeatable-add\" \/>"],"delete":["109","    <div class=\"repeated-chunk\" style=\"display:none\" name=\"${name}\">","132","      <input type=\"button\" value=\"${%Add}\" class=\"repeatable-add\" \/>"]}],"maven-plugin\/src\/main\/java\/hudson\/maven\/MavenProcessFactory.java":[{"add":["64","import java.util.jar.JarFile;","231","        MavenInstallation mvn = getMavenInstallation(listener);","250","        JDK jdk = getJava(listener);","293","    public MavenInstallation getMavenInstallation(TaskListener log) throws IOException, InterruptedException {","295","        if (mi != null) mi = mi.forNode(getCurrentNode(), log).forEnvironment(envVars);","300","    public JDK getJava(TaskListener log) throws IOException, InterruptedException {","302","        if (jdk != null) jdk = jdk.forNode(getCurrentNode(), log).forEnvironment(envVars);"],"delete":["230","        MavenInstallation mvn = getMavenInstallation();","249","        JDK jdk = getJava();","292","    public MavenInstallation getMavenInstallation() {","294","        if (mi != null) mi = mi.forNode(getCurrentNode()).forEnvironment(envVars);","299","    public JDK getJava() {","301","        if (jdk != null) jdk = jdk.forNode(getCurrentNode()).forEnvironment(envVars);"]}],"core\/src\/main\/resources\/lib\/form\/hetero-list.jelly":[{"add":["68","            <input type=\"hidden\" name=\"stapler-class\" value=\"${descriptor.clazz.name}\" \/>","89","    <div class=\"prototypes to-be-removed\">"],"delete":["88","    <div class=\"prototypes\" style=\"display:none\">"]}],"core\/src\/main\/java\/hudson\/tasks\/Ant.java":[{"add":["135","        EnvVars env = build.getEnvironment(listener);","141","            ai = ai.forNode(Computer.currentComputer().getNode(), listener);","393","        public AntInstallation forNode(Node node, TaskListener log) throws IOException, InterruptedException {","394","            return new AntInstallation(getName(), translateFor(node, log));"],"delete":["135","        EnvVars env = build.getEnvironment();","141","            ai = ai.forNode(Computer.currentComputer().getNode());","393","        public AntInstallation forNode(Node node) {","394","            return new AntInstallation(getName(),translateFor(node));"]}],"core\/src\/main\/java\/hudson\/tools\/ToolLocationTranslator.java":[{"add":["31","import hudson.model.TaskListener;","32","import java.io.IOException;","65","    public abstract String getToolHome(Node node, ToolInstallation installation, TaskListener log) throws IOException, InterruptedException;"],"delete":["63","    public abstract String getToolHome(Node node, ToolInstallation installation);"]}],"core\/src\/main\/java\/hudson\/model\/ExternalRun.java":[{"add":["63","                Proc proc = new Proc.LocalProc(cmd,getEnvironment(listener),System.in,new DualOutputStream(System.out,listener.getLogger()));"],"delete":["63","                Proc proc = new Proc.LocalProc(cmd,getEnvironment(),System.in,new DualOutputStream(System.out,listener.getLogger()));"]}],"war\/resources\/scripts\/hudson-behavior.js":[{"add":["24","\/\/","96","function toValue(e) {","97","    \/\/ compute the form validation value to be sent to the server","98","    if(e.getAttribute(\"type\").toLowerCase()==\"checkbox\")","99","        return e.checked;","100","    return encode(e.value);","101","}","102","","216","\/*","217","    If we are inside 'to-be-removed' class, some HTML altering behaviors interact badly, because","218","    the behavior re-executes when the removed master copy gets reinserted later.","219"," *\/","220","function isInsideRemovable(e) {","221","    return Element.ancestors(e).find(function(f){return f.hasClassName(\"to-be-removed\");});","222","}","223","","233","        if(isInsideRemovable(e))    return;","234","","298","        if(isInsideRemovable(e))    return;","299","","537","    \"TR.optional-block-start\": function(e) { \/\/ see optionalBlock.jelly","538","        \/\/ set start.ref to checkbox in preparation of row-set-end processing","539","        var checkbox = e.firstChild.firstChild;","540","        e.setAttribute(\"ref\", checkbox.id = \"cb\"+(iota++));","541","    },","542","","543","    \"TR.row-set-end\": function(e) { \/\/ see rowSet.jelly and optionalBlock.jelly","544","        \/\/ figure out the corresponding start block","545","        var end = e;","546","","547","        for( var depth=0; ; e=e.previousSibling) {","548","            if(Element.hasClassName(e,\"row-set-end\"))        depth++;","549","            if(Element.hasClassName(e,\"row-set-start\"))      depth--;","550","            if(depth==0)    break;","551","        }","552","        var start = e;","553","","554","        var ref = start.getAttribute(\"ref\");","555","        if(ref==null)","556","            start.id = ref = \"rowSetStart\"+(iota++);","557","","558","        applyNameRef(start,end,ref);","559","    },","560","","561","    \"BODY TR.optional-block-start\": function(e) { \/\/ see optionalBlock.jelly","562","        \/\/ this is prefixed by a pointless BODY so that two processing for optional-block-start","563","        \/\/ can sandwitch row-set-end","564","        \/\/ this requires \"TR.row-set-end\" to mark rows","565","        var checkbox = e.firstChild.firstChild;","566","        updateOptionalBlock(checkbox,false);","567","    },","568","","1480","var downloadService = {","1481","    continuations: {},","1482","","1483","    download : function(id,url,info, postBack,completionHandler) {","1484","        this.continuations[id] = {postBack:postBack,completionHandler:completionHandler};","1485","        loadScript(url+\"?\"+Hash.toQueryString(info));","1486","    },","1487","","1488","    post : function(id,data) {","1489","        var o = this.continuations[id];","1490","        new Ajax.Request(o.postBack, {","1491","            method:\"post\",","1492","            parameters:{json:Object.toJSON(data)},","1493","            onSuccess: function() {","1494","                if(o.completionHandler!=null)","1495","                    o.completionHandler();","1496","            }","1497","        });","1498","    }","1499","};","1500","","1501","\/\/ update center service. for historical reasons,","1502","\/\/ this is separate from downloadSerivce"],"delete":["24","initOptionalBlock\/\/","600","function initOptionalBlock(sid, eid, cid) {","601","    applyNameRef($(sid),$(eid),cid);","602","    updateOptionalBlock($(cid),false);","603","}","604",""]}],"maven-plugin\/src\/main\/java\/hudson\/maven\/MavenModuleSetBuild.java":[{"add":["313","                EnvVars envVars = getEnvironment(listener);","421","            mvn = mvn.forEnvironment(envVars).forNode(Computer.currentComputer().getNode(), listener);"],"delete":["313","                EnvVars envVars = getEnvironment();","421","            mvn = mvn.forEnvironment(envVars).forNode(Computer.currentComputer().getNode());"]}],"core\/src\/main\/resources\/hudson\/tools\/ZipExtractionInstaller\/help-url.html":[{"add":[],"delete":[]}],"core\/src\/main\/resources\/lib\/form\/rowSet.jelly":[{"add":["44","      <tr ref=\"${attrs.ref}\" class=\"row-set-start\" style=\"display:none\" name=\"${attrs.name}\" \/>","46","      <tr class=\"row-set-end\" \/>"],"delete":["44","      <j:set var=\"id\" value=\"${h.generateId()}\" \/>","45","      <j:set var=\"head\" value=\"rowGroupStart${id}\"\/>","46","      <j:set var=\"ref\" value=\"${attrs.ref?:head}\"\/>","47","","48","      <tr id=\"${head}\" style=\"display:none\" name=\"${attrs.name}\" \/>","50","      <tr id=\"rowGroupEnd${id}\" style=\"display:none\" \/>","51","      <script>","52","        applyNameRef($$('${head}') , $$('rowGroupEnd${id}') , '${ref}')","53","      <\/script>"]}],"war\/resources\/css\/style.css":[{"add":["689","\/*","690","    <DIV>s marked with to-be-removed is used in conjunction with repetable.jelly and hetero-list.jelly","691","    and represents a master copy that gets pulled out from HTML, then inserted later upon demand multiple times","692","    when the user does \"Add\".","693","*\/","694","DIV.to-be-removed { display: none; }","695","","696","\/* ========================= Other form related CSS ========================= *\/","697","","698",".row-set-end { display: none; }","699",""],"delete":[]}],"core\/src\/main\/java\/hudson\/tools\/ToolInstallation.java":[{"add":["27","import hudson.EnvVars;\r","34","import hudson.model.Saveable;\r","35","import hudson.model.TaskListener;\r","37","import hudson.util.DescribableList;\r","40","import java.io.IOException;\r","41","import java.util.List;\r","42","\r","43","import com.thoughtworks.xstream.annotations.XStreamSerializable;\r","64"," * (by using {@link #translateFor(Node, TaskListener)}) and\r","77","    \/**\r","78","     * {@link ToolProperty}s that are associated with this tool.\r","79","     *\/\r","80","    @XStreamSerializable\r","81","    private transient \/*almost final*\/ DescribableList<ToolProperty<?>,ToolPropertyDescriptor> properties\r","82","            = new DescribableList<ToolProperty<?>,ToolPropertyDescriptor>(Saveable.NOOP);\r","83","\r","84","    \/**\r","85","     * @deprecated\r","86","     *      as of 1.302. Use {@link #ToolInstallation(String, String, List)} \r","87","     *\/\r","93","    public ToolInstallation(String name, String home, List<? extends ToolProperty<?>> properties) {\r","94","        this.name = name;\r","95","        this.home = home;\r","96","        if(properties!=null) {\r","97","            try {\r","98","                this.properties.replaceBy(properties);\r","99","                for (ToolProperty<?> p : properties)\r","100","                    _setTool(p,this);\r","101","            } catch (IOException e) {\r","102","                throw new AssertionError(e); \/\/ no Saveable, so can't happen\r","103","            }\r","104","        }\r","105","    }\r","106","\r","107","    \/\/ helper function necessary to avoid a warning\r","108","    private <T extends ToolInstallation> void _setTool(ToolProperty<T> prop, ToolInstallation t) {\r","109","        prop.setTool(prop.type().cast(t));\r","110","    }\r","111","\r","129","    public DescribableList<ToolProperty<?>,ToolPropertyDescriptor> getProperties() {\r","130","        assert properties!=null;\r","131","        return properties;\r","132","    }\r","133","\r","139","     * Finds a tool on a node.\r","141","     * return the node-specific home directory.\r","142","     * Also checks available {@link ToolLocationTranslator}s.\r","143","     * Otherwise returns {@code installation.getHome()}.\r","146","     * This is the core logic behind {@link NodeSpecific#forNode(Node, TaskListener)} for {@link ToolInstallation},\r","152","    @SuppressWarnings(\"deprecation\")\r","153","    protected String translateFor(Node node, TaskListener log) throws IOException, InterruptedException {\r","154","        return ToolLocationNodeProperty.getToolHome(node, this, log);\r","155","    }\r","156","\r","157","    \/**\r","158","     * Invoked by XStream when this object is read into memory.\r","159","     *\/\r","160","    private Object readResolve() {\r","161","        if(properties==null)\r","162","            properties = new DescribableList<ToolProperty<?>,ToolPropertyDescriptor>(Saveable.NOOP);\r","163","        for (ToolProperty<?> p : properties)\r","164","            _setTool(p, this);\r","165","        return this;\r"],"delete":["29","import hudson.EnvVars;\r","57"," * (by using {@link #translateFor(Node)}) and\r","67","\r","99","     * return the node-specific home directory. Otherwise return {@code installation.getHome()}\r","102","     * This is the core logic behind {@link NodeSpecific#forNode(Node)} for {@link ToolInstallation},\r","108","    protected String translateFor(Node node) {\r","109","        return ToolLocationNodeProperty.getToolHome(node,this);\r"]}],"core\/src\/main\/resources\/lib\/form\/optionalBlock.jelly":[{"add":["50","  <tr class=\"optional-block-start row-set-start\" hasHelp=\"${attrs.help!=null}\"><!-- this ID marks the beginning -->","53","                  negative=\"${attrs.negative}\" checked=\"${checked}\" \/>","68","  <tr class=\"row-set-end optional-block-end\" \/>"],"delete":["50","  <j:set var=\"id\" value=\"${h.generateId()}\" \/>","51","  <tr id=\"oe_s${id}\" class=\"optional-block-start\" hasHelp=\"${attrs.help!=null}\"><!-- this ID marks the beginning -->","54","                  negative=\"${attrs.negative}\"","55","                  id=\"oe_c${id}\" checked=\"${checked}\" \/>","70","  <tr class=\"optional-block-end\" style=\"display:none\" id=\"oe_e${id}\">","71","    <script>","72","      initOptionalBlock('oe_s${id}','oe_e${id}','oe_c${id}');","73","    <\/script>","74","  <\/tr>"]}],"core\/src\/main\/resources\/hudson\/tools\/Messages.properties":[{"add":["23","CommandInstaller.DescriptorImpl.displayName=Run Command","24","CommandInstaller.no_command=Must provide a command to run.","25","CommandInstaller.no_toolHome=Must provide a tool home directory.","26","ZipExtractionInstaller.DescriptorImpl.displayName=Extract *.zip\/*.tar.gz","27","ZipExtractionInstaller.bad_connection=Server rejected connection.","28","ZipExtractionInstaller.malformed_url=Malformed URL.","29","ZipExtractionInstaller.could_not_connect=Could not connect to URL."],"delete":[]}],"core\/src\/main\/resources\/hudson\/tools\/CommandInstaller\/config.jelly":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/JDK.java":[{"add":["27","import hudson.util.FormValidation;","34","import hudson.tools.ToolProperty;","35","import hudson.tools.JDKInstaller;","41","import java.util.Arrays;","42","import java.util.Collections;","43","","44","import org.kohsuke.stapler.DataBoundConstructor;","45","import org.kohsuke.stapler.QueryParameter;","57","        super(name, javaHome, Collections.<ToolProperty<?>>emptyList());","58","    }","59","","60","    @DataBoundConstructor","61","    public JDK(String name, String home, List<? extends ToolProperty<?>> properties) {","62","        super(name, home, properties);","67","     *","68","     * @deprecated as of 1.304","69","     *      Use {@link #getHome()}","75","    @SuppressWarnings({\"deprecation\"})","76","    public @Override String getHome() {","85","        return new File(getHome(),\"bin\");","97","        return new File(getHome(),\"bin\/\"+execName);","113","        env.put(\"JAVA_HOME\",getHome());","116","    public JDK forNode(Node node, TaskListener log) throws IOException, InterruptedException {","117","        return new JDK(getName(), translateFor(node, log));","150","        public @Override JDK[] getInstallations() {","155","        public @Override synchronized void setInstallations(JDK... jdks) {","158","            list.addAll(Arrays.asList(jdks));","161","        @Override","162","        public List<JDKInstaller> getDefaultInstallers() {","163","            return Collections.singletonList(new JDKInstaller(null,false));","164","        }","165","","166","        \/**","167","         * Checks if the JAVA_HOME is a valid JAVA_HOME path.","168","         *\/","169","        public FormValidation doCheckHome(@QueryParameter File value) {","170","            \/\/ this can be used to check the existence of a file on the server, so needs to be protected","171","            Hudson.getInstance().checkPermission(Hudson.ADMINISTER);","172","","173","            if(value.exists() && !value.isDirectory())","174","                return FormValidation.error(Messages.Hudson_NotADirectory(value));","175","","176","            File toolsJar = new File(value,\"lib\/tools.jar\");","177","            File mac = new File(value,\"lib\/dt.jar\");","178","            if(!toolsJar.exists() && !mac.exists())","179","                return FormValidation.error(Messages.Hudson_NotJDKDir(value));","180","","181","            return FormValidation.ok();","182","        }"],"delete":["33","import hudson.tools.ToolLocationNodeProperty;","50","        super(name, javaHome);","60","    public String getHome() {","69","        return new File(getJavaHome(),\"bin\");","81","        return new File(getJavaHome(),\"bin\/\"+execName);","97","        env.put(\"JAVA_HOME\",getJavaHome());","100","    public JDK forNode(Node node) {","101","        return new JDK(getName(),translateFor(node));","134","        public JDK[] getInstallations() {","139","        public synchronized void setInstallations(JDK... jdks) {","142","            for (JDK jdk: jdks) list.add(jdk);"]}],"core\/src\/main\/resources\/hudson\/model\/JDK\/config_ja.properties":[{"add":[],"delete":[]}],"core\/src\/main\/resources\/lib\/form\/descriptorList.jelly":[{"add":["55","  <j:set var=\"instances\" value=\"${attrs.instances ?: instance[field] ?: descriptor['default'+h.capitalize(field)]}\"\/>"],"delete":["55","  <j:set var=\"instances\" value=\"${attrs.instances ?: instance[field]}\"\/>"]}],"core\/src\/main\/java\/hudson\/tools\/ToolProperty.java":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/tools\/ToolPropertyDescriptor.java":[{"add":[],"delete":[]}],"core\/src\/main\/resources\/hudson\/model\/JDK\/config_fr.properties":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/slaves\/NodeSpecific.java":[{"add":["28","import hudson.model.TaskListener;\r","29","import java.io.IOException;\r","46","    T forNode(Node node, TaskListener log) throws IOException, InterruptedException;\r"],"delete":["44","    T forNode(Node node);\r"]}],"core\/src\/main\/java\/hudson\/tools\/JDKInstaller.java":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/Descriptor.java":[{"add":["262","        return singleQuote(a.getUrl()+\"\/descriptorByName\/\"+clazz.getName()+\"\/check\"+capitalizedFieldName+\"?value=\")+\"+toValue(this)\";"],"delete":["262","        return singleQuote(a.getUrl()+\"\/descriptorByName\/\"+clazz.getName()+\"\/check\"+capitalizedFieldName+\"?value=\")+\"+encode(this.value)\";"]}],"core\/src\/main\/resources\/hudson\/tools\/CommandInstaller\/help-command.html":[{"add":[],"delete":[]}],"core\/pom.xml":[{"add":["347","        <exclusion><!-- excluded until stapler revs up -->","348","              <groupId>org.kohsuke.stapler<\/groupId>","349","              <artifactId>json-lib<\/artifactId>","350","        <\/exclusion>","353","    <dependency><!-- manually specified until stapler 1.104 -->","354","      <groupId>org.kohsuke.stapler<\/groupId>","355","      <artifactId>json-lib<\/artifactId>","356","      <version>2.1-rev2<\/version>","357","    <\/dependency>","382","      <version>1.3.1-hudson-2<\/version>","713","    <dependency>","714","      <groupId>org.jvnet.hudson<\/groupId>","715","      <artifactId>htmlunit<\/artifactId>","716","      <version>2.2-hudson-9<\/version>","717","    <\/dependency>"],"delete":["373","      <version>1.3.1-hudson-1<\/version>"]}],"core\/src\/main\/java\/hudson\/model\/DownloadService.java":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/tools\/ToolInstallerDescriptor.java":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/tasks\/Maven.java":[{"add":["40","import hudson.model.TaskListener;","180","        EnvVars env = build.getEnvironment(listener);","207","                mi = mi.forNode(Computer.currentComputer().getNode(), listener);","411","        public MavenInstallation forNode(Node node, TaskListener log) throws IOException, InterruptedException {","412","            return new MavenInstallation(getName(), translateFor(node, log));"],"delete":["45","import hudson.tools.ToolLocationNodeProperty;","180","        EnvVars env = build.getEnvironment();","207","                mi = mi.forNode(Computer.currentComputer().getNode());","411","        public MavenInstallation forNode(Node node) {","412","            return new MavenInstallation(getName(),translateFor(node));"]}],"core\/src\/main\/java\/hudson\/model\/Node.java":[{"add":[],"delete":["29","import hudson.tools.ToolLocationNodeProperty;"]}],"core\/src\/main\/resources\/hudson\/model\/JDK\/config_pt_BR.properties":[{"add":[],"delete":[]}],"core\/src\/main\/resources\/hudson\/model\/JDK\/config.jelly":[{"add":[],"delete":[]}],"core\/src\/main\/resources\/hudson\/tools\/ZipExtractionInstaller\/help.html":[{"add":[],"delete":[]}],"test\/src\/test\/java\/hudson\/tasks\/MavenTest.java":[{"add":["97","        String javaHome = jdk.getHome();"],"delete":["97","        String javaHome = jdk.getJavaHome();"]}],"core\/src\/main\/resources\/lib\/form\/option.jelly":[{"add":["31","    <st:attribute name=\"value\" use=\"required\">","32","      The value to be sent when the form is submitted.","33","      Due to the browser incompatibility between IE and Firefox,","34","      this parameter is mandatory.","35","    <\/st:attribute>"],"delete":[]}],"maven-plugin\/src\/main\/java\/hudson\/maven\/MavenBuild.java":[{"add":["475","            EnvVars envVars = getEnvironment(listener); \/\/ buildEnvironments should be set up first"],"delete":["475","            EnvVars envVars = getEnvironment(); \/\/ buildEnvironments should be set up first"]}],"core\/src\/main\/java\/hudson\/model\/AbstractBuild.java":[{"add":["438","    public EnvVars getEnvironment(TaskListener log) throws IOException, InterruptedException {","439","        EnvVars env = super.getEnvironment(log);","450","                jdk = jdk.forNode(computer.getNode(), log);"],"delete":["438","    public EnvVars getEnvironment() throws IOException, InterruptedException {","439","        EnvVars env = super.getEnvironment();","450","                jdk = jdk.forNode(computer.getNode());            "]}],"core\/src\/main\/resources\/lib\/layout\/layout.jelly":[{"add":["211","","212","            <!-- add YUI logger if debugging YUI -->","213","            <j:if test=\"${h.yuiSuffix=='debug'}\">","214","              <div id=\"yui-logreader\" style=\"margin-top:1em\"\/>","215","              <script>","216","                Behaviour.addLoadEvent(function(){","217","                  var logReader = new YAHOO.widget.LogReader(\"yui-logreader\");","218","                  logReader.collapse();","219","                });","220","              <\/script>","221","            <\/j:if>"],"delete":[]}],"core\/src\/main\/resources\/hudson\/model\/JDK\/config_de.properties":[{"add":[],"delete":[]}],"core\/src\/main\/resources\/hudson\/tools\/CommandInstaller\/help.html":[{"add":[],"delete":[]}],"core\/src\/main\/resources\/hudson\/tools\/ZipExtractionInstaller\/help-subdir.html":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/PageDecorator.java":[{"add":["95","     * Obtains the URL of this object, excluding the context path.","96","     *","97","     * <p>","98","     * Every {@link PageDecorator} is bound to URL via {@link Hudson#getDescriptor()}.","99","     * This method returns such an URL.","100","     *\/","101","    public final String getUrl() {","102","        return \"descriptor\/\"+clazz.getName();","103","    }","104","","105","    \/**"],"delete":[]}],"core\/src\/main\/resources\/hudson\/tools\/label.jelly":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/Run.java":[{"add":["47","import hudson.util.LogTaskListener;","1275","     * @deprecated as of XXX use {@link #getEnvironment(TaskListener)}","1276","     *\/","1277","    public EnvVars getEnvironment() throws IOException, InterruptedException {","1278","        return getEnvironment(new LogTaskListener(LOGGER, Level.INFO));","1279","    }","1280","","1281","    \/**","1294","    public EnvVars getEnvironment(TaskListener log) throws IOException, InterruptedException {"],"delete":["43","import hudson.tasks.BuildStep;","44","import hudson.tasks.BuildWrapper;","49","import hudson.util.ProcessTreeKiller;","1289","    public EnvVars getEnvironment() throws IOException, InterruptedException {"]}],"core\/src\/main\/resources\/hudson\/model\/Hudson\/configure.jelly":[{"add":["102","          <f:repeatable var=\"instance\" items=\"${it.JDKs}\" name=\"jdks\" add=\"${%Add JDK}\">","103","            <j:set var=\"descriptor\" value=\"${h.getJDKDescriptor()}\" \/>","104","            <st:include page=\"${descriptor.configPage}\" from=\"${descriptor}\" \/>"],"delete":["102","          <f:repeatable var=\"inst\" items=\"${it.JDKs}\" name=\"jdks\">","103","            <table width=\"100%\">","104","              <f:entry title=\"${%name}\">","105","                <input class=\"setting-input\" name=\"jdk_name\"","106","                  type=\"text\" value=\"${inst.name}\" \/>","107","              <\/f:entry>","108","","109","              <j:set var=\"status\" value=\"${null}\" \/>","110","              <j:if test=\"${inst!=null and !inst.exists and inst.name!=''}\">","111","                <j:set var=\"status\" value=\"${%no.such.JDK}\" \/>","112","              <\/j:if>","113","              <f:entry title=\"JAVA_HOME\" description=\"${status}\">","114","                <input class=\"setting-input validated\" name=\"jdk_home\"","115","                  type=\"text\" value=\"${inst.javaHome}\"","116","                  checkUrl=\"'javaHomeCheck?value='+escape(this.value)\"\/>","117","              <\/f:entry>","118","              <f:entry title=\"\">","119","                <div align=\"right\">","120","                  <f:repeatableDeleteButton \/>","121","                <\/div>","122","              <\/f:entry>","123","            <\/table>"]}],"core\/src\/main\/java\/hudson\/slaves\/NodeProperty.java":[{"add":["107","        return NodePropertyDescriptor.for_(all(),node);\r"],"delete":["38","import java.util.ArrayList;\r","108","        List<NodePropertyDescriptor> result = new ArrayList<NodePropertyDescriptor>();\r","109","        for (NodePropertyDescriptor npd : all()) {\r","110","            if (npd.isApplicable(node.getClass())) {\r","111","                result.add(npd);\r","112","            }\r","113","        }\r","114","        return result;\r"]}],"core\/src\/main\/java\/hudson\/FilePath.java":[{"add":["42","import static hudson.util.jna.GNUCLibrary.LIBC;","90","import com.sun.jna.Native;","91","","196","    \/**","197","     * Construct a path starting with a base location.","198","     * @param base starting point for resolution, and defines channel","199","     * @param rel a path which if relative will be resolved against base","200","     *\/","391","        ZipInputStream zip = new ZipInputStream(new BufferedInputStream(in));","418","     * Absolutizes this {@link FilePath} and returns the new one.","419","     *\/","420","    public FilePath absolutize() throws IOException, InterruptedException {","421","        return new FilePath(channel,act(new FileCallable<String>() {","422","            public String invoke(File f, VirtualChannel channel) throws IOException {","423","                return f.getAbsolutePath();","424","            }","425","        }));","426","    }","427","","428","    \/**","492","     * <li>If the target directory doesn't exist {@linkplain #mkdirs() it'll be created}.","496","     * <li>If the connection is refused but the target directory already exists, it is left alone.","511","        URLConnection con;","512","        try {","513","            con = archive.openConnection();","514","            con.connect();","515","        } catch (IOException x) {","516","            if (this.exists()) {","517","                \/\/ Cannot connect now, so assume whatever was last unpacked is still OK.","518","                if (listener != null) {","519","                    listener.getLogger().println(\"Skipping installation of \" + archive + \" to \" + remote + \": \" + x);","520","                }","521","                return false;","522","            } else {","523","                throw x;","524","            }","525","        }","626","            } catch (AbortException e) {","627","                throw e;    \/\/ pass through so that the caller can catch it as AbortException","746","     * The same as {@link FilePath#FilePath(FilePath,String)} but more OO.","747","     * @param rel a relative or absolute path","748","     * @return a file on the same channel","904","     * Sets the file permission.","905","     *","906","     * On Windows, no-op.","907","     *","908","     * @since 1.303","909","     *\/","910","    public void chmod(final int mask) throws IOException, InterruptedException {","911","        if(!isUnix())   return;","912","        act(new FileCallable<Void>() {","913","            public Void invoke(File f, VirtualChannel channel) throws IOException {","914","                if(LIBC.chmod(f.getAbsolutePath(),mask)!=0)","915","                    throw new IOException(\"Failed to chmod \"+f+\" : \"+LIBC.strerror(Native.getLastError()));","916","                return null;","917","            }","918","        });","919","    }","920","","921","    \/**","1322","                        LIBC.chmod(f.getPath(),mode);"],"delete":["42","import hudson.util.jna.GNUCLibrary;","384","        ZipInputStream zip = new ZipInputStream(in);","474","     * <li>If the target directory doesn't exit {@linkplain #mkdirs() it'll be created}.","492","        URLConnection con = archive.openConnection();","711","     * The same as {@code new FilePath(this,rel)} but more OO.","1267","                        GNUCLibrary.LIBC.chmod(f.getPath(),mode);"]}],"core\/src\/main\/java\/hudson\/tools\/PropertyDescriptor.java":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/Hudson.java":[{"add":["2184","            jdks.clear();","2185","            jdks.addAll(req.bindJSONToList(JDK.class,json.get(\"jdks\")));","2211","                pluginManager.getPlugin(o.getString(\"name\")).getPlugin().configure(req, o);","3313","        if(ver.equals(\"?\") || Boolean.getBoolean(\"hudson.script.noCache\"))"],"delete":["2184","            {\/\/ update JDK installations","2185","                jdks.clear();","2186","                String[] names = req.getParameterValues(\"jdk_name\");","2187","                String[] homes = req.getParameterValues(\"jdk_home\");","2188","                if(names!=null && homes!=null) {","2189","                    int len = Math.min(names.length,homes.length);","2190","                    for(int i=0;i<len;i++) {","2191","                        jdks.add(new JDK(names[i],homes[i]));","2192","                    }","2193","                }","2194","            }","2220","                pluginManager.getPlugin(o.getString(\"name\")).getPlugin().configure(o);","2905","     * Checks if the JAVA_HOME is a valid JAVA_HOME path.","2906","     *\/","2907","    public FormValidation doJavaHomeCheck(@QueryParameter File value) {","2908","        \/\/ this can be used to check the existence of a file on the server, so needs to be protected","2909","        checkPermission(ADMINISTER);","2910","","2911","        if(!value.isDirectory())","2912","            return FormValidation.error(Messages.Hudson_NotADirectory(value));","2913","","2914","        File toolsJar = new File(value,\"lib\/tools.jar\");","2915","        File mac = new File(value,\"lib\/dt.jar\");","2916","        if(!toolsJar.exists() && !mac.exists())","2917","            return FormValidation.error(Messages.Hudson_NotJDKDir(value));","2918","","2919","        return FormValidation.ok();","2920","    }","2921","","2922","    \/**","3340","        if(ver.equals(\"?\"))"]}],"war\/resources\/help\/tools\/help-label.html":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/util\/FormValidation.java":[{"add":["90"," *     String version = getAntVersion(antHome);"],"delete":["90"," *     String version = getAntVersin(antHome);"]}],"core\/src\/main\/java\/hudson\/tools\/InstallerTranslator.java":[{"add":[],"delete":[]}],"core\/src\/main\/resources\/hudson\/tools\/taglib":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/Plugin.java":[{"add":["148","     * @since 1.233","149","     * @deprecated override {@link #configure(StaplerRequest,JSONObject)} instead","150","     *\/","151","    public void configure(JSONObject formData) throws IOException, ServletException, FormException {","152","    }","153","","154","    \/**","179","     * @since XXX","181","    public void configure(StaplerRequest req, JSONObject formData) throws IOException, ServletException, FormException {","182","        configure(formData);"],"delete":["172","     *","173","     * @since 1.233","175","    public void configure(JSONObject formData) throws IOException, ServletException, FormException {"]}],"core\/src\/main\/resources\/hudson\/model\/JDK\/config_tr.properties":[{"add":[],"delete":[]}],"core\/src\/main\/resources\/hudson\/tools\/InstallSourceProperty\/help.html":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/tasks\/CommandInterpreter.java":[{"add":["77","                EnvVars envVars = build.getEnvironment(listener);"],"delete":["77","                EnvVars envVars = build.getEnvironment();"]}],"core\/src\/main\/resources\/hudson\/tools\/InstallSourceProperty\/config.jelly":[{"add":[],"delete":[]}],"core\/src\/main\/resources\/lib\/form\/checkbox.jelly":[{"add":["46","         onclick=\"${attrs.onclick}\" id=\"${attrs.id}\" class=\"${attrs.negative!=null ? 'negative' : null} ${attrs.checkUrl!=null?'validated':''}\"","47","         checkUrl=\"${attrs.checkUrl}\""],"delete":["46","         onclick=\"${attrs.onclick}\" id=\"${attrs.id}\" class=\"${attrs.negative!=null ? 'negative' : null}\""]}],"core\/src\/main\/resources\/hudson\/model\/JDK\/config_nl.properties":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/tools\/InstallSourceProperty.java":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/tools\/ToolDescriptor.java":[{"add":["27","import hudson.util.DescribableList;\r","28","\r","29","import java.util.Collections;\r","30","import java.util.List;\r","31","import java.io.IOException;\r","46","     * @return read-only list of installations;\r","47","     *      can be empty but never null.\r","50","        return installations.clone();\r","56","     * @param installations list of installations;\r","59","    public void setInstallations(T... installations) {\r","60","        this.installations = installations.clone();\r","62","\r","63","    \/**\r","64","     * Lists up {@link ToolPropertyDescriptor}s that are applicable to this {@link ToolInstallation}.\r","65","     *\/\r","66","    public List<ToolPropertyDescriptor> getPropertyDescriptors() {\r","67","        return PropertyDescriptor.for_(ToolProperty.all(),clazz);\r","68","    }\r","69","\r","70","    \/**\r","71","     * Optional list of installers to be configured by default for new tools of this type.\r","72","     * If there are popular versions of the tool available using generic installation techniques,\r","73","     * they can be returned here for the user's convenience.\r","74","     * @since XXX\r","75","     *\/\r","76","    public List<? extends ToolInstaller> getDefaultInstallers() {\r","77","        return Collections.emptyList();\r","78","    }\r","79","\r","80","    \/**\r","81","     * Default value for {@link ToolInstallation#getProperties()} used in the form binding.\r","82","     * @since XXX\r","83","     *\/\r","84","    public DescribableList<ToolProperty<?>,ToolPropertyDescriptor> getDefaultProperties() throws IOException {\r","85","        DescribableList<ToolProperty<?>,ToolPropertyDescriptor> r\r","86","                = new DescribableList<ToolProperty<?>, ToolPropertyDescriptor>(NOOP);\r","87","\r","88","        List<? extends ToolInstaller> installers = getDefaultInstallers();\r","89","        if(!installers.isEmpty())\r","90","            r.add(new InstallSourceProperty(installers));\r","91","\r","92","        return r;\r","93","    }\r","94","\r"],"delete":["41","     * @return\r","42","     *      can be empty but never null. Treat this as a read-only copy, do not mutate.\r","45","        return installations;\r","51","     * @return\r","54","    public void setInstallations(T[] installations) {\r","55","        this.installations = installations;\r"]}],"core\/src\/main\/java\/hudson\/tools\/ZipExtractionInstaller.java":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/Functions.java":[{"add":["43","import hudson.model.JDK;","73","import org.jvnet.tiger_types.Types;","94","import java.lang.reflect.Type;","95","import java.lang.reflect.ParameterizedType;","152","     * Given {@code c=MyList (extends ArrayList<Foo>), base=List}, compute the parameterization of 'base'","153","     * that's assignable from 'c' (in this case {@code List<Foo>}), and return its n-th type parameter","154","     * (n=0 would return {@code Foo}).","155","     *","156","     * <p>","157","     * This method is useful for doing type arithmetic.","158","     *","159","     * @throws AssertionError","160","     *      if c' is not parameterized.","161","     *\/","162","    public static <B> Class getTypeParameter(Class<? extends B> c, Class<B> base, int n) {","163","        Type parameterization = Types.getBaseClass(c,base);","164","        if (parameterization instanceof ParameterizedType) {","165","            ParameterizedType pt = (ParameterizedType) parameterization;","166","            return Types.erasure(Types.getTypeArgument(pt,n));","167","        } else {","168","            throw new AssertionError(c+\" doesn't properly parameterize \"+base);","169","        }","170","    }","171","","172","    public JDK.DescriptorImpl getJDKDescriptor() {","173","        return Hudson.getInstance().getDescriptorByType(JDK.DescriptorImpl.class);","174","    }","175","","176","    \/**","397","    public static boolean DEBUG_YUI = Boolean.getBoolean(\"debug.YUI\");","850","    \/**","851","     * Converts \"abc\" to \"Abc\".","852","     *\/","853","    public static String capitalize(String s) {","854","        if(s==null || s.length()==0) return s;","855","        return Character.toUpperCase(s.charAt(0))+s.substring(1);","856","    }","857","","1096","        \/\/ this method may be called to render start up errors, at which point Hudson doesn't exist yet. see HUDSON-3608 ","1097","        if(Hudson.getInstance()==null)  return Collections.emptyList();"],"delete":["368","    public static boolean DEBUG_YUI = System.getProperty(\"debug.YUI\")!=null;"]}],"core\/src\/main\/resources\/hudson\/model\/DownloadService\/footer.jelly":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/slaves\/NodePropertyDescriptor.java":[{"add":["26","import hudson.model.Node;\r","27","import hudson.tools.PropertyDescriptor;\r","38","public abstract class NodePropertyDescriptor extends PropertyDescriptor<NodeProperty<?>,Node> {\r","39","    protected NodePropertyDescriptor(Class<? extends NodeProperty<?>> clazz) {\r","40","        super(clazz);\r","43","    protected NodePropertyDescriptor() {\r","44","    }\r"],"delete":["25","import hudson.model.Descriptor;\r","26","import hudson.model.Node;\r","28","\r","29","import java.lang.reflect.ParameterizedType;\r","30","import java.lang.reflect.Type;\r","31","\r","32","import org.jvnet.tiger_types.Types;\r","43","public abstract class NodePropertyDescriptor extends Descriptor<NodeProperty<?>> {\r","44","    \/**\r","45","     * Returns true if this {@link NodeProperty} type is applicable to the\r","46","     * given node type.\r","47","     * \r","48","     * <p>\r","49","     * The default implementation of this method checks if the given node type is assignable to 'N' of\r","50","     * {@link NodeProperty}<tt>&lt;N><\/tt>, but subtypes can extend this to change this behavior.\r","51","     *\r","52","     * @return\r","53","     *      true to indicate applicable, in which case the property will be\r","54","     *      displayed in the configuration screen of this node.\r","55","     *\/\r","56","    public boolean isApplicable(Class<? extends Node> nodeType) {\r","57","        Type parameterization = Types.getBaseClass(clazz, NodeProperty.class);\r","58","        if (parameterization instanceof ParameterizedType) {\r","59","            ParameterizedType pt = (ParameterizedType) parameterization;\r","60","            Class<?> applicable = Types.erasure(Types.getTypeArgument(pt, 0));\r","61","            return applicable.isAssignableFrom(nodeType);\r","62","        } else {\r","63","            throw new AssertionError(clazz+\" doesn't properly parameterize NodeProperty. The isApplicable() method must be overriden.\");\r","64","        }\r"]}],"core\/src\/main\/java\/hudson\/tools\/ToolInstaller.java":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/util\/LogTaskListener.java":[{"add":[],"delete":[]}],"test\/src\/main\/java\/org\/jvnet\/hudson\/test\/CaptureEnvironmentBuilder.java":[{"add":["52","    \tenvVars = build.getEnvironment(listener);"],"delete":["52","    \tenvVars = build.getEnvironment();"]}],"core\/src\/main\/java\/hudson\/tools\/ToolLocationNodeProperty.java":[{"add":["31","import hudson.model.TaskListener;\r","35","import java.io.IOException;\r","88","    public static String getToolHome(Node node, ToolInstallation installation, TaskListener log) throws IOException, InterruptedException {\r","98","            result = t.getToolHome(node, installation, log);\r"],"delete":["86","    public static String getToolHome(Node node, ToolInstallation installation) {\r","96","            result = t.getToolHome(node,installation);\r"]}],"maven-plugin\/src\/main\/java\/hudson\/maven\/ProcessCache.java":[{"add":["28","import hudson.model.TaskListener;","64","        MavenInstallation getMavenInstallation(TaskListener listener) throws IOException, InterruptedException;","65","        JDK getJava(TaskListener listener) throws IOException, InterruptedException;","164","        MavenInstallation installation = factory.getMavenInstallation(listener);","165","        JDK jdk = factory.getJava(listener);"],"delete":["63","        MavenInstallation getMavenInstallation();","64","        JDK getJava();","163","        MavenInstallation installation = factory.getMavenInstallation();","164","        JDK jdk = factory.getJava();"]}],"core\/src\/main\/java\/hudson\/tools\/CommandInstaller.java":[{"add":[],"delete":[]}],"core\/src\/main\/resources\/hudson\/tools\/JDKInstaller\/config.jelly":[{"add":[],"delete":[]}],"test\/src\/test\/java\/hudson\/tasks\/EnvVarsInConfigTasksTest.java":[{"add":["30","\t\tJDK varJDK = new JDK(\"varJDK\", withVariable(defaultJDK.getHome()));\r"],"delete":["30","\t\tJDK varJDK = new JDK(\"varJDK\", withVariable(defaultJDK.getJavaHome()));\r"]}],"test\/src\/test\/java\/hudson\/tools\/JDKInstallerTest.java":[{"add":[],"delete":[]}],"core\/src\/main\/resources\/hudson\/tools\/ZipExtractionInstaller\/config.jelly":[{"add":[],"delete":[]}],"test\/src\/test\/java\/hudson\/model\/HudsonTest.java":[{"add":["90","        assertEquals(jdk.getHome(),home);"],"delete":["90","        assertEquals(jdk.getJavaHome(),home);"]}],"war\/pom.xml":[{"add":["113","                <resolveArtifact groupId=\"org.jvnet.hudson.plugins\" artifactId=\"ssh-slaves\" version=\"0.5.2\" type=\"hpi\" tofile=\"${basedir}\/target\/generated-resources\/WEB-INF\/plugins\/ssh-slaves.hpi\" \/>","161","              <!-- always reload scripts during debugging -->","162","              <name>hudson.script.noCache<\/name>","163","              <value>true<\/value>","164","            <\/systemProperty>","165","            <systemProperty>"],"delete":["113","                <resolveArtifact groupId=\"org.jvnet.hudson.plugins\" artifactId=\"ssh-slaves\" version=\"0.5\" type=\"hpi\" tofile=\"${basedir}\/target\/generated-resources\/WEB-INF\/plugins\/ssh-slaves.hpi\" \/>"]}]}},"ebccd71e7327bf1a234f27a4230533061112d798":{"changes":{"core\/src\/main\/java\/hudson\/model\/Computer.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/Computer.java":[{"add":["592","    \/**","593","     * Returns the current size of the executor pool for this computer.","594","     * This number may temporarily differ from {@link #getNumExecutors()} if there","595","     * are busy tasks when the configured size is decreased.  OneOffExecutors are","596","     * not included in this count.","597","     *\/","619","     * Returns true if all the executors of this computer are idle.","644","        for (Executor e : oneOffExecutors) {","645","            firstIdle = Math.max(firstIdle, e.getIdleStartMilliseconds());","646","        }"],"delete":["613","     * Returns true if all the executors of this computer is idle."]}]}},"ca8aa7748a6aee08f4b188571abd035d3b0842a8":{"changes":{"changelog.html":"MODIFY"},"diff":{"changelog.html":[{"add":["109","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-39971\">issue 39971<\/a>)"],"delete":["109","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-40489\">issue 40489<\/a>)"]}]}},"01e9631a1112de5e86ef99842b9d73ee53863c45":{"changes":{"core\/src\/main\/java\/hudson\/Functions.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/Functions.java":[{"add":["180","        \/\/ Find \"rest\" or URI by removing N path components.","181","        \/\/ Not using reqUri.substring(f.getUrl().length()) to avoid mismatches due to","182","        \/\/ url-encoding or extra slashes.  Former may occur in Tomcat (despite the spec saying","183","        \/\/ this string is not decoded, Tomcat apparently decodes this string. You see ' '","184","        \/\/ instead of '%20', which is what the browser has sent), latter may occur in some","185","        \/\/ proxy or URL-rewriting setups where extra slashes are inadvertently added.","186","        String furl = f.getUrl();","187","        int slashCount = 0;","188","        \/\/ Count components in ancestor URL","189","        for (int i = furl.indexOf('\/'); i >= 0; i = furl.indexOf('\/', i + 1)) slashCount++;","190","        \/\/ Remove that many from request URL, ignoring extra slashes","191","        String rest = reqUri.replaceFirst(\"(?:\/+[^\/]*){\" + slashCount + \"}\", \"\");"],"delete":["180","        \/\/ despite the spec saying this string is not decoded,","181","        \/\/ Tomcat apparently decodes this string. You see ' ' instead of '%20', which is what","182","        \/\/ the browser has sent. So do some quick scan to see if it's ASCII safe, and if not","183","        \/\/ re-encode it. Otherwise it won't match with ancUrl.","184","        if(reqUri.indexOf(' ')>=0) {","185","            try {","186","                \/\/ 3 arg version accepts illegal character. 1-arg version doesn't","187","                reqUri = new URI(null,reqUri,null).toASCIIString();","188","            } catch (URISyntaxException e) {","189","                \/\/ try to use reqUri as is.","190","            }","191","        }","192","","193","        String rest = reqUri.substring(f.getUrl().length());"]}]}},"1d49f9a4471499a27027c7c4ae1af980b1d018af":{"changes":{"core\/src\/main\/resources\/hudson\/matrix\/JDKAxis\/config.jelly":"MODIFY","core\/src\/main\/resources\/hudson\/matrix\/LabelAxis\/config.jelly":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/matrix\/JDKAxis\/config.jelly":[{"add":["28","      <f:checkbox name=\"values\" json=\"${jdk.name}\" checked=\"${instance.values.contains(jdk.name)}\" \/>"],"delete":["28","      <f:checkbox name=\"values\" value=\"${jdk.name}\" checked=\"${instance.values.contains(jdk.name)}\" \/>"]}],"core\/src\/main\/resources\/hudson\/matrix\/LabelAxis\/config.jelly":[{"add":["45","          new YAHOO.widget.TextNode('&lt;input type=\"checkbox\" name=\"values\" json=\"${l.name}\" '+has(\"${l.name}\")+'&gt;<label class=\"attach-previous\">${h.jsStringEscape(l.name)} (${h.jsStringEscape(l.description)})<\/label>', ${l.isSelfLabel()?'machines':'labels'}, false);"],"delete":["45","          new YAHOO.widget.TextNode('&lt;input type=\"checkbox\" name=\"values\" value=\"${l.name}\" '+has(\"${l.name}\")+'&gt;<label class=\"attach-previous\">${h.jsStringEscape(l.name)} (${h.jsStringEscape(l.description)})<\/label>', ${l.isSelfLabel()?'machines':'labels'}, false);"]}]}},"b9c18a7b4c6d194645a20312352cd4d4994eafb4":{"changes":{"core\/src\/main\/resources\/lib\/layout\/breadcrumbs.js":"MODIFY","core\/src\/main\/resources\/hudson\/model\/AbstractProject\/sidepanel.jelly":"MODIFY","changelog.html":"MODIFY","core\/src\/main\/java\/jenkins\/model\/ModelObjectWithContextMenu.java":"MODIFY","core\/src\/main\/resources\/lib\/layout\/task.jelly":"MODIFY"},"diff":{"core\/src\/main\/resources\/lib\/layout\/breadcrumbs.js":[{"add":["68","    function postRequest(action, event, url) {","69","        new Ajax.Request(url);","70","        if (event.length == 1 && event[0].target != null) {","71","            hoverNotification('Done.', event[0].target);","72","        }","73","    }","74","","120","                        if (e.post) {","121","                            e.onclick = {fn: postRequest, obj: e.url};","122","                            delete e.url;","123","                        }"],"delete":[]}],"core\/src\/main\/resources\/hudson\/model\/AbstractProject\/sidepanel.jelly":[{"add":["48","                  onclick=\"${it.parameterized?null:'return build(this)'}\" post=\"true\" permission=\"${it.BUILD}\"\/>"],"delete":["48","                  onclick=\"${it.parameterized?null:'return build(this)'}\" permission=\"${it.BUILD}\" \/>"]}],"changelog.html":[{"add":["60","  <li class=bug>","61","    \u201CBuild\u201D from job context menu produced a confusing warning page.","62","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-16844\">issue 16844<\/a>)"],"delete":["60",""]}],"core\/src\/main\/java\/jenkins\/model\/ModelObjectWithContextMenu.java":[{"add":["97","        \/** @since 1.504 *\/","98","        public ContextMenu add(String url, String icon, String text, boolean post) {","99","            if (text != null && icon != null && url != null) {","100","                MenuItem item = new MenuItem(url,icon,text);","101","                item.post = post;","102","                items.add(item);","103","            }","104","            return this;","105","        }","106","","180","         * True to make a POST request rather than GET.","181","         * @since 1.504","182","         *\/","183","        @Exported public boolean post;","184","","185","        \/**"],"delete":[]}],"core\/src\/main\/resources\/lib\/layout\/task.jelly":[{"add":["58","    <st:attribute name=\"post\" type=\"boolean\">","59","      If true, send a POST rather than a GET request.","60","      (onclick supersedes this except in the context menu.)","61","      (since 1.504)","62","    <\/st:attribute>","105","          ${taskTags!=null and attrs.contextMenu!='false' ? taskTags.add(href, icon, title, post == 'true') : null}","107","          <j:if test=\"${attrs.onclick == null &amp;&amp; post}\">","108","              <script>","109","                  function postRequest(a) {","110","                      new Ajax.Request(a.href);","111","                      hoverNotification('${%Done.}', a.parentNode);","112","                      return false;","113","                  }","114","              <\/script>","115","          <\/j:if>","116","","117","          <a href=\"${href}\" onclick=\"${attrs.onclick ?: (post ? 'postRequest(this)' : null)}\">","122","          <a href=\"${href}\" onclick=\"${attrs.onclick ?: (post ? 'postRequest(this)' : null)}\">"],"delete":["100","          ${taskTags!=null and attrs.contextMenu!='false' ? taskTags.add(href,icon,title) : null}","102","          <a href=\"${href}\" onclick=\"${attrs.onclick}\">","107","          <a href=\"${href}\" onclick=\"${attrs.onclick}\">"]}]}},"1e308c2a7457c5e9d5929b1de39328e2e27ab3b8":{"changes":{"changelog.html":"MODIFY"},"diff":{"changelog.html":[{"add":["69","  <li class=rfe>","70","    OS X installer now starts Jenkins upon system boot","71","    (<a href=\"https:\/\/github.com\/jenkinsci\/jenkins\/pull\/166\">pull request #166<\/a>)"],"delete":[]}]}},"c10c814b6e403c7588eaf805128f4e549369d06a":{"changes":{"changelog.html":"MODIFY"},"diff":{"changelog.html":[{"add":["69","  <li class=bug>","70","    <code>StringIndexOutOfBoundsException<\/code> in <code>PackageResult.findCorrespondingResult<\/code>.","71","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-17721\">issue 17721<\/a>)"],"delete":[]}]}},"5e4b7bcc36fbfff4c2cdeeea68390186ff9e6bb4":{"changes":{"core\/src\/main\/java\/hudson\/model\/RunParameterValue.java":"MODIFY","test\/src\/test\/java\/hudson\/model\/RunParameterDefinitionTest.java":"MODIFY","war\/src\/main\/webapp\/help\/parameter\/run-project.html":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/RunParameterValue.java":[{"add":["74","        env.put(name + \".jobName\", getJobName());   \/\/ undocumented, left for backward compatibility","75","        env.put(name + \"_JOBNAME\", getJobName());   \/\/ prefer this version","77","        env.put(name + \".number\" , getNumber ());   \/\/ same as above","78","        env.put(name + \"_NUMBER\" , getNumber ());"],"delete":["74","        env.put(name + \".jobName\", getJobName());","75","        env.put(name + \"_jobName\", getJobName());","77","        env.put(name + \".number\" , getNumber ());","78","        env.put(name + \"_number\" , getNumber ());"]}],"test\/src\/test\/java\/hudson\/model\/RunParameterDefinitionTest.java":[{"add":["62","        assertEquals(\"dir\/sub dir\/some project\", env.get(\"build_JOBNAME\"));","64","        assertEquals(\"2\", env.get(\"build_NUMBER\"));"],"delete":["62","        assertEquals(\"dir\/sub dir\/some project\", env.get(\"build_jobName\"));","64","        assertEquals(\"2\", env.get(\"build_number\"));"]}],"war\/src\/main\/webapp\/help\/parameter\/run-project.html":[{"add":["1","    Defines the job from which the user can pick runs. The last run will be the default.","2","    These parameters are exposed to build as environment variables:","3","<pre>","4","PARAMETER_NAME=<i>&lt;jenkins_url&gt;<\/i>\/job\/<i>&lt;job_name&gt;\/&lt;run_number&gt;<\/i>\/","5","PARAMETER_NAME_JOBNAME=<i>&lt;job_name&gt;<\/i>","6","PARAMETER_NAME_NUMBER=<i>&lt;run_number&gt;<\/i>","7","<\/pre>"],"delete":["1","    Defines the job from which the user can pick runs. The last run will be the default.<br\/>","2","    <br\/>","3","    These parameters are exposed to build as environment variables:<br\/>","4","    <br\/>","5","    PARAMETER_NAME=&lt;jenkins_url&gt;\/job\/&lt;job_name&gt;\/&lt;run_number\/<br\/>","6","    <br\/>","7","    PARAMETER_NAME.jobName=&lt;job_name&gt;<br\/>","8","    PARAMETER_NAME_jobName=&lt;job_name&gt;<br\/>","9","    <br\/>","10","    PARAMETER_NAME.number=&lt;run_number&gt;<br\/>","11","    PARAMETER_NAME_number=&lt;run_number&gt;"]}]}},"07923429f0ee80284f98d9a59d7691794bbfb5bc":{"changes":{"core\/src\/main\/java\/jenkins\/install\/InstallUtil.java":"MODIFY","core\/src\/main\/java\/jenkins\/model\/Jenkins.java":"MODIFY"},"diff":{"core\/src\/main\/java\/jenkins\/install\/InstallUtil.java":[{"add":["56","import java.util.logging.Level;","259","                        LOGGER.log(Level.FINE, \"discovered serialized lastVersion {0}\", lastVersion);"],"delete":[]}],"core\/src\/main\/java\/jenkins\/model\/Jenkins.java":[{"add":["3193","","3194","        if (initLevel == InitMilestone.COMPLETED) {","3195","            LOGGER.log(FINE, \"setting version {0} to {1}\", new Object[] {version, VERSION});","3196","            version = VERSION;","3197","        } else {","3198","            LOGGER.log(FINE, \"refusing to set version {0} to {1} during {2}\", new Object[] {version, VERSION, initLevel});","3199","        }"],"delete":["3193","        version = VERSION;"]}]}},"4f814c0a9f8e72384046015975f201f4f693abaf":{"changes":{"war\/pom.xml":"MODIFY"},"diff":{"war\/pom.xml":[{"add":["95","      <version>3.2<\/version>"],"delete":["95","      <version>3.1<\/version>"]}]}},"945d04aa876ba65b90d4c5d651eaab36190362c7":{"changes":{"core\/src\/main\/resources\/lib\/hudson\/executors.jelly":"MODIFY","changelog.html":"MODIFY"},"diff":{"core\/src\/main\/resources\/lib\/hudson\/executors.jelly":[{"add":["40","      <j:choose>","41","        <j:when test=\"${!c.offline or (c.offline and !e.idle)}\">","42","          <tr>","43","            <td class=\"pane\" align=\"right\" style=\"vertical-align: top\">","44","              ${name}","46","            <j:choose>","47","              <j:when test=\"${!e.alive}\">","48","                <td class=\"pane\">","49","                  <a href=\"${rootURL}\/${c.url}${url}\/causeOfDeath\">","50","                    <div class=\"error\">${%Dead} (!)<\/div>","51","                  <\/a>","52","                <\/td>","53","                <td class=\"pane\"\/>","54","              <\/j:when>","55","              <j:when test=\"${e.idle}\">","56","                <td class=\"pane\">","58","                    <j:when test=\"${c.offline}\">","59","                      <a href=\"${rootURL}\/${c.url}\">${%Offline}<\/a>","62","                      ${%Idle}","65","                <\/td>","66","                <td class=\"pane\"\/>","67","              <\/j:when>","68","              <j:otherwise>","69","                <!-- not actually optional, but it helps with backward compatibility -->","70","                <j:set var=\"executor\" value=\"${e}\" \/>","71","                <st:include it=\"${e.currentExecutable}\" page=\"executorCell.jelly\" optional=\"true\">","72","                  <td class=\"pane\">","73","                    <div style=\"white-space: normal\">${%Building}","74","                      <j:set var=\"exe\" value=\"${e.currentExecutable}\" \/>","75","                      <j:invokeStatic var=\"exeparent\"","76","                         className=\"hudson.model.queue.Executables\" method=\"getParentOf\">","77","                        <j:arg type=\"hudson.model.Queue$Executable\" value=\"${exe}\" \/>","78","                      <\/j:invokeStatic>","79","                      <j:choose>","80","                        <j:when test=\"${h.hasPermission(exeparent,exeparent.READ)}\">","81","                          <a href=\"${rootURL}\/${exeparent.url}\">${exeparent.fullDisplayName}<\/a>&#160;<a href=\"${rootURL}\/${exe.url}\">#${exe.number}<\/a>","82","                          <t:buildProgressBar build=\"${exe}\" executor=\"${executor}\"\/>","83","                        <\/j:when>","84","                        <j:otherwise>","85","                          <span>${%Unknown Task}<\/span>","86","                        <\/j:otherwise>","87","                      <\/j:choose>","88","                    <\/div>","89","                  <\/td>","90","                <\/st:include>","91","                <td class=\"pane\" align=\"center\" valign=\"middle\">","92","                  <j:if test=\"${e.hasStopPermission()}\">","93","                    <a href=\"${rootURL}\/${c.url}${url}\/stop\"><img src=\"${imagesURL}\/16x16\/stop.gif\" alt=\"${%terminate this build}\" \/><\/a>","94","                  <\/j:if>","95","                <\/td>","96","              <\/j:otherwise>","97","            <\/j:choose>","98","          <\/tr>","99","        <\/j:when>","100","      <\/j:choose>","132","        <j:forEach var=\"e\" items=\"${c.executors}\" varStatus=\"eloop\">","133","          <local:executor name=\"${eloop.index+1}\" url=\"executors\/${eloop.index}\" \/>","134","        <\/j:forEach>","135","        <j:forEach var=\"e\" items=\"${c.oneOffExecutors}\" varStatus=\"eloop\">","136","          <local:executor name=\"\" url=\"oneOffExecutors\/${eloop.index}\" \/>","137","        <\/j:forEach>"],"delete":["40","      <tr>","41","        <td class=\"pane\" align=\"right\" style=\"vertical-align: top\">","42","          ${name}","43","        <\/td>","44","        <j:choose>","45","          <j:when test=\"${!e.alive}\">","46","            <td class=\"pane\">","47","              <a href=\"${rootURL}\/${c.url}${url}\/causeOfDeath\">","48","                <div class=\"error\">${%Dead} (!)<\/div>","49","              <\/a>","51","            <td class=\"pane\"\/>","52","          <\/j:when>","53","          <j:when test=\"${e.idle}\">","54","            <td class=\"pane\">","55","              <j:choose>","56","                <j:when test=\"${c.offline}\">","57","                  <a href=\"${rootURL}\/${c.url}\">${%Offline}<\/a>","58","                <\/j:when>","59","                <j:otherwise>","60","                  ${%Idle}","61","                <\/j:otherwise>","62","              <\/j:choose>","63","            <\/td>","64","            <td class=\"pane\"\/>","65","          <\/j:when>","66","          <j:otherwise>","67","            <!-- not actually optional, but it helps with backward compatibility -->","68","            <j:set var=\"executor\" value=\"${e}\" \/>","69","            <st:include it=\"${e.currentExecutable}\" page=\"executorCell.jelly\" optional=\"true\">","70","              <td class=\"pane\">","71","                <div style=\"white-space: normal\">${%Building}","72","                  <j:set var=\"exe\" value=\"${e.currentExecutable}\" \/>","73","                  <j:invokeStatic var=\"exeparent\"","74","                     className=\"hudson.model.queue.Executables\" method=\"getParentOf\">","75","                    <j:arg type=\"hudson.model.Queue$Executable\" value=\"${exe}\" \/>","76","                  <\/j:invokeStatic>","78","                    <j:when test=\"${h.hasPermission(exeparent,exeparent.READ)}\">","79","                      <a href=\"${rootURL}\/${exeparent.url}\">${exeparent.fullDisplayName}<\/a>&#160;<a href=\"${rootURL}\/${exe.url}\">#${exe.number}<\/a>","80","                      <t:buildProgressBar build=\"${exe}\" executor=\"${executor}\"\/>","83","                      <span>${%Unknown Task}<\/span>","86","                <\/div>","87","              <\/td>","88","            <\/st:include>","89","            <td class=\"pane\" align=\"center\" valign=\"middle\">","90","              <j:if test=\"${e.hasStopPermission()}\">","91","                <a href=\"${rootURL}\/${c.url}${url}\/stop\"><img src=\"${imagesURL}\/16x16\/stop.gif\" alt=\"${%terminate this build}\" \/><\/a>","92","              <\/j:if>","93","            <\/td>","94","          <\/j:otherwise>","95","        <\/j:choose>","96","      <\/tr>","128","        <j:choose>","129","          <j:when test=\"${!c.offline}\">","130","            <j:forEach var=\"e\" items=\"${c.executors}\" varStatus=\"eloop\">","131","              <local:executor name=\"${eloop.index+1}\" url=\"executors\/${eloop.index}\" \/>","132","            <\/j:forEach>","133","            <j:forEach var=\"e\" items=\"${c.oneOffExecutors}\" varStatus=\"eloop\">","134","              <local:executor name=\"\" url=\"oneOffExecutors\/${eloop.index}\" \/>","135","            <\/j:forEach>","136","          <\/j:when>","137","        <\/j:choose>"]}],"changelog.html":[{"add":["53","  <li class=bug>","54","    Fix temporarily offline slaves not showing active jobs","55","    (<a href=\"http:\/\/issues.hudson-ci.org\/browse\/HUDSON-8546\">issue 8546<\/a>)"],"delete":[]}]}},"7619aeda1ab4b9d63f73f4548d181882b622c063":{"changes":{"core\/src\/main\/resources\/lib\/form\/advanced\/advanced.js":"MODIFY","test\/src\/test\/java\/lib\/form\/AdvancedButtonTest.java":"MODIFY","test\/src\/test\/resources\/lib\/form\/AdvancedButtonTest\/testSectionInsideOfAdvanced.jelly":"ADD"},"diff":{"core\/src\/main\/resources\/lib\/form\/advanced\/advanced.js":[{"add":["5","            var container = link.next(\"table.advancedBody\").down(); \/\/ TABLE -> TBODY","27","});"],"delete":["5","            var container = link.next().down(); \/\/ TABLE -> TBODY","27","});"]}],"test\/src\/test\/java\/lib\/form\/AdvancedButtonTest.java":[{"add":["8","import org.jvnet.hudson.test.Issue;","35","","36","    @Issue(\"JENKINS-14632\")","37","    public void testSectionInsideOfAdvanced() throws Exception {","38","        HtmlPage p = createWebClient().goTo(\"self\/testSectionInsideOfAdvanced\");","39","        HtmlForm f = p.getFormByName(\"config\");","40","        assertFalse(f.getInputByName(\"b\").isDisplayed());","41","        HtmlFormUtil.getButtonByCaption(f, \"Advanced...\").click();","42","        assertTrue(f.getInputByName(\"b\").isDisplayed());","43","    }","44","}"],"delete":["34","}"]}],"test\/src\/test\/resources\/lib\/form\/AdvancedButtonTest\/testSectionInsideOfAdvanced.jelly":[{"add":[],"delete":[]}]}},"bf7f14b165f235fed69ebabec0a852bff1874965":{"changes":{"core\/src\/main\/java\/hudson\/Functions.java":"MODIFY","core\/src\/main\/resources\/hudson\/Messages.properties":"MODIFY","core\/src\/main\/java\/hudson\/model\/Executor.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/Functions.java":[{"add":["153","import javax.annotation.CheckForNull;","1375","    \/**","1376","     * Gets info about the specified {@link Throwable}.","1377","     * @param t Input {@link Throwable}","1378","     * @return If {@link Throwable} is not null, a summary info with the ","1379","     *      stacktrace will be returned. Otherwise, the method returns a default","1380","     *      &quot;No exception details&quot; string.","1381","     *\/","1382","    public static String printThrowable(@CheckForNull Throwable t) {","1383","        if (t == null) {","1384","            return Messages.Functions_NoExceptionDetails();","1385","        }"],"delete":["1374","    public static String printThrowable(Throwable t) {"]}],"core\/src\/main\/resources\/hudson\/Messages.properties":[{"add":["69","ProxyConfiguration.Success=Success","70","","71","Functions.NoExceptionDetails=No Exception details"],"delete":["69","ProxyConfiguration.Success=Success"]}],"core\/src\/main\/java\/hudson\/model\/Executor.java":[{"add":["382","    public @CheckForNull Throwable getCauseOfDeath() {"],"delete":["382","    public Throwable getCauseOfDeath() {"]}]}},"24c31d138fe7b9ff14870b921220bdf709af20cc":{"changes":{"core\/src\/main\/java\/jenkins\/model\/Jenkins.java":"MODIFY"},"diff":{"core\/src\/main\/java\/jenkins\/model\/Jenkins.java":[{"add":["151","import hudson.slaves.EphemeralNode;","2396","                \/\/ JENKINS-8043: some slaves (eg. swarm slaves) are not saved into the config file","2397","                \/\/ and will get overwritten when reloading. Make a backup copy now, and re-add them later","2398","                NodeList oldSlaves = slaves;","2399","                ","2416","","2417","                \/\/ JENKINS-8043: re-add the slaves which were not saved into the config file","2418","                \/\/ and are now missing, but still connected.","2419","                if (oldSlaves != null) {","2420","                    ArrayList<Node> newSlaves = new ArrayList<Node>(slaves);","2421","                    for (Node n: oldSlaves) {","2422","                        if (n instanceof EphemeralNode) {","2423","                            if(!newSlaves.contains(n)) {","2424","                                newSlaves.add(n);","2425","                            }","2426","                        }","2427","                    }","2428","                    setNodes(newSlaves);","2429","                }"],"delete":["214","import org.kohsuke.accmod.Restricted;","215","import org.kohsuke.accmod.restrictions.DoNotUse;","216","import org.kohsuke.accmod.restrictions.NoExternalUse;"]}]}},"9912692b5b53fb7bf71209ac9e79f3f506b45bcc":{"changes":{"pom.xml":"MODIFY","war\/pom.xml":"MODIFY"},"diff":{"pom.xml":[{"add":["103","    <remoting.version>4.2<\/remoting.version>"],"delete":["103","    <remoting.version>4.0.1<\/remoting.version>"]}],"war\/pom.xml":[{"add":["117","      <version>1.7<\/version>"],"delete":["117","      <version>1.6<\/version>"]}]}},"48c95f5aee999a7fbf6d30f3a1e92eabf3723a02":{"changes":{"core\/src\/main\/java\/jenkins\/security\/ClassFilterImpl.java":"MODIFY"},"diff":{"core\/src\/main\/java\/jenkins\/security\/ClassFilterImpl.java":[{"add":["159","                    LOGGER.warning(\"JENKINS-49795: attempt to (de-)serialize anonymous \" + c + \" in \" + location);","161","                    LOGGER.warning(\"JENKINS-49795: attempt to (de-)serialize local \" + c + \" in \" + location);","163","                    LOGGER.warning(\"JENKINS-49795: attempt to (de-)serialize synthetic \" + c + \" in \" + location);"],"delete":["159","                    LOGGER.warning(\"JENKINS-49573: attempt to (de-)serialize anonymous \" + c + \" in \" + location);","161","                    LOGGER.warning(\"JENKINS-49573: attempt to (de-)serialize local \" + c + \" in \" + location);","163","                    LOGGER.warning(\"JENKINS-49573: attempt to (de-)serialize synthetic \" + c + \" in \" + location);"]}]}},"a08b16d281d9f7a34f3cffaefdc21a941d71aebf":{"changes":{"rpm\/SPECS\/jenkins.spec":"MODIFY"},"diff":{"rpm\/SPECS\/jenkins.spec":[{"add":["147","* Sat Apr 19 2014 mbarr@mbarr.net","148","- Removed the jenkins.repo installation.  Per https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-22690","149",""],"delete":["14","Source4:\tjenkins.repo","86","%__install -D -m0644 \"%{SOURCE4}\" \"%{buildroot}\/etc\/yum.repos.d\/jenkins.repo\"","144","%config(noreplace) \/etc\/yum.repos.d\/jenkins.repo"]}]}},"db2ac714552bfc55260398967978ffe094998e5d":{"changes":{"core\/pom.xml":"MODIFY"},"diff":{"core\/pom.xml":[{"add":["290","      <version>1.66<\/version>"],"delete":["290","      <version>1.65<\/version>"]}]}},"ad93581104dfe58cf0373322166893a614c530df":{"changes":{"core\/pom.xml":"MODIFY"},"diff":{"core\/pom.xml":[{"add":["44","    <stapler.version>1.222<\/stapler.version>"],"delete":["44","    <stapler.version>1.221<\/stapler.version>"]}]}},"de740c756f7de7fd225919342fa01796367abf00":{"changes":{"test\/src\/test\/java\/hudson\/cli\/CLIActionTest.java":"MODIFY","core\/src\/main\/java\/hudson\/cli\/CliCrumbExclusion.java":"ADD"},"diff":{"test\/src\/test\/java\/hudson\/cli\/CLIActionTest.java":[{"add":[],"delete":["91","        settings = wc.addCrumb(settings);"]}],"core\/src\/main\/java\/hudson\/cli\/CliCrumbExclusion.java":[{"add":[],"delete":[]}]}},"23daeeec8abe0630c2534fc44769eb86a4425dcd":{"changes":{"core\/pom.xml":"MODIFY","changelog.html":"MODIFY"},"diff":{"core\/pom.xml":[{"add":["679","      <version>1.5<\/version>"],"delete":["679","      <version>1.4<\/version>"]}],"changelog.html":[{"add":["78","  <li class=rfe>","79","    Memory space monitor now works for Mac OS X Snow Leopard","80","    (<a href=\"http:\/\/issues.jenkins-ci.org\/browse\/JENKINS-9374\">issue 9374<\/a>)"],"delete":[]}]}},"846ec90dd396416d70a50086a357950d1d9e2bcf":{"changes":{"changelog.html":"MODIFY"},"diff":{"changelog.html":[{"add":["74","  <li class=\"bug\">","75","    Update JNA library to 4.2.1 in order to integrate fixes for linux-ppc64 and linux-arm platforms.","76","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-15792\">issue 15792<\/a>)"],"delete":[]}]}},"f0a88e65be79628b4cd407b0d7576d7a1abcdd9e":{"changes":{"test\/src\/test\/groovy\/lib\/form\/TextAreaTest.groovy":"MODIFY"},"diff":{"test\/src\/test\/groovy\/lib\/form\/TextAreaTest.groovy":[{"add":["75","    @Issue(\"JENKINS-27505\")","78","        T1:{","79","            def TEXT_TO_TEST = \"some\\nvalue\\n\";","80","            def p = j.createFreeStyleProject();","81","            def target = new TextareaTestBuilder(TEXT_TO_TEST);","82","            p.buildersList.add(target);","83","            j.configRoundtrip(p);","84","            j.assertEqualDataBoundBeans(target, p.getBuildersList().get(TextareaTestBuilder.class));","85","        }","86","        ","87","        \/\/ test for a textarea beginning with a empty line.","88","        T2:{","89","            def TEXT_TO_TEST = \"\\nbegin\\n\\nwith\\nempty\\nline\\n\\n\";","90","            def p = j.createFreeStyleProject();","91","            def target = new TextareaTestBuilder(TEXT_TO_TEST);","92","            p.buildersList.add(target);","93","            j.configRoundtrip(p);","94","            j.assertEqualDataBoundBeans(target, p.getBuildersList().get(TextareaTestBuilder.class));","95","        }","96","        ","97","        \/\/ test for a textarea beginning with two empty lines.","98","        T3:{","99","            def TEXT_TO_TEST = \"\\n\\nbegin\\n\\nwith\\ntwo\\nempty\\nline\\n\\n\";","100","            def p = j.createFreeStyleProject();","101","            def target = new TextareaTestBuilder(TEXT_TO_TEST);","102","            p.buildersList.add(target);","103","            j.configRoundtrip(p);","104","            j.assertEqualDataBoundBeans(target, p.getBuildersList().get(TextareaTestBuilder.class));","105","        }"],"delete":["77","        def TEXT_TO_TEST = \"some\\nvalue\\n\";","78","        def p = j.createFreeStyleProject();","79","        def target = new TextareaTestBuilder(TEXT_TO_TEST);","80","        p.buildersList.add(target);","81","        j.configRoundtrip(p);","82","        j.assertEqualDataBoundBeans(target, p.getBuildersList().get(TextareaTestBuilder.class));","83","    }","84","","85","    @Issue(\"JENKINS-27505\")","86","    @Test","87","    public void testTextBeginningWithEmptyLine() {","88","        def TEXT_TO_TEST = \"\\nbegin\\n\\nwith\\nempty\\nline\\n\\n\";","89","        def p = j.createFreeStyleProject();","90","        def target = new TextareaTestBuilder(TEXT_TO_TEST);","91","        p.buildersList.add(target);","92","        j.configRoundtrip(p);","93","        j.assertEqualDataBoundBeans(target, p.getBuildersList().get(TextareaTestBuilder.class));","94","    }","95","","96","    @Issue(\"JENKINS-27505\")","97","    @Test","98","    public void testTextBeginningWithTwoEmptyLines() {","99","        def TEXT_TO_TEST = \"\\n\\nbegin\\n\\nwith\\ntwo\\nempty\\nline\\n\\n\";","100","        def p = j.createFreeStyleProject();","101","        def target = new TextareaTestBuilder(TEXT_TO_TEST);","102","        p.buildersList.add(target);","103","        j.configRoundtrip(p);","104","        j.assertEqualDataBoundBeans(target, p.getBuildersList().get(TextareaTestBuilder.class));"]}]}},"f00979aea4d46ddeb58718f1d91c8bb0c64444d1":{"changes":{"core\/src\/main\/java\/hudson\/model\/Job.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/AbstractProject.java":"MODIFY","core\/src\/main\/resources\/hudson\/model\/Job\/rename.properties":"MODIFY","core\/src\/main\/resources\/hudson\/model\/Job\/rename.jelly":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/Job.java":[{"add":["213","     * Returns true if a build of this project is in progress.","214","     *\/","215","    public boolean isBuilding() {","216","        RunT b = getLastBuild();","217","        return b!=null && b.isBuilding();","218","    }","219","","220","    \/**","1205","        if (isBuilding()) {","1206","            \/\/ redirect to page explaining that we can't rename now","1207","            rsp.sendRedirect(\"rename?newName=\" + newName);","1208","            return;","1209","        }","1210",""],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/AbstractProject.java":[{"add":[],"delete":["608","     * Returns true if a build of this project is in progress.","609","     *\/","610","    public boolean isBuilding() {","611","        R b = getLastBuild();","612","        return b!=null && b.isBuilding();","613","    }","614","","615","    \/**"]}],"core\/src\/main\/resources\/hudson\/model\/Job\/rename.properties":[{"add":["22","noRenameWhileBuilding=Unable to rename a job while it is building.","23","configWasSaved=All other configuration options were saved.","26","No=No"],"delete":["24","No=No"]}],"core\/src\/main\/resources\/hudson\/model\/Job\/rename.jelly":[{"add":["27","    <st:include page=\"sidepanel.jelly\" \/>","28","    <l:main-panel>","29","      <j:choose>","30","        <j:when test=\"${it.isBuilding()}\">","31","          ${%noRenameWhileBuilding}","32","          <j:if test=\"${request.referer.endsWith('\/configure')}\">","33","            <br\/> ${%configWasSaved}","34","          <\/j:if>","35","        <\/j:when>","36","        <j:otherwise>","37","          <j:set var=\"newName\" value=\"${request.getParameter('newName')}\" \/>","38","          <form method=\"get\" action=\"doRename\">","39","            ${%description(it.name, newName)}","40","            <input type=\"hidden\" name=\"newName\" value=\"${newName}\" \/>","41","            <f:submit value=\"${%Yes}\" \/>","42","            <input type=\"button\" value=\"${%No}\" onclick=\"javascript:history.back()\" class=\"yui-button\" \/>","43","          <\/form>","44","        <\/j:otherwise>","45","      <\/j:choose>","48","<\/j:jelly>"],"delete":["27","\t\t<st:include page=\"sidepanel.jelly\" \/>","28","\t\t<l:main-panel>","29","      <j:set var=\"newName\" value=\"${request.getParameter('newName')}\" \/>","30","      <form method=\"get\" action=\"doRename\">","31","\t\t    ${%description(it.name, newName)}","32","        <input type=\"hidden\" name=\"newName\" value=\"${newName}\" \/>","33","        <f:submit value=\"${%Yes}\" \/>","34","        <input type=\"button\" value=\"${%No}\" onclick=\"javascript:history.back()\" class=\"yui-button\" \/>","35","      <\/form>","38","<\/j:jelly>"]}]}},"92147c3597308bc05e6448ccc41409fcc7c05fd7":{"changes":{"core\/src\/main\/java\/hudson\/slaves\/AbstractCloudSlave.java":"MODIFY","core\/src\/main\/java\/hudson\/slaves\/NodeProvisioner.java":"MODIFY","core\/src\/main\/java\/hudson\/slaves\/SlaveComputer.java":"MODIFY","core\/src\/main\/java\/jenkins\/model\/Nodes.java":"ADD","core\/src\/main\/java\/jenkins\/util\/AtmostOneTaskExecutor.java":"MODIFY","core\/src\/main\/java\/hudson\/Functions.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/ResourceController.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/Computer.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/Node.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/Queue.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/AbstractCIBase.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/Hudson.java":"MODIFY","core\/src\/main\/resources\/hudson\/model\/Messages.properties":"MODIFY","core\/src\/main\/resources\/lib\/hudson\/executors.jelly":"MODIFY","core\/src\/main\/java\/hudson\/slaves\/RetentionStrategy.java":"MODIFY","core\/src\/main\/java\/jenkins\/model\/Jenkins.java":"MODIFY","core\/src\/main\/java\/hudson\/slaves\/ComputerRetentionWork.java":"MODIFY","core\/src\/main\/resources\/lib\/layout\/layout.jelly":"MODIFY","core\/src\/main\/java\/hudson\/model\/Executor.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/slaves\/AbstractCloudSlave.java":[{"add":["25","import hudson.model.Computer;","60","        final Computer computer = toComputer();","61","        if (computer != null) {","62","            computer.recordTermination();","63","        }"],"delete":[]}],"core\/src\/main\/java\/hudson\/slaves\/NodeProvisioner.java":[{"add":["37","import java.util.concurrent.Callable;","45","import java.util.concurrent.locks.Lock;","46","import java.util.concurrent.locks.ReadWriteLock;","47","import java.util.concurrent.locks.ReentrantLock;","48","import java.util.concurrent.locks.ReentrantReadWriteLock;","127","    @GuardedBy(\"#provisioningLock\")","130","    private final Lock provisioningLock = new ReentrantLock();","131","","132","    @GuardedBy(\"#provisioningLock\")","133","    private StrategyState provisioningState = null;","134","","160","        provisioningLock.lock();","161","        try {","163","        } finally {","164","            provisioningLock.unlock();","189","    private void update() {","190","        provisioningLock.lock();","191","        try {","192","            lastSuggestedReview = System.currentTimeMillis();","193","            Queue.withLock(new Runnable() {","194","                @Override","195","                public void run() {","196","                    Jenkins jenkins = Jenkins.getInstance();","197","                    \/\/ clean up the cancelled launch activity, then count the # of executors that we are about to","198","                    \/\/ bring up.","200","                    int plannedCapacitySnapshot = 0;","201","                    List<PlannedNode> completedLaunches = new ArrayList<PlannedNode>();","203","                    for (Iterator<PlannedNode> itr = pendingLaunches.iterator(); itr.hasNext(); ) {","204","                        PlannedNode f = itr.next();","205","                        if (f.future.isDone()) {","206","                            completedLaunches.add(f);","207","                            itr.remove();","208","                        } else {","209","                            plannedCapacitySnapshot += f.numExecutors;","210","                        }","211","                    }","212","","213","                    for (PlannedNode f : completedLaunches) {","214","                        try {","215","                            Node node = f.future.get();","216","                            for (CloudProvisioningListener cl : CloudProvisioningListener.all()) {","217","                                cl.onComplete(f, node);","218","                            }","219","","220","                            jenkins.addNode(node);","221","                            LOGGER.log(Level.INFO,","222","                                    \"{0} provisioning successfully completed. We have now {1,number,integer} computer\"","223","                                            + \"(s)\",","224","                                    new Object[]{f.displayName, jenkins.getComputers().length});","225","                        } catch (InterruptedException e) {","226","                            throw new AssertionError(e); \/\/ since we confirmed that the future is already done","227","                        } catch (ExecutionException e) {","228","                            LOGGER.log(Level.WARNING, \"Provisioned slave \" + f.displayName + \" failed to launch\",","229","                                    e.getCause());","230","                            for (CloudProvisioningListener cl : CloudProvisioningListener.all()) {","231","                                cl.onFailure(f, e.getCause());","232","                            }","233","                        } catch (IOException e) {","234","                            LOGGER.log(Level.WARNING, \"Provisioned slave \" + f.displayName + \" failed to launch\", e);","235","                            for (CloudProvisioningListener cl : CloudProvisioningListener.all()) {","236","                                cl.onFailure(f, e);","237","                            }","238","                        }","239","","240","                        f.spent();","241","                    }","242","","243","                    float plannedCapacity = plannedCapacitySnapshot;","244","                    plannedCapacitiesEMA.update(plannedCapacity);","245","","246","                    int idleSnapshot = stat.computeIdleExecutors();","247","                    int queueLengthSnapshot = stat.computeQueueLength();","248","","249","                    if (queueLengthSnapshot <= idleSnapshot) {","250","                        LOGGER.log(Level.FINE,","251","                                \"Queue length {0} is less than the idle capacity {1}. No provisioning strategy \"","252","                                        + \"required\",","253","                                new Object[]{queueLengthSnapshot, idleSnapshot});","254","                        provisioningState = null;","255","                    } else {","256","                        provisioningState = new StrategyState(queueLengthSnapshot, label, idleSnapshot,","257","                                stat.computeTotalExecutors(),","258","                                plannedCapacitySnapshot);","259","                    }","260","                }","261","            });","262","","263","            if (provisioningState != null) {","264","                List<Strategy> strategies = Jenkins.getInstance().getExtensionList(Strategy.class);","265","                for (Strategy strategy : strategies.isEmpty()","266","                        ? Arrays.<Strategy>asList(new StandardStrategyImpl())","267","                        : strategies) {","268","                    LOGGER.log(Level.FINER, \"Consulting {0} provisioning strategy with state {1}\",","269","                            new Object[]{strategy, provisioningState});","270","                    if (StrategyDecision.PROVISIONING_COMPLETED == strategy.apply(provisioningState)) {","271","                        LOGGER.log(Level.FINER, \"Provisioning strategy {0} declared provisioning complete\",","272","                                strategy);","273","                        break;","274","                    }","277","        } finally {","278","            provisioningLock.unlock();","415","        public int getAdditionalPlannedCapacity() {","416","            provisioningLock.lock();","417","            try {","418","                return additionalPlannedCapacity;","419","            } finally {","420","                provisioningLock.unlock();","421","            }","487","            provisioningLock.lock();","488","            try {","490","                if (additionalPlannedCapacity > 0) {","491","                        this.additionalPlannedCapacity += additionalPlannedCapacity;","493","            } finally {","494","                provisioningLock.unlock();"],"delete":["122","    @GuardedBy(\"self\")","150","        synchronized (pendingLaunches) {","176","    private synchronized void update() {","177","        Jenkins jenkins = Jenkins.getInstance();","178","        lastSuggestedReview = System.currentTimeMillis();","180","        \/\/ clean up the cancelled launch activity, then count the # of executors that we are about to bring up.","181","        int plannedCapacitySnapshot = 0;","182","        List<PlannedNode> completedLaunches = new ArrayList<PlannedNode>();","184","        synchronized (pendingLaunches) {","185","            for (Iterator<PlannedNode> itr = pendingLaunches.iterator(); itr.hasNext(); ) {","186","                PlannedNode f = itr.next();","187","                if (f.future.isDone()) {","188","                    completedLaunches.add(f);","189","                    itr.remove();","190","                } else {","191","                    plannedCapacitySnapshot += f.numExecutors;","194","        }","195","","196","        for (PlannedNode f : completedLaunches) {","197","            try {","198","                Node node = f.future.get();","199","                for (CloudProvisioningListener cl : CloudProvisioningListener.all()) {","200","                    cl.onComplete(f, node);","201","                }","202","","203","                jenkins.addNode(node);","204","                LOGGER.log(Level.INFO,","205","                        \"{0} provisioning successfully completed. We have now {1,number,integer} computer(s)\",","206","                        new Object[]{f.displayName, jenkins.getComputers().length});","207","            } catch (InterruptedException e) {","208","                throw new AssertionError(e); \/\/ since we confirmed that the future is already done","209","            } catch (ExecutionException e) {","210","                LOGGER.log(Level.WARNING, \"Provisioned slave \" + f.displayName + \" failed to launch\", e.getCause());","211","                for (CloudProvisioningListener cl : CloudProvisioningListener.all()) {","212","                    cl.onFailure(f, e.getCause());","213","                }","214","            } catch (IOException e) {","215","                LOGGER.log(Level.WARNING, \"Provisioned slave \" + f.displayName + \" failed to launch\", e);","216","                for (CloudProvisioningListener cl : CloudProvisioningListener.all()) {","217","                    cl.onFailure(f, e);","218","                }","219","            }","220","","221","            f.spent();","222","        }","223","","224","        float plannedCapacity = plannedCapacitySnapshot;","225","        plannedCapacitiesEMA.update(plannedCapacity);","226","","227","        int idleSnapshot = stat.computeIdleExecutors();","228","        int queueLengthSnapshot = stat.computeQueueLength();","229","","230","        if (queueLengthSnapshot <= idleSnapshot) {","231","            LOGGER.log(Level.FINE,","232","                    \"Queue length {0} is less than the idle capacity {1}. No provisioning strategy required\",","233","                    new Object[]{queueLengthSnapshot, idleSnapshot});","234","        } else {","235","            StrategyState state =","236","                    new StrategyState(queueLengthSnapshot, label, idleSnapshot, stat.computeTotalExecutors(),","237","                            plannedCapacitySnapshot);","238","            List<Strategy> strategies = Jenkins.getInstance().getExtensionList(Strategy.class);","239","            for (Strategy strategy : strategies.isEmpty()","240","                    ? Arrays.<Strategy>asList(new StandardStrategyImpl())","241","                    : strategies) {","242","                LOGGER.log(Level.FINER, \"Consulting {0} provisioning strategy with state {1}\",","243","                        new Object[]{strategy, state});","244","                if (StrategyDecision.PROVISIONING_COMPLETED == strategy.apply(state)) {","245","                    LOGGER.log(Level.FINER, \"Provisioning strategy {0} declared provisioning complete\",","246","                            strategy);","247","                    break;","248","                }","249","            }","386","        public synchronized int getAdditionalPlannedCapacity() {","387","            return additionalPlannedCapacity;","453","            synchronized (pendingLaunches) {","455","            }","456","            if (additionalPlannedCapacity > 0) {","457","                synchronized (this) {","458","                    this.additionalPlannedCapacity += additionalPlannedCapacity;"]}],"core\/src\/main\/java\/hudson\/slaves\/SlaveComputer.java":[{"add":["651","    protected void setNode(final Node node) {","659","            if (node instanceof Slave) {","660","                Queue.withLock(new Runnable() {","661","                    @Override","662","                    public void run() {","663","                        ((Slave)node).getRetentionStrategy().check(SlaveComputer.this);","664","                    }","665","                });","666","            } else {","668","            }"],"delete":["651","    protected void setNode(Node node) {","659","            if (node instanceof Slave)","660","                ((Slave)node).getRetentionStrategy().check(this);","661","            else"]}],"core\/src\/main\/java\/jenkins\/model\/Nodes.java":[{"add":[],"delete":[]}],"core\/src\/main\/java\/jenkins\/util\/AtmostOneTaskExecutor.java":[{"add":["4","import hudson.util.DaemonThreadFactory;","5","import hudson.util.NamingThreadFactory;","67","        this(new AtmostOneThreadExecutor(new NamingThreadFactory(","68","                        new DaemonThreadFactory(),","69","                        String.format(\"AtmostOneTaskExecutor[%s]\", task)","70","                )),","71","                task","72","        );"],"delete":["65","        this(new AtmostOneThreadExecutor(),task);"]}],"core\/src\/main\/java\/hudson\/Functions.java":[{"add":["30","import hudson.init.InitMilestone;","204","","205","    public static boolean isExtensionsAvailable() {","206","        final Jenkins jenkins = Jenkins.getInstance();","207","        return jenkins == null ? false : jenkins.getInitLevel().compareTo(InitMilestone.EXTENSIONS_AUGMENTED) >= 0;","208","    }","209",""],"delete":["203","    "]}],"core\/src\/main\/java\/hudson\/model\/ResourceController.java":[{"add":["31","import java.util.concurrent.Callable;","77","    public void execute(@Nonnull Runnable task, final ResourceActivity activity ) throws InterruptedException {","78","        final ResourceList resources = activity.getResourceList();","79","        _withLock(new Runnable() {","80","            @Override","81","            public void run() {","82","                while(inUse.isCollidingWith(resources))","83","                    try {","84","                        \/\/ TODO revalidate the resource list after re-acquiring lock, for now we just let the build fail","85","                        _await();","86","                    } catch (InterruptedException e) {","87","                        throw new RuntimeException(e);","88","                    }","90","                \/\/ we have a go","91","                inProgress.add(activity);","92","                inUse = ResourceList.union(inUse,resources);","93","            }","94","        });","99","            _withLock(new Runnable() {","100","                @Override","101","                public void run() {","102","                    inProgress.remove(activity);","103","                    inUse = ResourceList.union(resourceView);","104","                    _signalAll();","105","                }","106","            });","119","    public boolean canRun(final ResourceList resources) {","120","        try {","121","            return _withLock(new Callable<Boolean>() {","122","                @Override","123","                public Boolean call() {","124","                    return !inUse.isCollidingWith(resources);","125","                }","126","            });","127","        } catch (Exception e) {","128","            throw new IllegalStateException(\"Inner callable does not throw exception\");","129","        }","140","    public Resource getMissingResource(final ResourceList resources) {","141","        try {","142","            return _withLock(new Callable<Resource>() {","143","                @Override","144","                public Resource call() {","145","                    return resources.getConflict(inUse);","146","                }","147","            });","148","        } catch (Exception e) {","149","            throw new IllegalStateException(\"Inner callable does not throw exception\");","150","        }","165","","166","    protected void _await() throws InterruptedException {","167","        wait();","168","    }","169","","170","    protected void _signalAll() {","171","        notifyAll();","172","    }","173","","174","    protected void _withLock(Runnable runnable) {","175","        synchronized (this) {","176","            runnable.run();","177","        }","178","    }","179","","180","    protected <V> V _withLock(java.util.concurrent.Callable<V> callable) throws Exception {","181","        synchronized (this) {","182","            return callable.call();","183","        }","184","    }"],"delete":["76","    public void execute(@Nonnull Runnable task, ResourceActivity activity ) throws InterruptedException {","77","        ResourceList resources = activity.getResourceList();","78","        synchronized(this) {","79","            while(inUse.isCollidingWith(resources))","80","                wait();","82","            \/\/ we have a go","83","            inProgress.add(activity);","84","            inUse = ResourceList.union(inUse,resources);","85","        }","90","            synchronized(this) {","91","                inProgress.remove(activity);","92","                inUse = ResourceList.union(resourceView);","93","                notifyAll();","94","            }","107","    public synchronized boolean canRun(ResourceList resources) {","108","        return !inUse.isCollidingWith(resources);","119","    public synchronized Resource getMissingResource(ResourceList resources) {","120","        return resources.getConflict(inUse);"]}],"core\/src\/main\/java\/hudson\/model\/Computer.java":[{"add":["178","    private transient final List<RuntimeException> terminatedBy = Collections.synchronizedList(new ArrayList","179","            <RuntimeException>());","180","","181","    public void recordTermination() {","182","        try {","183","            throw new RuntimeException(String.format(\"Termination requested by %s\", Thread.currentThread()));","184","        } catch (RuntimeException e) {","185","            terminatedBy.add(e);","186","        }","187","    }","188","","189","    public List<RuntimeException> getTerminatedBy() {","190","        return new ArrayList<RuntimeException>(terminatedBy);","191","    }","192","","421","        recordTermination();","437","        recordTermination();","827","    public List<DisplayExecutor> getDisplayExecutors() {","828","        List<DisplayExecutor> result = new ArrayList<DisplayExecutor>(executors.size()+oneOffExecutors.size());","829","        int index = 0;","830","        for (Executor e: executors) {","831","            result.add(new DisplayExecutor(Integer.toString(index+1), String.format(\"executors\/%d\", index), e));","832","            index++;","833","        }","834","        index = 0;","835","        for (OneOffExecutor e: oneOffExecutors) {","836","            result.add(new DisplayExecutor(\"\", String.format(\"oneOffExecutors\/%d\", index), e));","837","            index++;","838","        }","839","        return result;","840","    }","841","","901","    \/*package*\/ void removeExecutor(final Executor e) {","902","        Queue.withLock(new Runnable() {","903","            @Override","904","            public void run() {","905","                synchronized (Computer.this) {","906","                    executors.remove(e);","907","                    addNewExecutorIfNecessary();","908","                    if(!isAlive())","909","                    {","910","                        AbstractCIBase ciBase = Jenkins.getInstance();","911","                        ciBase.removeComputer(Computer.this);","912","                    }","913","                }","914","            }","915","        });","1454","    public static class DisplayExecutor implements ModelObject {","1455","","1456","        @Nonnull","1457","        private final String displayName;","1458","        @Nonnull","1459","        private final String url;","1460","        @Nonnull","1461","        private final Executor executor;","1462","","1463","        public DisplayExecutor(@Nonnull String displayName, @Nonnull String url, @Nonnull Executor executor) {","1464","            this.displayName = displayName;","1465","            this.url = url;","1466","            this.executor = executor;","1467","        }","1468","","1469","        @Override","1470","        @Nonnull","1471","        public String getDisplayName() {","1472","            return displayName;","1473","        }","1474","","1475","        @Nonnull","1476","        public String getUrl() {","1477","            return url;","1478","        }","1479","","1480","        @Nonnull","1481","        public Executor getExecutor() {","1482","            return executor;","1483","        }","1484","","1485","        @Override","1486","        public String toString() {","1487","            final StringBuilder sb = new StringBuilder(\"DisplayExecutor{\");","1488","            sb.append(\"displayName='\").append(displayName).append('\\'');","1489","            sb.append(\", url='\").append(url).append('\\'');","1490","            sb.append(\", executor=\").append(executor);","1491","            sb.append('}');","1492","            return sb.toString();","1493","        }","1494","","1495","        @Override","1496","        public boolean equals(Object o) {","1497","            if (this == o) {","1498","                return true;","1499","            }","1500","            if (o == null || getClass() != o.getClass()) {","1501","                return false;","1502","            }","1503","","1504","            DisplayExecutor that = (DisplayExecutor) o;","1505","","1506","            if (!executor.equals(that.executor)) {","1507","                return false;","1508","            }","1509","","1510","            return true;","1511","        }","1512","","1513","        @Override","1514","        public int hashCode() {","1515","            return executor.hashCode();","1516","        }","1517","    }","1518",""],"delete":["869","    \/*package*\/ synchronized void removeExecutor(Executor e) {","870","        executors.remove(e);","871","        addNewExecutorIfNecessary();","872","        if(!isAlive())","873","        {","874","            AbstractCIBase ciBase = Jenkins.getInstance();","875","            ciBase.removeComputer(this);","876","        }"]}],"core\/src\/main\/java\/hudson\/model\/Node.java":[{"add":["375","        if (!isAcceptingTasks()) {","376","            return CauseOfBlockage.fromMessage(Messages._Node_BecauseNodeIsNotAcceptingTasks(getNodeName()));","377","        }","378",""],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/Queue.java":[{"add":["90","import java.util.LinkedHashSet;","101","import java.util.concurrent.locks.Condition;","102","import java.util.concurrent.locks.Lock;","103","import java.util.concurrent.locks.ReentrantLock;","146"," *                                    ^              |","147"," *                                    |              |","148"," *                                    +---(rarely)---+","152"," * Note: In the normal case of events pending items only move to left. However they can move back","153"," * if the node they are assigned to execute on disappears before their {@link Executor} thread","154"," * starts, where the node is removed before the {@link Executable} has been instantiated it","155"," * is safe to move the pending item back to buildable. Once the {@link Executable} has been","156"," * instantiated the only option is to let the {@link Executable} bomb out as soon as it starts","157"," * to try an execute on the node that no longer exists.","158"," *","159"," * <p>","208","    private transient volatile Snapshot snapshot = new Snapshot(waitingList, blockedProjects, buildables, pendings);","209","","338","    private transient final Lock lock = new ReentrantLock();","339","","340","    private transient final Condition condition = lock.newCondition();","341","","377","    public void load() {","378","        lock.lock();","454","        } finally {","455","            updateSnapshot();","456","            lock.unlock();","463","    public void save() {","466","        lock.lock();","468","            \/\/ write out the queue state we want to save","469","            State state = new State();","470","            state.counter = WaitingItem.COUNTER.longValue();","471","","472","            \/\/ write out the tasks on the queue","473","            for (Item item: getItems()) {","474","                if(item.task instanceof TransientTask)  continue;","475","            state.items.add(item);","476","            }","477","","478","            try {","479","                XmlFile queueFile = new XmlFile(XSTREAM, getXMLQueueFile());","480","                queueFile.write(state);","481","                SaveableListener.fireOnChange(this, queueFile);","482","            } catch (IOException e) {","483","                LOGGER.log(Level.WARNING, \"Failed to write out the queue file \" + getXMLQueueFile(), e);","484","            }","485","        } finally {","486","            lock.unlock();","494","    public void clear() {","496","        lock.lock();","497","        try {","498","            for (WaitingItem i : new ArrayList<WaitingItem>(","499","                    waitingList))   \/\/ copy the list as we'll modify it in the loop","500","                i.cancel(this);","501","            blockedProjects.cancelAll();","502","            pendings.cancelAll();","503","            buildables.cancelAll();","504","        } finally {","505","            updateSnapshot();","506","            lock.unlock();","507","        }","553","    public WaitingItem schedule(Task p, int quietPeriod, List<Action> actions) {","578","    public @Nonnull ScheduleResult schedule2(Task p, int quietPeriod, List<Action> actions) {","586","        lock.lock();","587","        try {","588","            for (QueueDecisionHandler h : QueueDecisionHandler.all())","589","                if (!h.shouldSchedule(p, actions))","590","                    return ScheduleResult.refused();    \/\/ veto","592","            return scheduleInternal(p, quietPeriod, actions);","593","        } finally {","594","            updateSnapshot();","595","            lock.unlock();","596","        }","612","    private @Nonnull ScheduleResult scheduleInternal(Task p, int quietPeriod, List<Action> actions) {","613","        lock.lock();","614","        try {","615","            Calendar due = new GregorianCalendar();","616","            due.add(Calendar.SECOND, quietPeriod);","618","            \/\/ Do we already have this task in the queue? Because if so, we won't schedule a new one.","619","            List<Item> duplicatesInQueue = new ArrayList<Item>();","620","            for (Item item : liveGetItems(p)) {","621","                boolean shouldScheduleItem = false;","622","                for (QueueAction action : item.getActions(QueueAction.class)) {","623","                    shouldScheduleItem |= action.shouldSchedule(actions);","624","                }","625","                for (QueueAction action : Util.filter(actions, QueueAction.class)) {","626","                    shouldScheduleItem |= action.shouldSchedule((new ArrayList<Action>(item.getAllActions())));","627","                }","628","                if (!shouldScheduleItem) {","629","                    duplicatesInQueue.add(item);","630","                }","632","            if (duplicatesInQueue.isEmpty()) {","633","                LOGGER.log(Level.FINE, \"{0} added to queue\", p);","635","                \/\/ put the item in the queue","636","                WaitingItem added = new WaitingItem(due, p, actions);","637","                added.enter(this);","638","                scheduleMaintenance();   \/\/ let an executor know that a new item is in the queue.","639","                return ScheduleResult.created(added);","642","            LOGGER.log(Level.FINE, \"{0} is already in the queue\", p);","643","","644","            \/\/ but let the actions affect the existing stuff.","645","            for (Item item : duplicatesInQueue) {","646","                for (FoldableAction a : Util.filter(actions, FoldableAction.class)) {","647","                    a.foldIntoExisting(item, p, actions);","648","                }","649","            }","650","","651","            boolean queueUpdated = false;","652","            for (WaitingItem wi : Util.filter(duplicatesInQueue, WaitingItem.class)) {","653","                if (quietPeriod <= 0) {","654","                    \/\/ the user really wants to build now, and they mean NOW.","655","                    \/\/ so let's pull in the timestamp if we can.","656","                    if (wi.timestamp.before(due))","657","                        continue;","658","                } else {","659","                    \/\/ otherwise we do the normal quiet period implementation","660","                    if (wi.timestamp.after(due))","661","                        continue;","662","                    \/\/ quiet period timer reset. start the period over again","663","                }","664","","665","                \/\/ waitingList is sorted, so when we change a timestamp we need to maintain order","666","                wi.leave(this);","667","                wi.timestamp = due;","668","                wi.enter(this);","669","                queueUpdated = true;","670","            }","671","","672","            if (queueUpdated) scheduleMaintenance();","673","","674","            \/\/ REVISIT: when there are multiple existing items in the queue that matches the incoming one,","675","            \/\/ whether the new one should affect all existing ones or not is debatable. I for myself","676","            \/\/ thought this would only affect one, so the code was bit of surprise, but I'm keeping the current","677","            \/\/ behaviour.","678","            return ScheduleResult.existing(duplicatesInQueue.get(0));","679","        } finally {","680","            updateSnapshot();","681","            lock.unlock();","690","    public boolean add(Task p, int quietPeriod) {","694","    public @CheckForNull WaitingItem schedule(Task p, int quietPeriod) {","702","    public boolean add(Task p, int quietPeriod, Action... actions) {","709","    public @CheckForNull WaitingItem schedule(Task p, int quietPeriod, Action... actions) {","716","    public @Nonnull ScheduleResult schedule2(Task p, int quietPeriod, Action... actions) {","726","    public boolean cancel(Task p) {","727","        lock.lock();","728","        try {","729","            LOGGER.log(Level.FINE, \"Cancelling {0}\", p);","730","            for (WaitingItem item : waitingList) {","731","                if (item.task.equals(p)) {","732","                    return item.cancel(this);","733","                }","735","            \/\/ use bitwise-OR to make sure that both branches get evaluated all the time","736","            return blockedProjects.cancel(p) != null | buildables.cancel(p) != null;","737","        } finally {","738","            updateSnapshot();","739","            lock.unlock();","743","    private void updateSnapshot() {","744","        snapshot = new Snapshot(waitingList, blockedProjects, buildables, pendings);","745","    }","746","","747","    public boolean cancel(Item item) {","764","    public boolean isEmpty() {","765","        Snapshot snapshot = this.snapshot;","766","        return snapshot.waitingList.isEmpty() && snapshot.blockedProjects.isEmpty() && snapshot.buildables.isEmpty()","767","                && snapshot.pendings.isEmpty();","770","    private WaitingItem peek() {","781","    public Item[] getItems() {","782","        Snapshot s = this.snapshot;","783","        Item[] r = new Item[s.waitingList.size() + s.blockedProjects.size() + s.buildables.size() +","784","                s.pendings.size()];","785","        s.waitingList.toArray(r);","786","        int idx = s.waitingList.size();","787","        for (BlockedItem p : s.blockedProjects) {","789","        }","790","        for (BuildableItem p : reverse(s.buildables)) {","792","        }","793","        for (BuildableItem p : reverse(s.pendings)) {","795","        }","820","    public Item getItem(long id) {","821","        Snapshot snapshot = this.snapshot;","822","        for (Item item : snapshot.blockedProjects) {","823","            if (item.id == id)","824","                return item;","825","        }","826","        for (Item item : snapshot.buildables) {","827","            if (item.id == id)","828","                return item;","829","        }","830","        for (Item item : snapshot.pendings) {","831","            if (item.id == id)","832","                return item;","833","        }","834","        for (Item item : snapshot.waitingList) {","835","            if (item.id == id) {","836","                return item;","837","            }","838","        }","845","    public List<BuildableItem> getBuildableItems(Computer c) {","846","        Snapshot snapshot = this.snapshot;","848","        _getBuildableItems(c, snapshot.buildables, result);","849","        _getBuildableItems(c, snapshot.pendings, result);","853","    private void _getBuildableItems(Computer c, List<BuildableItem> col, List<BuildableItem> result) {","857","        for (BuildableItem p : col) {","866","    public List<BuildableItem> getBuildableItems() {","867","        Snapshot snapshot = this.snapshot;","868","        ArrayList<BuildableItem> r = new ArrayList<BuildableItem>(snapshot.buildables);","869","        r.addAll(snapshot.pendings);","876","    public List<BuildableItem> getPendingItems() {","877","        return new ArrayList<BuildableItem>(snapshot.pendings);","903","    public List<Item> getUnblockedItems() {","904","        Snapshot snapshot = this.snapshot;","905","        List<Item> queuedNotBlocked = new ArrayList<Item>();","906","        queuedNotBlocked.addAll(snapshot.waitingList);","907","        queuedNotBlocked.addAll(snapshot.buildables);","908","        queuedNotBlocked.addAll(snapshot.pendings);","918","    public Set<Task> getUnblockedTasks() {","929","    public boolean isPending(Task t) {","930","        Snapshot snapshot = this.snapshot;","931","        for (BuildableItem i : snapshot.pendings)","940","    public int countBuildableItemsFor(Label l) {","941","        Snapshot snapshot = this.snapshot;","943","        for (BuildableItem bi : snapshot.buildables)","945","                if (null == l || bi.getAssignedLabelFor(st) == l)","947","        for (BuildableItem bi : snapshot.pendings)","949","                if (null == l || bi.getAssignedLabelFor(st) == l)","957","    public int countBuildableItems() {","966","    public Item getItem(Task t) {","967","        Snapshot snapshot = this.snapshot;","968","        for (Item item : snapshot.blockedProjects) {","969","            if (item.task.equals(t))","970","                return item;","971","        }","972","        for (Item item : snapshot.buildables) {","973","            if (item.task.equals(t))","974","                return item;","975","        }","976","        for (Item item : snapshot.pendings) {","977","            if (item.task.equals(t))","978","                return item;","979","        }","980","        for (Item item : snapshot.waitingList) {","992","     * @since 1.FIXME","994","    private List<Item> liveGetItems(Task t) {","995","        lock.lock();","996","        try {","997","            List<Item> result = new ArrayList<Item>();","998","            result.addAll(blockedProjects.getAll(t));","999","            result.addAll(buildables.getAll(t));","1000","            result.addAll(pendings.getAll(t));","1001","            for (Item item : waitingList) {","1002","                if (item.task.equals(t)) {","1003","                    result.add(item);","1004","                }","1005","            }","1006","            return result;","1007","        } finally {","1008","            lock.unlock();","1009","        }","1010","    }","1011","","1012","    \/**","1013","     * Gets the information about the queue item for the given project.","1014","     *","1015","     * @return null if the project is not in the queue.","1016","     *\/","1017","    public List<Item> getItems(Task t) {","1018","        Snapshot snapshot = this.snapshot;","1019","        List<Item> result = new ArrayList<Item>();","1020","        for (Item item : snapshot.blockedProjects) {","1021","            if (item.task.equals(t)) {","1022","                result.add(item);","1023","            }","1024","        }","1025","        for (Item item : snapshot.buildables) {","1026","            if (item.task.equals(t)) {","1027","                result.add(item);","1028","            }","1029","        }","1030","        for (Item item : snapshot.pendings) {","1031","            if (item.task.equals(t)) {","1032","                result.add(item);","1033","            }","1034","        }","1035","        for (Item item : snapshot.waitingList) {","1047","    public Item getItem(AbstractProject p) {","1055","    public boolean contains(Task t) {","1056","        final Snapshot snapshot = this.snapshot;","1057","        for (Item item : snapshot.blockedProjects) {","1058","            if (item.task.equals(t))","1059","                return true;","1060","        }","1061","        for (Item item : snapshot.buildables) {","1062","            if (item.task.equals(t))","1063","                return true;","1064","        }","1065","        for (Item item : snapshot.pendings) {","1066","            if (item.task.equals(t))","1067","                return true;","1068","        }","1069","        for (Item item : snapshot.waitingList) {","1082","    \/*package*\/ void onStartExecuting(Executor exec) throws InterruptedException {","1083","        lock.lock();","1084","        try {","1085","            final WorkUnit wu = exec.getCurrentWorkUnit();","1086","            pendings.remove(wu.context.item);","1088","            LeftItem li = new LeftItem(wu.context);","1089","            li.enter(this);","1090","        } finally {","1091","            updateSnapshot();","1092","            lock.unlock();","1093","        }","1197","    @Override","1198","    protected void _await() throws InterruptedException {","1199","        condition.await();","1200","    }","1201","","1202","    @Override","1203","    protected void _signalAll() {","1204","        condition.signalAll();","1205","    }","1206","","1213","    protected void _withLock(Runnable runnable) {","1214","        lock.lock();","1215","        try {","1216","            runnable.run();","1217","        } finally {","1218","            lock.unlock();","1219","        }","1233","    protected <V, T extends Throwable> V _withLock(hudson.remoting.Callable<V, T> callable) throws T {","1234","        lock.lock();","1235","        try {","1236","            return callable.call();","1237","        } finally {","1238","            lock.unlock();","1239","        }","1252","    protected <V> V _withLock(java.util.concurrent.Callable<V> callable) throws Exception {","1253","        lock.lock();","1254","        try {","1255","            return callable.call();","1256","        } finally {","1257","            lock.unlock();","1258","        }","1273","    public void maintain() {","1274","        lock.lock();","1275","        try {","1277","            LOGGER.log(Level.FINE, \"Queue maintenance started {0}\", this);","1279","            \/\/ The executors that are currently waiting for a job to run.","1280","            Map<Executor, JobOffer> parked = new HashMap<Executor, JobOffer>();","1281","","1282","            {\/\/ update parked (and identify any pending items who's executor has disappeared)","1283","                List<BuildableItem> lostPendings = new ArrayList<BuildableItem>(pendings);","1284","                for (Computer c : Jenkins.getInstance().getComputers()) {","1285","                    for (Executor e : c.getExecutors()) {","1286","                        if (e.isParking()) {","1287","                            parked.put(e, new JobOffer(e));","1288","                        }","1289","                        final WorkUnit workUnit = e.getCurrentWorkUnit();","1290","                        if (workUnit != null) {","1291","                            lostPendings.remove(workUnit.context.item);","1292","                        }","1293","                    }","1294","                }","1295","                \/\/ pending -> buildable","1296","                for (BuildableItem p: lostPendings) {","1297","                    LOGGER.log(Level.INFO,","1298","                            \"BuildableItem {0}: pending -> buildable as the assigned executor disappeared\",","1299","                            p.task.getFullDisplayName());","1300","                    p.isPending = false;","1301","                    pendings.remove(p);","1302","                    makeBuildable(p);","1303","                }","1304","            }","1305","","1306","","1307","            {\/\/ blocked -> buildable","1308","                for (BlockedItem p : new ArrayList<BlockedItem>(blockedProjects.values())) {\/\/ copy as we'll mutate the list","1309","                    if (!isBuildBlocked(p) && allowNewBuildableTask(p.task)) {","1310","                        \/\/ ready to be executed","1311","                        Runnable r = makeBuildable(new BuildableItem(p));","1312","                        if (r != null) {","1313","                            p.leave(this);","1314","                            r.run();","1315","                        }","1320","            \/\/ waitingList -> buildable\/blocked","1321","            while (!waitingList.isEmpty()) {","1322","                WaitingItem top = peek();","1324","                if (top.timestamp.compareTo(new GregorianCalendar()) > 0)","1325","                    break; \/\/ finished moving all ready items from queue","1326","","1327","                top.leave(this);","1328","                Task p = top.task;","1329","                if (!isBuildBlocked(top) && allowNewBuildableTask(p)) {","1330","                    \/\/ ready to be executed immediately","1331","                    Runnable r = makeBuildable(new BuildableItem(top));","1334","                    } else {","1335","                        new BlockedItem(top).enter(this);","1338","                    \/\/ this can't be built now because another build is in progress","1339","                    \/\/ set this project aside.","1344","            final QueueSorter s = sorter;","1345","            if (s != null)","1346","                s.sortBuildableItems(buildables);","1348","            \/\/ allocate buildable jobs to executors","1349","            for (BuildableItem p : new ArrayList<BuildableItem>(","1350","                    buildables)) {\/\/ copy as we'll mutate the list in the loop","1351","                \/\/ one last check to make sure this build is not blocked.","1352","                if (isBuildBlocked(p)) {","1353","                    p.leave(this);","1354","                    new BlockedItem(p).enter(this);","1355","                    LOGGER.log(Level.FINE, \"Catching that {0} is blocked in the last minute\", p);","1356","                    continue;","1357","                }","1358","","1359","                List<JobOffer> candidates = new ArrayList<JobOffer>(parked.size());","1360","                for (JobOffer j : parked.values())","1361","                    if (j.canTake(p))","1362","                        candidates.add(j);","1363","","1364","                MappingWorksheet ws = new MappingWorksheet(p, candidates);","1365","                Mapping m = loadBalancer.map(p.task, ws);","1366","                if (m == null) {","1367","                    \/\/ if we couldn't find the executor that fits,","1368","                    \/\/ just leave it in the buildables list and","1369","                    \/\/ check if we can execute other projects","1370","                    LOGGER.log(Level.FINER, \"Failed to map {0} to executors. candidates={1} parked={2}\",","1371","                            new Object[]{p, candidates, parked.values()});","1372","                    continue;","1373","                }","1374","","1375","                \/\/ found a matching executor. use it.","1376","                WorkUnitContext wuc = new WorkUnitContext(p);","1377","                m.execute(wuc);","1378","","1380","                if (!wuc.getWorkUnits().isEmpty())","1381","                    makePending(p);","1382","                else","1383","                    LOGGER.log(Level.FINE, \"BuildableItem {0} with empty work units!?\", p);","1385","        } finally {","1386","            updateSnapshot();","1387","            lock.unlock();","2515","    private static class Snapshot {","2516","        private final Set<WaitingItem> waitingList;","2517","        private final List<BlockedItem> blockedProjects;","2518","        private final List<BuildableItem> buildables;","2519","        private final List<BuildableItem> pendings;","2520","","2521","        public Snapshot(Set<WaitingItem> waitingList, List<BlockedItem> blockedProjects, List<BuildableItem> buildables,","2522","                        List<BuildableItem> pendings) {","2523","            this.waitingList = new LinkedHashSet<WaitingItem>(waitingList);","2524","            this.blockedProjects = new ArrayList<BlockedItem>(blockedProjects);","2525","            this.buildables = new ArrayList<BuildableItem>(buildables);","2526","            this.pendings = new ArrayList<BuildableItem>(pendings);","2527","        }","2528","    }","2529",""],"delete":["356","    public synchronized void load() {","438","    public synchronized void save() {","441","        \/\/ write out the queue state we want to save","442","        State state = new State();","443","        state.counter = WaitingItem.COUNTER.longValue();","444","","445","        \/\/ write out the tasks on the queue","446","        for (Item item: getItems()) {","447","            if(item.task instanceof TransientTask)  continue;","448","\t    state.items.add(item);","449","    \t}","450","","452","            XmlFile queueFile = new XmlFile(XSTREAM, getXMLQueueFile());","453","            queueFile.write(state);","454","            SaveableListener.fireOnChange(this, queueFile);","455","        } catch (IOException e) {","456","            LOGGER.log(Level.WARNING, \"Failed to write out the queue file \" + getXMLQueueFile(), e);","464","    public synchronized void clear() {","466","        for (WaitingItem i : new ArrayList<WaitingItem>(waitingList))   \/\/ copy the list as we'll modify it in the loop","467","            i.cancel(this);","468","        blockedProjects.cancelAll();","469","        pendings.cancelAll();","470","        buildables.cancelAll();","516","    public synchronized WaitingItem schedule(Task p, int quietPeriod, List<Action> actions) {","541","    public synchronized @Nonnull ScheduleResult schedule2(Task p, int quietPeriod, List<Action> actions) {","549","    \tfor(QueueDecisionHandler h : QueueDecisionHandler.all())","550","    \t\tif (!h.shouldSchedule(p, actions))","551","                return ScheduleResult.refused();    \/\/ veto","553","        return scheduleInternal(p, quietPeriod, actions);","569","    private synchronized @Nonnull ScheduleResult scheduleInternal(Task p, int quietPeriod, List<Action> actions) {","570","        Calendar due = new GregorianCalendar();","571","    \tdue.add(Calendar.SECOND, quietPeriod);","573","        \/\/ Do we already have this task in the queue? Because if so, we won't schedule a new one.","574","    \tList<Item> duplicatesInQueue = new ArrayList<Item>();","575","    \tfor(Item item : getItems(p)) {","576","    \t\tboolean shouldScheduleItem = false;","577","    \t\tfor (QueueAction action: item.getActions(QueueAction.class)) {","578","                shouldScheduleItem |= action.shouldSchedule(actions);","579","    \t\t}","580","    \t\tfor (QueueAction action: Util.filter(actions,QueueAction.class)) {","581","                shouldScheduleItem |= action.shouldSchedule((new ArrayList<Action>(item.getAllActions())));","582","    \t\t}","583","    \t\tif(!shouldScheduleItem) {","584","    \t\t\tduplicatesInQueue.add(item);","585","    \t\t}","586","    \t}","587","    \tif (duplicatesInQueue.isEmpty()) {","588","    \t\tLOGGER.log(Level.FINE, \"{0} added to queue\", p);","589","","590","    \t\t\/\/ put the item in the queue","591","            WaitingItem added = new WaitingItem(due,p,actions);","592","            added.enter(this);","593","            scheduleMaintenance();   \/\/ let an executor know that a new item is in the queue.","594","            return ScheduleResult.created(added);","595","    \t}","596","","597","        LOGGER.log(Level.FINE, \"{0} is already in the queue\", p);","598","","599","        \/\/ but let the actions affect the existing stuff.","600","        for(Item item : duplicatesInQueue) {","601","            for(FoldableAction a : Util.filter(actions,FoldableAction.class)) {","602","                a.foldIntoExisting(item, p, actions);","604","        }","606","        boolean queueUpdated = false;","607","        for(WaitingItem wi : Util.filter(duplicatesInQueue,WaitingItem.class)) {","608","            if(quietPeriod<=0) {","609","                \/\/ the user really wants to build now, and they mean NOW.","610","                \/\/ so let's pull in the timestamp if we can.","611","                if (wi.timestamp.before(due))","612","                    continue;","613","            } else {","614","                \/\/ otherwise we do the normal quiet period implementation","615","                if (wi.timestamp.after(due))","616","                    continue;","617","                \/\/ quiet period timer reset. start the period over again","620","            \/\/ waitingList is sorted, so when we change a timestamp we need to maintain order","621","            wi.leave(this);","622","            wi.timestamp = due;","623","            wi.enter(this);","624","            queueUpdated=true;","626","","627","        if (queueUpdated)   scheduleMaintenance();","628","","629","        \/\/ REVISIT: when there are multiple existing items in the queue that matches the incoming one,","630","        \/\/ whether the new one should affect all existing ones or not is debatable. I for myself","631","        \/\/ thought this would only affect one, so the code was bit of surprise, but I'm keeping the current","632","        \/\/ behaviour.","633","        return ScheduleResult.existing(duplicatesInQueue.get(0));","641","    public synchronized boolean add(Task p, int quietPeriod) {","645","    public synchronized @CheckForNull WaitingItem schedule(Task p, int quietPeriod) {","653","    public synchronized boolean add(Task p, int quietPeriod, Action... actions) {","660","    public synchronized @CheckForNull WaitingItem schedule(Task p, int quietPeriod, Action... actions) {","667","    public synchronized @Nonnull ScheduleResult schedule2(Task p, int quietPeriod, Action... actions) {","677","    public synchronized boolean cancel(Task p) {","678","        LOGGER.log(Level.FINE, \"Cancelling {0}\", p);","679","        for (WaitingItem item : waitingList) {","680","            if (item.task.equals(p)) {","681","                return item.cancel(this);","684","        \/\/ use bitwise-OR to make sure that both branches get evaluated all the time","685","        return blockedProjects.cancel(p)!=null | buildables.cancel(p)!=null;","688","    public synchronized boolean cancel(Item item) {","705","    public synchronized boolean isEmpty() {","706","        return waitingList.isEmpty() && blockedProjects.isEmpty() && buildables.isEmpty() && pendings.isEmpty();","709","    private synchronized WaitingItem peek() {","720","    public synchronized Item[] getItems() {","721","        Item[] r = new Item[waitingList.size() + blockedProjects.size() + buildables.size() + pendings.size()];","722","        waitingList.toArray(r);","723","        int idx = waitingList.size();","724","        for (BlockedItem p : blockedProjects.values())","726","        for (BuildableItem p : reverse(buildables.values()))","728","        for (BuildableItem p : reverse(pendings.values()))","754","    public synchronized Item getItem(long id) {","755","    \tfor (Item item: waitingList) if (item.id == id) return item;","756","    \tfor (Item item: blockedProjects) if (item.id == id) return item;","757","    \tfor (Item item: buildables) if (item.id == id) return item;","758","        for (Item item: pendings) if (item.id == id) return item;","759","","766","    public synchronized List<BuildableItem> getBuildableItems(Computer c) {","768","        _getBuildableItems(c, buildables, result);","769","        _getBuildableItems(c, pendings, result);","773","    private void _getBuildableItems(Computer c, ItemList<BuildableItem> col, List<BuildableItem> result) {","777","        for (BuildableItem p : col.values()) {","786","    public synchronized List<BuildableItem> getBuildableItems() {","787","        ArrayList<BuildableItem> r = new ArrayList<BuildableItem>(buildables.values());","788","        r.addAll(pendings.values());","795","    public synchronized List<BuildableItem> getPendingItems() {","796","        return new ArrayList<BuildableItem>(pendings.values());","822","    public synchronized List<Item> getUnblockedItems() {","823","    \tList<Item> queuedNotBlocked = new ArrayList<Item>();","824","        queuedNotBlocked.addAll(waitingList);","825","        queuedNotBlocked.addAll(buildables);","826","        queuedNotBlocked.addAll(pendings);","836","    public synchronized Set<Task> getUnblockedTasks() {","847","    public synchronized boolean isPending(Task t) {","848","        for (BuildableItem i : pendings)","857","    public synchronized int countBuildableItemsFor(Label l) {","859","        for (BuildableItem bi : buildables.values())","861","                if (null==l || bi.getAssignedLabelFor(st)==l)","863","        for (BuildableItem bi : pendings.values())","865","                if (null==l || bi.getAssignedLabelFor(st)==l)","873","    public synchronized int countBuildableItems() {","882","    public synchronized Item getItem(Task t) {","883","        BlockedItem bp = blockedProjects.get(t);","884","        if (bp!=null)","885","            return bp;","886","        BuildableItem bi = buildables.get(t);","887","        if(bi!=null)","888","            return bi;","889","        bi = pendings.get(t);","890","        if(bi!=null)","891","            return bi;","892","","893","        for (Item item : waitingList) {","906","    public synchronized List<Item> getItems(Task t) {","907","    \tList<Item> result =new ArrayList<Item>();","908","    \tresult.addAll(blockedProjects.getAll(t));","909","    \tresult.addAll(buildables.getAll(t));","910","        result.addAll(pendings.getAll(t));","911","        for (Item item : waitingList) {","923","    public synchronized Item getItem(AbstractProject p) {","931","    public synchronized boolean contains(Task t) {","932","        if (blockedProjects.containsKey(t) || buildables.containsKey(t) || pendings.containsKey(t))","933","            return true;","934","        for (Item item : waitingList) {","947","    \/*package*\/ synchronized void onStartExecuting(Executor exec) throws InterruptedException {","948","        final WorkUnit wu = exec.getCurrentWorkUnit();","949","        pendings.remove(wu.context.item);","951","        LeftItem li = new LeftItem(wu.context);","952","        li.enter(this);","1062","    protected synchronized void _withLock(Runnable runnable) {","1063","        runnable.run();","1077","    protected synchronized <V, T extends Throwable> V _withLock(hudson.remoting.Callable<V, T> callable) throws T {","1078","        return callable.call();","1091","    protected synchronized <V> V _withLock(java.util.concurrent.Callable<V> callable) throws Exception {","1092","        return callable.call();","1107","    public synchronized void maintain() {","1108","        LOGGER.log(Level.FINE, \"Queue maintenance started {0}\", this);","1110","        \/\/ The executors that are currently waiting for a job to run.","1111","        Map<Executor,JobOffer> parked = new HashMap<Executor,JobOffer>();","1113","        {\/\/ update parked","1114","            for (Computer c : Jenkins.getInstance().getComputers()) {","1115","                for (Executor e : c.getExecutors()) {","1116","                    if (e.isParking()) {","1117","                        parked.put(e,new JobOffer(e));","1121","        }","1124","        {\/\/ blocked -> buildable","1125","            for (BlockedItem p : new ArrayList<BlockedItem>(blockedProjects.values())) {\/\/ copy as we'll mutate the list","1126","                if (!isBuildBlocked(p) && allowNewBuildableTask(p.task)) {","1127","                    \/\/ ready to be executed","1128","                    Runnable r = makeBuildable(new BuildableItem(p));","1130","                        p.leave(this);","1133","                }","1134","            }","1135","        }","1136","","1137","        \/\/ waitingList -> buildable\/blocked","1138","        while (!waitingList.isEmpty()) {","1139","            WaitingItem top = peek();","1140","","1141","            if (top.timestamp.compareTo(new GregorianCalendar())>0)","1142","                break; \/\/ finished moving all ready items from queue","1143","","1144","            top.leave(this);","1145","            Task p = top.task;","1146","            if (!isBuildBlocked(top) && allowNewBuildableTask(p)) {","1147","                \/\/ ready to be executed immediately","1148","                Runnable r = makeBuildable(new BuildableItem(top));","1149","                if (r != null) {","1150","                    r.run();","1154","            } else {","1155","                \/\/ this can't be built now because another build is in progress","1156","                \/\/ set this project aside.","1157","                new BlockedItem(top).enter(this);","1159","        }","1161","        final QueueSorter s = sorter;","1162","        if (s != null)","1163","        \ts.sortBuildableItems(buildables);","1165","        \/\/ allocate buildable jobs to executors","1166","        for (BuildableItem p : new ArrayList<BuildableItem>(buildables)) {\/\/ copy as we'll mutate the list in the loop","1167","            \/\/ one last check to make sure this build is not blocked.","1168","            if (isBuildBlocked(p)) {","1170","                new BlockedItem(p).enter(this);","1171","                LOGGER.log(Level.FINE, \"Catching that {0} is blocked in the last minute\", p);","1172","                continue;","1174","","1175","            List<JobOffer> candidates = new ArrayList<JobOffer>(parked.size());","1176","            for (JobOffer j : parked.values())","1177","                if (j.canTake(p))","1178","                    candidates.add(j);","1179","","1180","            MappingWorksheet ws = new MappingWorksheet(p, candidates);","1181","            Mapping m = loadBalancer.map(p.task, ws);","1182","            if (m == null) {","1183","                \/\/ if we couldn't find the executor that fits,","1184","                \/\/ just leave it in the buildables list and","1185","                \/\/ check if we can execute other projects","1186","                LOGGER.log(Level.FINER, \"Failed to map {0} to executors. candidates={1} parked={2}\", new Object[]{p, candidates, parked.values()});","1187","                continue;","1188","            }","1189","","1190","            \/\/ found a matching executor. use it.","1191","            WorkUnitContext wuc = new WorkUnitContext(p);","1192","            m.execute(wuc);","1193","","1194","            p.leave(this);","1195","            if (!wuc.getWorkUnits().isEmpty())","1196","                makePending(p);","1197","            else","1198","                LOGGER.log(Level.FINE, \"BuildableItem {0} with empty work units!?\", p);"]}],"core\/src\/main\/java\/hudson\/model\/AbstractCIBase.java":[{"add":["137","    \/*package*\/ void removeComputer(final Computer computer) {","138","        Queue.withLock(new Runnable() {","139","            @Override","140","            public void run() {","141","                Map<Node,Computer> computers = getComputerMap();","142","                for (Map.Entry<Node, Computer> e : computers.entrySet()) {","143","                    if (e.getValue() == computer) {","144","                        computers.remove(e.getKey());","145","                        computer.onRemoved();","146","                        return;","147","                    }","148","                }","150","        });","165","    protected void updateComputerList(final boolean automaticSlaveLaunch) {","166","        final Map<Node,Computer> computers = getComputerMap();","167","        Queue.withLock(new Runnable() {","168","            @Override","169","            public void run() {","170","                Map<String,Computer> byName = new HashMap<String,Computer>();","171","                for (Computer c : computers.values()) {","172","                    Node node = c.getNode();","173","                    if (node == null)","174","                        continue;   \/\/ this computer is gone","175","                    byName.put(node.getNodeName(),c);","176","                }","178","                final Set<Computer> old = new HashSet<Computer>(computers.values());","179","                Set<Computer> used = new HashSet<Computer>();","181","                updateComputer(AbstractCIBase.this, byName, used, automaticSlaveLaunch);","182","                for (Node s : getNodes()) {","183","                    long start = System.currentTimeMillis();","184","                    updateComputer(s, byName, used, automaticSlaveLaunch);","185","                    if(LOG_STARTUP_PERFORMANCE)","186","                        LOGGER.info(String.format(\"Took %dms to update node %s\",","187","                                System.currentTimeMillis()-start, s.getNodeName()));","188","                }","190","                \/\/ find out what computers are removed, and kill off all executors.","191","                \/\/ when all executors exit, it will be removed from the computers map.","192","                \/\/ so don't remove too quickly","193","                old.removeAll(used);","194","                for (Computer c : old) {","195","                    killComputer(c);","196","                }","198","        });"],"delete":["50","    private final transient Object updateComputerLock = new Object();","51","","139","    \/*package*\/ void removeComputer(Computer computer) {","140","        Map<Node,Computer> computers = getComputerMap();","141","        for (Map.Entry<Node, Computer> e : computers.entrySet()) {","142","            if (e.getValue() == computer) {","143","                computers.remove(e.getKey());","144","                computer.onRemoved();","145","                return;","147","        }","162","    protected void updateComputerList(boolean automaticSlaveLaunch) throws IOException {","163","        Map<Node,Computer> computers = getComputerMap();","164","        synchronized(updateComputerLock) {\/\/ just so that we don't have two code updating computer list at the same time","165","            Map<String,Computer> byName = new HashMap<String,Computer>();","166","            for (Computer c : computers.values()) {","167","                Node node = c.getNode();","168","                if (node == null)","169","                    continue;   \/\/ this computer is gone","170","                byName.put(node.getNodeName(),c);","171","            }","173","            final Set<Computer> old = new HashSet<Computer>(computers.values());","174","            Set<Computer> used = new HashSet<Computer>();","176","            updateComputer(this, byName, used, automaticSlaveLaunch);","177","            for (Node s : getNodes()) {","178","                long start = System.currentTimeMillis();","179","                updateComputer(s, byName, used, automaticSlaveLaunch);","180","                if(LOG_STARTUP_PERFORMANCE)","181","                    LOGGER.info(String.format(\"Took %dms to update node %s\",","182","                            System.currentTimeMillis()-start, s.getNodeName()));","183","            }","185","            \/\/ find out what computers are removed, and kill off all executors.","186","            \/\/ when all executors exit, it will be removed from the computers map.","187","            \/\/ so don't remove too quickly","188","            old.removeAll(used);","189","            for (Computer c : old) {","190","                killComputer(c);","192","        }"]}],"core\/src\/main\/java\/hudson\/model\/Hudson.java":[{"add":["123","        return (List)getNodes();"],"delete":["123","        return (List)slaves;"]}],"core\/src\/main\/resources\/hudson\/model\/Messages.properties":[{"add":["315","Node.BecauseNodeIsNotAcceptingTasks={0} is not accepting tasks"],"delete":[]}],"core\/src\/main\/resources\/lib\/hudson\/executors.jelly":[{"add":["41","      <j:if test=\"${!c.offline or (c.offline and !e.idle)}\">","42","        <tr>","43","          <td class=\"pane\" align=\"right\" style=\"vertical-align: top\">","44","            ${name}","45","          <\/td>","46","          <j:choose>","47","            <j:when test=\"${!e.active}\">","48","              <td class=\"pane\">","49","                <a href=\"${rootURL}\/${c.url}${url}\/causeOfDeath\">","50","                  <div class=\"error\">${%Dead} (!)<\/div>","51","                <\/a>","52","              <\/td>","53","              <td class=\"pane\"\/>","54","              <td class=\"pane\"\/>","55","            <\/j:when>","56","            <j:when test=\"${e.idle}\">","57","              <td class=\"pane\">","58","                <j:choose>","59","                  <j:when test=\"${c.offline}\">","60","                    <a href=\"${rootURL}\/${c.url}\" class=\"model-link inside\">${%Offline}<\/a>","61","                  <\/j:when>","62","                  <j:otherwise>","63","                    ${%Idle}","64","                  <\/j:otherwise>","65","                <\/j:choose>","66","              <\/td>","67","              <td class=\"pane\"\/>","68","              <td class=\"pane\"\/>","69","            <\/j:when>","70","            <j:otherwise>","71","              <!-- not actually optional, but it helps with backward compatibility -->","72","              <j:set var=\"executor\" value=\"${e}\" \/>","73","              <st:include it=\"${e.currentExecutable}\" page=\"executorCell.jelly\" optional=\"true\">","75","                  <div style=\"white-space: normal\">","76","                    <j:set var=\"exe\" value=\"${e.currentExecutable}\" \/>","77","                    <j:set var=\"wu\" value=\"${e.currentWorkUnit}\" \/>","78","                    <j:choose>","79","                      <j:when test=\"${exe == null and wu != null}\">","80","                        <j:set var=\"exeparent\" value=\"${wu.work}\"\/>","81","                        <j:choose>","82","                          <j:when test=\"${h.hasPermission(exeparent,exeparent.READ)}\">","83","                            <a href=\"${rootURL}\/${exeparent.url}\"><l:breakable value=\"${exeparent.fullDisplayName}\"\/><\/a>","84","                            <t:progressBar tooltip=\"${%Pending}\" pos=\"-1\" href=\"${rootURL}\/${exeparent.url}\"\/>","85","                          <\/j:when>","86","                          <j:otherwise>","87","                            <span>${%Unknown Task}<\/span>","88","                          <\/j:otherwise>","89","                        <\/j:choose>","90","                      <\/j:when>","91","                      <j:when test=\"${exe == null and wu == null}\">","92","                        <!-- went idle concurrent with testing for idle -->","93","                        ${%Idle}","94","                      <\/j:when>","95","                      <j:otherwise>","96","                        <j:invokeStatic var=\"exeparent\"","97","                           className=\"hudson.model.queue.Executables\" method=\"getParentOf\">","98","                          <j:arg type=\"hudson.model.Queue$Executable\" value=\"${exe}\" \/>","99","                        <\/j:invokeStatic>","100","                        <j:choose>","101","                          <j:when test=\"${h.hasPermission(exeparent,exeparent.READ)}\">","102","                            <a href=\"${rootURL}\/${exeparent.url}\"><l:breakable value=\"${exeparent.fullDisplayName}\"\/><\/a>","103","                            <t:buildProgressBar build=\"${exe}\" executor=\"${executor}\"\/>","104","                          <\/j:when>","105","                          <j:otherwise>","106","                            <span>${%Unknown Task}<\/span>","107","                          <\/j:otherwise>","108","                        <\/j:choose>","109","                      <\/j:otherwise>","110","                    <\/j:choose>","111","                  <\/div>","113","              <td class=\"pane\">","114","                <j:if test=\"${h.hasPermission(exeparent,exeparent.READ)}\">","115","                    <a href=\"${rootURL}\/${exe.url}\" class=\"model-link inside\"><l:breakable value=\"${exe.displayName}\"\/><\/a>","116","                <\/j:if>","117","              <\/td>","118","              <\/st:include>","119","              <td class=\"pane\" align=\"center\" valign=\"middle\">","120","                <j:if test=\"${e.hasStopPermission()}\">","121","                  <l:stopButton href=\"${rootURL}\/${c.url}${url}\/stop\" alt=\"${%terminate this build}\"\/>","122","                <\/j:if>","123","              <\/td>","124","            <\/j:otherwise>","125","          <\/j:choose>","126","        <\/tr>","127","      <\/j:if>","131","  <j:set var=\"computersSize\" value=\"${computers.size()}\"\/>","132","  <l:pane width=\"3\" id=\"executors\"","133","      title=\"&lt;a href='${rootURL}\/computer\/'>${%Build Executor Status}&lt;\/a>\"","134","      collapsedText=\"${%Computers(computersSize - 1, app.unlabeledLoad.computeTotalExecutors() - app.unlabeledLoad.computeIdleExecutors(), app.unlabeledLoad.computeTotalExecutors())}\">","135","    <colgroup><col width=\"30\"\/><col width=\"200*\"\/><col width=\"24\"\/><\/colgroup>","137","    <j:forEach var=\"c\" items=\"${computers}\">","138","      <j:set var=\"cDisplayExecutors\" value=\"${c.displayExecutors}\"\/>","139","      <tr>","140","        <j:if test=\"${computersSize gt 1 and !cDisplayExecutors.isEmpty()}\">","141","          <th class=\"pane\" colspan=\"3\">","142","            <local:computerCaption title=\"${c.displayName}\" \/>","143","          <\/th>","144","        <\/j:if>","145","      <\/tr>","146","      <j:forEach var=\"de\" items=\"${cDisplayExecutors}\" varStatus=\"eloop\">","147","        <j:set var=\"e\" value=\"${de.executor}\"\/>","148","        <local:executor name=\"${de.displayName}\" url=\"${de.url}\" \/>","150","    <\/j:forEach>","151","  <\/l:pane>","152","  <!-- schedule updates only for the full page reload -->","153","  <j:if test=\"${ajax==null and !h.isAutoRefresh(request) and h.hasPermission(app.READ)}\">","154","    <script defer=\"defer\">","155","      refreshPart('executors',\"${rootURL}\/${h.hasView(it,'ajaxExecutors')?it.url:''}ajaxExecutors\");","156","    <\/script>","157","  <\/j:if>"],"delete":["41","      <j:choose>","42","        <j:when test=\"${!c.offline or (c.offline and !e.idle)}\">","43","          <tr>","44","            <td class=\"pane\" align=\"right\" style=\"vertical-align: top\">","45","              ${name}","46","            <\/td>","47","            <j:choose>","48","              <j:when test=\"${!e.active}\">","50","                  <a href=\"${rootURL}\/${c.url}${url}\/causeOfDeath\">","51","                    <div class=\"error\">${%Dead} (!)<\/div>","52","                  <\/a>","54","                <td class=\"pane\"\/>","55","                <td class=\"pane\"\/>","56","              <\/j:when>","57","              <j:when test=\"${e.idle}\">","58","                <td class=\"pane\">","59","                  <j:choose>","60","                    <j:when test=\"${c.offline}\">","61","                      <a href=\"${rootURL}\/${c.url}\" class=\"model-link inside\">${%Offline}<\/a>","62","                    <\/j:when>","63","                    <j:otherwise>","64","                      ${%Idle}","65","                    <\/j:otherwise>","66","                  <\/j:choose>","67","                <\/td>","68","                <td class=\"pane\"\/>","69","                <td class=\"pane\"\/>","70","              <\/j:when>","71","              <j:otherwise>","72","                <!-- not actually optional, but it helps with backward compatibility -->","73","                <j:set var=\"executor\" value=\"${e}\" \/>","74","                <st:include it=\"${e.currentExecutable}\" page=\"executorCell.jelly\" optional=\"true\">","75","                  <td class=\"pane\">","76","                    <div style=\"white-space: normal\">","77","                      <j:set var=\"exe\" value=\"${e.currentExecutable}\" \/>","78","                      <j:invokeStatic var=\"exeparent\"","79","                         className=\"hudson.model.queue.Executables\" method=\"getParentOf\">","80","                        <j:arg type=\"hudson.model.Queue$Executable\" value=\"${exe}\" \/>","81","                      <\/j:invokeStatic>","82","                      <j:choose>","83","                        <j:when test=\"${h.hasPermission(exeparent,exeparent.READ)}\">","84","                          <a href=\"${rootURL}\/${exeparent.url}\"><l:breakable value=\"${exeparent.fullDisplayName}\"\/><\/a>","85","                          <t:buildProgressBar build=\"${exe}\" executor=\"${executor}\"\/>","86","                        <\/j:when>","87","                        <j:otherwise>","88","                          <span>${%Unknown Task}<\/span>","89","                        <\/j:otherwise>","90","                      <\/j:choose>","91","                    <\/div>","92","                  <\/td>","93","                <td class=\"pane\">","94","                  <j:if test=\"${h.hasPermission(exeparent,exeparent.READ)}\">","95","                      <a href=\"${rootURL}\/${exe.url}\" class=\"model-link inside\"><l:breakable value=\"${exe.displayName}\"\/><\/a>","96","                  <\/j:if>","97","                <\/td>","98","                <\/st:include>","99","                <td class=\"pane\" align=\"center\" valign=\"middle\">","100","                  <j:if test=\"${e.hasStopPermission()}\">","101","                    <l:stopButton href=\"${rootURL}\/${c.url}${url}\/stop\" alt=\"${%terminate this build}\"\/>","102","                  <\/j:if>","103","                <\/td>","104","              <\/j:otherwise>","105","            <\/j:choose>","106","          <\/tr>","107","        <\/j:when>","108","      <\/j:choose>","112","    <l:pane width=\"3\" id=\"executors\"","113","        title=\"&lt;a href='${rootURL}\/computer\/'>${%Build Executor Status}&lt;\/a>\"","114","        collapsedText=\"${%Computers(computers.size() - 1, app.unlabeledLoad.computeTotalExecutors() - app.unlabeledLoad.computeIdleExecutors(), app.unlabeledLoad.computeTotalExecutors())}\">","115","      <colgroup><col width=\"30\"\/><col width=\"200*\"\/><col width=\"24\"\/><\/colgroup>","117","      <j:forEach var=\"c\" items=\"${computers}\">","118","        <tr>","119","          <j:if test=\"${computers.size() gt 1 and (c.executors.size()!=0 or c.oneOffExecutors.size()!=0)}\">","120","            <th class=\"pane\" colspan=\"3\">","121","              <local:computerCaption title=\"${c.displayName}\" \/>","122","            <\/th>","123","          <\/j:if>","124","        <\/tr>","125","        <j:forEach var=\"e\" items=\"${c.executors}\" varStatus=\"eloop\">","126","          <local:executor name=\"${eloop.index+1}\" url=\"executors\/${eloop.index}\" \/>","127","        <\/j:forEach>","128","        <j:forEach var=\"e\" items=\"${c.oneOffExecutors}\" varStatus=\"eloop\">","129","          <local:executor name=\"\" url=\"oneOffExecutors\/${eloop.index}\" \/>","130","        <\/j:forEach>","132","    <\/l:pane>","133","    <!-- schedule updates only for the full page reload -->","134","    <j:if test=\"${ajax==null and !h.isAutoRefresh(request) and h.hasPermission(app.READ)}\">","135","      <script defer=\"defer\">","136","        refreshPart('executors',\"${rootURL}\/${h.hasView(it,'ajaxExecutors')?it.url:''}ajaxExecutors\");","137","      <\/script>","138","    <\/j:if>"]}],"core\/src\/main\/java\/hudson\/slaves\/RetentionStrategy.java":[{"add":["35","import net.jcip.annotations.GuardedBy;","38","import java.util.concurrent.TimeUnit;","58","    @GuardedBy(\"hudson.model.Queue#lock\")","96","    public void start(final T c) {","97","        Queue.withLock(new Runnable() {","98","            @Override","99","            public void run() {","100","                check(c);","101","            }","102","        });","267","                    \/\/ we've been idle for long enough","268","                    logger.log(Level.INFO, \"Disconnecting computer {0} as it has been idle for {1}\",","269","                            new Object[]{c.getName(), Util.getTimeSpanString(idleMilliseconds)});","270","                    c.disconnect(OfflineCause.create(Messages._RetentionStrategy_Demand_OfflineIdle()));","271","                } else {","272","                    \/\/ no point revisiting until we can be confident we will be idle","273","                    return TimeUnit.MILLISECONDS.toMinutes(TimeUnit.MINUTES.toMillis(idleDelay) - idleMilliseconds);"],"delete":["93","    public void start(T c) {","94","        check(c);","259","                    Queue.withLock(new Runnable() {","260","                        @Override","261","                        public void run() {","262","                            \/\/ re-check idle now that we are within the Queue lock","263","                            if (c.isIdle()) {","264","                                final long idleMilliseconds = System.currentTimeMillis() - c.getIdleStartMilliseconds();","265","                                if (idleMilliseconds > idleDelay * 1000 * 60 \/*MINS->MILLIS*\/) {","266","                                    \/\/ we've been idle for long enough","267","                                    logger.log(Level.INFO, \"Disconnecting computer {0} as it has been idle for {1}\",","268","                                            new Object[]{c.getName(), Util.getTimeSpanString(idleMilliseconds)});","269","                                    c.disconnect(OfflineCause.create(Messages._RetentionStrategy_Demand_OfflineIdle()));","270","                                }","271","                            }","272","                        }","273","                    });"]}],"core\/src\/main\/java\/jenkins\/model\/Jenkins.java":[{"add":["291","import java.util.concurrent.locks.ReentrantReadWriteLock;","501","     * Legacy store of the set of installed cluster nodes.","502","     * @deprecated in favour of {@link Nodes}","504","    @Deprecated","505","    protected transient volatile NodeList slaves;","506","","507","    \/**","508","     * The holder of the set of installed cluster nodes.","509","     *","510","     * @since 1.FIXME","511","     *\/","512","    private transient final Nodes nodes = new Nodes(this);","1218","    protected void updateComputerList() {","1667","        return nodes.getNode(name);","1686","        return nodes.getNodes();","1692","    public void addNode(Node n) throws IOException {","1693","        nodes.addNode(n);","1699","    public void removeNode(@Nonnull Node n) throws IOException {","1700","        nodes.removeNode(n);","1703","    public void setNodes(final List<? extends Node> n) throws IOException {","1704","        nodes.setNodes(n);","1721","    \/*package*\/ void trimLabels() {","2630","                if (slaves != null && !slaves.isEmpty() && nodes.isLegacy()) {","2631","                    nodes.setNodes(slaves);","2632","                    slaves = null;","2633","                } else {","2634","                    nodes.load();","2635","                }","2675","                    for (Node slave : nodes.getNodes())"],"delete":["500","     * Set of installed cluster nodes.","501","     * <p>","502","     * We use this field with copy-on-write semantics.","503","     * This field has mutable list (to keep the serialization look clean),","504","     * but it shall never be modified. Only new completely populated slave","505","     * list can be set here.","506","     * <p>","507","     * The field name should be really {@code nodes}, but again the backward compatibility","508","     * prevents us from renaming.","510","    protected volatile NodeList slaves;","1216","    protected void updateComputerList() throws IOException {","1665","        return slaves.getNode(name);","1684","        return slaves;","1690","    public synchronized void addNode(Node n) throws IOException {","1691","        if(n==null)     throw new IllegalArgumentException();","1692","        ArrayList<Node> nl = new ArrayList<Node>(this.slaves);","1693","        if(!nl.contains(n)) \/\/ defensive check","1694","            nl.add(n);","1695","        setNodes(nl);","1701","    public synchronized void removeNode(@Nonnull Node n) throws IOException {","1702","        Computer c = n.toComputer();","1703","        if (c!=null)","1704","            c.disconnect(OfflineCause.create(Messages._Hudson_NodeBeingRemoved()));","1705","","1706","        ArrayList<Node> nl = new ArrayList<Node>(this.slaves);","1707","        nl.remove(n);","1708","        setNodes(nl);","1711","    public void setNodes(final List<? extends Node> nodes) throws IOException {","1712","        Jenkins.this.slaves = new NodeList(nodes);","1713","        updateComputerList();","1714","        trimLabels();","1715","        save();","1732","    private void trimLabels() {","2629","                \/\/ JENKINS-8043: some slaves (eg. swarm slaves) are not saved into the config file","2630","                \/\/ and will get overwritten when reloading. Make a backup copy now, and re-add them later","2631","                NodeList oldSlaves = slaves;","2632","","2645","                if (slaves == null) slaves = new NodeList();","2648","","2649","                \/\/ JENKINS-8043: re-add the slaves which were not saved into the config file","2650","                \/\/ and are now missing, but still connected.","2651","                if (oldSlaves != null) {","2652","                    ArrayList<Node> newSlaves = new ArrayList<Node>(slaves);","2653","                    for (Node n: oldSlaves) {","2654","                        if (n instanceof EphemeralNode) {","2655","                            if(!newSlaves.contains(n)) {","2656","                                newSlaves.add(n);","2657","                            }","2658","                        }","2659","                    }","2660","                    setNodes(newSlaves);","2661","                }","2699","                    for (Node slave : slaves)"]}],"core\/src\/main\/java\/hudson\/slaves\/ComputerRetentionWork.java":[{"add":["2"," *","4"," *","11"," *","14"," *","29","import hudson.model.Queue;","59","        for (final Computer c : Jenkins.getInstance().getComputers()) {","60","            Queue.withLock(new Runnable() {","61","                @Override","62","                public void run() {","63","                    Node n = c.getNode();","64","                    if (n!=null && n.isHoldOffLaunchUntilSave())","65","                        return;","66","                    if (!nextCheck.containsKey(c) || startRun > nextCheck.get(c)) {","67","                        \/\/ at the moment I don't trust strategies to wait more than 60 minutes","68","                        \/\/ strategies need to wait at least one minute","69","                        final long waitInMins = Math.max(1, Math.min(60, c.getRetentionStrategy().check(c)));","70","                        nextCheck.put(c, startRun + waitInMins*1000*60 \/*MINS->MILLIS*\/);","71","                    }","72","                }","73","            });"],"delete":["2"," * ","4"," * ","11"," * ","14"," * ","58","        for (Computer c : Jenkins.getInstance().getComputers()) {","59","            Node n = c.getNode();","60","            if (n!=null && n.isHoldOffLaunchUntilSave())","61","                continue;","62","            if (!nextCheck.containsKey(c) || startRun > nextCheck.get(c)) {","63","                \/\/ at the moment I don't trust strategies to wait more than 60 minutes","64","                \/\/ strategies need to wait at least one minute","65","                final long waitInMins = Math.max(1, Math.min(60, c.getRetentionStrategy().check(c)));","66","                nextCheck.put(c, startRun + waitInMins*1000*60 \/*MINS->MILLIS*\/);","67","            }"]}],"core\/src\/main\/resources\/lib\/layout\/layout.jelly":[{"add":["71","  <j:set var=\"extensionsAvailable\" value=\"${h.extensionsAvailable}\"\/>","74","    <j:if test=\"${extensionsAvailable}\">","75","      <j:forEach var=\"pd\" items=\"${h.pageDecorators}\">","76","        <st:include it=\"${pd}\" page=\"httpHeaders.jelly\" optional=\"true\"\/>","77","      <\/j:forEach>","78","    <\/j:if>","131","    <j:if test=\"${extensionsAvailable}\">","132","      <script>","133","          crumb.init(\"${h.getCrumbRequestField()}\", \"${h.getCrumb(request)}\");","134","      <\/script>","135","    <\/j:if>","150","    <j:if test=\"${extensionsAvailable}\">","151","      <j:forEach var=\"pd\" items=\"${h.pageDecorators}\">","152","        <st:include it=\"${pd}\" page=\"header.jelly\" optional=\"true\" \/>","153","      <\/j:forEach>","154","    <\/j:if>","268","        <j:if test=\"${extensionsAvailable}\">","272","        <\/j:if>"],"delete":["73","    <j:forEach var=\"pd\" items=\"${h.pageDecorators}\">","74","      <st:include it=\"${pd}\" page=\"httpHeaders.jelly\" optional=\"true\"\/>","75","    <\/j:forEach>","128","    <script>","129","        crumb.init(\"${h.getCrumbRequestField()}\", \"${h.getCrumb(request)}\");","130","    <\/script>","145","    <j:forEach var=\"pd\" items=\"${h.pageDecorators}\">","146","      <st:include it=\"${pd}\" page=\"header.jelly\" optional=\"true\" \/>","147","    <\/j:forEach>"]}],"core\/src\/main\/java\/hudson\/model\/Executor.java":[{"add":["39","import net.jcip.annotations.GuardedBy;","51","import java.io.PrintWriter;","52","import java.io.StringWriter;","58","import java.util.concurrent.locks.ReadWriteLock;","59","import java.util.concurrent.locks.ReentrantReadWriteLock;","80","    private final ReadWriteLock lock = new ReentrantReadWriteLock();","82","    @GuardedBy(\"#lock\")","96","    @GuardedBy(\"#lock\")","97","    private Queue.Executable executable;","103","    @GuardedBy(\"#lock\")","104","    private WorkUnit workUnit;","110","    @GuardedBy(\"#lock\")","111","    private boolean started;","117","    @GuardedBy(\"#lock\")","123","    @GuardedBy(\"#lock\")","162","        lock.writeLock().lock();","163","        try {","170","            interruptStatus = result;","171","","176","        } finally {","177","            lock.writeLock().unlock();","183","        lock.readLock().lock();","184","        try {","185","            Result r = interruptStatus;","186","            if (r == null) r =","187","                    Result.ABORTED; \/\/ this is when we programmatically throw InterruptedException instead of calling the interrupt method.","188","","189","            return r;","190","        } finally {","191","            lock.readLock().unlock();","192","        }","203","        \/\/ atomically get&clear causes.","204","        lock.writeLock().lock();","205","        try {","209","        } finally {","210","            lock.writeLock().unlock();","218","    \/**","219","     * There are some cases where an executor is started but the node is removed or goes off-line before we are ready","220","     * to start executing the assigned work unit. This method is called to clear the assigned work unit so that","221","     * the {@link Queue#maintain()} method can return the item to the buildable state.","222","     *","223","     * Note: once we create the {@link Executable} we cannot unwind the state and the build will have to end up being","224","     * marked as a failure.","225","     *\/","226","    private void resetWorkUnit(String reason) {","227","        StringWriter writer = new StringWriter();","228","        PrintWriter pw = new PrintWriter(writer);","229","        try {","230","            pw.printf(\"%s grabbed %s from queue but %s %s. \", getName(), workUnit, owner.getDisplayName(), reason);","231","            if (owner.getTerminatedBy().isEmpty()) {","232","                pw.print(\"No termination trace available.\");","233","            } else {","234","                pw.println(\"Termination trace follows:\");","235","                for (RuntimeException terminator: owner.getTerminatedBy()) {","236","                    terminator.printStackTrace(pw);","237","                }","238","            }","239","        } finally {","240","            pw.close();","241","        }","242","        LOGGER.log(WARNING, writer.toString());","243","        lock.writeLock().lock();","244","        try {","245","            if (executable != null) {","246","                throw new IllegalStateException(\"Cannot reset the work unit after the executable has been created\");","247","            }","248","            workUnit = null;","249","        } finally {","250","            lock.writeLock().unlock();","251","        }","252","    }","253","","256","        if (!owner.isOnline()) {","257","            resetWorkUnit(\"went off-line before the task's worker thread started\");","258","            owner.removeExecutor(this);","259","            queue.scheduleMaintenance();","260","            return;","261","        }","262","        if (owner.getNode() == null) {","263","            resetWorkUnit(\"was removed before the task's worker thread started\");","264","            owner.removeExecutor(this);","265","            queue.scheduleMaintenance();","266","            return;","267","        }","268","        final WorkUnit workUnit;","269","        lock.writeLock().lock();","270","        try {","271","            startTime = System.currentTimeMillis();","272","            workUnit = this.workUnit;","273","        } finally {","274","            lock.writeLock().unlock();","275","        }","285","            task = Queue.withLock(new java.util.concurrent.Callable<SubTask>() {","286","                @Override","287","                public SubTask call() throws Exception {","288","                    if (!owner.isOnline()) {","289","                        resetWorkUnit(\"went off-line before the task's worker thread was ready to execute\");","290","                        return null;","291","                    }","292","                    if (owner.getNode() == null) {","293","                        resetWorkUnit(\"was removed before the task's worker thread was ready to execute\");","294","                        return null;","295","                    }","296","                    \/\/ after this point we cannot unwind the assignment of the work unit, if the owner","297","                    \/\/ is removed or goes off-line then the build will just have to fail.","298","                    workUnit.setExecutor(Executor.this);","299","                    queue.onStartExecuting(Executor.this);","300","                    if (LOGGER.isLoggable(FINE))","301","                        LOGGER.log(FINE, getName()+\" grabbed \"+workUnit+\" from queue\");","302","                    SubTask task = workUnit.work;","303","                    Executable executable = task.createExecutable();","304","                    lock.writeLock().lock();","305","                    try {","306","                        Executor.this.executable = executable;","307","                    } finally {","308","                        lock.writeLock().unlock();","309","                    }","310","                    workUnit.setExecutable(executable);","311","                    return task;","312","                }","313","            });","314","            Executable executable;","315","            lock.readLock().lock();","316","            try {","317","                if (this.workUnit == null) {","318","                    \/\/ we called resetWorkUnit, so bail. Outer finally will remove this and schedule queue maintenance","319","                    return;","320","                }","321","                executable = this.executable;","322","            } finally {","323","                lock.readLock().unlock();","379","            for (RuntimeException e1: owner.getTerminatedBy()) LOGGER.log(Level.WARNING, String.format(\"%s termination trace\", getName()), e1);","403","        lock.readLock().lock();","404","        try {","405","            return executable;","406","        } finally {","407","            lock.readLock().unlock();","408","        }","420","        lock.readLock().lock();","421","        try {","422","            return workUnit;","423","        } finally {","424","            lock.readLock().unlock();","425","        }","434","        lock.readLock().lock();","435","        try {","436","            if (executable == null) {","437","                return null;","438","            }","439","            if (executable instanceof AbstractBuild) {","440","                AbstractBuild ab = (AbstractBuild) executable;","441","                return ab.getWorkspace();","442","            }","443","            return null;","444","        } finally {","445","            lock.readLock().unlock();","473","        lock.readLock().lock();","474","        try {","475","            return workUnit == null && executable == null;","476","        } finally {","477","            lock.readLock().unlock();","478","        }","485","        lock.readLock().lock();","486","        try {","487","            return workUnit != null || executable != null;","488","        } finally {","489","            lock.readLock().unlock();","490","        }","503","        lock.readLock().lock();","504","        try {","505","            return !started || isAlive();","506","        } finally {","507","            lock.readLock().unlock();","508","        }","515","        lock.readLock().lock();","516","        try {","517","            return !started;","518","        } finally {","519","            lock.readLock().unlock();","520","        }","541","        long d;","542","        lock.readLock().lock();","543","        try {","544","            if (executable == null) {","545","                return -1;","546","            }","547","            d = Executables.getEstimatedDurationFor(executable);","548","        } finally {","549","            lock.readLock().unlock();","550","        }","551","        if (d < 0) {","552","            return -1;","553","        }","555","        int num = (int) (getElapsedTime() * 100 \/ d);","556","        if (num >= 100) {","557","            num = 99;","558","        }","571","        long d;","572","        long elapsed;","573","        lock.readLock().lock();","574","        try {","575","            if (executable == null) {","576","                return false;","577","            }","579","            elapsed = getElapsedTime();","580","            d = Executables.getEstimatedDurationFor(executable);","581","        } finally {","582","            lock.readLock().unlock();","583","        }","584","        if (d >= 0) {","586","            return d * 10 < elapsed;","589","            return TimeUnit2.MILLISECONDS.toHours(elapsed) > 24;","594","        lock.readLock().lock();","595","        try {","596","            return System.currentTimeMillis() - startTime;","597","        } finally {","598","            lock.readLock().unlock();","599","        }","608","        lock.readLock().lock();","609","        try {","610","            return startTime - workUnit.context.item.buildableStartMilliseconds;","611","        } finally {","612","            lock.readLock().unlock();","613","        }","631","        long d;","632","        lock.readLock().lock();","633","        try {","634","            if (executable == null) {","635","                return Messages.Executor_NotAvailable();","636","            }","638","            d = Executables.getEstimatedDurationFor(executable);","639","        } finally {","640","            lock.readLock().unlock();","641","        }","642","        if (d < 0) {","643","            return Messages.Executor_NotAvailable();","644","        }","646","        long eta = d - getElapsedTime();","647","        if (eta <= 0) {","648","            return Messages.Executor_NotAvailable();","649","        }","659","        long d;","660","        lock.readLock().lock();","661","        try {","662","            if (executable == null) {","663","                return -1;","664","            }","666","            d = Executables.getEstimatedDurationFor(executable);","667","        } finally {","668","            lock.readLock().unlock();","669","        }","670","        if (d < 0) {","671","            return -1;","672","        }","674","        long eta = d - getElapsedTime();","675","        if (eta <= 0) {","676","            return -1;","677","        }","688","    public void start() {","692","    \/*protected*\/ void start(WorkUnit task) {","693","        lock.writeLock().lock();","694","        try {","695","            this.workUnit = task;","696","            super.start();","697","            started = true;","698","        } finally {","699","            lock.writeLock().unlock();","700","        }","720","        lock.writeLock().lock(); \/\/ need write lock as interrupt will change the field","721","        try {","722","            if (executable != null) {","723","                Tasks.getOwnerTaskOf(getParentOf(executable)).checkAbortPermission();","724","                interrupt();","725","            }","726","        } finally {","727","            lock.writeLock().unlock();","748","        lock.readLock().lock();","749","        try {","750","            return executable != null && Tasks.getOwnerTaskOf(getParentOf(executable)).hasAbortPermission();","751","        } finally {","752","            lock.readLock().unlock();","753","        }","764","        lock.readLock().lock();","765","        try {","766","            if (isIdle())","767","                return Math.max(creationTime, owner.getConnectTime());","768","            else {","769","                return Math.max(startTime + Math.max(0, Executables.getEstimatedDurationFor(executable)),","770","                        System.currentTimeMillis() + 15000);","771","            }","772","        } finally {","773","            lock.readLock().unlock();"],"delete":["89","    private volatile Queue.Executable executable;","95","    private volatile WorkUnit workUnit;","101","    private volatile boolean started;","150","        synchronized (this) {","156","        }","158","        interruptStatus = result;","159","        synchronized (this.causes) {","169","        Result r = interruptStatus;","170","        if (r==null)    r = Result.ABORTED; \/\/ this is when we programmatically throw InterruptedException instead of calling the interrupt method.","171","        return r;","182","        \/\/ atomically get&clear causes, and minimize the lock.","183","        synchronized (causes) {","196","        startTime = System.currentTimeMillis();","206","            synchronized (queue) {","207","                workUnit.setExecutor(this);","208","                queue.onStartExecuting(this);","209","                if (LOGGER.isLoggable(FINE))","210","                    LOGGER.log(FINE, getName()+\" grabbed \"+workUnit+\" from queue\");","211","                task = workUnit.work;","212","                executable = task.createExecutable();","213","                workUnit.setExecutable(executable);","292","        return executable;","304","        return workUnit;","313","        Executable e = executable;","314","        if(e==null) return null;","315","        if (e instanceof AbstractBuild) {","316","            AbstractBuild ab = (AbstractBuild) e;","317","            return ab.getWorkspace();","319","        return null;","346","        return executable==null;","353","        return executable!=null;","366","        return !started || isAlive();","373","        return !started;","394","        Queue.Executable e = executable;","395","        if(e==null)     return -1;","396","        long d = Executables.getEstimatedDurationFor(e);","397","        if(d<0)         return -1;","399","        int num = (int)(getElapsedTime()*100\/d);","400","        if(num>=100)    num=99;","413","        Queue.Executable e = executable;","414","        if(e==null)     return false;","416","        long elapsed = getElapsedTime();","417","        long d = Executables.getEstimatedDurationFor(e);","418","        if(d>=0) {","420","            return d*10 < elapsed;","423","            return TimeUnit2.MILLISECONDS.toHours(elapsed)>24;","428","        return System.currentTimeMillis() - startTime;","437","        return startTime - workUnit.context.item.buildableStartMilliseconds;","455","        Queue.Executable e = executable;","456","        if(e==null)     return Messages.Executor_NotAvailable();","458","        long d = Executables.getEstimatedDurationFor(e);","459","        if(d<0)         return Messages.Executor_NotAvailable();","461","        long eta = d-getElapsedTime();","462","        if(eta<=0)      return Messages.Executor_NotAvailable();","472","        Queue.Executable e = executable;","473","        if(e==null)     return -1;","475","        long d = Executables.getEstimatedDurationFor(e);","476","        if(d<0)         return -1;","478","        long eta = d-getElapsedTime();","479","        if(eta<=0)      return -1;","490","    public synchronized void start() {","494","    \/*protected*\/ synchronized void start(WorkUnit task) {","495","        this.workUnit = task;","496","        super.start();","497","        started = true;","517","        Queue.Executable e = executable;","518","        if(e!=null) {","519","            Tasks.getOwnerTaskOf(getParentOf(e)).checkAbortPermission();","520","            interrupt();","541","        Queue.Executable e = executable;","542","        return e!=null && Tasks.getOwnerTaskOf(getParentOf(e)).hasAbortPermission();","553","        if (isIdle())","554","            return Math.max(creationTime, owner.getConnectTime());","555","        else {","556","            return Math.max(startTime + Math.max(0, Executables.getEstimatedDurationFor(executable)),","557","                    System.currentTimeMillis() + 15000);"]}]}},"9568986efb1f435ca2c95422c57fcf579c8bf222":{"changes":{"core\/src\/main\/java\/jenkins\/model\/GlobalProjectNamingStrategyConfiguration.java":"MODIFY"},"diff":{"core\/src\/main\/java\/jenkins\/model\/GlobalProjectNamingStrategyConfiguration.java":[{"add":["48","                Class clazz = Class.forName(className, true, Jenkins.getInstance().getPluginManager().uberClassLoader);"],"delete":["48","                Class clazz = Class.forName(className);"]}]}},"415cd5472a5d39f7493d5157e78dba9e8dfb9cb4":{"changes":{"war\/src\/main\/webapp\/scripts\/hudson-behavior.js":"MODIFY"},"diff":{"war\/src\/main\/webapp\/scripts\/hudson-behavior.js":[{"add":["1031","            try { c.addEventListener(\"change\",h,false); } catch (ex) { c.attachEvent(\"change\",h); }"],"delete":["1031","            c.addEventListener(\"change\",h,false);"]}]}},"12fd3e47e393fb1942cd5cb29766bcefe62a81f8":{"changes":{"core\/src\/main\/java\/hudson\/model\/Job.java":"MODIFY","core\/src\/main\/java\/jenkins\/model\/lazy\/AbstractLazyLoadRunMap.java":"MODIFY","core\/src\/test\/java\/jenkins\/model\/lazy\/SortedIntListTest.java":"MODIFY","test\/src\/test\/java\/hudson\/model\/RunMapTest.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/RunMap.java":"MODIFY","core\/src\/main\/java\/jenkins\/model\/Jenkins.java":"MODIFY","core\/src\/main\/java\/jenkins\/model\/lazy\/LazyBuildMixIn.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/Queue.java":"MODIFY","core\/src\/main\/java\/jenkins\/model\/lazy\/SortedIntList.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/Job.java":[{"add":["126","    private static final Logger LOGGER = Logger.getLogger(Job.class.getName());","127","","208","                LOGGER.log(Level.WARNING, \"Corruption in {0}: {1}\", new Object[] {f, e});","209","                if (this instanceof LazyBuildMixIn.LazyLoadingJob) {","210","                    \/\/ allow LazyBuildMixIn.onLoad to fix it","212","                    RunT lB = getLastBuild();","213","                    synchronized (this) {","214","                        this.nextBuildNumber = lB != null ? lB.getNumber() + 1 : 1;","215","                    }","216","                    saveNextBuildNumber();","1241","            LOGGER.log(Level.WARNING, \"failed to parse \" + json, e);"],"delete":["25","import com.google.common.base.Function;","26","import com.google.common.collect.Collections2;","208","                \/\/ try to infer the value of the next build number from the existing build records. See JENKINS-11563","209","                File[] folders = buildDir.listFiles(new FileFilter() {","210","                    public boolean accept(File file) {","211","                        return file.isDirectory() && file.getName().matches(\"[0-9]+\");","212","                    }","213","                });","214","","215","                if (folders == null || folders.length == 0) {","216","                    this.nextBuildNumber = 1;","218","                    Collection<Integer> foldersInt = Collections2.transform(Arrays.asList(folders), new Function<File, Integer>() {","219","                        public Integer apply(File file) {","220","                            return Integer.parseInt(file.getName());","221","                        }","222","                    });","223","                    this.nextBuildNumber = Collections.max(foldersInt) + 1;","225","                saveNextBuildNumber();","1249","            Logger.getLogger(Job.class.getName()).log(Level.WARNING, \"failed to parse \" + json, e);"]}],"core\/src\/main\/java\/jenkins\/model\/lazy\/AbstractLazyLoadRunMap.java":[{"add":["370","    \/**","371","     * @return the highest recorded build number, or 0 if there are none","372","     *\/","373","    @Restricted(NoExternalUse.class)","374","    public synchronized int maxNumberOnDisk() {","375","        return numberOnDisk.max();","376","    }","377","","379","        if (number <= maxNumberOnDisk()) {","380","            throw new IllegalStateException(\"JENKINS-27530: cannot create a build with number \" + number + \" since that (or higher) is already in use among \" + numberOnDisk);"],"delete":["371","        if (numberOnDisk.isInRange(numberOnDisk.ceil(number))) {","372","            throw new IllegalStateException(\"cannot create a build with number \" + number + \" since that (or higher) is already in use among \" + numberOnDisk);"]}],"core\/src\/test\/java\/jenkins\/model\/lazy\/SortedIntListTest.java":[{"add":["36","    @Test public void max() {","37","        SortedIntList l = new SortedIntList(5);","38","        assertEquals(0, l.max());","39","        l.add(1);","40","        assertEquals(1, l.max());","41","        l.add(5);","42","        assertEquals(5, l.max());","43","        l.add(10);","44","        assertEquals(10, l.max());","45","    }","46",""],"delete":[]}],"test\/src\/test\/java\/hudson\/model\/RunMapTest.java":[{"add":["2","import hudson.model.queue.QueueTaskFuture;","15","    \/\/ TODO https:\/\/github.com\/jenkinsci\/jenkins\/pull\/2438: @Rule public LoggerRule logs = new LoggerRule();","46","    @Issue(\"JENKINS-27530\")","47","    @Test public void reloadWhileBuildIsInQueue() throws Exception {","48","        \/\/logs.record(Queue.class, Level.FINE);","49","        FreeStyleProject p = r.createFreeStyleProject(\"p\");","50","        p.getBuildersList().add(new SleepBuilder(9999999));","51","        r.jenkins.setNumExecutors(1);","52","        assertEquals(1, p.scheduleBuild2(0).waitForStart().number);","53","        p.scheduleBuild2(0);","54","        \/\/ Note that the bug does not reproduce simply from p.doReload(), since in that case Job identity remains intact:","55","        r.jenkins.reload();","56","        p = r.jenkins.getItemByFullName(\"p\", FreeStyleProject.class);","57","        FreeStyleBuild b1 = p.getLastBuild();","58","        assertEquals(1, b1.getNumber());","59","        \/* Currently fails since Run.project is final. But anyway that is not the problem:","60","        assertEquals(p, b1.getParent());","61","        *\/","62","        Queue.Item[] items = Queue.getInstance().getItems();","63","        assertEquals(1, items.length);","64","        assertEquals(p, items[0].task); \/\/ the real issue: assignBuildNumber was being called on the wrong Job","65","        QueueTaskFuture<Queue.Executable> b2f = items[0].getFuture();","66","        b1.getExecutor().interrupt();","67","        r.assertBuildStatus(Result.ABORTED, r.waitForCompletion(b1));","68","        FreeStyleBuild b2 = (FreeStyleBuild) b2f.waitForStart();","69","        assertEquals(2, b2.getNumber());","70","        assertEquals(p, b2.getParent());","71","        b2.getExecutor().interrupt();","72","        r.assertBuildStatus(Result.ABORTED, r.waitForCompletion(b2));","73","        FreeStyleBuild b3 = p.scheduleBuild2(0).waitForStart();","74","        assertEquals(3, b3.getNumber());","75","        assertEquals(p, b3.getParent());","76","        b3.getExecutor().interrupt();","77","        r.assertBuildStatus(Result.ABORTED, r.waitForCompletion(b3));","78","    }","79",""],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/RunMap.java":[{"add":["187","            throw new IllegalStateException(\"JENKINS-23152: \" + rootDir + \" already existed; will not overwrite with \" + r);"],"delete":["187","            throw new IllegalStateException(rootDir + \" already existed; will not overwrite with \" + r);"]}],"core\/src\/main\/java\/jenkins\/model\/Jenkins.java":[{"add":["311","import hudson.init.Initializer;","3715","     * Beware that this calls neither {@link ItemListener#onLoaded} nor {@link Initializer}s.","3718","        queue.save();","3721","        queue.load();"],"delete":["46","import hudson.LocalPluginManager;","241","import org.kohsuke.stapler.DataBoundSetter;"]}],"core\/src\/main\/java\/jenkins\/model\/lazy\/LazyBuildMixIn.java":[{"add":["27","import hudson.model.AbstractItem;","35","import hudson.model.queue.SubTask;","104","        int max = _builds.maxNumberOnDisk();","105","        int next = asJob().getNextBuildNumber();","106","        if (next <= max) {","107","            LOGGER.log(Level.WARNING, \"JENKINS-27530: improper nextBuildNumber {0} detected in {1} with highest build number {2}; adjusting\", new Object[] {next, asJob(), max});","108","            asJob().updateNextBuildNumber(max + 1);","109","        }","131","                    LOGGER.log(Level.FINE, \"keeping reloaded {0}\", r);"],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/Queue.java":[{"add":["344","            \/\/ Clear items, for the benefit of reloading.","345","            waitingList.clear();","346","            blockedProjects.clear();","347","            buildables.clear();","348","            pendings.clear();","1382","            LOGGER.log(Level.FINE, \"Queue maintenance started on {0} with {1}\", new Object[] {this, snapshot});","2792","","2793","        @Override","2794","        public String toString() {","2795","            return \"Queue.Snapshot{waitingList=\" + waitingList + \";blockedProjects=\" + blockedProjects + \";buildables=\" + buildables + \";pendings=\" + pendings + \"}\";","2796","        }"],"delete":["1377","            LOGGER.log(Level.FINE, \"Queue maintenance started {0}\", this);"]}],"core\/src\/main\/java\/jenkins\/model\/lazy\/SortedIntList.java":[{"add":["85","    public int max() {","86","        return size > 0 ? data[size - 1] : 0;","87","    }","88",""],"delete":[]}]}},"e3200aabd52a01dfa677a33919977341e7b6a806":{"changes":{"war\/src\/main\/less\/pluginSetupWizard.less":"MODIFY"},"diff":{"war\/src\/main\/less\/pluginSetupWizard.less":[{"add":["54","    ","125","            height: 20%;","126","            max-height: 20%;","559","       position: relative;","560","       max-height: 40%;","561","       height: 40%;","562","       top: 0;","615","           position: relative;","616","           height: 40%;","617","           max-height: 40%;","618","           top: 0;"],"delete":["54","","557","       position:static;","558","       max-height:33%;","611","           position:static;","612","           max-height:33%;"]}]}},"0bf434845b5de755d730fb73ae1688b02dba8894":{"changes":{"core\/src\/main\/resources\/hudson\/AboutJenkins\/index.jelly":"MODIFY","changelog.html":"MODIFY","core\/src\/main\/java\/hudson\/AboutJenkins.java":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/AboutJenkins\/index.jelly":[{"add":["37","      <j:set var=\"uri\" value=\"${it.licensesURL}\"\/>","38","      <j:choose>","39","          <j:when test=\"${uri != null}\">","40","              <t:thirdPartyLicenses>","41","                  <j:include uri=\"${uri}\"\/>","42","              <\/t:thirdPartyLicenses>","43","          <\/j:when>","44","          <j:otherwise>","45","              <p>${%No information recorded}<\/p>","46","          <\/j:otherwise>","47","      <\/j:choose>"],"delete":["37","      <t:thirdPartyLicenses>","38","        <st:include page=\"\/META-INF\/licenses.xml\" optional=\"true\" \/>","39","      <\/t:thirdPartyLicenses>"]}],"changelog.html":[{"add":["59","  <li class=bug>","60","    Third-party license display for core was broken since 1.506.","61","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-17724\">issue 17724<\/a>)"],"delete":[]}],"core\/src\/main\/java\/hudson\/AboutJenkins.java":[{"add":["3","import java.net.URL;","4","import org.kohsuke.accmod.Restricted;","5","import org.kohsuke.accmod.restrictions.NoExternalUse;","32","","33","    @Restricted(NoExternalUse.class)","34","    public URL getLicensesURL() {","35","        return AboutJenkins.class.getResource(\"\/META-INF\/licenses.xml\");","36","    }","37",""],"delete":[]}]}},"84f6eb075acb375c3800ad3ed58dfedac3f73495":{"changes":{"core\/src\/main\/java\/hudson\/markup\/EscapedMarkupFormatter.java":"MODIFY","test\/src\/test\/java\/hudson\/markup\/MarkupFormatterTest.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/markup\/EscapedMarkupFormatter.java":[{"add":["49","        if (markup != null) {","50","            output.write(Util.escape(markup));","51","        }"],"delete":["49","        output.write(Util.escape(markup));"]}],"test\/src\/test\/java\/hudson\/markup\/MarkupFormatterTest.java":[{"add":["71","","72","    @Test","73","    public void defaultEscaped() throws Exception {","74","        assertEquals(\"&lt;your thing here&gt;\", j.jenkins.getMarkupFormatter().translate(\"<your thing here>\"));","75","        assertEquals(\"\", j.jenkins.getMarkupFormatter().translate(\"\"));","76","        assertEquals(\"\", j.jenkins.getMarkupFormatter().translate(null));","77","    }","78",""],"delete":[]}]}},"61016e1a841c6ec39828e5fb7cdcd83dd426fcb7":{"changes":{"core\/src\/test\/java\/jenkins\/util\/TimeDurationTest.java":"MODIFY"},"diff":{"core\/src\/test\/java\/jenkins\/util\/TimeDurationTest.java":[{"add":["3","import org.jvnet.hudson.test.Issue;","12","@Issue(\"JENKINS-44052\")"],"delete":["11",""]}]}},"e5f61e29e260688d7d73339202c22ca199535018":{"changes":{"core\/src\/main\/resources\/jenkins\/security\/whitelisted-classes.txt":"MODIFY"},"diff":{"core\/src\/main\/resources\/jenkins\/security\/whitelisted-classes.txt":[{"add":["124","java.util.concurrent.ConcurrentLinkedQueue"],"delete":[]}]}},"8f7d16a53382f3794b36439ce494395b0de3c35a":{"changes":{"core\/src\/main\/java\/jenkins\/model\/Jenkins.java":"MODIFY"},"diff":{"core\/src\/main\/java\/jenkins\/model\/Jenkins.java":[{"add":["2452","        if(!projectsDir.getCanonicalFile().isDirectory() && !projectsDir.mkdirs()) {"],"delete":["2452","        if(!projectsDir.isDirectory() && !projectsDir.mkdirs()) {"]}]}},"7f7db958c21b39d29b77c8a186a94fb83f0a30f2":{"changes":{"core\/src\/main\/java\/hudson\/util\/DescribableList.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/util\/DescribableList.java":[{"add":["48","import java.util.logging.Level;","49","import java.util.logging.Logger;","214","                try {","215","                    dd.buildDependencyGraph(owner,graph);","216","                } catch (RuntimeException e) {","217","                    LOGGER.log(Level.SEVERE, \"Failed to build dependency graph for \" + owner,e);","218","                }","285","","286","    private final static Logger LOGGER = Logger.getLogger(DescribableList.class.getName());"],"delete":["212","                dd.buildDependencyGraph(owner,graph);"]}]}},"a6dddf2917c1d9ae819f86947a7ccffa2a04d728":{"changes":{"core\/src\/main\/java\/hudson\/matrix\/MatrixConfiguration.java":"MODIFY","changelog.html":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/matrix\/MatrixConfiguration.java":[{"add":["25","import hudson.EnvVars;","30","import hudson.model.Node;","32","import hudson.model.TaskListener;","90","","91","    @Override","92","    public EnvVars getEnvironment(Node node, TaskListener listener) throws IOException, InterruptedException {","93","        EnvVars env =  super.getEnvironment(node, listener);","94","","95","        AxisList axes = getParent().getAxes();","96","        for (Map.Entry<String,String> e : getCombination().entrySet()) {","97","            Axis a = axes.find(e.getKey());","98","            if (a!=null)","99","                a.addBuildVariable(e.getValue(),env); \/\/ TODO: hijacking addBuildVariable but perhaps we need addEnvVar?","100","            else","101","                env.put(e.getKey(), e.getValue());","102","        }","103","","104","        return env;","105","    }","106",""],"delete":["87","    "]}],"changelog.html":[{"add":["85","  <li class=bug>","86","    Changed the way matrix axis values are exposed as env variables","87","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-11577\">issue 11577<\/a>)"],"delete":[]}]}},"f9810b5131e3024930df233a02a356e3cb5b5f84":{"changes":{"changelog.html":"MODIFY"},"diff":{"changelog.html":[{"add":["57","  <li class='major bug'>","58","    Regression in Windows slaves since 1.547.","59","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-21373\">issue 21373<\/a>)"],"delete":[]}]}},"026f366caf607be27030d2824cfe4e1c7ea4ad17":{"changes":{"war\/pom.xml":"MODIFY"},"diff":{"war\/pom.xml":[{"add":["150","                  <version>0.9.10-hudson-4<\/version>"],"delete":["150","                  <version>0.9.10-hudson-3<\/version>"]}]}},"104f4888bbf587103dc1df6f870a8c688de66895":{"changes":{"core\/src\/main\/java\/hudson\/slaves\/OfflineCause.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/slaves\/OfflineCause.java":[{"add":[],"delete":["105","        @Exported"]}]}},"4fbfe25797079ead5fee2c42145cb4e75365c865":{"changes":{"core\/src\/main\/resources\/hudson\/PluginManager\/sidepanel.groovy":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/PluginManager\/sidepanel.groovy":[{"add":["30","        l.task(icon:\"icon-gear2 icon-md\", href:\"${rootURL}\/manage\", title:_(\"Manage Jenkins\"), permission:app.ADMINISTER, it:app)"],"delete":["30","        l.task(icon:\"icon-setting icon-md\", href:\"${rootURL}\/manage\", title:_(\"Manage Jenkins\"), permission:app.ADMINISTER, it:app)"]}]}},"725b6afeac4ac5b8821c095f3b093cd0daa3a526":{"changes":{"test\/src\/test\/java\/hudson\/model\/AbstractBuildTest2.java":"ADD","core\/src\/main\/java\/hudson\/model\/AbstractBuild.java":"MODIFY"},"diff":{"test\/src\/test\/java\/hudson\/model\/AbstractBuildTest2.java":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/AbstractBuild.java":[{"add":["744","            final String buildStep;","745","","746","            if (bs instanceof Describable) {","747","                buildStep = ((Describable) bs).getDescriptor().getDisplayName();","748","            } else {","749","                buildStep = bs.getClass().getName();","750","            }","753","                LOGGER.log(Level.FINE, \"{0} : {1} failed\", new Object[] {AbstractBuild.this, buildStep});","754","                listener.error(\"Step \u2018\" + buildStep + \"\u2019 failed: \" + e.getMessage());","756","                String msg = \"Step \u2018\" + buildStep + \"\u2019 aborted due to exception: \";"],"delete":["744","            final String publisher = ((Publisher) bs).getDescriptor().getDisplayName();","747","                LOGGER.log(Level.FINE, \"{0} : {1} failed\", new Object[] {AbstractBuild.this, publisher});","748","                listener.error(\"Publisher '\" + publisher + \"' failed: \" + e.getMessage());","750","                String msg = \"Publisher '\" + publisher + \"' aborted due to exception: \";"]}]}},"f36917c210d52ce7fc1f4bca71c9f1baf11c4647":{"changes":{"core\/pom.xml":"MODIFY"},"diff":{"core\/pom.xml":[{"add":["117","      <version>build217-jenkins-10<\/version>"],"delete":["117","      <version>build217-jenkins-9<\/version>"]}]}},"cff691e05a415c860396b9d369c82e01b4aef69d":{"changes":{"maven-plugin\/src\/main\/java\/hudson\/maven\/AbstractMavenBuilder.java":"MODIFY","maven-plugin\/src\/main\/java\/hudson\/maven\/Maven3Builder.java":"MODIFY","changelog.html":"MODIFY"},"diff":{"maven-plugin\/src\/main\/java\/hudson\/maven\/AbstractMavenBuilder.java":[{"add":["201","    protected boolean isDebug() {","202","        for(String goal : goals) {","203","            if (goal.equals(\"-X\") || goal.equals(\"--debug\"))  return true;","204","        }","205","        return false;","206","    }","207","    ","208","    protected boolean isQuiet() {","209","        for(String goal : goals) {","210","            if (goal.equals(\"-q\") || goal.equals(\"--quiet\"))  return true;","211","        }","212","        return false;","213","    }","214",""],"delete":[]}],"maven-plugin\/src\/main\/java\/hudson\/maven\/Maven3Builder.java":[{"add":["169","        private final AbstractMavenBuilder maven3Builder;","189","        public MavenExecutionListener(AbstractMavenBuilder maven3Builder) {","196","            ","197","            \/\/ TODO: we should think about reusing the code in org.apache.maven.cli.DefaultMavenExecutionRequestBuilder#logging?","198","            \/\/ E.g. there's also the option to redirect logging to a file which is handled there, but not here.","199","            PrintStreamLogger logger = new PrintStreamLogger( maven3Builder.listener.getLogger() );","200","            if (maven3Builder.isDebug()) {","201","                logger.setThreshold(PrintStreamLogger.LEVEL_DEBUG);","202","            } else if (maven3Builder.isQuiet()) {","203","                logger.setThreshold(PrintStreamLogger.LEVEL_ERROR);","204","            }","205","            ","206","            this.eventLogger = new ExecutionEventLogger( logger );"],"delete":["169","        private final Maven3Builder maven3Builder;","189","        public MavenExecutionListener(Maven3Builder maven3Builder) {","196","            this.eventLogger = new ExecutionEventLogger( new PrintStreamLogger( maven3Builder.listener.getLogger() ) );"]}],"changelog.html":[{"add":["88","  <li class=bug>","89","    Maven 3 builds ignored quiet (-q) and debug (-X) options ","90","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-16843\">issue 16843<\/a>)"],"delete":[]}]}},"4ecd6cc8377e7e124cbeb87ded49af9424b8a81a":{"changes":{"test\/src\/main\/java\/org\/jvnet\/hudson\/test\/PluginAutomaticTestBuilder.java":"MODIFY"},"diff":{"test\/src\/main\/java\/org\/jvnet\/hudson\/test\/PluginAutomaticTestBuilder.java":[{"add":["25","import hudson.PluginWrapper;","29","import jenkins.model.Jenkins;","59","            suite.addTest(new OtherTests(\"testCliSanity\", params));","60","            suite.addTest(new OtherTests(\"testPluginActive\", params));","82","        private final Map<String,?> params;","83","","84","        public OtherTests(String name, Map<String,?> params) {","86","            this.params = params;","93","        public void testPluginActive() {","94","            String plugin = (String) params.get(\"artifactId\");","95","            if (plugin != null) {","96","                PluginWrapper pw = Jenkins.getInstance().getPluginManager().getPlugin(plugin);","97","                assertNotNull(pw);","98","                assertTrue(plugin + \" was not active\", pw.isActive());","99","            }","100","        }","101",""],"delete":["57","            suite.addTest(new OtherTests(\"testCliSanity\"));","79","        public OtherTests(String name) {"]}]}},"55a287b9ad8a5cdf358ba76aaeefa714b9f47af4":{"changes":{"core\/src\/main\/java\/hudson\/Util.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/AbstractItem.java":"MODIFY","core\/src\/main\/java\/hudson\/maven\/reporters\/MavenArtifact.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/Util.java":[{"add":["29","import java.net.URI;","30","import java.net.URISyntaxException;","701","     * Encodes the URL by RFC 2396.","702","     *","703","     * I thought there's another spec that refers to UTF-8 as the encoding,","704","     * but don't remember it right now.","705","     *","706","     * @since 1.204","707","     *\/","708","    public static String encodeRFC2396(String url) {","709","        try {","710","            return new URI(null,url,null).toASCIIString();","711","        } catch (URISyntaxException e) {","712","            LOGGER.warning(\"Failed to encode \"+url);    \/\/ could this ever happen?","713","            return url;","714","        }","715","    }","716","","717","    \/**"],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/AbstractItem.java":[{"add":["14","import java.net.URI;","153","        return Util.encodeRFC2396(request.getRootPath()+'\/'+getUrl());"],"delete":["152","        return request.getRootPath()+'\/'+getUrl();"]}],"core\/src\/main\/java\/hudson\/maven\/reporters\/MavenArtifact.java":[{"add":["159","        listener.getLogger().println(\"[HUDSON] Archiving \"+ file+\" to \"+target);"],"delete":["158","        listener.getLogger().println(\"[HUDSON] Archiving \"+ file);"]}]}},"71ad43a141ddeb62d6df4a13b8513c42d73c0b82":{"changes":{"changelog.html":"MODIFY","core\/src\/main\/java\/hudson\/slaves\/RetentionStrategy.java":"MODIFY"},"diff":{"changelog.html":[{"add":["58","    With 'on-demand' retention strategy, wrong slave can be started for jobs restricted to specific slave.","59","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-13735\">issue 13735<\/a>)","60","  <li class=bug>"],"delete":[]}],"core\/src\/main\/java\/hudson\/slaves\/RetentionStrategy.java":[{"add":["201","                        if (idleExecutors>0)","202","                            availableComputers.put(o, idleExecutors);","209","                    \/\/ can any of the currently idle executors take this task?","210","                    \/\/ assume the answer is no until we can find such an executor","218","                            } else {","219","                                availableComputers.remove(o);","225","                    \/\/ this 'item' cannot be built by any of the existing idle nodes, but it can be built by 'c'","226","                    if (needExecutor && c.getNode().canTake(item) == null) {"],"delete":["201","                        availableComputers.put(o, idleExecutors);","220","                    if (needExecutor) {"]}]}},"4fb6ad1f3f6b14f9ab17a0c7a2450e86de201ec7":{"changes":{"core\/src\/main\/java\/hudson\/model\/PasswordParameterValue.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/PasswordParameterDefinition.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/PasswordParameterValue.java":[{"add":["3"," * Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi, Romain Seguy","25","import hudson.EnvVars;","26","import hudson.util.Secret;","27","import hudson.util.VariableResolver;","33","public class PasswordParameterValue extends ParameterValue {","34","","35","    private final Secret value;","36","","37","    \/\/ kept for backward compatibility","39","        this(name, value, null);","40","    }","41","","42","    @DataBoundConstructor","43","    public PasswordParameterValue(String name, String value, String description) {","44","        super(name, description);","45","        this.value = Secret.fromString(value);","46","    }","47","","48","    @Override","49","    public void buildEnvVars(AbstractBuild<?,?> build, EnvVars env) {","50","        env.put(name, value != null ? value.toString() : null);","51","    }","52","","53","    @Override","54","    public VariableResolver<String> createVariableResolver(AbstractBuild<?, ?> build) {","55","        return new VariableResolver<String>() {","56","            public String resolve(String name) {","57","                return PasswordParameterValue.this.name.equals(name) ? (value != null ? value.toString() : null) : null;","58","            }","59","        };"],"delete":["3"," * Copyright (c) 2004-2009, Sun Microsystems, Inc.","30","public class PasswordParameterValue extends StringParameterValue {","31","    @DataBoundConstructor","33","        super(name, value);"]}],"core\/src\/main\/java\/hudson\/model\/PasswordParameterDefinition.java":[{"add":["3"," * Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi, Romain Seguy","29","import hudson.util.Secret;","32"," * Parameter whose value is a {@link Secret} and is hidden from the UI.","37","public class PasswordParameterDefinition extends SimpleParameterDefinition {","38","","39","    private Secret defaultValue;","40","","43","        super(name, description);","44","        this.defaultValue = Secret.fromString(defaultValue);","45","    }","46","","47","    @Override","48","    public ParameterValue createValue(String value) {","49","        return new PasswordParameterValue(getName(), value, getDescription());","50","    }","51","","52","    @Override","53","    public PasswordParameterValue createValue(StaplerRequest req, JSONObject jo) {","54","        PasswordParameterValue value = req.bindJSON(PasswordParameterValue.class, jo);","55","        value.setDescription(getDescription());","56","        return value;","57","    }","58","","59","    @Override","60","    public ParameterValue getDefaultParameterValue() {","61","        return new PasswordParameterValue(getName(), getDefaultValue(), getDescription());","62","    }","63","","64","    public String getDefaultValue() {","65","        return defaultValue != null ? defaultValue.toString() : null;","66","    }","67","","68","    \/\/ kept for backward compatibility","69","    public void setDefaultValue(String defaultValue) {","70","        this.defaultValue = Secret.fromString(defaultValue);","79","        ","80","        @Override","81","        public String getHelpFile() {","82","            return \"\/help\/parameter\/string.html\";","83","        }"],"delete":["3"," * Copyright (c) 2004-2009, Sun Microsystems, Inc.","31"," * Parameter whose value is a string, but is hidden from the UI.","32"," * Useful for passwords, even though its protection is still somewhat limited.","37","public class PasswordParameterDefinition extends StringParameterDefinition {","40","        super(name, defaultValue, description);","49","    }","50","","51","    @Override","52","    public PasswordParameterValue createValue(StaplerRequest req, JSONObject jo) {","53","        PasswordParameterValue value = req.bindJSON(PasswordParameterValue.class, jo);","54","        value.setDescription(getDescription());","55","        return value;"]}]}},"85319d0a579af8965854877f9e0f025c04af6db4":{"changes":{"pom.xml":"MODIFY"},"diff":{"pom.xml":[{"add":["172","        <version>3.13<\/version>"],"delete":["172","        <version>3.12<\/version>"]}]}},"c718516adfddeb10cbf616ce37c619cc6bbafd53":{"changes":{"pom.xml":"MODIFY"},"diff":{"pom.xml":[{"add":["181","        <version>2.60<\/version>"],"delete":["181","        <version>2.59<\/version>"]}]}},"d6d06edf90c364a77b5f8677e7a490b194751c69":{"changes":{"core\/src\/main\/java\/hudson\/cli\/EnablePluginCommand.java":"MODIFY","test\/src\/test\/java\/hudson\/cli\/EnablePluginCommandTest.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/cli\/EnablePluginCommand.java":[{"add":["62","        boolean enabledAnyPlugins = false;","64","            enabledAnyPlugins |= enablePlugin(manager, pluginName);","66","        if (restart && enabledAnyPlugins) {","72","    private boolean enablePlugin(PluginManager manager, String shortName) throws IOException {","78","            return false;","84","        return true;"],"delete":["63","            enablePlugin(manager, pluginName);","65","        if (restart) {","71","    private void enablePlugin(PluginManager manager, String shortName) throws IOException {","77","            return;"]}],"test\/src\/test\/java\/hudson\/cli\/EnablePluginCommandTest.java":[{"add":["28","import org.junit.Assume;","31","import org.jvnet.hudson.test.Issue;","56","    private void assertPluginEnabled(String name) {","57","        PluginWrapper plugin = j.getPluginManager().getPlugin(name);","58","        assertThat(plugin, is(notNullValue()));","59","        assertTrue(plugin.isEnabled());","60","    }","61","","62","    private void disablePlugin(String name) throws IOException {","63","        PluginWrapper plugin = j.getPluginManager().getPlugin(name);","64","        assertThat(plugin, is(notNullValue()));","65","        plugin.disable();","66","    }","67","","68","    private void assertPluginDisabled(String name) {","69","        PluginWrapper plugin = j.getPluginManager().getPlugin(name);","70","        assertThat(plugin, is(notNullValue()));","71","        assertFalse(plugin.isEnabled());","72","    }","73","","74","    private void assumeNotWindows() {","75","        Assume.assumeFalse(System.getProperty(\"os.name\").startsWith(\"Windows\"));","76","    }","77","","78","    private void assertJenkinsInQuietMode() {","79","        QuietDownCommandTest.assertJenkinsInQuietMode(j);","80","    }","81","","82","    private void assertJenkinsNotInQuietMode() {","83","        QuietDownCommandTest.assertJenkinsNotInQuietMode(j);","84","    }","85","","87","    @Issue(\"JENKINS-52822\")","92","        assertThat(installTestPlugin(name), succeeded());","93","        assertPluginEnabled(name);","94","        disablePlugin(name);","95","        assertPluginDisabled(name);","97","        assertPluginEnabled(name);","98","        assertJenkinsNotInQuietMode();","102","    @Issue(\"JENKINS-52822\")","104","        assertThat(enablePlugins(\"foobar\"), failedWith(3));","105","        assertJenkinsNotInQuietMode();","109","    @Issue(\"JENKINS-52822\")","113","        disablePlugin(\"depender\");","114","        disablePlugin(\"dependee\");","116","        assertPluginEnabled(\"depender\");","117","        assertPluginEnabled(\"dependee\");","118","        assertJenkinsNotInQuietMode();","119","    }","120","","121","    @Test","122","    @Issue(\"JENKINS-52950\")","123","    public void enablePluginWithRestart() throws IOException {","124","        assumeNotWindows();","125","        String name = \"credentials\";","126","        assertThat(installTestPlugin(name), succeeded());","127","        disablePlugin(name);","128","        assertThat(enablePlugins(\"-restart\", name), succeeded());","129","        assertJenkinsInQuietMode();","130","    }","131","","132","    @Test","133","    @Issue(\"JENKINS-52950\")","134","    public void enableNoPluginsWithRestartIsNoOp() {","135","        assumeNotWindows();","136","        String name = \"variant\";","137","        assertThat(installTestPlugin(name), succeeded());","138","        assertThat(enablePlugins(\"-restart\", name), succeeded());","139","        assertJenkinsNotInQuietMode();"],"delete":["59","        assertThat(installTestPlugin(\"token-macro\"), succeeded());","60","        PluginWrapper wrapper = m.getPlugin(name);","61","        assertThat(wrapper, is(notNullValue()));","62","        assertTrue(wrapper.isEnabled());","63","        wrapper.disable();","64","        assertFalse(wrapper.isEnabled());","65","","67","        assertTrue(wrapper.isEnabled());","72","        assertThat(","73","                new CLICommandInvoker(j, \"enable-plugin\").invokeWithArgs(\"foobar\"), failedWith(3)","74","        );","81","        PluginManager m = j.getPluginManager();","82","        PluginWrapper depender = m.getPlugin(\"depender\");","83","        assertThat(depender, is(notNullValue()));","84","        PluginWrapper dependee = m.getPlugin(\"dependee\");","85","        assertThat(dependee, is(notNullValue()));","86","","87","        depender.disable();","88","        dependee.disable();","89","","91","        assertTrue(depender.isEnabled());","92","        assertTrue(dependee.isEnabled());"]}]}},"a885cc2179ea76bced186c3ed223ce50fec58a75":{"changes":{"core\/src\/main\/resources\/hudson\/util\/Messages.properties":"MODIFY","core\/src\/main\/java\/hudson\/util\/FormFieldValidator.java":"MODIFY","changelog.html":"MODIFY","core\/src\/main\/resources\/hudson\/Messages.properties":"MODIFY","core\/src\/test\/java\/hudson\/FilePathTest.java":"MODIFY","core\/src\/main\/java\/hudson\/FilePath.java":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/util\/Messages.properties":[{"add":["26","FormFieldValidator.did_not_manage_to_validate_may_be_too_sl=Did not manage to validate {0} (may be too slow)","29","HttpResponses.Saved=Saved"],"delete":["28","HttpResponses.Saved=Saved"]}],"core\/src\/main\/java\/hudson\/util\/FormFieldValidator.java":[{"add":["380","                String msg = ws.validateAntFileMask(value, 10000);","384","                ok(Messages.FormFieldValidator_did_not_manage_to_validate_may_be_too_sl(value));"],"delete":["380","                String msg = ws.validateAntFileMask(value);","384","                ok(); \/\/ coundn't check"]}],"changelog.html":[{"add":["60","  <li class=bug>","61","    <code>FilePath.validateAntFileMask<\/code> too slow for <code>\/configure<\/code>.","62","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-7214\">issue 7214<\/a>)"],"delete":[]}],"core\/src\/main\/resources\/hudson\/Messages.properties":[{"add":["22","FilePath.did_not_manage_to_validate_may_be_too_sl=Did not manage to validate {0} (may be too slow)"],"delete":[]}],"core\/src\/test\/java\/hudson\/FilePathTest.java":[{"add":["451","    @Bug(7214)","452","    public void testValidateAntFileMaskBounded() throws Exception {","453","        File tmp = Util.createTempDir();","454","        try {","455","            FilePath d = new FilePath(french, tmp.getPath());","456","            FilePath d2 = d.child(\"d1\/d2\");","457","            d2.mkdirs();","458","            for (int i = 0; i < 100; i++) {","459","                FilePath d3 = d2.child(\"d\" + i);","460","                d3.mkdirs();","461","                d3.child(\"f.txt\").touch(0);","462","            }","463","            assertEquals(null, d.validateAntFileMask(\"d1\/d2\/**\/f.txt\"));","464","            assertEquals(null, d.validateAntFileMask(\"d1\/d2\/**\/f.txt\", 10));","465","            assertEquals(Messages.FilePath_validateAntFileMask_portionMatchButPreviousNotMatchAndSuggest(\"**\/*.js\", \"**\", \"**\/*.js\"), d.validateAntFileMask(\"**\/*.js\", 1000));","466","            try {","467","                d.validateAntFileMask(\"**\/*.js\", 10);","468","                fail();","469","            } catch (InterruptedException x) {","470","                \/\/ good","471","            }","472","        } finally {","473","            Util.deleteRecursive(tmp);","474","        }","475","    }","476",""],"delete":[]}],"core\/src\/main\/java\/hudson\/FilePath.java":[{"add":["841","                throw (InterruptedException)new InterruptedException(e.getMessage()).initCause(e);","1977","        return validateAntFileMask(fileMasks, Integer.MAX_VALUE);","1978","    }","1979","","1980","    \/**","1981","     * Like {@link #validateAntFileMask(String)} but performing only a bounded number of operations.","1982","     * <p>Whereas the unbounded overload is appropriate for calling from cancelable, long-running tasks such as build steps,","1983","     * this overload should be used when an answer is needed quickly, such as for {@link #validateFileMask(String)}","1984","     * or anything else returning {@link FormValidation}.","1985","     * <p>If a positive match is found, {@code null} is returned immediately.","1986","     * A message is returned in case the file pattern can definitely be determined to not match anything in the directory within the alloted time.","1987","     * If the time runs out without finding a match but without ruling out the possibility that there might be one, {@link InterruptedException} is thrown,","1988","     * in which case the calling code should give the user the benefit of the doubt and use {@link hudson.util.FormValidation.Kind#OK} (with or without a message).","1989","     * @param bound a maximum number of negative operations (deliberately left vague) to perform before giving up on a precise answer; 10_000 is a reasonable pick","1990","     * @throws InterruptedException not only in case of a channel failure, but also if too many operations were performed without finding any matches","1991","     * @since 1.484","1992","     *\/","1993","    public String validateAntFileMask(final String fileMasks, final int bound) throws IOException, InterruptedException {","1995","            private static final long serialVersionUID = 1;","1996","            public String invoke(File dir, VirtualChannel channel) throws IOException, InterruptedException {","2093","            private boolean hasMatch(File dir, String pattern) throws InterruptedException {","2094","                class Cancel extends RuntimeException {}","2095","                DirectoryScanner ds = bound == Integer.MAX_VALUE ? new DirectoryScanner() : new DirectoryScanner() {","2096","                    int ticks;","2097","                    @Override public synchronized boolean isCaseSensitive() {","2098","                        if (!filesIncluded.isEmpty() || !dirsIncluded.isEmpty() || ticks++ > bound) {","2099","                            throw new Cancel();","2100","                        }","2101","                        return super.isCaseSensitive();","2102","                    }","2103","                };","2104","                ds.setBasedir(dir);","2105","                ds.setIncludes(new String[] {pattern});","2106","                try {","2107","                    ds.scan();","2108","                } catch (Cancel c) {","2109","                    if (ds.getIncludedFilesCount()!=0 || ds.getIncludedDirsCount()!=0) {","2110","                        return true;","2111","                    } else {","2112","                        throw new InterruptedException(\"no matches found within \" + bound);","2113","                    }","2114","                }","2163","            String msg = validateAntFileMask(value, 10000);","2167","            return FormValidation.ok(Messages.FilePath_did_not_manage_to_validate_may_be_too_sl(value));"],"delete":["29","import hudson.model.AbstractDescribableImpl;","842","                throw (InterruptedException)new InterruptedException().initCause(e);","1979","            public String invoke(File dir, VirtualChannel channel) throws IOException {","2076","            private boolean hasMatch(File dir, String pattern) {","2077","                FileSet fs = Util.createFileSet(dir,pattern);","2078","                DirectoryScanner ds = fs.getDirectoryScanner(new Project());","2079","","2128","            String msg = validateAntFileMask(value);","2132","            return FormValidation.ok();"]}]}},"0c6a314297bfac957d7a60059d9fa29b70e17ea6":{"changes":{"core\/src\/main\/java\/hudson\/init\/impl\/InstallUncaughtExceptionHandler.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/init\/impl\/InstallUncaughtExceptionHandler.java":[{"add":["35","                    WebApp.get(j.servletContext).getSomeStapler().invoke(req, rsp, j, \"\/oops\");"],"delete":["35","                    WebApp.get(j.servletContext).getSomeStapler().invoke(req, rsp, Jenkins.get(), \"\/oops\");"]}]}},"9b0e1fb6f6b94b5f2a4267fbf923b917f29ab968":{"changes":{"core\/src\/main\/java\/hudson\/tools\/JDKInstaller.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/tools\/JDKInstaller.java":[{"add":["548","            return n.getChannel().call(new GetCurrentCPU());","564","","565","        static class GetCurrentCPU implements Callable<CPU,DetectionFailedException> {","566","            private static final long serialVersionUID = 1L;","567","            public CPU call() throws DetectionFailedException {","568","                return current();","569","            }","570","        }","571",""],"delete":["548","            return n.getChannel().call(new Callable<CPU,DetectionFailedException>() {","549","                public CPU call() throws DetectionFailedException {","550","                    return current();","551","                }","552","            });"]}]}},"b0c222477b0eaf0bc2c7a4c7eba35be7d2e591a8":{"changes":{"test\/src\/test\/java\/hudson\/maven\/MavenMultiModuleTest.java":"MODIFY","core\/src\/main\/resources\/hudson\/views\/JobColumn\/column.jelly":"MODIFY","maven-plugin\/src\/main\/resources\/hudson\/maven\/MavenModuleSet\/modules.jelly":"MODIFY","core\/src\/main\/resources\/lib\/hudson\/projectView.jelly":"MODIFY","core\/src\/main\/resources\/hudson\/model\/TreeView\/ajaxRows.jelly":"MODIFY","core\/src\/main\/resources\/hudson\/model\/View\/main.groovy":"MODIFY"},"diff":{"test\/src\/test\/java\/hudson\/maven\/MavenMultiModuleTest.java":[{"add":[],"delete":["2","import com.gargoylesoftware.htmlunit.html.HtmlAnchor;","415","    @Ignore(\"still failing\")","427","        for (HtmlAnchor a : modulesPage.getAnchors()) {","428","            System.out.println(a.getHrefAttribute() + \" ? \" + a.asText());","429","        }"]}],"core\/src\/main\/resources\/hudson\/views\/JobColumn\/column.jelly":[{"add":["27","        <a href=\"${jobBaseUrl}${job.shortUrl}\" class='model-link inside'> <l:breakable value=\"${h.getRelativeDisplayNameFrom(job, itemGroup)}\"\/><\/a>"],"delete":["27","        <a href=\"${jobBaseUrl}${job.shortUrl}\" class='model-link inside'> <l:breakable value=\"${h.getRelativeDisplayNameFrom(job,currentView.owner.itemGroup)}\"\/><\/a>"]}],"maven-plugin\/src\/main\/resources\/hudson\/maven\/MavenModuleSet\/modules.jelly":[{"add":["46","          <t:projectView jobs=\"${it.getDisabledModules(false)}\" showViewTabs=\"${needsView}\" indenter=\"${it.createIndenter()}\" itemGroup=\"${it}\">"],"delete":["46","          <t:projectView jobs=\"${it.getDisabledModules(false)}\" showViewTabs=\"${needsView}\" indenter=\"${it.createIndenter()}\">"]}],"core\/src\/main\/resources\/lib\/hudson\/projectView.jelly":[{"add":["51","    <st:attribute name=\"itemGroup\" use=\"optional\" type=\"hudson.model.ItemGroup\">","52","      The containing group, for purposes of name calculation.","53","    <\/st:attribute>"],"delete":[]}],"core\/src\/main\/resources\/hudson\/model\/TreeView\/ajaxRows.jelly":[{"add":["34","      <!-- TODO set itemGroup? -->","43","<\/j:jelly>"],"delete":["42","<\/j:jelly>"]}],"core\/src\/main\/resources\/hudson\/model\/View\/main.groovy":[{"add":["13","    t.projectView(jobs: items, showViewTabs: true, columnExtensions: my.columns, indenter: my.indenter, itemGroup: my.owner.itemGroup) {"],"delete":["13","    t.projectView(jobs: items, showViewTabs: true, columnExtensions: my.columns, indenter: my.indenter) {"]}]}},"885f61061fa8a9ad394547608450e30e4e3eecbe":{"changes":{"core\/src\/main\/java\/hudson\/security\/ProjectMatrixAuthorizationStrategy.java":"MODIFY","core\/src\/main\/java\/hudson\/security\/AuthorizationMatrixProperty.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/security\/ProjectMatrixAuthorizationStrategy.java":[{"add":["59","            if(name!=null && (name.equals(\"permission\") || name.equals(\"useProjectSecurity\")))\r"],"delete":["59","            if(name!=null && name.equals(\"permission\"))\r"]}],"core\/src\/main\/java\/hudson\/security\/AuthorizationMatrixProperty.java":[{"add":["219","\t\t\twriter.startNode(\"useProjectSecurity\");\r","220","\t\t\tcontext.convertAnother(Boolean.valueOf(amp.isUseProjectSecurity()));\r","221","\t\t\twriter.endNode();\r","222","\t\t\t\r","239","\t\t\tString prop = reader.peekNextChild();\r","240","\t\t\tif (prop!=null && prop.equals(\"useProjectSecurity\")) {\r","241","\t\t\t\treader.moveDown();\r","242","\t\t\t\tBoolean useSecurity = (Boolean) context.convertAnother(as, Boolean.class);\r","243","\t\t\t\tas.setUseProjectSecurity(useSecurity.booleanValue());\r","244","\t\t\t\treader.moveUp();\r","245","\t\t\t}\r"],"delete":[]}]}},"c54a3172d334b00281425a4daef6f2379e11b521":{"changes":{"pom.xml":"MODIFY"},"diff":{"pom.xml":[{"add":["106","    <maven-war-plugin.version>3.2.3<\/maven-war-plugin.version>"],"delete":["106","    <maven-war-plugin.version>3.0.0<\/maven-war-plugin.version> <!-- JENKINS-47127 bump when 3.2.0 is out. Cf. MWAR-407 -->"]}]}},"42913335f1ad5a2fcf3b4480dc6013ed6c1c84ed":{"changes":{"core\/src\/main\/resources\/lib\/hudson\/queue.jelly":"MODIFY"},"diff":{"core\/src\/main\/resources\/lib\/hudson\/queue.jelly":[{"add":["13","          <j:if test=\"${h.hasPermission(app.ADMINISTER)}\">"],"delete":["13","          <j:if test=\"${h.checkPermission(app.ADMINISTER)}\">"]}]}},"6f343dc7c2f0c32e9eb1a0b5d588a2e7ad6f62ba":{"changes":{"core\/src\/main\/java\/hudson\/model\/Computer.java":"MODIFY","core\/src\/main\/java\/jenkins\/model\/Jenkins.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/Queue.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/Computer.java":[{"add":["992","        final Runnable task = new Runnable() {","998","                    if (!isAlive()) {","1006","        };","1007","        if (!Queue.tryWithLock(task)) {","1008","            \/\/ JENKINS-28840 if we couldn't get the lock push the operation to a separate thread to avoid deadlocks","1009","            threadPoolForRemoting.submit(Queue.wrapWithLock(task));","1010","        }","1033","        Queue.withLock(new Runnable() {","1034","            @Override","1035","            public void run() {","1036","                for (Executor e : executors) {","1037","                    e.interruptForShutdown();","1038","                }","1039","            }","1040","        });"],"delete":["992","        Queue.withLock(new Runnable() {","998","                    if (!isAlive()) \/\/ TODO except from interrupt\/doYank this is called while the executor still isActive(), so how could !this.isAlive()?","999","                    {","1007","        });","1030","        for (Executor e : executors) {","1031","            e.interruptForShutdown();","1032","        }"]}],"core\/src\/main\/java\/jenkins\/model\/Jenkins.java":[{"add":["2780","        final Set<Future<?>> pending = new HashSet<Future<?>>();","2782","        \/\/ JENKINS-28840 we know we will be interrupting all the Computers so get the Queue lock once for all","2783","        Queue.withLock(new Runnable() {","2784","            @Override","2785","            public void run() {","2786","                for( Computer c : computers.values() ) {","2787","                    c.interrupt();","2788","                    killComputer(c);","2789","                    pending.add(c.disconnect(null));","2790","                }","2791","            }","2792","        });"],"delete":["2780","        Set<Future<?>> pending = new HashSet<Future<?>>();","2782","        for( Computer c : computers.values() ) {","2783","            c.interrupt();","2784","            killComputer(c);","2785","            pending.add(c.disconnect(null));","2786","        }"]}],"core\/src\/main\/java\/hudson\/model\/Queue.java":[{"add":["114","import org.jenkinsci.remoting.RoleChecker;","339","    private transient final ReentrantLock lock = new ReentrantLock();","1221","    \/**","1222","     * Some operations require to be performed with the {@link Queue} lock held. Use one of these methods rather","1223","     * than locking directly on Queue in order to allow for future refactoring.","1224","     * @param runnable the operation to perform.","1225","     * @return {@code true} if the lock available and the operation performed. ","1226","     * @since 1.FIXME","1227","     *\/","1228","    public static boolean tryWithLock(Runnable runnable) {","1229","        final Jenkins jenkins = Jenkins.getInstance();","1230","        final Queue queue = jenkins == null ? null : jenkins.getQueue();","1231","        if (queue == null) {","1232","            runnable.run();","1233","            return true;","1234","        } else {","1235","            return queue._tryWithLock(runnable);","1236","        }","1237","    }","1238","    \/**","1239","     * Wraps a {@link Runnable} with the  {@link Queue} lock held. ","1240","     *","1241","     * @param runnable the operation to wrap.","1242","     * @since 1.FIXME","1243","     *\/","1244","    public static Runnable wrapWithLock(Runnable runnable) {","1245","        final Jenkins jenkins = Jenkins.getInstance();","1246","        final Queue queue = jenkins == null ? null : jenkins.getQueue();","1247","        return queue == null ? runnable : new LockedRunnable(runnable);","1248","    }","1249","","1250","    \/**","1251","     * Wraps a {@link hudson.remoting.Callable} with the  {@link Queue} lock held. ","1252","     *","1253","     * @param callable the operation to wrap.","1254","     * @since 1.FIXME","1255","     *\/","1256","    public static <V, T extends Throwable> hudson.remoting.Callable<V, T> wrapWithLock(hudson.remoting.Callable<V, T> callable) {","1257","        final Jenkins jenkins = Jenkins.getInstance();","1258","        final Queue queue = jenkins == null ? null : jenkins.getQueue();","1259","        return queue == null ? callable : new LockedHRCallable<>(callable);","1260","    }","1261","","1262","    \/**","1263","     * Wraps a {@link java.util.concurrent.Callable} with the {@link Queue} lock held. ","1264","     *","1265","     * @param callable the operation to wrap.","1266","     * @since 1.FIXME","1267","     *\/","1268","    public static <V> java.util.concurrent.Callable<V> wrapWithLock(java.util.concurrent.Callable<V> callable) {","1269","        final Jenkins jenkins = Jenkins.getInstance();","1270","        final Queue queue = jenkins == null ? null : jenkins.getQueue();","1271","        return queue == null ? callable : new LockedJUCCallable<V>(callable);","1272","    }","1273","","1302","     * @param runnable the operation to perform.","1303","     * @return {@code true} if the lock available and the operation performed. ","1304","     * @since 1.FIXME","1305","     *\/","1306","    protected boolean _tryWithLock(Runnable runnable) {","1307","        if (lock.tryLock()) {","1308","            try {","1309","                runnable.run();","1310","            } finally {","1311","                lock.unlock();","1312","            }","1313","            return true;","1314","        } else {","1315","            return false;","1316","        }","1317","    }","1318","","1319","    \/**","1320","     * Some operations require to be performed with the {@link Queue} lock held. Use one of these methods rather","1321","     * than locking directly on Queue in order to allow for future refactoring.","1383","                        if (e.isInterrupted()) {","1384","                            \/\/ JENKINS-28840 we will deadlock if we try to touch this executor while interrupt flag set","1385","                            \/\/ we need to clear lost pendings as we cannot know what work unit was on this executor","1386","                            \/\/ while it is interrupted. (All this dancing is a result of Executor extending Thread)","1387","                            lostPendings.clear(); \/\/ we'll get them next time around when the flag is cleared.","1388","                            continue;","1389","                        }","2653","    ","2654","    private static class LockedRunnable implements Runnable  {","2655","        private final Runnable delegate;","2656","","2657","        private LockedRunnable(Runnable delegate) {","2658","            this.delegate = delegate;","2659","        }","2660","","2661","        @Override","2662","        public void run() {","2663","            withLock(delegate);","2664","        }","2665","    }","2666","","2667","    private static class LockedJUCCallable<V> implements java.util.concurrent.Callable<V> {","2668","        private final java.util.concurrent.Callable<V> delegate;","2669","","2670","        private LockedJUCCallable(java.util.concurrent.Callable<V> delegate) {","2671","            this.delegate = delegate;","2672","        }","2673","","2674","        @Override","2675","        public V call() throws Exception {","2676","            return withLock(delegate);","2677","        }","2678","    }","2679","","2680","    private static class LockedHRCallable<V,T extends Throwable> implements hudson.remoting.Callable<V,T> {","2681","        private static final long serialVersionUID = 1L;","2682","        private final hudson.remoting.Callable<V,T> delegate;","2683","","2684","        private LockedHRCallable(hudson.remoting.Callable<V,T> delegate) {","2685","            this.delegate = delegate;","2686","        }","2687","","2688","        @Override","2689","        public V call() throws T {","2690","            return withLock(delegate);","2691","        }","2692","","2693","        @Override","2694","        public void checkRoles(RoleChecker checker) throws SecurityException {","2695","            delegate.checkRoles(checker);","2696","        }","2697","    }"],"delete":["101","import java.util.concurrent.locks.Lock;","339","    private transient final Lock lock = new ReentrantLock();"]}]}},"752a7c7b8bd357f2962c0b361eef465b1fd1c83f":{"changes":{"changelog.html":"MODIFY"},"diff":{"changelog.html":[{"add":["58","    Fixed: XML API Logs Too Much Information When Invalid Char is Present","59","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-13378\">issue 13378<\/a>)","60","  <li class=bug>"],"delete":[]}]}},"044c4ad122652f98d82417abefc8b9598130e841":{"changes":{"core\/src\/main\/java\/hudson\/Util.java":"MODIFY","core\/src\/main\/resources\/hudson\/model\/DirectoryBrowserSupport\/dir.jelly":"MODIFY","core\/src\/main\/resources\/hudson\/model\/Run\/artifacts-index.jelly":"MODIFY","core\/src\/main\/java\/hudson\/model\/Run.java":"MODIFY","core\/src\/test\/java\/hudson\/UtilTest.java":"MODIFY","core\/src\/main\/resources\/lib\/hudson\/artifactList.jelly":"MODIFY","core\/src\/main\/java\/hudson\/model\/DirectoryBrowserSupport.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/Util.java":[{"add":["36","import java.nio.CharBuffer;","37","import java.nio.charset.CharacterCodingException;","38","import java.nio.charset.CharsetEncoder;","559","     * @deprecated Only escapes non-ASCII but leaves other URL-unsafe characters.","560","     * Util.rawEncode should generally be used instead, though be careful to pass only","561","     * a single path component to that method (it will encode \/, but this method does not).","563","    @Deprecated","598","     * Encode a single path component for use in an HTTP URL.","599","     * Escapes all non-ASCII, general unsafe (space and \"#%<>[\\]^`{|}~)","600","     * and HTTP special characters (\/;:?) as specified in RFC1738,","601","     * plus backslash (Windows path separator).","602","     * Note that slash(\/) is encoded, so the given string should be a","603","     * single path component used in constructing a URL.","604","     * Method name inspired by PHP's rawencode.","605","     *\/","606","    public static String rawEncode(String s) {","607","        boolean escaped = false;","608","        StringBuilder out = null;","609","        CharsetEncoder enc = null;","610","        CharBuffer buf = null;","611","        char c;","612","        for (int i = 0, m = s.length(); i < m; i++) {","613","            c = s.charAt(i);","614","            if ((c<64 || c>90) && (c<97 || c>122) && (c<38 || c>57 || c==47)","615","                    && c!=61 && c!=36 && c!=33 && c!=95) {","616","                if (!escaped) {","617","                    out = new StringBuilder(i + (m - i) * 3);","618","                    out.append(s.substring(0, i));","619","                    enc = Charset.forName(\"UTF-8\").newEncoder();","620","                    buf = CharBuffer.allocate(1);","621","                    escaped = true;","622","                }","623","                \/\/ 1 char -> UTF8","624","                buf.put(0,c);","625","                buf.rewind();","626","                try {","627","                    for (byte b : enc.encode(buf).array()) {","628","                        out.append('%');","629","                        out.append(toDigit((b >> 4) & 0xF));","630","                        out.append(toDigit(b & 0xF));","631","                    }","632","                } catch (CharacterCodingException ex) { }","633","            } else if (escaped) {","634","                out.append(c);","635","            }","636","        }","637","        return escaped ? out.toString() : s;","638","    }","639","","640","    private static char toDigit(int n) {","641","        return (char)(n < 10 ? '0' + n : 'A' + n - 10);","642","    }","643","","644","    \/**","652","     * Escapes HTML unsafe characters like &lt;, &amp; to the respective character entities."],"delete":["598","     * Escapes HTML unsafe characters like &lt;, &amp;to the respective character entities.","641","    private static char toDigit(int n) {","642","        char ch = Character.forDigit(n,16);","643","        if(ch>='a')     ch = (char)(ch-'a'+'A');","644","        return ch;","645","    }","646",""]}],"core\/src\/main\/resources\/hudson\/model\/DirectoryBrowserSupport\/dir.jelly":[{"add":["11","              <a href=\"${p.href}\">${h.xmlEscape(p.title)}<\/a>","36","                          <a href=\"${t.href}\">${h.xmlEscape(t.title)}<\/a>","39","                          ${h.xmlEscape(t.title)}","56","                        <a href=\"${x.href}\/*view*\/\">${%view}<\/a>"],"delete":["11","              <a href=\"${p.href}\">${p.title}<\/a>","36","                          <a href=\"${t.href}\">${t.title}<\/a>","39","                          ${t.title}","56","                        <a href=\"${x.href}\/*view*\/\">view<\/a>"]}],"core\/src\/main\/resources\/hudson\/model\/Run\/artifacts-index.jelly":[{"add":["5","\t\t  ${%Build Artifacts}","9","\t\t    <li><a href=\"artifact\/${f.href}\">${h.xmlEscape(f.displayPath)}<\/a><\/li>","14","<\/j:jelly>"],"delete":["5","\t\t  Build Artifacts","9","\t\t    <li><a href=\"artifact\/${f}\">${f}<\/a><\/li>","14","<\/j:jelly>"]}],"core\/src\/main\/java\/hudson\/model\/Run.java":[{"add":["568","        for (String child : children) {","573","                addArtifacts(sub, path + child + '\/', pathHref + Util.rawEncode(child) + '\/', r);","575","                r.add(new Artifact(path + child, pathHref + Util.rawEncode(child)));","577","        }"],"delete":["47","import java.net.URLEncoder;","569","        for (String child : children) try {","574","                addArtifacts(sub, path + child + '\/', pathHref + URLEncoder.encode(child,\"UTF-8\") + '\/', r);","576","                r.add(new Artifact(path + child, pathHref + URLEncoder.encode(child,\"UTF-8\")));","578","        } catch (UnsupportedEncodingException e) { \/* Won't happen as UTF-8 is hardcoded *\/ }"]}],"core\/src\/test\/java\/hudson\/UtilTest.java":[{"add":["70","     * Test the rawEncode() method.","71","     *\/","72","    public void testRawEncode() {","73","        String[] data = {  \/\/ Alternating raw,encoded","74","            \"abcdefghijklmnopqrstuvwxyz\", \"abcdefghijklmnopqrstuvwxyz\",","75","            \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\", \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\",","76","            \"01234567890!@$&*()-_=+',.\", \"01234567890!@$&*()-_=+',.\",","77","            \" \\\"#%\/:;<>?\", \"%20%22%23%25%2F%3A%3B%3C%3E%3F\",","78","            \"[\\\\]^`{|}~\", \"%5B%5C%5D%5E%60%7B%7C%7D%7E\",","79","            \"d\\u00E9velopp\\u00E9s\", \"d%C3%A9%00velopp%C3%A9%00s\",","80","        };","81","        for (int i = 0; i < data.length; i += 2) {","82","            assertEquals(\"test \" + i, data[i + 1], Util.rawEncode(data[i]));","83","        }","84","    }","85","","86","    \/**"],"delete":[]}],"core\/src\/main\/resources\/lib\/hudson\/artifactList.jelly":[{"add":["16","                      <a href=\"${baseURL}artifact\/${f.href}\">${h.xmlEscape(f.displayPath)}<\/a>"],"delete":["16","\t              <a href=\"${baseURL}artifact\/${f.href}\">${f.displayPath}<\/a>"]}],"core\/src\/main\/java\/hudson\/model\/DirectoryBrowserSupport.java":[{"add":["381","                    Path p = new Path(Util.rawEncode(f.getName()),f.getName(),f.isDirectory(),f.length(), f.canRead());","388","                        String relPath = Util.rawEncode(f.getName());","399","                            relPath += '\/'+Util.rawEncode(f.getName());","466","            href.append(Util.rawEncode(filePath.getName()));"],"delete":["19","import java.net.URLEncoder;","382","                    Path p = new Path(URLEncoder.encode(f.getName(),\"UTF-8\"),f.getName(),f.isDirectory(),f.length(), f.canRead());","389","                        String relPath = URLEncoder.encode(f.getName(),\"UTF-8\");","400","                            relPath += '\/'+URLEncoder.encode(f.getName(),\"UTF-8\");","467","            href.append(URLEncoder.encode(filePath.getName(),\"UTF-8\"));"]}]}},"3f9550468f49fc12cd3abcdc1e650ef982e2318a":{"changes":{"core\/src\/test\/java\/jenkins\/util\/io\/PathRemoverTest.java":"MODIFY"},"diff":{"core\/src\/test\/java\/jenkins\/util\/io\/PathRemoverTest.java":[{"add":["448","            assertThat(e.getMessage(), endsWith(\"(Discarded \" + (lockedFiles + 1 - maxExceptions) + \" additional exceptions)\"));"],"delete":["448","            assertThat(e.getMessage(), endsWith(\"(Discarded\" + (lockedFiles + 1 - maxExceptions) + \" additional exceptions)\"));"]}]}},"274b058c6279f3cb9a6c4474ba2128452e78b95c":{"changes":{"core\/src\/main\/java\/hudson\/tools\/DownloadFromUrlInstaller.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/tools\/DownloadFromUrlInstaller.java":[{"add":["12","import java.util.HashSet;","172","        \/**","173","         * Merge a list of ToolInstallerList and removes duplicate tool installers (ie having the same id)","174","         * @param jsonList the list of ToolInstallerList to merge","175","         * @return the merged ToolInstallerList wrapped in a JSONObject","176","         *\/","179","","180","            HashSet<String> processedIds = new HashSet<String>();","183","                for(ToolInstallerEntry entry : toolInstallerList.list) {","184","                    \/\/ being able to add the id into the processedIds set means this tool has not been processed before","185","                    if (processedIds.add(entry.id)) {","186","                        reducedToolEntries.add(entry);"],"delete":["173","            \/\/collect all tool installers objects from the multiple json objects","176","                reducedToolEntries.addAll(Arrays.asList(toolInstallerList.list));","177","            }","178","","179","            while (Downloadable.hasDuplicates(reducedToolEntries, \"id\")) {","180","                List<ToolInstallerEntry> tmpToolInstallerEntries = new LinkedList<>();","181","                \/\/we need to skip the processed entries","182","                boolean processed[] = new boolean[reducedToolEntries.size()];","183","                for (int i = 0; i < reducedToolEntries.size(); i++) {","184","                    if (processed[i] == true) {","185","                        continue;","186","                    }","187","                    ToolInstallerEntry data1 = reducedToolEntries.get(i);","188","                    boolean hasDuplicate = false;","189","                    for (int j = i + 1; j < reducedToolEntries.size(); j ++) {","190","                        ToolInstallerEntry data2 = reducedToolEntries.get(j);","191","                        \/\/if we found a duplicate we choose the first one","192","                        if (data1.id.equals(data2.id)) {","193","                            hasDuplicate = true;","194","                            processed[j] = true;","195","                            tmpToolInstallerEntries.add(data1);","196","                            \/\/after the first duplicate has been found we break the loop since the duplicates are","197","                            \/\/processed two by two","198","                            break;","199","                        }","200","                    }","201","                    \/\/if no duplicate has been found we just insert the entry in the tmp list","202","                    if (!hasDuplicate) {","203","                        tmpToolInstallerEntries.add(data1);","206","                reducedToolEntries = tmpToolInstallerEntries;"]}]}},"1e170d43ed097db6146dbdd95acc556fa6d79794":{"changes":{"core\/src\/main\/resources\/lib\/form\/textarea\/textarea.js":"MODIFY"},"diff":{"core\/src\/main\/resources\/lib\/form\/textarea\/textarea.js":[{"add":["4","            var display = p.style.display;","10","","29","            Element.on(e.up('form'),\"jenkins:apply\", function() {","30","                e.value = codemirror.getValue()","31","            })"],"delete":["4","            var display = p.style.display; ","10","        ","29","    \t\tElement.on(e.up('form'),\"jenkins:apply\", function() {","30","\t\t\te.value = codemirror.getValue()","31","\t\t})","33","\t\t","34","        \/\/refresh CM when there are some layout updates","35","        function refreshCM() {","36","            codemirror.refresh();","37","        }","38","        layoutUpdateCallback.add(refreshCM);"]}]}},"e7b2df21a92939e9f01ce0f9afd6112aafc1cfba":{"changes":{"core\/src\/main\/java\/hudson\/model\/UpdateCenter.java":"MODIFY","changelog.html":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/UpdateCenter.java":[{"add":["926","        public String getErrorMessage() {","927","            return error != null ? error.getMessage() : null;","928","        }","929","        "],"delete":[]}],"changelog.html":[{"add":["79","  <li class=bug>","80","    UpdateCenter REST API chokes if there was a plugin installation failure.","81","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-16836\">issue 16836<\/a>)"],"delete":[]}]}},"55a68acca970dca12dcde6028b56a784d0c7c5fa":{"changes":{"core\/src\/main\/java\/hudson\/model\/AbstractItem.java":"MODIFY","core\/src\/test\/java\/hudson\/FunctionsTest.java":"MODIFY","core\/src\/main\/java\/hudson\/Functions.java":"MODIFY","changelog.html":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/AbstractItem.java":[{"add":["330","     * Gets the display name of the current item relative to the given group.","331","     *","332","     * @since XXX","333","     * @param p the ItemGroup used as point of reference for the item","334","     * @return","335","     *      String like \"foo  bar\"","336","     *\/","337","    public String getRelativeDisplayNameFrom(ItemGroup p) {","338","        return Functions.getRelativeDisplayNameFrom(this, p);","339","    }","340","    ","341","    \/**","358","        return Functions.getRelativeNameFrom(this, p);"],"delete":["346","        if (p == null) return getFullName();","347","        \/\/ first list up all the parents","348","        Map<ItemGroup,Integer> parents = new HashMap<ItemGroup,Integer>();","349","        int depth=0;","350","        while (p!=null) {","351","            parents.put(p, depth++);","352","            if (p instanceof Item)","353","                p = ((Item)p).getParent();","354","            else","355","                p = null;","356","        }","357","","358","        StringBuilder buf = new StringBuilder();","359","        Item i=this;","360","        while (true) {","361","            if (buf.length()>0) buf.insert(0,'\/');","362","            buf.insert(0,i.getName());","363","            ItemGroup g = i.getParent();","364","","365","            Integer d = parents.get(g);","366","            if (d!=null) {","367","                String s=\"\";","368","                for (int j=d; j>0; j--)","369","                    s+=\"..\/\";","370","                return s+buf;","371","            }","372","","373","            if (g instanceof Item)","374","                i = (Item)g;","375","            else","376","                return null;","377","        }"]}],"core\/src\/test\/java\/hudson\/FunctionsTest.java":[{"add":["30","import hudson.model.Item;","174","    @Test","175","    public void testGetRelativeDisplayName() {","176","        Item i = mock(Item.class);","177","        when(i.getName()).thenReturn(\"jobName\");","178","        when(i.getFullDisplayName()).thenReturn(\"displayName\");","179","        assertEquals(\"displayName\",Functions.getRelativeDisplayNameFrom(i, null));","180","    }","181","    ","182","    @Test","183","    public void testGetRelativeDisplayNameInsideItemGroup() {","184","        Item i = mock(Item.class);","185","        when(i.getName()).thenReturn(\"jobName\");","186","        when(i.getDisplayName()).thenReturn(\"displayName\");","187","        TopLevelItemAndItemGroup ig = mock(TopLevelItemAndItemGroup.class);","188","        Jenkins j = mock(Jenkins.class);","189","        when(ig.getName()).thenReturn(\"parent\");","190","        when(ig.getDisplayName()).thenReturn(\"parentDisplay\");","191","        when(ig.getParent()).thenReturn((ItemGroup) j);","192","        when(i.getParent()).thenReturn(ig);","193","        ","194","        assertEquals(\"displayName\", Functions.getRelativeDisplayNameFrom(i, ig));","195","        assertEquals(\"parentDisplay  displayName\", Functions.getRelativeDisplayNameFrom(i, j));","196","    }","197","    "],"delete":[]}],"core\/src\/main\/java\/hudson\/Functions.java":[{"add":["976","    \/**","977","     * Gets the relative name or display name to the given item from the specified group.","978","     *","979","     * @since 1.515","980","     * @param p the Item we want the relative display name","981","     * @param g the ItemGroup used as point of reference for the item","982","     * @param useDisplayName if true, returns a display name, otherwise returns a name","983","     * @return","984","     *      String like \"foo  bar\"","985","     *\/","986","    public static String getRelativeNameFrom(Item p, ItemGroup g, boolean useDisplayName) {","987","        if (p == null) return null;","988","        if (g == null) return useDisplayName ? p.getFullDisplayName() : p.getFullName();","989","        String separationString = useDisplayName ? \"  \" : \"\/\";","990","        ","991","        \/\/ first list up all the parents","992","        Map<ItemGroup,Integer> parents = new HashMap<ItemGroup,Integer>();","993","        int depth=0;","994","        while (g!=null) {","995","            parents.put(g, depth++);","996","            if (g instanceof Item)","997","                g = ((Item)g).getParent();","998","            else","999","                g = null;","1000","        }","1001","","1002","        StringBuilder buf = new StringBuilder();","1003","        Item i=p;","1004","        while (true) {","1005","            if (buf.length()>0) buf.insert(0,separationString);","1006","            buf.insert(0,useDisplayName ? i.getDisplayName() : i.getName());","1007","            ItemGroup gr = i.getParent();","1008","","1009","            Integer d = parents.get(gr);","1010","            if (d!=null) {","1011","                String s=\"\";","1012","                for (int j=d; j>0; j--)","1013","                    s+=\"..\" + separationString;","1014","                return s+buf;","1015","            }","1016","","1017","            if (gr instanceof Item)","1018","                i = (Item)gr;","1019","            else","1020","                return null;","1021","        }","1022","    }","1023","    ","1024","    \/**","1025","     * Gets the name to the given item relative to given group.","1026","     *","1027","     * @since 1.515","1028","     * @param p the Item we want the relative display name","1029","     * @param g the ItemGroup used as point of reference for the item","1030","     * @return","1031","     *      String like \"foo  bar\"","1032","     *\/","1033","    public static String getRelativeNameFrom(Item p, ItemGroup g) {","1034","        return getRelativeNameFrom(p, g, false);","1035","    }    ","1036","    ","1048","        return getRelativeNameFrom(p, g, true);"],"delete":["987","        if (p == null) return null;","988","        String relativeName = p.getRelativeNameFrom(g);","989","        if (relativeName == null) return null;","990","        return relativeName.replace(\"\/\", \"  \");"]}],"changelog.html":[{"add":["57","  <li class=bug>","58","    Display Name is not shown.","59","     (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-17715\">issue 17715<\/a>)"],"delete":["57","  <li class=>"]}]}},"06c211c6b425e313f808f9cbdd49d32f9c922a84":{"changes":{"core\/src\/main\/java\/jenkins\/model\/lazy\/AbstractLazyLoadRunMap.java":"MODIFY","core\/src\/main\/java\/hudson\/matrix\/MatrixConfiguration.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/AbstractProject.java":"MODIFY","changelog.html":"MODIFY"},"diff":{"core\/src\/main\/java\/jenkins\/model\/lazy\/AbstractLazyLoadRunMap.java":[{"add":["48","import javax.annotation.CheckForNull;","356","    public @CheckForNull R search(final int n, final Direction d) {"],"delete":["355","    public R search(final int n, final Direction d) {"]}],"core\/src\/main\/java\/hudson\/matrix\/MatrixConfiguration.java":[{"add":["241","        if (lb == null) {","242","            throw new IOException(\"cannot start a build of \" + getFullName() + \" since its parent has no builds at all\");","243","        }","244",""],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/AbstractProject.java":[{"add":["137","import javax.annotation.CheckForNull;","1064","    public @CheckForNull R getLastBuild() {"],"delete":["1063","    public R getLastBuild() {"]}],"changelog.html":[{"add":["57","  <li class=bug>","58","    Fixed another possible cause of an NPE from MatrixConfiguration.newBuild.","59","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-17728\">issue 17728<\/a>)"],"delete":["57","  <li class=>"]}]}},"f0efdbab087ea26342a034da198d055bd7141b8a":{"changes":{"test\/src\/test\/java\/hudson\/security\/csrf\/DefaultCrumbIssuerTest.java":"MODIFY","core\/src\/main\/resources\/hudson\/security\/csrf\/CrumbFilter\/retry.jelly":"MODIFY"},"diff":{"test\/src\/test\/java\/hudson\/security\/csrf\/DefaultCrumbIssuerTest.java":[{"add":["10","import jenkins.model.Jenkins;","11","import junit.framework.Assert;","139","    @Issue(\"JENKINS-34254\")","140","    @Test public void testRequirePostErrorPageCrumb() throws Exception {","141","        Jenkins.getInstance().setCrumbIssuer(new DefaultCrumbIssuer(false));","142","        WebClient wc = r.createWebClient();","143","        try {","144","            wc.goTo(\"quietDown\");","145","            fail(\"expected failure\");","146","        } catch (FailingHttpStatusCodeException ex) {","147","            Assert.assertEquals(\"expect HTTP 405 method not allowed\", 405, ex.getStatusCode());","148","        }","149","        HtmlPage retry = (HtmlPage) wc.getCurrentWindow().getEnclosedPage();","150","        HtmlPage success = r.submit(retry.getFormByName(\"retry\"));","151","        Assert.assertTrue(\"quieting down\", r.jenkins.isQuietingDown());","152","    }","153",""],"delete":[]}],"core\/src\/main\/resources\/hudson\/security\/csrf\/CrumbFilter\/retry.jelly":[{"add":["36","            <f:form method=\"post\" name=\"retry\">"],"delete":["36","            <f:form method=\"post\">"]}]}},"3bfeda469c5778215f44dfb084f364da96c7dbf6":{"changes":{"core\/src\/main\/java\/hudson\/matrix\/MatrixProject.java":"MODIFY","changelog.html":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/matrix\/MatrixProject.java":[{"add":[],"delete":["468","        Collections.sort(axes); \/\/ perhaps the file was edited on disk and the sort order might have been broken"]}],"changelog.html":[{"add":["57","  <li class=bug>","58","    Matrix configuration axes are no longer automatically re-ordered to alphanumeric order on reload.","59","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-14696\">issue 14696<\/a>)"],"delete":["57","  <li class=>"]}]}},"4f5300003c3a56c286b76729a2a40378ca9bf5f2":{"changes":{"core\/src\/main\/java\/jenkins\/slaves\/JnlpSlaveAgentProtocol3.java":"MODIFY"},"diff":{"core\/src\/main\/java\/jenkins\/slaves\/JnlpSlaveAgentProtocol3.java":[{"add":["152","        if (forceEnabled != null) {"],"delete":["139","     * This feature is being A\/B tested right now.","153","        if (forceEnabled != null)","155","        else {","156","            byte hash = Util.fromHexString(Jenkins.getActiveInstance().getLegacyInstanceId())[0];","157","            ENABLED = (hash%10)==0;"]}]}},"7cdce2fb9e3e918e27a6505976dcc877d1441368":{"changes":{"core\/src\/main\/resources\/hudson\/PluginManager\/installed.jelly":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/PluginManager\/installed.jelly":[{"add":["29","                  <h4>","30","                    <j:choose>","31","                      <j:when test=\"${p.updateInfo!=null}\">","32","                        <a href=\"${p.updateInfo.wiki}\">","33","                          ${p.updateInfo.title}","34","                        <\/a>","35","                      <\/j:when>","36","                      <j:otherwise>","37","                        ${p.longName}","38","                      <\/j:otherwise>","39","                    <\/j:choose>","40","                  <\/h4>"],"delete":["29","                  <h4>${p.longName}<\/h4>"]}]}},"d7598f118fd6d9989164cd2ff7126001a6ee2ff2":{"changes":{"war\/pom.xml":"MODIFY"},"diff":{"war\/pom.xml":[{"add":["51","      <version>1.34<\/version>"],"delete":["51","      <version>1.33<\/version>"]}]}},"8fc609fe0952b285d5b26a59fd5ff4c29704d33d":{"changes":{"changelog.html":"MODIFY","pom.xml":"MODIFY"},"diff":{"changelog.html":[{"add":["57","  <li class=bug>","58","    Channel reader thread can end up consuming 100% CPU","59","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-23471\">issue 23471<\/a>)","60","  <li class=bug>","61","    CancelledKeyException can cause all JNLP slaves to disconnect (and the problem remains until restart)","62","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-24050\">issue 24050<\/a>)"],"delete":["57","  <li class=>"]}],"pom.xml":[{"add":["175","        <version>2.45<\/version>"],"delete":["175","        <version>2.44<\/version>"]}]}},"d46586fb876adb1824ce6159f67a3df6f1ba495a":{"changes":{"war\/resources\/scripts\/hudson-behavior.js":"MODIFY","core\/src\/main\/resources\/lib\/form\/editableComboBox.jelly":"MODIFY","core\/src\/main\/resources\/lib\/form\/editableComboBoxValue.jelly":"MODIFY"},"diff":{"war\/resources\/scripts\/hudson-behavior.js":[{"add":["1467","","1468","\/\/ create a combobox.","1469","\/\/ @param id","1470","\/\/      ID of the <input type=text> element that becomes a combobox.","1471","\/\/ @param valueFunction","1472","\/\/      Function that returns all the candidates as an array","1473","function createComboBox(id,valueFunction) {","1474","    var candidates = valueFunction();","1475","","1476","    Behaviour.addLoadEvent(function() {","1477","        var callback = function(value \/*, comboBox*\/) {","1478","          var items = new Array();","1479","          if (value.length > 0) { \/\/ if no value, we'll not provide anything","1480","            value = value.toLowerCase();","1481","            for (var i = 0; i<candidates.length; i++) {","1482","              if (candidates[i].toLowerCase().indexOf(value) >= 0) {","1483","                items.push(candidates[i]);","1484","                if(items.length>20)","1485","                  break; \/\/ 20 items in the list should be enough","1486","              }","1487","            }","1488","          }","1489","          return items; \/\/ equiv to: comboBox.setItems(items);","1490","        };","1491","","1492","        new ComboBox(id,callback);","1493","    });","1494","}"],"delete":[]}],"core\/src\/main\/resources\/lib\/form\/editableComboBox.jelly":[{"add":["28","    createComboBox(\"${id}\",function() {","29","        var values = [];","30","        <!-- fill in values -->","31","        <j:if test=\"${items!=null}\">","32","          <j:forEach var=\"v\" items=\"${items}\">","33","            <f:editableComboBoxValue value=\"${v}\" \/>","34","          <\/j:forEach>","35","        <\/j:if>","36","        <d:invokeBody \/>","37","        return values;","38","    });"],"delete":["27","    <j:set target=\"${requestScope}\" property=\"editableComboBoxCount\" value=\"${editableComboBoxCount + 1}\" defaultValue=\"1\" \/>","28","    <j:set var=\"uniqid\" value=\"${id + editableComboBoxCount}\" \/>","29","\t<j:set target=\"${requestScope}\" property=\"editableComboBox\" value=\"${uniqid}\" \/>","31","\t  var ${uniqid}_values = new Array();","32","","33","\t  <!-- fill in values -->","34","\t  <j:if test=\"${items!=null}\">","35","\t    <j:forEach var=\"v\" items=\"${items}\">","36","\t      <f:editableComboBoxValue value=\"${v}\" \/>","37","\t    <\/j:forEach>","38","\t  <\/j:if>","39","\t  <d:invokeBody \/>","40","","41","\t\t<![CDATA[","42","\t  function ${uniqid}_Callback(value \/*, comboBox*\/) {","43","\t    var items = new Array();","44","\t    var candidates = ${uniqid}_values;","45","\t    if (value.length > 0) { \/\/ if no value, we'll not provide anything","46","\t      value = value.toLowerCase();","47","\t      for (var i = 0; i < candidates.length; i++) {","48","\t        if (candidates[i].toLowerCase().indexOf(value) >= 0) {","49","\t          items.push(candidates[i]);","50","\t          if(items.length>20)","51","\t            break; \/\/ 20 items in the list should be enough","52","\t        }","53","\t      }","54","\t    }","55","\t    return items; \/\/ equiv to: comboBox.setItems(items);","56","\t  }","57","\t  ]]>","58","","59","\t  <!-- IE doesn't like a combobox to be created before the page is fully loaded. -->","60","\t  var oldOnLoadFor${uniqid} = window.onload;","61","\t  window.onload = function() { if(oldOnLoadFor${uniqid}) oldOnLoadFor${uniqid}();","62","\t    new ComboBox(\"${id}\", ${uniqid}_Callback);","63","\t  }"]}],"core\/src\/main\/resources\/lib\/form\/editableComboBoxValue.jelly":[{"add":["3","<j:jelly xmlns:j=\"jelly:core\" xmlns:st=\"jelly:stapler\">","4","  <st:documentation>","5","    Used inside &lt;f:editableComboBox\/> to specify one value of a combobox.","6","    Normally one would use multiple values.","7","    <st:attribute name=\"value\" use=\"required\" \/>","8","  <\/st:documentation>","9","\tvalues.push(\"${value}\");"],"delete":["3","<j:jelly xmlns:j=\"jelly:core\">","4","\t${editableComboBox}_values.push(\"${value}\");"]}]}},"ae710c8119a1a358d868417f18951e9a9668da36":{"changes":{"core\/src\/main\/java\/hudson\/Functions.java":"MODIFY","core\/src\/main\/resources\/lib\/layout\/task.jelly":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/Functions.java":[{"add":["56","import java.io.UnsupportedEncodingException;","66","import java.net.URLDecoder;","981","     * If the given href link is matching the current page, return true.","982","     *","983","     * Used in <tt>task.jelly<\/tt> to decide if the page should be highlighted.","984","     *\/","985","    public boolean hyperlinkMatchesCurrentPage(String href) throws UnsupportedEncodingException {","986","        String url = Stapler.getCurrentRequest().getRequestURL().toString();","987","        url = URLDecoder.decode(url,\"UTF-8\");","988","        href = URLDecoder.decode(href,\"UTF-8\");","989","","990","        return (href.length()>1 && url.endsWith(href))","991","            || (href.equals(\".\") && url.endsWith(\".\"));","992","    }","993","","994","    \/**"],"delete":[]}],"core\/src\/main\/resources\/lib\/layout\/task.jelly":[{"add":["15","  <j:set var=\"match\" value=\"${h.hyperlinkMatchesCurrentPage(href)}\" \/>"],"delete":["15","  <j:invokeStatic var=\"requestURL\" className=\"java.net.URLDecoder\" method=\"decode\">","16","    <j:arg value=\"${request.requestURL.toString()}\"\/>","17","    <j:arg value=\"UTF-8\"\/>","18","  <\/j:invokeStatic>","19","  <j:set var=\"match\" value=\"${(size(href) gt 1 and requestURL.endsWith(href)) or (href=='.' and requestURL.endsWith('\/'))}\" \/>"]}]}},"7320ce252fb8701f71385a5a36fce45f72db55ce":{"changes":{"maven-agent\/pom.xml":"MODIFY","core\/pom.xml":"MODIFY","test\/src\/main\/java\/org\/jvnet\/hudson\/test\/HudsonTestCase.java":"MODIFY","maven-plugin\/pom.xml":"MODIFY","core\/src\/main\/java\/hudson\/model\/Label.java":"MODIFY","debian\/debian\/changelog":"MODIFY","pom.xml":"MODIFY","core\/src\/main\/java\/hudson\/model\/labels\/LabelAtom.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/Hudson.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/labels\/LabelExpression.java":"MODIFY","test\/pom.xml":"MODIFY","remoting\/pom.xml":"MODIFY","core\/src\/main\/java\/hudson\/model\/AbstractProject.java":"MODIFY","ui-samples-plugin\/pom.xml":"MODIFY","cli\/pom.xml":"MODIFY","maven-interceptor\/pom.xml":"MODIFY","core\/src\/main\/grammar\/labelExpr.g":"MODIFY","test\/src\/test\/java\/hudson\/model\/labels\/LabelExpressionTest.java":"MODIFY","core\/src\/main\/resources\/hudson\/model\/AbstractProject\/help-assignedLabelString.html":"MODIFY","war\/pom.xml":"MODIFY"},"diff":{"maven-agent\/pom.xml":[{"add":["29","    <version>1.374-SNAPSHOT<\/version>"],"delete":["29","    <version>1.373-SNAPSHOT<\/version>"]}],"core\/pom.xml":[{"add":["30","    <version>1.374-SNAPSHOT<\/version>"],"delete":["30","    <version>1.373-SNAPSHOT<\/version>"]}],"test\/src\/main\/java\/org\/jvnet\/hudson\/test\/HudsonTestCase.java":[{"add":["556","        return createSlave(l==null ? null : l.getExpression(), env);"],"delete":["556","        return createSlave(l==null ? null : l.getName(), env);"]}],"maven-plugin\/pom.xml":[{"add":["29","    <version>1.374-SNAPSHOT<\/version>"],"delete":["29","    <version>1.373-SNAPSHOT<\/version>"]}],"core\/src\/main\/java\/hudson\/model\/Label.java":[{"add":["36","import hudson.util.QuotedStringTokenizer;","65","    \/**","66","     * Display name of this label.","67","     *\/","98","    \/**","99","     * Alias for {@link #getDisplayName()}.","100","     *\/","102","    public final String getName() {","103","        return getDisplayName();","106","    \/**","107","     * Returns a human-readable text that represents this label.","108","     *\/","114","     * Returns a label expression that represents this label.","115","     *\/","116","    public abstract String getExpression();","117","","118","    \/**","442","            writer.setValue(src.getExpression());","464","            for( String l : new QuotedStringTokenizer(labels).toArray())"],"delete":["95","    public String getName() {","96","        return name;","427","            writer.setValue(src.getName());","449","            for( String l : labels.split(\" +\"))"]}],"debian\/debian\/changelog":[{"add":["0","hudson (1.373) unstable; urgency=low","1","","2","  * See http:\/\/hudson.dev.java.net\/changelog.html for more details.","3","","4"," -- Kohsuke Kawaguchi <kk@kohsuke.org>  Mon, 23 Aug 2010 11:01:23 -0700","5",""],"delete":[]}],"pom.xml":[{"add":["35","  <version>1.374-SNAPSHOT<\/version>"],"delete":["35","  <version>1.373-SNAPSHOT<\/version>"]}],"core\/src\/main\/java\/hudson\/model\/labels\/LabelAtom.java":[{"add":["33","import hudson.model.Messages;","37","import hudson.util.QuotedStringTokenizer;","71","     * If the label contains 'unsafe' chars, escape them.","72","     *\/","73","    @Override","74","    public String getExpression() {","75","        return escape(name);","76","    }","77","","78","    \/**","201","    public static boolean needsEscape(String name) {","204","            \/\/ additional restricted chars","205","            for( int i=0; i<name.length(); i++ ) {","206","                char ch = name.charAt(i);","207","                if(\" ()\\t\\n\".indexOf(ch)!=-1)","208","                    return true;","209","            }","211","        } catch (Failure failure) {","212","            return true;","216","    public static String escape(String name) {","217","        if (needsEscape(name))","218","            return QuotedStringTokenizer.quote(name);","219","        return name;","220","    }","221",""],"delete":["191","    public static boolean isValidName(String name) {","194","            return true;","195","        } catch (Failure failure) {"]}],"core\/src\/main\/java\/hudson\/model\/Hudson.java":[{"add":["1377","                \/\/ laxly accept it as a single label atom for backward compatibility","1378","                return getLabelAtom(expr);"],"delete":["78","import hudson.scm.SCMDescriptor;","107","import hudson.tools.ToolDescriptor;","108","import hudson.tools.ToolInstallation;","1380","                throw new IllegalArgumentException(\"Invalid label expression: \"+expr,e);","1390","        if (!LabelAtom.isValidName(name))","1391","            throw new IllegalArgumentException(\"Illegal character in a token: \"+name);"]}],"core\/src\/main\/java\/hudson\/model\/labels\/LabelExpression.java":[{"add":["39","    @Override","40","    public String getExpression() {","41","        return getDisplayName();","42","    }","43","","70","            super('('+base.getExpression()+')');","90","            return '('+l.getExpression()+')';","91","        return l.getExpression();"],"delete":["65","            super('('+base.getName()+')');","85","            return '('+l.getName()+')';","86","        return l.getName();"]}],"test\/pom.xml":[{"add":["29","    <version>1.374-SNAPSHOT<\/version>"],"delete":["29","    <version>1.373-SNAPSHOT<\/version>"]}],"remoting\/pom.xml":[{"add":["29","    <version>1.374-SNAPSHOT<\/version>"],"delete":["29","    <version>1.373-SNAPSHOT<\/version>"]}],"core\/src\/main\/java\/hudson\/model\/AbstractProject.java":[{"add":["45","import hudson.model.labels.LabelAtom;","46","import hudson.model.labels.LabelExpression;","303","        if (canRoam || assignedNode==null)    return null;","304","        try {","305","            LabelExpression.parseExpression(assignedNode);","306","            return assignedNode;","307","        } catch (ANTLRException e) {","308","            \/\/ must be old label or host name that includes whitespace or other unsafe chars","309","            return LabelAtom.escape(assignedNode);","310","        }","323","            else                                        assignedNode = l.getExpression();"],"delete":["301","        if (canRoam)    return null;","302","        return assignedNode;","315","            else                                        assignedNode = l.getName();"]}],"ui-samples-plugin\/pom.xml":[{"add":["29","    <version>1.374-SNAPSHOT<\/version>"],"delete":["29","    <version>1.373-SNAPSHOT<\/version>"]}],"cli\/pom.xml":[{"add":["6","    <version>1.374-SNAPSHOT<\/version>"],"delete":["6","    <version>1.373-SNAPSHOT<\/version>"]}],"maven-interceptor\/pom.xml":[{"add":["29","    <version>1.374-SNAPSHOT<\/version>"],"delete":["29","    <version>1.373-SNAPSHOT<\/version>"]}],"core\/src\/main\/grammar\/labelExpr.g":[{"add":["79","  | s:STRINGLITERAL","80","    { l=LabelAtom.get(hudson.util.QuotedStringTokenizer.unquote(s.getText())); }","95","    :   ~( '&' | '|' | '!' | '<' | '>' | '(' | ')' | ' ' | '\\t' | '\\\"' | '\\'' )","107","","108","STRINGLITERAL","109","    :   '\"'","110","        ( '\\\\' ( 'b' | 't' | 'n' | 'f' | 'r' | '\\\"' | '\\'' | '\\\\' )   \/* escape *\/","111","        |  ~( '\\\\' | '\"' | '\\r' | '\\n' )","112","        )*","113","        '\"'","114","    ;"],"delete":["78","    { LabelAtom.isValidName(a.getText()) }?","94","    :   ~( '&' | '|' | '!' | '<' | '>' | '(' | ')' | ' ' | '\\t')"]}],"test\/src\/test\/java\/hudson\/model\/labels\/LabelExpressionTest.java":[{"add":["28","import hudson.model.AbstractProject;","32","import hudson.model.Label;","33","import hudson.model.Node.Mode;","35","import hudson.slaves.RetentionStrategy;","41","import java.lang.reflect.Field;","42","import java.util.Collections;","143","        parseShouldFail(\"foo (bar)\");","144","    }","145","","146","    public void testLaxParsing() {","147","        \/\/ this should parse as an atom","148","        LabelAtom l = (LabelAtom)hudson.getLabel(\"lucene.zones.apache.org (Solaris 10)\");","149","        assertEquals(l.getName(),\"lucene.zones.apache.org (Solaris 10)\");","150","        assertEquals(l.getExpression(),\"\\\"lucene.zones.apache.org (Solaris 10)\\\"\");","151","    }","152","","153","    public void testDataCompatibilityWithHostNameWithWhitespace() throws Exception {","154","        DumbSlave slave = new DumbSlave(\"abc def (xyz) : test\", \"dummy\",","155","                createTmpDir().getPath(), \"1\", Mode.NORMAL, \"\", createComputerLauncher(null), RetentionStrategy.NOOP, Collections.EMPTY_LIST);","156","        hudson.addNode(slave);","157","","158","","159","        FreeStyleProject p = createFreeStyleProject();","160","        p.setAssignedLabel(hudson.getLabel(\"abc def\"));","161","        assertEquals(\"abc def\",p.getAssignedLabel().getName());","162","        assertEquals(\"\\\"abc def\\\"\",p.getAssignedLabel().getExpression());","163","","164","        \/\/ expression should be persisted, not the name","165","        Field f = AbstractProject.class.getDeclaredField(\"assignedNode\");","166","        f.setAccessible(true);","167","        assertEquals(\"\\\"abc def\\\"\",f.get(p));","168","","169","        \/\/ but if the name is set, we'd still like to parse it","170","        f.set(p,\"a:b c\");","171","        assertEquals(\"a:b c\",p.getAssignedLabel().getName());","172","    }","173","","174","    public void testQuote() {","175","        Label l = hudson.getLabel(\"\\\"abc\\\\\\\\\\\\\\\"def\\\"\");","176","        assertEquals(\"abc\\\\\\\"def\",l.getName());","196","            fail(expr + \" should fail to parse\");"],"delete":["137","        parseShouldFail(\"foo*bar\");","157","            fail();"]}],"core\/src\/main\/resources\/hudson\/model\/AbstractProject\/help-assignedLabelString.html":[{"add":["47","","48","    <p>","49","    Label names or slave names can be quoted if they contain unsafe characters. For example,","50","    <tt>\"hudson-solaris (Solaris)\" || \"Windows 2008\"<\/tt>"],"delete":[]}],"war\/pom.xml":[{"add":["29","    <version>1.374-SNAPSHOT<\/version>"],"delete":["29","    <version>1.373-SNAPSHOT<\/version>"]}]}},"41fc5e8622d2c1e43ffa9c7f48fdbcfbe492c19c":{"changes":{"test\/src\/test\/java\/jenkins\/agents\/WebSocketAgentsTest.java":"MODIFY","core\/src\/main\/java\/jenkins\/websocket\/WebSocketSession.java":"MODIFY","core\/src\/main\/java\/jenkins\/agents\/WebSocketAgents.java":"MODIFY","pom.xml":"MODIFY"},"diff":{"test\/src\/test\/java\/jenkins\/agents\/WebSocketAgentsTest.java":[{"add":["37","import java.util.Random;","102","            assertNotNull(s.getChannel().call(new FatTask()));","105","            p.getBuildersList().add(Functions.isWindows() ? new BatchFile(\"echo hello\") : new Shell(\"dd if=\/dev\/random count=1024 bs=200\"));","126","    private static class FatTask extends SlaveToMasterCallable<String, RuntimeException> {","127","        private byte[] payload;","128","","129","        private FatTask() {","130","            payload = new byte[1024 * 1024];","131","            new Random().nextBytes(payload);","132","        }","133","","134","        @Override","135","        public String call() {","136","            return new String(payload);","137","        }","138","    }","139",""],"delete":["103","            p.getBuildersList().add(Functions.isWindows() ? new BatchFile(\"echo hello\") : new Shell(\"echo hello\"));"]}],"core\/src\/main\/java\/jenkins\/websocket\/WebSocketSession.java":[{"add":["62","    \/\/ https:\/\/www.eclipse.org\/jetty\/javadoc\/9.4.24.v20191120\/org\/eclipse\/jetty\/websocket\/common\/WebSocketRemoteEndpoint.html","134","    protected final void sendBinary(ByteBuffer partialByte, boolean isLast) {","135","        try {","136","            remoteEndpoint.getClass().getMethod(\"sendPartialBytes\", ByteBuffer.class, boolean.class).invoke(remoteEndpoint, partialByte, isLast);","137","        } catch (Exception x) {","138","            throw new RuntimeException(x);","139","        }","140","    }","141","","142","    @SuppressWarnings(\"unchecked\")"],"delete":[]}],"core\/src\/main\/java\/jenkins\/agents\/WebSocketAgents.java":[{"add":["32","import hudson.remoting.AbstractByteBufferCommandTransport;","35","import hudson.remoting.ChunkHeader;","107","        private Transport transport;","120","                transport = new Transport();","121","                state.fireAfterChannel(state.getChannelBuilder().build(transport));","130","            try {","131","                transport.receive(ByteBuffer.wrap(payload, offset, len));","132","            } catch (IOException | InterruptedException e) {","133","                error(e);","141","            transport.terminate(x);","151","        class Transport extends AbstractByteBufferCommandTransport {","154","            protected void write(ByteBuffer header, ByteBuffer data) throws IOException {","155","                LOGGER.finest(() -> \"sending message of length \" + ChunkHeader.length(ChunkHeader.peek(header)));","156","                sendBinary(header, false);","157","                sendBinary(data, true);"],"delete":["32","import hudson.remoting.AbstractByteArrayCommandTransport;","34","import hudson.remoting.Channel;","42","import java.util.Arrays;","108","        private AbstractByteArrayCommandTransport.ByteArrayReceiver receiver;","121","                state.fireAfterChannel(state.getChannelBuilder().build(new Transport()));","130","            if (offset == 0 && len == payload.length) {","131","                receiver.handle(payload);","132","            } else {","133","                receiver.handle(Arrays.copyOfRange(payload, offset, offset + len));","141","            receiver.terminate(x);","151","        class Transport extends AbstractByteArrayCommandTransport {","154","            public void setup(AbstractByteArrayCommandTransport.ByteArrayReceiver bar) {","155","                receiver = bar;","156","            }","157","","158","            @Override","159","            public void writeBlock(Channel chnl, byte[] bytes) throws IOException {","160","                LOGGER.finest(() -> \"writing block of length \" + bytes.length + \" to \" + agent);","161","                try {","162","                    sendBinary(ByteBuffer.wrap(bytes)).get();","163","                } catch (Exception x) {","164","                    x.printStackTrace();","165","                    throw new IOException(x);","166","                }","185",""]}],"pom.xml":[{"add":["103","    <remoting.version>4.3-20200323.083513-2<\/remoting.version><!-- https:\/\/github.com\/jenkinsci\/remoting\/pull\/373 -->"],"delete":["103","    <remoting.version>4.2<\/remoting.version>"]}]}},"e8efc96f3d4ce3ed6dc121661423ad4a2892e2b2":{"changes":{"core\/src\/test\/java\/hudson\/model\/RunTest.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/Run.java":"MODIFY"},"diff":{"core\/src\/test\/java\/hudson\/model\/RunTest.java":[{"add":["31","import java.util.Set;","33","import java.util.TreeSet;","215","","216","    @Test","217","    public void compareRunsFromSameJobWithDifferentNumbers() throws Exception {","218","        final ItemGroup group = Mockito.mock(ItemGroup.class);","219","        final Job j = Mockito.mock(Job.class);","220","","221","        Mockito.when(j.getParent()).thenReturn(group);","222","        Mockito.when(group.getFullName()).thenReturn(\"j\");","223","        Mockito.when(j.assignBuildNumber()).thenReturn(1, 2);","224","","225","        Run r1 = new Run(j) {};","226","        Run r2 = new Run(j) {};","227","","228","        final Set<Run> treeSet = new TreeSet<>();","229","        treeSet.add(r1);","230","        treeSet.add(r2);","231","","232","        assertTrue(r1.compareTo(r2) < 0);","233","        assertTrue(treeSet.size() == 2);","234","    }","235","","236","    @Issue(\"JENKINS-42319\")","237","    @Test","238","    public void compareRunsFromDifferentParentsWithSameNumber() throws Exception {","239","        final ItemGroup group1 = Mockito.mock(ItemGroup.class);","240","        final ItemGroup group2 = Mockito.mock(ItemGroup.class);","241","        final Job j1 = Mockito.mock(Job.class);","242","        final Job j2 = Mockito.mock(Job.class);","243","        Mockito.when(j1.getParent()).thenReturn(group1);","244","        Mockito.when(j2.getParent()).thenReturn(group2);","245","        Mockito.when(group1.getFullName()).thenReturn(\"g1\");","246","        Mockito.when(group2.getFullName()).thenReturn(\"g2\");","247","        Mockito.when(j1.assignBuildNumber()).thenReturn(1);","248","        Mockito.when(j2.assignBuildNumber()).thenReturn(1);","249","","250","        Run r1 = new Run(j1) {};","251","        Run r2 = new Run(j2) {};","252","","253","        final Set<Run> treeSet = new TreeSet<>();","254","        treeSet.add(r1);","255","        treeSet.add(r2);","256","","257","        assertTrue(r1.compareTo(r2) != 0);","258","        assertTrue(treeSet.size() == 2);","259","    }"],"delete":["27","import hudson.model.Run.Artifact;"]}],"core\/src\/main\/java\/hudson\/model\/Run.java":[{"add":["415","     * If numbers are equal order based on names of parent projects.","418","        final int res = this.number - that.number;","419","        if (res == 0)","420","            return this.getParent().getFullName().compareTo(that.getParent().getFullName());","421","","422","        return res;"],"delete":["417","        return this.number - that.number;"]}]}},"042a4cd8a4137b28e881df5fbbf017e9fdd1a1c9":{"changes":{"test\/src\/main\/java\/org\/jvnet\/hudson\/test\/HudsonTestCase.java":"MODIFY","test\/src\/test\/java\/hudson\/model\/AbortedFreeStyleBuildTest.java":"ADD","test\/src\/test\/java\/hudson\/maven\/AbortedMavenBuildTest.java":"ADD"},"diff":{"test\/src\/main\/java\/org\/jvnet\/hudson\/test\/HudsonTestCase.java":[{"add":["38","import hudson.tasks.BuildWrapper;","39","import hudson.tasks.BuildWrapperDescriptor;","100","import net.sf.json.JSONObject;","1694","","1695","    public static class TestBuildWrapper extends BuildWrapper {","1696","        public Result buildResultInTearDown;","1697","","1698","        @Override","1699","        public Environment setUp(AbstractBuild build, Launcher launcher, BuildListener listener) throws IOException, InterruptedException {","1700","            return new BuildWrapper.Environment() {","1701","                @Override","1702","                public boolean tearDown(AbstractBuild build, BuildListener listener) throws IOException, InterruptedException {","1703","                    buildResultInTearDown = build.getResult();","1704","                    return true;","1705","                }","1706","            };","1707","        }","1708","","1709","        @Extension","1710","        public static class TestBuildWrapperDescriptor extends BuildWrapperDescriptor {","1711","            @Override","1712","            public boolean isApplicable(AbstractProject<?, ?> project) {","1713","                return true;","1714","            }","1715","","1716","            @Override","1717","            public BuildWrapper newInstance(StaplerRequest req, JSONObject formData) {","1718","                throw new UnsupportedOperationException();","1719","            }","1720","","1721","            @Override","1722","            public String getDisplayName() {","1723","                return this.getClass().getName();","1724","            }","1725","        }","1726","    }"],"delete":[]}],"test\/src\/test\/java\/hudson\/model\/AbortedFreeStyleBuildTest.java":[{"add":[],"delete":[]}],"test\/src\/test\/java\/hudson\/maven\/AbortedMavenBuildTest.java":[{"add":[],"delete":[]}]}},"5a3d877164e37554fa93eb9c5f011b6001d23956":{"changes":{"changelog.html":"MODIFY"},"diff":{"changelog.html":[{"add":["57","  <li class=bug>","58","    Provided maven settings.xml in maven builder is lost.","59","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-15976\">issue 15976<\/a>)"],"delete":["57","  <li class=>"]}]}},"90ff9f806fcac1a58f4bd40bfcc4ed5273ff116a":{"changes":{"core\/src\/main\/java\/hudson\/tasks\/junit\/JUnitResultArchiver.java":"MODIFY","changelog.html":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/tasks\/junit\/JUnitResultArchiver.java":[{"add":[],"delete":["34","import hudson.model.CheckPoint;","154","","155","\t\t\tCHECKPOINT.block(listener, getDescriptor().getDisplayName());","156","","173","\t\tCHECKPOINT.report();","191","\t\/**","192","\t * This class does explicit checkpointing.","193","\t *\/","218","\t\/**","219","\t * Test result tracks the diff from the previous run, hence the checkpoint.","220","\t *\/","221","\tprivate static final CheckPoint CHECKPOINT = new CheckPoint(","222","\t\t\t\"JUnit result archiving\");","223",""]}],"changelog.html":[{"add":["57","  <li class=\"bug\">","58","    Should not stop a build from finishing just to compute JUnit result difference to a prior build which is still running.","59","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-10234\">issue 10234<\/a>)"],"delete":["57","  <li class=>"]}]}},"ffc5884a174255a762f5c4cffec8656172224a04":{"changes":{"test\/pom.xml":"MODIFY","test\/src\/test\/java\/hudson\/util\/FormFieldValidatorTest.java":"ADD","core\/pom.xml":"MODIFY","core\/src\/main\/java\/hudson\/util\/FormFieldValidator.java":"MODIFY","core\/src\/main\/java\/hudson\/tasks\/test\/AggregatedTestResultPublisher.java":"MODIFY","core\/src\/main\/java\/hudson\/tasks\/BuildTrigger.java":"MODIFY"},"diff":{"test\/pom.xml":[{"add":["74","      <version>2.2-hudson-7<\/version>"],"delete":["74","      <version>2.2-hudson-5<\/version>"]}],"test\/src\/test\/java\/hudson\/util\/FormFieldValidatorTest.java":[{"add":[],"delete":[]}],"core\/pom.xml":[{"add":["233","      <version>1.90<\/version>"],"delete":["233","      <version>1.89<\/version>"]}],"core\/src\/main\/java\/hudson\/util\/FormFieldValidator.java":[{"add":["78","                if(subject==null)","79","                    throw new AccessDeniedException(\"No subject\");","286","            super(request, response, request.findAncestorObject(AbstractProject.class), Item.CONFIGURE);","349","            super(request, response, request.findAncestorObject(AbstractProject.class), Item.CONFIGURE);"],"delete":["9","import hudson.model.Job;","285","            super(request, response, (AbstractProject) request.findAncestor(AbstractProject.class).getObject(), Item.CONFIGURE);","348","            super(request, response, (AbstractProject) request.findAncestor(AbstractProject.class).getObject(), Item.CONFIGURE);"]}],"core\/src\/main\/java\/hudson\/tasks\/test\/AggregatedTestResultPublisher.java":[{"add":["230","            AbstractProject project = req.findAncestorObject(AbstractProject.class);"],"delete":["230","            AbstractProject project = (AbstractProject) req.findAncestor(AbstractProject.class).getObject();"]}],"core\/src\/main\/java\/hudson\/tasks\/BuildTrigger.java":[{"add":["276","            AccessControlled anc = req.findAncestorObject(AccessControlled.class);"],"delete":["276","            AccessControlled anc = (AccessControlled) req.findAncestor(AccessControlled.class).getObject();"]}]}},"bd751ff878e50bcc17d6ce5971377f00d11496fa":{"changes":{"core\/pom.xml":"MODIFY","changelog.html":"MODIFY"},"diff":{"core\/pom.xml":[{"add":["44","    <stapler.version>1.196<\/stapler.version>"],"delete":["44","    <stapler.version>1.195<\/stapler.version>"]}],"changelog.html":[{"add":["58","    Invalid JSON gets produced with duplicate keys (seen on change sets)","59","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-13336\">issue 13336<\/a>)","60","  <li class=bug>"],"delete":[]}]}},"6e91651a574fbc38eae152c8f7dc3c0c7d42fb7b":{"changes":{"core\/src\/main\/java\/hudson\/model\/Executor.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/Executor.java":[{"add":["51","import java.util.Arrays;","138","        if (LOGGER.isLoggable(FINE))","139","            LOGGER.log(FINE, String.format(\"%s is interrupted(%s): %s\", getDisplayName(), result, Util.join(Arrays.asList(causes),\",\")), new InterruptedException());","140",""],"delete":[]}]}},"30dd4c6e02df2e00a30475b040d604f972081fdd":{"changes":{"war\/src\/main\/js\/widgets\/config\/tabbar.js":"MODIFY"},"diff":{"war\/src\/main\/js\/widgets\/config\/tabbar.js":[{"add":["7","\/**","8"," * Extracting this call from outside of the addPageTabs due to a regression","9"," * in 2.216\/2.217 (see JENKINS-61429)","10"," *","11"," * The proxied call to Behaviour.specify needs to be called from outside of the","12"," * addPageTabs function. Otherwise, it will not apply to existing draggable","13"," * elements on the form. It would only only apply to new elements.","14"," *","15"," * Extracting this Behaviour.specify call to the module level causes it to be executed","16"," * on script load, and this seems to set up the event listeners properly.","17"," *\/","18","behaviorShim.specify(\".dd-handle\", 'config-drag-start', 1000, function(el) {","19","    page.fixDragEvent(el);","20","});","21","","161","};"],"delete":["11","        behaviorShim.specify(\".dd-handle\", 'config-drag-start', 1000, function(el) {","12","            page.fixDragEvent(el);","13","        });","149","};"]}]}},"ad92ad461159ea3320da15f9d7030cdd12d83cee":{"changes":{"changelog.html":"MODIFY"},"diff":{"changelog.html":[{"add":["69","  <li class=bug>","70","    Zip\/tar files created by Jenkins now properly retains Unix file modes.","71","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-9397\">issue 9397<\/a>)"],"delete":[]}]}},"17116a2129b808d64d76b5dcba9d3037003aed30":{"changes":{"core\/src\/main\/java\/jenkins\/model\/JenkinsLocationConfiguration.java":"MODIFY"},"diff":{"core\/src\/main\/java\/jenkins\/model\/JenkinsLocationConfiguration.java":[{"add":["87","    \/**","88","     * Sets the e-mail address of Jenkins administrator.","89","     * @param adminAddress Admin address. Use null to reset the value to default.","90","     *\/","91","    public void setAdminAddress(@CheckForNull String adminAddress) {","92","        String address = Util.nullify(adminAddress);","93","        if(address != null && address.startsWith(\"\\\"\") && address.endsWith(\"\\\"\")) {","96","            address = address.substring(1,address.length()-1);","98","        this.adminAddress = address;"],"delete":["87","    public void setAdminAddress(@Nonnull String adminAddress) {","88","        if(adminAddress.startsWith(\"\\\"\") && adminAddress.endsWith(\"\\\"\")) {","91","            adminAddress = adminAddress.substring(1,adminAddress.length()-1);","93","        this.adminAddress = adminAddress;"]}]}},"ea724ab13dd3b55d41902fd723f788de080fd4d3":{"changes":{"war\/src\/main\/webapp\/help\/parameter\/boolean_fr.html":"MODIFY","war\/src\/main\/webapp\/help\/parameter\/boolean-default_fr.html":"MODIFY"},"diff":{"war\/src\/main\/webapp\/help\/parameter\/boolean_fr.html":[{"add":["1","    Dfinit un paramtre boolen simple. La valeur de la chane de caractres sera 'true' ou 'false'.","3","    configuration  l'aide de la substitution de variables."],"delete":["1","    Dfinit un paramtre boolen simple. La valeur de la chane de caractres de sera 'true' ou 'false'.","3","    configuration  l'aide de la substituion de variables."]}],"war\/src\/main\/webapp\/help\/parameter\/boolean-default_fr.html":[{"add":["1","    Spcifie la valeur par dfaut de ce champ."],"delete":["1","    Spcifit la valeur par dfaut de ce champ."]}]}},"5493f84fa638df973d2c72e88686792440ec94d6":{"changes":{"core\/src\/main\/resources\/hudson\/model\/Job\/rename.properties":"MODIFY","core\/src\/main\/resources\/hudson\/model\/Job\/rename.jelly":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/model\/Job\/rename.properties":[{"add":["23","newNameInUse=The name {0} is already in use."],"delete":[]}],"core\/src\/main\/resources\/hudson\/model\/Job\/rename.jelly":[{"add":["29","      <j:set var=\"newName\" value=\"${request.getParameter('newName')}\" \/>","37","        <j:when test=\"${app.getItem(newName)!=null and !it.name.equalsIgnoreCase(newName)}\">","38","          ${%newNameInUse(newName)}","39","          <j:if test=\"${request.referer.endsWith('\/configure')}\">","40","            <br\/> ${%configWasSaved}","41","          <\/j:if>","42","        <\/j:when>","48","            <input type=\"button\" value=\"${%No}\"","49","                   onclick=\"javascript:history.back()\" class=\"yui-button\" \/>"],"delete":["37","          <j:set var=\"newName\" value=\"${request.getParameter('newName')}\" \/>","42","            <input type=\"button\" value=\"${%No}\" onclick=\"javascript:history.back()\" class=\"yui-button\" \/>"]}]}},"b1fac2194bd125d5c1a35d21bf7491ccbeb1fc99":{"changes":{"core\/src\/main\/resources\/hudson\/model\/Hudson\/loginError.jelly":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/model\/Hudson\/loginError.jelly":[{"add":["2","  <st:statusCode value=\"401\" \/>"],"delete":[]}]}},"01b1f1ddbcad7ed8ea781e41ba4bd8d890f13c67":{"changes":{"core\/src\/main\/java\/jenkins\/model\/queue\/AsynchronousExecution.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/Executor.java":"MODIFY"},"diff":{"core\/src\/main\/java\/jenkins\/model\/queue\/AsynchronousExecution.java":[{"add":["41","import org.kohsuke.accmod.restrictions.DoNotUse;","64","     * If {@link #completed} is called before {@link #setExecutorWithoutCompleting}, then either {@link #NULL} for success, or the error.","101","     * @return Associated Executor. May be {@code null} if {@link #setExecutorWithoutCompleting(hudson.model.Executor)} ","109","    \/**","110","     * Set the executor without notifying it about task completion.","111","     * The caller <b>must<\/b> also call {@link #maybeComplete()}","112","     * after releasing any problematic locks.","113","     *\/","115","    public synchronized final void setExecutorWithoutCompleting(@Nonnull Executor executor) {","116","        assert this.executor == null;","118","    }","119","","120","    \/**","121","     * If there is a pending completion notification, deliver it to the executor.","122","     * Must be called after {@link #setExecutorWithoutCompleting(Executor)}.","123","     *\/","124","    @Restricted(NoExternalUse.class)","125","    public synchronized final void maybeComplete() {","126","        assert this.executor != null;","127","        if (result != null) {","128","            executor.completedAsynchronous(result != NULL ? result : null);"],"delete":["63","     * If {@link #completed} is called before {@link #setExecutor}, then either {@link #NULL} for success, or the error.","100","     * @return Associated Executor. May be {@code null} if {@link #setExecutor(hudson.model.Executor)} ","109","    public synchronized final void setExecutor(@Nonnull Executor executor) {","110","        assert this.executor==null;","111","","113","        if (result!=null) {","114","            executor.completedAsynchronous( result!=NULL ? result : null );"]}],"core\/src\/main\/java\/hudson\/model\/Executor.java":[{"add":["433","                    x.setExecutorWithoutCompleting(this);","438","                x.maybeComplete();"],"delete":["433","                    x.setExecutor(this);"]}]}},"aac20468ff5511ea6c58de07f3bcf3ae108b9cb0":{"changes":{"pom.xml":"MODIFY"},"diff":{"pom.xml":[{"add":["179","        <version>2.52<\/version>"],"delete":["179","        <version>2.51<\/version>"]}]}},"978ddf3bd2d144025fe2a092111ceece120fc824":{"changes":{"core\/src\/main\/java\/hudson\/tasks\/junit\/TestResult.java":"MODIFY","core\/src\/main\/java\/hudson\/tasks\/junit\/CaseResult.java":"MODIFY","core\/src\/main\/java\/hudson\/tasks\/junit\/SuiteResult.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/tasks\/junit\/TestResult.java":[{"add":["209","    @Exported(inline=true)","210","    public Collection<SuiteResult> getSuites() {","211","        return suites;","212","    }","213",""],"delete":["205","    @Exported(name=\"child\",inline=true)"]}],"core\/src\/main\/java\/hudson\/tasks\/junit\/CaseResult.java":[{"add":["188","    @Exported","241","    @Exported"],"delete":["228","     * The stdout of this test. Note that due to the design of the format,","229","     * stdout for the entire {@link SuiteResult} is reported,","230","     * and Hudson cannot tell what portion of the output corresponds to this test.","231","     *","232","     * @since 1.272","233","     *\/","234","    @Exported","235","    public String getStdout() {","236","        return parent.getStdout();","237","    }","238","","239","    \/**","240","     * The stderr of this test. Note that due to the design of the format,","241","     * stdout for the entire {@link SuiteResult} is reported,","242","     * and Hudson cannot tell what portion of the output corresponds to this test.","243","     *","244","     * @since 1.272","245","     *\/","246","    @Exported","247","    public String getStderr() {","248","        return parent.getStderr();","249","    }","250","","251","    \/**"]}],"core\/src\/main\/java\/hudson\/tasks\/junit\/SuiteResult.java":[{"add":["141","    \/**","142","     * The stdout of this test. Note that due to the design of the format,","143","     * stdout for the entire {@link SuiteResult} is reported,","144","     * and Hudson cannot tell what portion of the output corresponds to this test.","145","     *","146","     * @since 1.281","147","     *\/","153","    \/**","154","     * The stderr of this test. Note that due to the design of the format,","155","     * stdout for the entire {@link SuiteResult} is reported,","156","     * and Hudson cannot tell what portion of the output corresponds to this test.","157","     *","158","     * @since 1.281","159","     *\/","174","    @Exported(inline=true)"],"delete":["160","    @Exported"]}]}},"6351a8a25826679a69648e772e163dafdfc5cae3":{"changes":{"core\/src\/main\/java\/hudson\/ClassicPluginStrategy.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/ClassicPluginStrategy.java":[{"add":["58","import java.lang.reflect.InvocationTargetException;","59","import java.net.URI;","152","        URL baseResourceURL = null;","201","            try {","202","                Class pathJDK7 = Class.forName(\"java.nio.file.Path\");","203","                Object toPath = File.class.getMethod(\"toPath\").invoke(expandDir);","204","                URI uri = (URI) pathJDK7.getMethod(\"toUri\").invoke(toPath);","205","","206","                baseResourceURL = uri.toURL();","207","            } catch (NoSuchMethodException e) {","208","                throw new Error(e);","209","            } catch (ClassNotFoundException e) {","210","                baseResourceURL = expandDir.toURI().toURL();","211","            } catch (InvocationTargetException e) {","212","                throw new Error(e);","213","            } catch (IllegalAccessException e) {","214","                throw new Error(e);","215","            }"],"delete":["149","        URL baseResourceURL;","199","            baseResourceURL = expandDir.toURI().toURL();"]}]}},"2db804ec5d8217a1a4c1adea2d492b37de37484d":{"changes":{"pom.xml":"MODIFY"},"diff":{"pom.xml":[{"add":["108","    <remoting.version>3.26<\/remoting.version>"],"delete":["108","    <remoting.version>3.25<\/remoting.version>"]}]}},"16c395e32c54fe38d05b88237c376d105c45231a":{"changes":{"changelog.html":"MODIFY"},"diff":{"changelog.html":[{"add":["57","  <li class=bug>","58","    Fixed a corner case handling of tool installation.","59","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-16846\">issue 16846<\/a>)"],"delete":[]}]}},"a9b4ca4e71f35488b69a3be3752f219fce1cfd28":{"changes":{"war\/src\/main\/webapp\/scripts\/hudson-behavior.js":"MODIFY"},"diff":{"war\/src\/main\/webapp\/scripts\/hudson-behavior.js":[{"add":["519","    var h = e.onclick;"],"delete":["519","    var type = e.type;","520","    var h = e.onclick || function (event) {","521","        if (type && type.toLowerCase() === 'submit') {","522","            var target = event.target;","523","            var form = findAncestor(target, \"FORM\");","524","            form.submit();","525","        } else {","526","            \/\/FIXME: get some usecases for else","527","        }","528","    };"]}]}},"6affcc507a7987ec69a63ba5c495fd691cf04864":{"changes":{"core\/src\/main\/java\/hudson\/scm\/SCMDescriptor.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/scm\/SCMDescriptor.java":[{"add":["55","    ","56","    private transient final AtomicInteger atomicGeneration = new AtomicInteger(1);","84","        return atomicGeneration.get();","94","        atomicGeneration.incrementAndGet();"],"delete":["55","","56","    private final AtomicInteger generation = new AtomicInteger(1);","84","        return generation.get();","94","        generation.incrementAndGet();"]}]}},"31b951f4025c34959b5a3e33d24601c6156a64ad":{"changes":{"changelog.html":"MODIFY"},"diff":{"changelog.html":[{"add":["63","    Fix for JENKINS-8711 breaks deployments with credentials","64","    (<a href=\"http:\/\/issues.jenkins-ci.org\/browse\/JENKINS-8939\">issue 8939<\/a>)","65","  <li class=bug>"],"delete":[]}]}},"831fdb132cedec464cc87b46727baa7a350b4254":{"changes":{"core\/src\/main\/java\/hudson\/model\/Cause.java":"MODIFY","test\/src\/test\/java\/hudson\/model\/CauseTest.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/Cause.java":[{"add":["455","            User user = getUserId() == null ? null : User.getById(getUserId(), false);","456","            if (user != null) {","457","                listener.getLogger().println(Messages.Cause_UserIdCause_ShortDescription(","458","                        ModelHyperlinkNote.encodeTo(user)));","459","            } else {","460","                listener.getLogger().println(Messages.Cause_UserIdCause_ShortDescription(","461","                        \"unknown or anonymous\"));","462","            }"],"delete":["455","            listener.getLogger().println(Messages.Cause_UserIdCause_ShortDescription(","456","                    \/\/ TODO JENKINS-48467 - better to use ModelHyperlinkNote.encodeTo(User), or User.getUrl, since it handles URL escaping","457","                    ModelHyperlinkNote.encodeTo(\"\/user\/\"+getUserIdOrUnknown(), getUserName())));"]}],"test\/src\/test\/java\/hudson\/model\/CauseTest.java":[{"add":["27","","28","import java.io.*;","31","","32","import static org.hamcrest.CoreMatchers.containsString;","34","","35","import hudson.security.*;","36","import hudson.util.StreamTaskListener;","37","import jenkins.model.Jenkins;","88","","89","    @Issue(\"JENKINS-48467\")","90","    @Test public void userIdCausePrintTest() throws Exception {","91","        ByteArrayOutputStream baos = new ByteArrayOutputStream();","92","        TaskListener listener = new StreamTaskListener(baos);","93","","94","        \/\/null userId - print unknown or anonymous","95","        Cause causeA = new Cause.UserIdCause(null);","96","        causeA.print(listener);","97","","98","        assertEquals(baos.toString().trim(),\"Started by user unknown or anonymous\");","99","        baos.reset();","100","","101","        \/\/SYSTEM userid  - getDisplayName() should be SYSTEM","102","        Cause causeB = new Cause.UserIdCause();","103","        causeB.print(listener);","104","","105","        assertThat(baos.toString(), containsString(\"SYSTEM\"));","106","        baos.reset();","107","","108","        \/\/unknown userid - print unknown or anonymous","109","        Cause causeC = new Cause.UserIdCause(\"abc123\");","110","        causeC.print(listener);","111","","112","        assertEquals(baos.toString().trim(),\"Started by user unknown or anonymous\");","113","        baos.reset();","114","","115","        \/\/More or less standard operation","116","        \/\/user userid  - getDisplayName() should be foo","117","        User user = User.getById(\"foo\", true);","118","        Cause causeD = new Cause.UserIdCause(user.getId());","119","        causeD.print(listener);","120","","121","        assertThat(baos.toString(), containsString(user.getDisplayName()));","122","        baos.reset();","123","    }"],"delete":["27","import java.io.File;"]}]}},"3a5b72ce57237cedfa7af6245f943caaa70fee00":{"changes":{"changelog.html":"MODIFY","core\/src\/main\/java\/hudson\/model\/ComputerSet.java":"MODIFY"},"diff":{"changelog.html":[{"add":["65","    \"Create a new slave\" page didn't auto-complete for copying.","66","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-12490\">issue 12490<\/a>)","67","  <li class=bug>"],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/ComputerSet.java":[{"add":["27","import hudson.Extension;","62","public final class ComputerSet extends AbstractModelObject implements Describable<ComputerSet> {","301","    ","336","    public Descriptor<ComputerSet> getDescriptor() {","337","        return Jenkins.getInstance().getDescriptorOrDie(ComputerSet.class);","338","    }","339","","340","    @Extension","341","    public static class DescriptorImpl extends Descriptor<ComputerSet> {","342","        @Override","343","        public String getDisplayName() {","344","            return \"\";","345","        }","346","","347","        \/**","348","         * Auto-completion for the \"copy from\" field in the new job page.","349","         *\/","350","        public AutoCompletionCandidates doAutoCompleteCopyNewItemFrom(@QueryParameter final String value) {","351","            final AutoCompletionCandidates r = new AutoCompletionCandidates();","352","","353","            for (Node n : Jenkins.getInstance().getNodes()) {","354","                if (n.getNodeName().startsWith(value))","355","                    r.add(n.getNodeName());","356","            }","357","","358","            return r;","359","        }","360","    }","361",""],"delete":["61","public final class ComputerSet extends AbstractModelObject {","300",""]}]}},"8861563bd1e7fc28c5686f0dc9552529cfdfbf45":{"changes":{"test\/src\/test\/java\/hudson\/cli\/CreateJobCommandTest.java":"ADD","changelog.html":"MODIFY","core\/src\/main\/java\/hudson\/model\/ItemGroupMixIn.java":"MODIFY","core\/src\/main\/java\/hudson\/cli\/CreateJobCommand.java":"MODIFY","test\/src\/test\/java\/hudson\/cli\/CopyJobCommandTest.java":"MODIFY","core\/src\/main\/java\/hudson\/cli\/CopyJobCommand.java":"MODIFY"},"diff":{"test\/src\/test\/java\/hudson\/cli\/CreateJobCommandTest.java":[{"add":[],"delete":[]}],"changelog.html":[{"add":["57","  <li class=bug>","58","    Corrected permission checks for <code>copy-job<\/code> and <code>create-job<\/code> CLI commands.","59","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-22262\">issue 22262<\/a>)"],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/ItemGroupMixIn.java":[{"add":["208","        src.checkPermission(Item.EXTENDED_READ);","238","        \/\/ TODO what if we have no DISCOVER permission on the existing job?","273","        \/\/ TODO problem with DISCOVER as noted above"],"delete":[]}],"core\/src\/main\/java\/hudson\/cli\/CreateJobCommand.java":[{"add":[],"delete":["25","import hudson.model.ModifiableItemGroup;","26","import hudson.model.TopLevelItem;","50","        h.checkPermission(Item.CREATE);"]}],"test\/src\/test\/java\/hudson\/cli\/CopyJobCommandTest.java":[{"add":["27","import static hudson.cli.CLICommandInvoker.Matcher.*;","28","import hudson.model.AbstractItem;","30","import hudson.model.Item;","31","import hudson.model.Job;","32","import hudson.model.User;","33","import hudson.security.ACL;","34","import hudson.security.AuthorizationStrategy;","35","import hudson.security.SparseACL;","36","import java.util.Collection;","37","import java.util.Collections;","38","import jenkins.model.Jenkins;","39","import org.acegisecurity.acls.sid.PrincipalSid;","40","import static org.hamcrest.MatcherAssert.assertThat;","45","import org.jvnet.hudson.test.Bug;","53","    private CLICommand copyJobCommand;","57","        copyJobCommand = new CopyJobCommand();","58","        command = new CLICommandInvoker(j, copyJobCommand);","74","    @Bug(22262)","75","    @Test public void folderPermissions() throws Exception {","76","        final MockFolder d1 = j.createFolder(\"d1\");","77","        final FreeStyleProject p = d1.createProject(FreeStyleProject.class, \"p\");","78","        final MockFolder d2 = j.createFolder(\"d2\");","79","        \/\/ alice has no real permissions. bob has READ on everything but no more. charlie has CREATE on d2 but not EXTENDED_READ on p. debbie has both.","80","        final SparseACL rootACL = new SparseACL(null);","81","        rootACL.add(new PrincipalSid(\"alice\"), Jenkins.READ, true);","82","        rootACL.add(new PrincipalSid(\"bob\"), Jenkins.READ, true);","83","        rootACL.add(new PrincipalSid(\"charlie\"), Jenkins.READ, true);","84","        rootACL.add(new PrincipalSid(\"debbie\"), Jenkins.READ, true);","85","        final SparseACL d1ACL = new SparseACL(null);","86","        d1ACL.add(new PrincipalSid(\"bob\"), Item.READ, true);","87","        d1ACL.add(new PrincipalSid(\"charlie\"), Item.READ, true);","88","        d1ACL.add(new PrincipalSid(\"debbie\"), Item.READ, true);","89","        final SparseACL pACL = new SparseACL(null);","90","        pACL.add(new PrincipalSid(\"bob\"), Item.READ, true);","91","        pACL.add(new PrincipalSid(\"charlie\"), Item.READ, true);","92","        pACL.add(new PrincipalSid(\"debbie\"), Item.READ, true);","93","        pACL.add(new PrincipalSid(\"debbie\"), Item.EXTENDED_READ, true);","94","        final SparseACL d2ACL = new SparseACL(null);","95","        d2ACL.add(new PrincipalSid(\"bob\"), Item.READ, true);","96","        d2ACL.add(new PrincipalSid(\"charlie\"), Item.READ, true);","97","        d2ACL.add(new PrincipalSid(\"charlie\"), Item.CREATE, true);","98","        d2ACL.add(new PrincipalSid(\"debbie\"), Item.READ, true);","99","        d2ACL.add(new PrincipalSid(\"debbie\"), Item.CREATE, true);","100","        j.jenkins.setSecurityRealm(j.createDummySecurityRealm());","101","        j.jenkins.setAuthorizationStrategy(new AuthorizationStrategy() {","102","            @Override public ACL getRootACL() {","103","                return rootACL;","104","            }","105","            @Override public ACL getACL(Job<?, ?> project) {","106","                if (project == p) {","107","                    return pACL;","108","                } else {","109","                    throw new AssertionError(project);","110","                }","111","            }","112","            @Override public ACL getACL(AbstractItem item) {","113","                if (item == d1) {","114","                    return d1ACL;","115","                } else if (item == d2) {","116","                    return d2ACL;","117","                } else {","118","                    throw new AssertionError(item);","119","                }","120","            }","121","            @Override public Collection<String> getGroups() {","122","                return Collections.emptySet();","123","            }","124","        });","125","        copyJobCommand.setTransportAuth(User.get(\"alice\").impersonate());","126","        assertThat(command.invokeWithArgs(\"d1\/p\", \"d2\/p\"), failedWith(-1));","127","        copyJobCommand.setTransportAuth(User.get(\"bob\").impersonate());","128","        assertThat(command.invokeWithArgs(\"d1\/p\", \"d2\/p\"), failedWith(-1));","129","        copyJobCommand.setTransportAuth(User.get(\"charlie\").impersonate());","130","        assertThat(command.invokeWithArgs(\"d1\/p\", \"d2\/p\"), failedWith(-1));","131","        copyJobCommand.setTransportAuth(User.get(\"debbie\").impersonate());","132","        assertThat(command.invokeWithArgs(\"d1\/p\", \"d2\/p\"), succeededSilently());","133","        assertNotNull(d2.getItem(\"p\"));","134","    }","135",""],"delete":["35","import static org.hamcrest.MatcherAssert.assertThat;","36","","37","import static hudson.cli.CLICommandInvoker.Matcher.succeededSilently;","38","","46","        command = new CLICommandInvoker(j, new CopyJobCommand());"]}],"core\/src\/main\/java\/hudson\/cli\/CopyJobCommand.java":[{"add":[],"delete":["53","        jenkins.checkPermission(Item.CREATE);"]}]}},"f3e9d5d6819b0a96c41f4570487ff42b966d8bb2":{"changes":{"core\/src\/main\/java\/hudson\/util\/jna\/SHELLEXECUTEINFO.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/util\/jna\/SHELLEXECUTEINFO.java":[{"add":["83","                \"hProcess\");"],"delete":["83","                \"hProcess\", \"SEE_MASK_NOCLOSEPROCESS\", \"SW_HIDE\", \"SW_SHOW\");"]}]}},"93a7d49ed1197a6d8906f77a22f9dab591f045c4":{"changes":{"core\/src\/main\/java\/hudson\/model\/Queue.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/Executor.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/Queue.java":[{"add":["1116","         * ","1117","         * Please, consider using {@link Executor#getEstimatedDurationFor(Executable)}","1118","         * to protected against AbstractMethodErrors!"],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/Executor.java":[{"add":["271","        long d = getEstimatedDurationFor(e);","292","        long d = getEstimatedDurationFor(e);","324","        long d = getEstimatedDurationFor(e);","341","        long d = getEstimatedDurationFor(e);","381","            return Math.max(startTime + Math.max(0, getEstimatedDurationFor(executable)),","419","    ","420","    \/**","421","     * Returns the estimated duration for the executable.","422","     * Protects against {@link AbstractMethodError}s if the {@link Executable} implementation","423","     * was compiled against Hudson < 1.383 ","424","     *\/","425","    public static long getEstimatedDurationFor(Executable e) {","426","        try {","427","            return e.getEstimatedDuration();","428","        } catch (AbstractMethodError error) {","429","            return e.getParent().getEstimatedDuration();","430","        }","431","    }"],"delete":["271","        long d = e.getEstimatedDuration();","292","        long d = e.getEstimatedDuration();","324","        long d = e.getEstimatedDuration();","341","        long d = e.getEstimatedDuration();","381","            return Math.max(startTime + Math.max(0, executable.getEstimatedDuration()),"]}]}},"f5e94294dd4dd373f8352e17c29e72a684774b81":{"changes":{"core\/src\/main\/resources\/hudson\/model\/queue\/_api.jelly":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/model\/queue\/_api.jelly":[{"add":["6","    The id of the item to cancel is expected to be passed as a query parameter named <code>id<\/code>.","16","<\/j:jelly>"],"delete":["6","    The id of the item to cancel is expected.","16","<\/j:jelly>"]}]}},"8d60595fcedffe947a08be097bc906134118983f":{"changes":{"core\/src\/main\/resources\/hudson\/security\/SecurityRealm\/signup.jelly":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/security\/SecurityRealm\/signup.jelly":[{"add":["25","    <st:statusCode value=\"404\" \/>"],"delete":[]}]}},"189a1f31f1bc0358fa10b4a143e6c402aa93405f":{"changes":{"core\/src\/main\/resources\/hudson\/model\/labels\/LabelAtom\/configure.jelly":"ADD","core\/src\/main\/java\/hudson\/model\/LabelFinder.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/Label.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/labels\/LabelAtomPropertyDescriptor.java":"ADD","core\/src\/main\/java\/hudson\/model\/Node.java":"MODIFY","test\/src\/test\/java\/hudson\/model\/labels\/LabelAtomPropertyTest.java":"ADD","core\/src\/main\/java\/hudson\/model\/labels\/LabelAtom.java":"ADD","core\/src\/main\/java\/hudson\/model\/Hudson.java":"MODIFY","\/dev\/null":"DELETE","core\/src\/main\/java\/hudson\/model\/labels\/LabelExpression.java":"ADD","test\/src\/test\/java\/hudson\/tasks\/EnvVarsInConfigTasksTest.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/labels\/LabelAtomProperty.java":"ADD","core\/src\/main\/java\/hudson\/model\/labels\/package-info.java":"ADD","test\/src\/test\/java\/hudson\/tools\/ToolLocationNodePropertyTest.java":"MODIFY","core\/src\/main\/grammar\/labelExpr.g":"MODIFY","test\/src\/test\/java\/hudson\/model\/labels\/LabelExpressionTest.java":"ADD","core\/src\/main\/java\/hudson\/model\/labels\/LabelOperatorPrecedence.java":"ADD"},"diff":{"core\/src\/main\/resources\/hudson\/model\/labels\/LabelAtom\/configure.jelly":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/LabelFinder.java":[{"add":["3"," * Copyright (c) 2004-2010, Sun Microsystems, Inc., Kohsuke Kawaguchi, Stephen Connolly","28","import hudson.model.labels.LabelAtom;"],"delete":["3"," * Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi, Stephen Connolly","28","import hudson.model.label.LabelAtom;"]}],"core\/src\/main\/java\/hudson\/model\/Label.java":[{"add":["3"," * Copyright (c) 2004-2010, Sun Microsystems, Inc., Kohsuke Kawaguchi, Tom Huybrechts","29","import hudson.model.labels.LabelAtom;","30","import hudson.model.labels.LabelExpression;","31","import hudson.model.labels.LabelExpressionLexer;","32","import hudson.model.labels.LabelExpressionParser;","33","import hudson.model.labels.LabelOperatorPrecedence;"],"delete":["3"," * Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi, Tom Huybrechts","29","import hudson.model.label.LabelAtom;","30","import hudson.model.label.LabelExpression;","31","import hudson.model.label.LabelExpressionLexer;","32","import hudson.model.label.LabelExpressionParser;","33","import hudson.model.label.LabelOperatorPrecedence;"]}],"core\/src\/main\/java\/hudson\/model\/labels\/LabelAtomPropertyDescriptor.java":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/Node.java":[{"add":["3"," * Copyright (c) 2004-2010, Sun Microsystems, Inc., Kohsuke Kawaguchi,","4"," * Seiji Sogabe, Stephen Connolly","32","import hudson.model.labels.LabelAtom;"],"delete":["3"," * Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi, Seiji Sogabe, Stephen Connolly","31","import hudson.model.label.LabelAtom;"]}],"test\/src\/test\/java\/hudson\/model\/labels\/LabelAtomPropertyTest.java":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/labels\/LabelAtom.java":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/Hudson.java":[{"add":["69","import hudson.model.labels.LabelAtom;"],"delete":["69","import hudson.model.label.LabelAtom;"]}],"\/dev\/null":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/labels\/LabelExpression.java":[{"add":[],"delete":[]}],"test\/src\/test\/java\/hudson\/tasks\/EnvVarsInConfigTasksTest.java":[{"add":["3","import hudson.model.labels.LabelAtom;"],"delete":["3","import hudson.model.label.LabelAtom;"]}],"core\/src\/main\/java\/hudson\/model\/labels\/LabelAtomProperty.java":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/labels\/package-info.java":[{"add":[],"delete":[]}],"test\/src\/test\/java\/hudson\/tools\/ToolLocationNodePropertyTest.java":[{"add":["3"," * Copyright (c) 2004-2010, Sun Microsystems, Inc., Tom Huybrechts","28","import hudson.model.labels.LabelAtom;","189","}"],"delete":["3"," * Copyright (c) 2004-2009, Sun Microsystems, Inc., Tom Huybrechts","28","import hudson.model.label.LabelAtom;","189","}"]}],"core\/src\/main\/grammar\/labelExpr.g":[{"add":["24","  package hudson.model.labels;"],"delete":["24","  package hudson.model.label;"]}],"test\/src\/test\/java\/hudson\/model\/labels\/LabelExpressionTest.java":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/labels\/LabelOperatorPrecedence.java":[{"add":[],"delete":[]}]}},"b0b06b515ba4471a1ec6fec77d96efc71935b2b9":{"changes":{"maven-plugin\/src\/main\/java\/hudson\/maven\/MavenModuleSetBuild.java":"MODIFY","changelog.html":"MODIFY","maven-plugin\/src\/main\/java\/hudson\/maven\/MavenBuild.java":"MODIFY"},"diff":{"maven-plugin\/src\/main\/java\/hudson\/maven\/MavenModuleSetBuild.java":[{"add":["149","        \/\/ We need to add M2_HOME and the mvn binary to the PATH so if Maven","150","        \/\/ needs to run Maven it will pick the correct one.","151","        \/\/ This can happen if maven calls ANT which itself calls Maven","152","        \/\/ or if Maven calls itself e.g. maven-release-plugin","153","        MavenInstallation mvn = project.getMaven();","154","        if (mvn == null)","155","            throw new AbortException(","156","                    \"A Maven installation needs to be available for this project to be built.\\n\"","157","                    + \"Either your server has no Maven installations defined, or the requested Maven version does not exist.\");","158","","159","        mvn = mvn.forEnvironment(envs).forNode(","160","                Computer.currentComputer().getNode(), log);","161","        envs.put(\"M2_HOME\", mvn.getHome());","162","        envs.put(\"PATH+MAVEN\", mvn.getHome() + \"\/bin\");"],"delete":[]}],"changelog.html":[{"add":["74","  <li class=bug>","75","    Configure the environment for Maven job type builds","76","    (<a href=\"http:\/\/issues.jenkins-ci.org\/browse\/JENKINS-8092\">issue 8902<\/a>)"],"delete":[]}],"maven-plugin\/src\/main\/java\/hudson\/maven\/MavenBuild.java":[{"add":["195","        \/\/ We need to add M2_HOME and the mvn binary to the PATH so if Maven","196","        \/\/ needs to run Maven it will pick the correct one.","197","        \/\/ This can happen if maven calls ANT which itself calls Maven","198","        \/\/ or if Maven calls itself e.g. maven-release-plugin","199","        MavenInstallation mvn = project.getParent().getMaven();","200","        if (mvn == null)","201","            throw new AbortException(","202","                    \"A Maven installation needs to be available for this project to be built.\\n\"","203","                    + \"Either your server has no Maven installations defined, or the requested Maven version does not exist.\");","204","        mvn = mvn.forEnvironment(envs).forNode(Computer.currentComputer().getNode(), log);","205","        envs.put(\"M2_HOME\", mvn.getHome());","206","        envs.put(\"PATH+MAVEN\", mvn.getHome() + \"\/bin\");"],"delete":[]}]}},"e65f8880e4631f7efaa17fce474dc692c94b19c6":{"changes":{"core\/src\/main\/java\/hudson\/scheduler\/CronTab.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/scheduler\/CronTab.java":[{"add":["103","            long bitMask = (i<4)?bits[i]:(long)dayOfWeek;","105","                if(!checkBits(bitMask,j)) {"],"delete":["104","                if(!checkBits(bits[i],j)) {"]}]}},"9a3e5518baa044ce2fedf25af73490d58b0d3976":{"changes":{"core\/src\/test\/java\/jenkins\/slaves\/DefaultJnlpSlaveReceiverTest.java":"ADD","core\/src\/main\/java\/jenkins\/slaves\/DefaultJnlpSlaveReceiver.java":"MODIFY"},"diff":{"core\/src\/test\/java\/jenkins\/slaves\/DefaultJnlpSlaveReceiverTest.java":[{"add":[],"delete":[]}],"core\/src\/main\/java\/jenkins\/slaves\/DefaultJnlpSlaveReceiver.java":[{"add":["50","                return true;"],"delete":["50","                return false;"]}]}},"ccb3e4cd501b14f617979117ea31fc21f07b972b":{"changes":{"core\/src\/main\/java\/hudson\/ProxyConfiguration.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/ProxyConfiguration.java":[{"add":["398","                return new NTCredentials(user, Secret.fromString(password).getPlainText(), \"\", domain);"],"delete":["398","                return new NTCredentials(user, Secret.fromString(password).getPlainText(), domain, \"\");"]}]}},"ce015a9c85c0c88e601d0fe513ec9994603b5f36":{"changes":{"test\/src\/main\/java\/org\/jvnet\/hudson\/test\/HudsonTestCase.java":"MODIFY","core\/src\/main\/java\/hudson\/util\/ChartUtil.java":"MODIFY","core\/src\/main\/java\/hudson\/WebAppMain.java":"MODIFY","core\/src\/main\/java\/hudson\/tasks\/test\/AbstractTestResultAction.java":"MODIFY"},"diff":{"test\/src\/main\/java\/org\/jvnet\/hudson\/test\/HudsonTestCase.java":[{"add":["30","import hudson.WebAppMain;","52","import javax.servlet.ServletContextEvent;","124","        WebAppMain.installExpressionFactory(new ServletContextEvent(hudson.servletContext));","504",""],"delete":["501","        "]}],"core\/src\/main\/java\/hudson\/util\/ChartUtil.java":[{"add":["57","     * @deprecated","58","     *      Use {@code awtProblemCause!=null} instead. As of 1.267.","59","     *\/","60","    public static boolean awtProblem = false;","61","","62","    \/**","65","    public static Throwable awtProblemCause = null;","209","            awtProblemCause = t;","210","            awtProblem = true;"],"delete":["59","    public static Throwable awtProblem = null;","203","            awtProblem = t;"]}],"core\/src\/main\/java\/hudson\/WebAppMain.java":[{"add":["118","            if(ChartUtil.awtProblemCause!=null) {","119","                context.setAttribute(APP,new AWTProblem(ChartUtil.awtProblemCause));","153","            installExpressionFactory(event);","198","    public static void installExpressionFactory(ServletContextEvent event) {","199","        Stapler.setExpressionFactory(event, new ExpressionFactory2());","200","    }","201",""],"delete":["118","            if(ChartUtil.awtProblem!=null) {","119","                context.setAttribute(APP,new AWTProblem(ChartUtil.awtProblem));","153","            Stapler.setExpressionFactory(event, new ExpressionFactory2());"]}],"core\/src\/main\/java\/hudson\/tasks\/test\/AbstractTestResultAction.java":[{"add":["158","        if(ChartUtil.awtProblemCause!=null) {"],"delete":["158","        if(ChartUtil.awtProblem!=null) {"]}]}},"68af8c83c10ac2a4ca42cebfe053f06931415bb6":{"changes":{"war\/pom.xml":"MODIFY"},"diff":{"war\/pom.xml":[{"add":["132","      <version>2.5<\/version>"],"delete":["132","      <version>2.4<\/version>"]}]}},"4462eda829944a39f2ddfdab607d7105be8aface":{"changes":{"core\/src\/main\/java\/hudson\/model\/UpdateCenter.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/UpdateCenter.java":[{"add":["32","import hudson.security.ACLContext;","1375","         * The name of the user that started this job","1376","         *\/","1377","        private String authentication;","1378","","1379","        \/**","1392","            this.authentication = Jenkins.getAuthentication().getName();","1401","                \/\/ safeRestart records the current authentication for the log, so set it to the managing user","1402","                try (ACLContext _ = ACL.as(User.get(authentication, false, Collections.emptyMap()))) {","1403","                    Jenkins.getInstance().safeRestart();","1404","                }"],"delete":["1394","                Jenkins.getInstance().safeRestart();"]}]}},"2f057b4edde450bb2e6fe86bcd02fd731c8dbc88":{"changes":{"changelog.html":"MODIFY"},"diff":{"changelog.html":[{"add":["58","  <li class=bug>","59","    Failure to serialize a single <code>Action<\/code> could cause an entire REST export response to fail.","60","    Upgraded to Stapler <code>1.249<\/code> with a fix.","61","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-40088\">issue 40088<\/a>)"],"delete":["58","  <li class=>","93","  <li class=bug>","94","    Failure to serialize a single <code>Action<\/code> could cause an entire REST export response to fail.","95","    Upgraded to Stapler <code>1.249<\/code> with a fix.","96","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-40088\">issue 40088<\/a>)"]}]}},"ea1b80aebe85a9414d5befd58e976d85818a258d":{"changes":{"changelog.html":"MODIFY","cli\/src\/main\/java\/hudson\/cli\/CLI.java":"MODIFY"},"diff":{"changelog.html":[{"add":["58","    CLI - I\/O error in channel Chunked connection\/Unexpected termination of the channel - still occuring in Jenkins 1.449.","59","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-12037\">issue 12037<\/a>)","60","  <li class=bug>"],"delete":[]}],"cli\/src\/main\/java\/hudson\/cli\/CLI.java":[{"add":["152","        final long interval = 15*1000;","153","        final long timeout = (interval * 3) \/ 4;","154","        new PingThread(ch,timeout,interval) {"],"delete":["152","        new PingThread(ch,15*1000) {"]}]}},"dc06c3f03b026c8faafa3e080f3a307c97f4fd42":{"changes":{"test\/src\/test\/java\/hudson\/cli\/CLIActionTest.java":"MODIFY","cli\/src\/main\/java\/hudson\/cli\/PlainCLIProtocol.java":"MODIFY","cli\/src\/main\/java\/hudson\/cli\/CLI.java":"MODIFY"},"diff":{"test\/src\/test\/java\/hudson\/cli\/CLIActionTest.java":[{"add":[],"delete":["42","import org.junit.Ignore;","258","    @Ignore(\"TODO JENKINS-46659 seems to be broken\")"]}],"cli\/src\/main\/java\/hudson\/cli\/PlainCLIProtocol.java":[{"add":[],"delete":["36","import java.util.concurrent.TimeoutException;","114","                        } catch (IOException x) {","115","                            if (x.getCause() instanceof TimeoutException) { \/\/ TODO on Tomcat this seems to be SocketTimeoutException","116","                                LOGGER.log(Level.FINE, \"ignoring idle timeout, perhaps from Jetty\", x);","117","                                continue;","118","                            } else {","119","                                throw x;","120","                            }"]}],"cli\/src\/main\/java\/hudson\/cli\/CLI.java":[{"add":["706","            new Thread(\"ping\") { \/\/ JENKINS-46659","707","                @Override","708","                public void run() {","709","                    try {","710","                        Thread.sleep(10_000);","711","                        while (!connection.complete) {","712","                            LOGGER.fine(\"sending ping\");","713","                            connection.sendEncoding(Charset.defaultCharset().name()); \/\/ no-op at this point","714","                            Thread.sleep(10_000);","715","                        }","716","                    } catch (IOException | InterruptedException x) {","717","                        LOGGER.log(Level.WARNING, null, x);","718","                    }","719","                }","720","","721","            }.start();"],"delete":[]}]}}}