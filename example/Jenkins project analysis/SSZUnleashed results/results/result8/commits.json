{"da8afbc2b9525d99efc44ab8edbd16253828d641":{"changes":{"core\/src\/main\/java\/hudson\/scm\/SubversionSCM.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/scm\/SubversionSCM.java":[{"add":["728","            final File keyFile;","729","            FileItem item=null;","730","            if(!passwordKind) {","731","                item = parser.getFileItem(\"privateKey\");","732","                keyFile = File.createTempFile(\"hudson\",\"key\");","733","                if(item!=null)","734","                    try {","735","                        item.write(keyFile);","736","                    } catch (Exception e) {","737","                        throw new IOException2(e);","738","                    }","739","            } else {","740","                keyFile = null;","741","            }"],"delete":["728","            FileItem item = parser.getFileItem(\"privateKey\");","729","            final File keyFile = File.createTempFile(\"hudson\",\"key\");","730","            if(item!=null)","731","                try {","732","                    item.write(keyFile);","733","                } catch (Exception e) {","734","                    throw new IOException2(e);","735","                }"]}]}},"afcdb045c1bab10617421029cd513dbad70b4101":{"changes":{"core\/src\/main\/java\/hudson\/slaves\/SlaveComputer.java":"MODIFY","core\/src\/main\/resources\/jenkins\/slaves\/systemInfo\/EnvVarsSlaveInfo\/systemInfo.jelly":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/slaves\/SlaveComputer.java":[{"add":["28","import hudson.Main;","90","import java.util.Map;","91","import java.util.TreeMap;","907","    \/**","908","     * Expose real full env vars map from agent for UI presentation","909","     *\/","910","    public Map<String,String> getEnvVarsFull() throws IOException, InterruptedException {","911","        if(getChannel() == null) {","912","            Map<String, String> env = new TreeMap<> ();","913","            env.put(\"N\/A\",\"N\/A\");","914","            return env;","915","        } else {","916","            return getChannel().call(new ListFullEnvironment());","917","        }","918","    }","919","","920","    private static class ListFullEnvironment extends MasterToSlaveCallable<Map<String,String>,IOException> {","921","        public Map<String,String> call() throws IOException {","922","            Map<String, String> env = new TreeMap<>(System.getenv());","923","            if(Main.isUnitTest || Main.isDevelopmentMode) {","924","                \/\/ if unit test is launched with maven debug switch,","925","                \/\/ we need to prevent forked Maven processes from seeing it, or else","926","                \/\/ they'll hang","927","                env.remove(\"MAVEN_OPTS\");","928","            }","929","            return env;","930","        }","931","    }","932",""],"delete":[]}],"core\/src\/main\/resources\/jenkins\/slaves\/systemInfo\/EnvVarsSlaveInfo\/systemInfo.jelly":[{"add":["31","  <t:propertyTable items=\"${it.envVarsFull}\" \/>"],"delete":["31","  <t:propertyTable items=\"${it.envVars}\" \/>"]}]}},"132f8b769d3cd39861d686ccf0751fd81cf8595d":{"changes":{"changelog.html":"MODIFY","core\/src\/main\/java\/hudson\/PluginManager.java":"MODIFY"},"diff":{"changelog.html":[{"add":["58","    Fixed a bug in the auto-overwrite of bundled plugins on Windows.","59","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-12514\">issue 12514<\/a>)","60","  <li class=bug>"],"delete":[]}],"core\/src\/main\/java\/hudson\/PluginManager.java":[{"add":["416","        \/\/ normalization first, if the old file exists.","417","        rename(new File(rootDir,legacyName),file);","418","        rename(new File(rootDir,legacyName+\".pinned\"),pinFile);","434","     * Rename a legacy file to a new name, with care to Windows where {@link File#renameTo(File)}","435","     * doesn't work if the destination already exists.","436","     *\/","437","    private void rename(File legacyFile, File newFile) throws IOException {","438","        if (!legacyFile.exists())   return;","439","        if (newFile.exists()) {","440","            Util.deleteFile(newFile);","441","        }","442","        if (!legacyFile.renameTo(newFile)) {","443","            LOGGER.warning(\"Failed to rename \" + legacyFile + \" to \" + newFile);","444","        }","445","    }","446","","447","    \/**"],"delete":["416","        {\/\/ normalization first","417","            File legacyFile = new File(rootDir,legacyName);","418","            if (legacyFile.exists())    legacyFile.renameTo(file);","419","            File legacyPinFile = new File(rootDir,legacyName+\".pinned\");","420","            if (legacyPinFile.exists())    legacyPinFile.renameTo(pinFile);","421","        }"]}]}},"cf1fdf98e435b4c7df54f1a8e958d185f1a0f3d2":{"changes":{"core\/src\/main\/java\/hudson\/model\/Queue.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/Queue.java":[{"add":["801","        if (t.task instanceof hudson.security.AccessControlled) {","802","            if (((hudson.security.AccessControlled)t.task).hasPermission(hudson.model.Item.READ)","803","                    || ((hudson.security.AccessControlled) t.task).hasPermission(hudson.security.Permission.READ)) {"],"delete":["801","        if (t.task instanceof hudson.model.Item) {","802","            if (((hudson.model.Item)t.task).hasPermission(hudson.model.Item.READ)) {"]}]}},"4a6f58d5cd49dfae3d5ef93d6fc1d894ad5ccefa":{"changes":{"core\/src\/main\/java\/hudson\/model\/Run.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/Run.java":[{"add":["4"," * Daniel Dyer, Red Hat, Inc., Tom Huybrechts, Romain Seguy, Yahoo! Inc.,","5"," * Darek Ostolski","1552","            RunT failedBuild = since.getNextBuild();","1553","            return new Summary(false, Messages.Run_Summary_BrokenSince(failedBuild.getDisplayName()));"],"delete":["4"," * Daniel Dyer, Red Hat, Inc., Tom Huybrechts, Romain Seguy, Yahoo! Inc.","1551","            return new Summary(false, Messages.Run_Summary_BrokenSince(since.getDisplayName()));"]}]}},"47de54d070f67af95b4fefb6d006a72bb31a5cb8":{"changes":{"core\/pom.xml":"MODIFY","core\/src\/main\/java\/hudson\/ClassicPluginStrategy.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/AbstractProject.java":"MODIFY","changelog.html":"MODIFY","core\/src\/main\/java\/hudson\/PluginManager.java":"MODIFY","pom.xml":"MODIFY"},"diff":{"core\/pom.xml":[{"add":["217","      <groupId>org.jenkins-ci<\/groupId>","218","      <artifactId>bytecode-compatibility-transformer<\/artifactId>","219","      <version>1.3<\/version>","220","    <\/dependency>","221","    <dependency>"],"delete":[]}],"core\/src\/main\/java\/hudson\/ClassicPluginStrategy.java":[{"add":["224","","225","        AntClassLoader2 classLoader = new AntClassLoader2(parent);","226","        classLoader.addPathFiles(paths);","227","        return classLoader;","644","    private final class AntClassLoader2 extends AntClassLoader implements Closeable {","661","","692","","693","        @Override","694","        protected Class defineClassFromData(File container, byte[] classData, String classname) throws IOException {","695","            return super.defineClassFromData(container, pluginManager.getCompatibilityTransformer().transform(classname,classData), classname);","696","        }"],"delete":["61","import java.net.URLClassLoader;","225","        if(useAntClassLoader && !Closeable.class.isAssignableFrom(URLClassLoader.class)) {","226","            \/\/ using AntClassLoader with Closeable so that we can predictably release jar files opened by URLClassLoader","227","            AntClassLoader2 classLoader = new AntClassLoader2(parent);","228","            classLoader.addPathFiles(paths);","229","            return classLoader;","230","        } else {","231","            \/\/ Tom reported that AntClassLoader has a performance issue when Hudson keeps trying to load a class that doesn't exist,","232","            \/\/ so providing a legacy URLClassLoader support, too","233","            List<URL> urls = new ArrayList<URL>();","234","            for (File path : paths)","235","                urls.add(path.toURI().toURL());","236","            return new URLClassLoader(urls.toArray(new URL[urls.size()]),parent);","237","        }","654","    private static final class AntClassLoader2 extends AntClassLoader implements Closeable {"]}],"core\/src\/main\/java\/hudson\/model\/AbstractProject.java":[{"add":["97","import org.jenkinsci.bytecode.AdaptField;","245","    @AdaptField(was=List.class)"],"delete":[]}],"changelog.html":[{"add":["57","  <li class=bug>","58","    Fixed <tt>NoSuchFieldError: triggers<\/tt> with older Maven plugin","59","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-18677\">issue 18677<\/a>)","60","  <li class=rfe>","61","    Added bytecode transformation driven compatibility ensurance mechanism","62","    (<a href=\"https:\/\/groups.google.com\/forum\/#!topic\/jenkinsci-dev\/7qCClb36njo\">discussion<\/a>)"],"delete":[]}],"core\/src\/main\/java\/hudson\/PluginManager.java":[{"add":["61","import org.jenkinsci.bytecode.Transformer;","154","    private final Transformer compatibilityTransformer = new Transformer();","155","","184","","185","        \/\/ load up rules for the core first","186","        try {","187","            compatibilityTransformer.loadRules(getClass().getClassLoader());","188","        } catch (IOException e) {","189","            LOGGER.log(Level.WARNING, \"Failed to load compatibility rewrite rules\",e);","190","        }","191","    }","192","","193","    public Transformer getCompatibilityTransformer() {","194","        return compatibilityTransformer;","317","                            \/\/ Let's see for a while until we open this functionality up to plugins","318","\/\/                            g.followedBy().attains(PLUGINS_LISTED).add(\"Load compatibility rules\", new Executable() {","319","\/\/                                public void run(Reactor reactor) throws Exception {","320","\/\/                                    compatibilityTransformer.loadRules(uberClassLoader);","321","\/\/                                }","322","\/\/                            });","323",""],"delete":[]}],"pom.xml":[{"add":["176","        <version>2.32<\/version>"],"delete":["176","        <version>2.31<\/version>"]}]}},"b39ff9938a29b34bd6fb881722c978e0f886854d":{"changes":{"core\/src\/main\/java\/hudson\/model\/UpdateCenter.java":"MODIFY","core\/src\/main\/java\/hudson\/PluginManager.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/UpdateSite.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/UpdateCenter.java":[{"add":["1065","            Future<FormValidation> future = site.updateDirectly();","2518","            site.updateDirectlyNow();"],"delete":["1065","            Future<FormValidation> future = site.updateDirectly(DownloadService.signatureCheck);","2518","            site.updateDirectlyNow(true);"]}],"core\/src\/main\/java\/hudson\/PluginManager.java":[{"add":["1764","            FormValidation v = site.updateDirectlyNow();"],"delete":["1764","            FormValidation v = site.updateDirectlyNow(DownloadService.signatureCheck);"]}],"core\/src\/main\/java\/hudson\/model\/UpdateSite.java":[{"add":["166","     * @return null if no updates are necessary, or the future result","167","     * @since TODO","168","     *\/","169","    public @CheckForNull Future<FormValidation> updateDirectly() {","170","        return updateDirectly(DownloadService.signatureCheck);","171","    }","172","","173","    \/**","174","     * Update the data file from the given URL if the file","175","     * does not exist, or is otherwise due for update.","176","     * Accepted formats are JSONP or HTML with {@code postMessage}, not raw JSON.","180","     * @deprecated use {@linkplain #updateDirectly()}","182","    @Deprecated","195","    \/**","196","     * Forces an update of the data file from the configured URL, irrespective of the last time the data was retrieved.","197","     * @return A {@code FormValidation} indicating the if the update metadata was successfully downloaded from the configured update site","198","     * @since TODO","199","     * @throws IOException if there was an error downloading or saving the file.","200","     *\/","201","    public @Nonnull FormValidation updateDirectlyNow() throws IOException {","202","        return updateDirectlyNow(DownloadService.signatureCheck);","203","    }","204",""],"delete":[]}]}},"9bc7e21dc0bd679e7b6506f264079630493237d4":{"changes":{"core\/src\/main\/java\/hudson\/tasks\/junit\/TestResult.java":"MODIFY","core\/src\/main\/java\/hudson\/tasks\/junit\/JUnitResultArchiver.java":"MODIFY","changelog.html":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/tasks\/junit\/TestResult.java":[{"add":["379","    ","380","    \/**","381","     * Returns <tt>true<\/tt> if this doesn't have any any test results. ","382","     * @since 1.511","383","     *\/","384","    @Exported(visibility=999)","385","    public boolean isEmpty() {","386","        return getTotalCount() == 0;","387","    }"],"delete":[]}],"core\/src\/main\/java\/hudson\/tasks\/junit\/JUnitResultArchiver.java":[{"add":["140","\t\t\tif (result.isEmpty()) {","141","\t\t\t    \/\/ most likely a configuration error in the job - e.g. false pattern to match the JUnit result files","143","\t\t\t}"],"delete":["59","import java.io.Serializable;","141","\t\t\tif (result.getPassCount() == 0 && result.getFailCount() == 0)"]}],"changelog.html":[{"add":["57","  <li class=bug>","58","    JUnit result archiver should only fail builds if there are really no results - i.e. also no skipped tests.","59","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-7970\">issue 7970<\/a>)"],"delete":["57","  <li class=>"]}]}},"2c7961e7e084a7d7bcab3040226a45a019f7915c":{"changes":{"core\/src\/main\/java\/hudson\/model\/AbstractProject.java":"MODIFY","changelog.html":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/AbstractProject.java":[{"add":["224","     * @since 1.410","1976","     * @since 1.410"],"delete":["224","     * @since xxx","1976","     * @since XXX"]}],"changelog.html":[{"add":["66","  <li class=rfe>","67","    Support custom workspace for maven\/ivy projects","68","    (<a href=\"http:\/\/issues.jenkins-ci.org\/browse\/JENKINS-8848\">issue 8848<\/a>)"],"delete":[]}]}},"34c15c775e95c4e8706e21ffdb4e5187444ff401":{"changes":{"core\/src\/main\/resources\/hudson\/model\/User\/delete.jelly":"ADD","core\/src\/main\/java\/hudson\/model\/User.java":"MODIFY","core\/src\/main\/resources\/hudson\/model\/User\/sidepanel.jelly":"MODIFY","core\/src\/main\/resources\/hudson\/security\/HudsonPrivateSecurityRealm\/index.jelly":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/model\/User\/delete.jelly":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/User.java":[{"add":["50","import javax.servlet.http.HttpServletResponse;","305","","411","     * Deletes the data directory and removes this user from Hudson.","412","     *","413","     * @throws IOException","414","     *      if we fail to delete.","415","     *\/","416","    public synchronized void delete() throws IOException {","417","        synchronized (byName) {","418","            byName.remove(id);","419","            Util.deleteRecursive(new File(getRootDir(), id));","420","        }","421","    }","422","","423","    \/**","464","    \/**","465","     * Deletes this user from Hudson.","466","     *\/","467","    public void doDoDelete(StaplerRequest req, StaplerResponse rsp) throws IOException, ServletException {","468","        requirePOST();","469","        checkPermission(Hudson.ADMINISTER);","470","        if (id.equals(Hudson.getAuthentication().getName())) {","471","            rsp.sendError(HttpServletResponse.SC_BAD_REQUEST, \"Cannot delete self\");","472","            return;","473","        }","474","","475","        delete();","476","","477","        rsp.sendRedirect2(\"..\/..\");","478","    }","479","","561","    \/**","562","     * With ADMINISTER permission, can delete users with persisted data but can't delete self.","563","     *\/","564","    public boolean canDelete() {","565","        return hasPermission(Hudson.ADMINISTER) && !id.equals(Hudson.getAuthentication().getName())","566","                && new File(getRootDir(), id).exists();","567","    }","568",""],"delete":[]}],"core\/src\/main\/resources\/hudson\/model\/User\/sidepanel.jelly":[{"add":["35","      <l:task icon=\"images\/24x24\/setting.gif\" href=\"${rootURL}\/${it.url}\/configure\" title=\"${%Configure}\" permission=\"${app.ADMINISTER}\" \/>","36","      <j:if test=\"${it.canDelete()}\">","37","        <l:task icon=\"images\/24x24\/edit-delete.gif\" href=\"${rootURL}\/${it.url}\/delete\" title=\"${%Delete}\" \/>","38","      <\/j:if>","42","<\/j:jelly>"],"delete":["35","      <l:task icon=\"images\/24x24\/setting.gif\" href=\"${rootURL}\/${it.url}\/configure\" title=\"${%Configure}\" permission=\"${app.ADMINISTER}\"\/>","39","<\/j:jelly>"]}],"core\/src\/main\/resources\/hudson\/security\/HudsonPrivateSecurityRealm\/index.jelly":[{"add":["41","            <td>","42","              <a href=\"${user.url}\/configure\"><img src=\"${imagesURL}\/32x32\/setting.gif\" alt=\"Setting\"\/><\/a>","43","              <j:if test=\"${user.canDelete()}\">","44","                <a href=\"${user.url}\/delete\"><img src=\"${imagesURL}\/24x24\/edit-delete.gif\" alt=\"Delete\"\/><\/a>","45","              <\/j:if>","46","            <\/td>"],"delete":["41","            <td><a href=\"${user.url}\/configure\"><img src=\"${imagesURL}\/32x32\/setting.gif\" alt=\"Setting\"\/><\/a><\/td>"]}]}},"3b00f576279446227fd3f19d39b9e61105fa3d91":{"changes":{"core\/src\/main\/resources\/hudson\/model\/Run\/consoleFull.jelly":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/model\/Run\/consoleFull.jelly":[{"add":["23","<st:compress xmlns:j=\"jelly:core\" xmlns:st=\"jelly:stapler\" xmlns:d=\"jelly:define\" xmlns:l=\"\/lib\/layout\" xmlns:t=\"\/lib\/hudson\" xmlns:f=\"\/lib\/form\" xmlns:i=\"jelly:fmt\">","26","<\/st:compress>"],"delete":["23","<j:jelly xmlns:j=\"jelly:core\" xmlns:st=\"jelly:stapler\" xmlns:d=\"jelly:define\" xmlns:l=\"\/lib\/layout\" xmlns:t=\"\/lib\/hudson\" xmlns:f=\"\/lib\/form\">","26","<\/j:jelly>"]}]}},"36e79456403ca6a4f51d43dde39351e83aef6462":{"changes":{"core\/src\/main\/resources\/hudson\/PluginManager\/table.jelly":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/PluginManager\/table.jelly":[{"add":["51","      ","52","      <div id=\"filter-container\">","53","        ${%Filter}:","54","        <input type=\"text\" id=\"filter-box\"\/>","55","      <\/div>","57","      <form method=\"post\" action=\"install\">"],"delete":["51","      <form method=\"post\" action=\"install\">","52","        <div id=\"filter-container\">","53","          ${%Filter}:","54","          <input type=\"text\" id=\"filter-box\"\/>","55","        <\/div>"]}]}},"8fbd44db2b2ebf81947a6c3c5861bc30b48cc775":{"changes":{"core\/pom.xml":"MODIFY"},"diff":{"core\/pom.xml":[{"add":["119","      <version>build217-jenkins-5<\/version>"],"delete":["119","      <version>build217-jenkins-7<\/version>"]}]}},"2b6c00db3406c753291ff00ccd16d64ad5f92a78":{"changes":{"debian\/debian\/jenkins.init":"MODIFY"},"diff":{"debian\/debian\/jenkins.init":[{"add":["105","    check_tcp_port \"http\" \"$HTTP_PORT\" \"8080\" || return 2"],"delete":["105","    check_tcp_port \"http\" \"$HTTP_PORT\" \"8080\" || return 1"]}]}},"09bcc5d6538b3cfffbf71228ebd1679e3e20d8b2":{"changes":{"core\/src\/main\/java\/hudson\/util\/IOUtils.java":"MODIFY","core\/src\/main\/java\/hudson\/FilePath.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/util\/IOUtils.java":[{"add":["15","import static hudson.Util.fileToPath;","16","","56","            return Files.createDirectories(fileToPath(dir)).toFile();","57","        } catch (UnsupportedOperationException e) {","58","            throw new IOException(e);","129","                return Util.permissionsToMode(Files.getPosixFilePermissions(fileToPath(f)));"],"delete":["53","        if(dir.mkdirs() || dir.exists())","54","            return dir;","55","","56","        \/\/ following Ant <mkdir> task to avoid possible race condition.","58","            Thread.sleep(10);","59","        } catch (InterruptedException e) {","60","            \/\/ ignore","62","","63","        if (dir.mkdirs() || dir.exists())","64","            return dir;","65","","66","        throw new IOException(\"Failed to create a directory at \"+dir);","136","                return Util.permissionsToMode(Files.getPosixFilePermissions(Util.fileToPath(f)));"]}],"core\/src\/main\/java\/hudson\/FilePath.java":[{"add":["81","import java.nio.file.LinkOption;","128","import static hudson.Util.fileToPath;","131","","1170","                return mkdirs(f) || f.exists();","1620","            Files.setPosixFilePermissions(fileToPath(f), Util.modeToPermissions(mask));","1967","                Files.move(fileToPath(reading(f)), fileToPath(creating(new File(target.remote))), LinkOption.NOFOLLOW_LINKS);","2029","                    Files.createDirectories(fileToPath(targetDir));","2030","                    Files.copy(fileToPath(reading(f)), fileToPath(writing(targetFile)), StandardCopyOption.COPY_ATTRIBUTES, StandardCopyOption.REPLACE_EXISTING);","2962","    private boolean mkdirs(File dir) throws IOException {","2966","        Files.createDirectories(fileToPath(dir));","2967","        return true;"],"delete":["1167","                return f.mkdirs() || f.exists();","1617","            Files.setPosixFilePermissions(Util.fileToPath(f), Util.modeToPermissions(mask));","1964","            \treading(f).renameTo(creating(new File(target.remote)));","2026","                    Files.createDirectories(Util.fileToPath(targetDir));","2027","                    Files.copy(Util.fileToPath(reading(f)), Util.fileToPath(writing(targetFile)), StandardCopyOption.COPY_ATTRIBUTES, StandardCopyOption.REPLACE_EXISTING);","2959","    private boolean mkdirs(File dir) {","2963","        return dir.mkdirs();"]}]}},"dced4d4cd49c02105b789d6ff5367b38497c246c":{"changes":{"\/dev\/null":"DELETE","core\/pom.xml":"MODIFY","core\/src\/main\/resources\/lib\/hudson\/executors.jelly":"MODIFY","core\/src\/main\/java\/hudson\/model\/queue\/Executables.java":"ADD","core\/src\/main\/java\/hudson\/model\/Queue.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/Executor.java":"MODIFY"},"diff":{"\/dev\/null":[{"add":[],"delete":[]}],"core\/pom.xml":[{"add":["384","      <version>1.152<\/version>"],"delete":["384","      <version>1.151<\/version>"]}],"core\/src\/main\/resources\/lib\/hudson\/executors.jelly":[{"add":["69","            <st:include it=\"${e.currentExecutable}\" page=\"executorCell.jelly\" optional=\"true\">","70","              <td class=\"pane\">","71","                <div style=\"white-space: normal\">${%Building}","72","                  <j:set var=\"exe\" value=\"${e.currentExecutable}\" \/>","73","                  <j:choose>","74","                    <j:when test=\"${h.hasPermission(exe.parent,exe.parent.READ)}\">","75","                      <a href=\"${rootURL}\/${exe.parent.url}\">${exe.parent.fullDisplayName}<\/a>&#160;<a href=\"${rootURL}\/${exe.url}\">#${exe.number}<\/a>","76","                      <t:buildProgressBar build=\"${exe}\" executor=\"${executor}\"\/>","77","                    <\/j:when>","78","                    <j:otherwise>","79","                      <span>${%Unknown Task}<\/span>","80","                    <\/j:otherwise>","81","                  <\/j:choose>","82","                <\/div>","83","              <\/td>","84","            <\/st:include>"],"delete":["69","            <st:include it=\"${e.currentExecutable}\" page=\"executorCell.jelly\" optional=\"true\" \/>"]}],"core\/src\/main\/java\/hudson\/model\/queue\/Executables.java":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/Queue.java":[{"add":["38","import hudson.model.queue.Executables;","1093","         *","1094","         * <p>","1095","         * Since this method went through a signature change in 1.FATTASK, the invocation may results in","1096","         * {@link AbstractMethodError}.","1097","         * Use {@link Executables#getParentOf(Executable)} that avoids this."],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/Executor.java":[{"add":["28","import hudson.model.queue.Executables;","47","import static hudson.model.queue.Executables.*;","48","","272","        long d = getParentOf(e).getEstimatedDuration();","293","        long d = getParentOf(e).getEstimatedDuration();","325","        long d = getParentOf(e).getEstimatedDuration();","342","        long d = getParentOf(e).getEstimatedDuration();","357","            Tasks.getOwnerTaskOf(getParentOf(e)).checkAbortPermission();","368","        return e!=null && Tasks.getOwnerTaskOf(getParentOf(e)).hasAbortPermission();","382","            return Math.max(startTime + Math.max(0, getParentOf(executable).getEstimatedDuration()),"],"delete":["269","        long d = e.getParent().getEstimatedDuration();","290","        long d = e.getParent().getEstimatedDuration();","322","        long d = e.getParent().getEstimatedDuration();","339","        long d = e.getParent().getEstimatedDuration();","354","            Tasks.getOwnerTaskOf(e.getParent()).checkAbortPermission();","365","        return e!=null && Tasks.getOwnerTaskOf(e.getParent()).hasAbortPermission();","379","            return Math.max(startTime + Math.max(0, executable.getParent().getEstimatedDuration()),"]}]}},"8d9b9ccad52a6ecc5feccd14babbc65f795b1a12":{"changes":{"war\/src\/main\/webapp\/env-vars_tr.html":"MODIFY","war\/src\/main\/webapp\/env-vars_nl.html":"MODIFY","war\/src\/main\/webapp\/env-vars_de.html":"MODIFY","war\/src\/main\/webapp\/env-vars.html":"MODIFY","war\/src\/main\/webapp\/env-vars_ja.html":"MODIFY"},"diff":{"war\/src\/main\/webapp\/env-vars_tr.html":[{"add":["21","    <dd>String of \"hudson-<i>${JOB_NAME}<\/i>-<i>${BUILD_NUMBER}<\/i>\". Convenient to put into"],"delete":["21","    <dd>String of \"hudson-<i>${JOBNAME}<\/i>-<i>${BUILD_NUMBER}<\/i>\". Convenient to put into"]}],"war\/src\/main\/webapp\/env-vars_nl.html":[{"add":["21","    <dd>Het label :\"hudson-<i>${JOB_NAME}<\/i>-<i>${BUILD_NUMBER}<\/i>\". Dit label is typisch handig om"],"delete":["21","    <dd>Het label :\"hudson-<i>${JOBNAME}<\/i>-<i>${BUILD_NUMBER}<\/i>\". Dit label is typisch handig om"]}],"war\/src\/main\/webapp\/env-vars_de.html":[{"add":["22","    <dd>Eine Zeichenkette in der Form \"hudson-<i>${JOB_NAME}<\/i>-<i>${BUILD_NUMBER}<\/i>\"."],"delete":["22","    <dd>Eine Zeichenkette in der Form \"hudson-<i>${JOBNAME}<\/i>-<i>${BUILD_NUMBER}<\/i>\". "]}],"war\/src\/main\/webapp\/env-vars.html":[{"add":["21","    <dd>String of \"hudson-<i>${JOB_NAME}<\/i>-<i>${BUILD_NUMBER}<\/i>\". Convenient to put into"],"delete":["21","    <dd>String of \"hudson-<i>${JOBNAME}<\/i>-<i>${BUILD_NUMBER}<\/i>\". Convenient to put into"]}],"war\/src\/main\/webapp\/env-vars_ja.html":[{"add":["21","    <dd>??? \"hudson-<i>${JOB_NAME}<\/i>-<i>${BUILD_NUMBER}<\/i>\"?"],"delete":["21","    <dd>??? \"hudson-<i>${JOBNAME}<\/i>-<i>${BUILD_NUMBER}<\/i>\"? "]}]}},"7f2d4faf37c2a7eb2c7573ec40386e5808fd002e":{"changes":{"core\/src\/main\/java\/hudson\/model\/AbstractProject.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/AbstractProject.java":[{"add":["813","            req.getView(this,\"noWorkspace.jelly\").forward(req,rsp);"],"delete":["813","            rsp.forward(this,\"noWorkspace\",req);"]}]}},"cb623640ccd820ad0540efc3b50cc596626e43a2":{"changes":{"test\/src\/test\/groovy\/hudson\/model\/AbstractProjectTest.groovy":"MODIFY","core\/src\/main\/java\/hudson\/model\/AbstractProject.java":"MODIFY","changelog.html":"MODIFY"},"diff":{"test\/src\/test\/groovy\/hudson\/model\/AbstractProjectTest.groovy":[{"add":["390","        d.renameTo(\"d2\");","391","        p = jenkins.getItemByFullName(\"d2\/edited\");","392","        p._getRuns().purgeCache();","393","        assertEquals(1, p.getBuilds().size());"],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/AbstractProject.java":[{"add":["30","import com.infradna.tool.bridge_method_injector.WithBridgeMethods;","33","import hudson.EnvVars;","34","import hudson.Extension;","35","import hudson.ExtensionPoint;","38","import hudson.Functions;","57","import hudson.model.queue.QueueTaskFuture;","58","import hudson.model.queue.ScheduleResult;","59","import hudson.model.queue.SubTask;","66","","67","import static hudson.scm.PollingResult.*;","113","import javax.annotation.Nonnull;","114","import javax.servlet.ServletException;","116","import jenkins.model.Jenkins;","117","import jenkins.model.JenkinsLocationConfiguration;","118","import jenkins.model.ModelObjectWithChildren;","119","import jenkins.model.Uptime;","120","import jenkins.model.lazy.AbstractLazyLoadRunMap.Direction;","121","import jenkins.scm.DefaultSCMCheckoutStrategyImpl;","122","import jenkins.scm.SCMCheckoutStrategy;","123","import jenkins.scm.SCMCheckoutStrategyDescriptor;","124","import jenkins.util.TimeDuration;","125","import net.sf.json.JSONObject;","126","import org.acegisecurity.Authentication;","127","import org.acegisecurity.context.SecurityContext;","128","import org.acegisecurity.context.SecurityContextHolder;","129","import org.jenkinsci.bytecode.AdaptField;","130","import org.kohsuke.accmod.Restricted;","131","import org.kohsuke.accmod.restrictions.DoNotUse;","132","import org.kohsuke.accmod.restrictions.NoExternalUse;","133","import org.kohsuke.args4j.Argument;","134","import org.kohsuke.args4j.CmdLineException;","135","import org.kohsuke.stapler.Ancestor;","136","import org.kohsuke.stapler.AncestorInPath;","137","import org.kohsuke.stapler.ForwardToView;","138","import org.kohsuke.stapler.HttpRedirect;","139","import org.kohsuke.stapler.HttpResponse;","140","import org.kohsuke.stapler.HttpResponses;","141","import org.kohsuke.stapler.QueryParameter;","142","import org.kohsuke.stapler.StaplerRequest;","143","import org.kohsuke.stapler.StaplerResponse;","144","import org.kohsuke.stapler.export.Exported;","145","import org.kohsuke.stapler.interceptor.RequirePOST;","2418","    @Restricted(DoNotUse.class)","2419","    @Extension public static final class ItemListenerImpl extends ItemListener {","2420","        @Override public void onLocationChanged(Item item, String oldFullName, String newFullName) {","2421","            if (item instanceof AbstractProject) {","2422","                AbstractProject p = (AbstractProject) item;","2423","                p.builds.updateBaseDir(p.getBuildDir());","2424","            }","2425","        }","2426","    }","2427",""],"delete":["29","import com.infradna.tool.bridge_method_injector.WithBridgeMethods;","30","import hudson.EnvVars;","31","import hudson.ExtensionPoint;","32","import hudson.Functions;","50","import hudson.model.queue.QueueTaskFuture;","51","import hudson.model.queue.ScheduleResult;","52","import hudson.model.queue.SubTask;","87","import jenkins.model.Jenkins;","88","import jenkins.model.JenkinsLocationConfiguration;","89","import jenkins.model.ModelObjectWithChildren;","90","import jenkins.model.Uptime;","91","import jenkins.model.lazy.AbstractLazyLoadRunMap.Direction;","92","import jenkins.scm.DefaultSCMCheckoutStrategyImpl;","93","import jenkins.scm.SCMCheckoutStrategy;","94","import jenkins.scm.SCMCheckoutStrategyDescriptor;","95","import jenkins.util.TimeDuration;","96","import net.sf.json.JSONObject;","97","import org.acegisecurity.Authentication;","98","import org.acegisecurity.context.SecurityContext;","99","import org.acegisecurity.context.SecurityContextHolder;","100","import org.jenkinsci.bytecode.AdaptField;","101","import org.kohsuke.accmod.Restricted;","102","import org.kohsuke.accmod.restrictions.NoExternalUse;","103","import org.kohsuke.args4j.Argument;","104","import org.kohsuke.args4j.CmdLineException;","105","import org.kohsuke.stapler.Ancestor;","106","import org.kohsuke.stapler.AncestorInPath;","107","import org.kohsuke.stapler.ForwardToView;","108","import org.kohsuke.stapler.HttpRedirect;","109","import org.kohsuke.stapler.HttpResponse;","110","import org.kohsuke.stapler.HttpResponses;","111","import org.kohsuke.stapler.QueryParameter;","112","import org.kohsuke.stapler.StaplerRequest;","113","import org.kohsuke.stapler.StaplerResponse;","114","import org.kohsuke.stapler.export.Exported;","115","import org.kohsuke.stapler.interceptor.RequirePOST;","116","","117","import javax.annotation.Nonnull;","118","import javax.servlet.ServletException;","141","","142","import static hudson.scm.PollingResult.*;","1674","    @Override","1675","    public void renameTo(String newName) throws IOException {","1676","        super.renameTo(newName);","1677","        \/\/ Update locations inside builds cache","1678","        builds.updateBaseDir(getBuildDir());","1679","    }","1680",""]}],"changelog.html":[{"add":["68","  <li class=\"major bug\">","69","    Builds can seem to disappear from a job in a folder if that folder is renamed.","70","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-18694\">issue 18694<\/a>)"],"delete":[]}]}},"e0971a53055aa4a22039c19a712985c95adcdd21":{"changes":{"core\/src\/main\/resources\/hudson\/model\/Messages.properties":"MODIFY","core\/src\/main\/resources\/hudson\/widgets\/BuildHistoryWidget\/entries.jelly":"MODIFY","core\/src\/main\/java\/hudson\/Functions.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/Queue.java":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/model\/Messages.properties":[{"add":["115","Queue.HudsonIsAboutToShutDown=Hudson is about to shut down"],"delete":[]}],"core\/src\/main\/resources\/hudson\/widgets\/BuildHistoryWidget\/entries.jelly":[{"add":["31","    <j:forEach var=\"item\" items=\"${queuedItems}\" indexVar=\"i\">","32","      <j:set var=\"id\" value=\"${h.generateId()}\"\/>","33","      <tr class=\"build-row transitive\" id=\"${id}\">","34","        <td nowrap=\"nowrap\">","35","          <img width=\"16\" height=\"16\" src=\"${imagesURL}\/16x16\/grey.gif\" alt=\"${%pending}\"\/>","36","          <st:nbsp\/>","37","          #${it.owner.nextBuildNumber+queuedItems.size()-i-1}","38","        <\/td>","39","        <td style=\"white-space:normal;\">","40","          <div style=\"float:right\">","41","            <j:if test=\"${item.hasCancelPermission()}\">","42","              <a href=\"${rootURL}\/queue\/item\/${item.id}\/cancelQueue\">","43","                <img src=\"${imagesURL}\/16x16\/stop.gif\" alt=\"cancel this build\"\/>","44","              <\/a>","45","            <\/j:if>","46","          <\/div>","47","          (${%pending}${h.prepend(' - ',item.why)})","48","        <\/td>","49","      <\/tr>","50","    <\/j:forEach>"],"delete":["31","\t  <j:forEach var=\"item\" items=\"${queuedItems}\" indexVar=\"i\">","32","    <j:set var=\"id\" value=\"${h.generateId()}\"\/>","33","    <tr class=\"build-row transitive\" id=\"${id}\">","34","      <td nowrap=\"nowrap\">","35","        <img width=\"16\" height=\"16\" src=\"${imagesURL}\/16x16\/grey.gif\" alt=\"${%pending}\" \/><st:nbsp\/>","36","        #${it.owner.nextBuildNumber+queuedItems.size()-i-1}","37","      <\/td>","38","      <td nowrap=\"nowrap\" tooltip=\"${item.task.why}\">","39","        <div style=\"float:right\">","40","          <j:if test=\"${item.hasCancelPermission()}\">","41","            <a href=\"${rootURL}\/queue\/item\/${item.id}\/cancelQueue\"><img src=\"${imagesURL}\/16x16\/stop.gif\" alt=\"cancel this build\" \/><\/a>","42","          <\/j:if>","43","        <\/div>","44","        (${%pending})","45","      <\/td>","46","    <\/tr>","47","\t  <\/j:forEach>"]}],"core\/src\/main\/java\/hudson\/Functions.java":[{"add":["1076","    \/**","1077","     * Prepend a prefix only when there's the specified body.","1078","     *\/","1079","    public String prepend(String prefix, String body) {","1080","        if(body!=null && body.length()>0)","1081","            return prefix+body;","1082","        return body;","1083","    }","1084",""],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/Queue.java":[{"add":["1066","            if(hudson.isQuietingDown())","1067","                return Messages.Queue_HudsonIsAboutToShutDown();","1068","","1069","            Label label = task.getAssignedLabel();"],"delete":["1065","            Label label = task.getAssignedLabel();"]}]}},"c83a8fdf0d048905928ba531d45527c1173f868d":{"changes":{"core\/src\/main\/java\/hudson\/PluginWrapper.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/PluginWrapper.java":[{"add":["443","        if (!disableFile.exists()) {","444","            LOGGER.log(Level.FINEST, \"Plugin {0} has been already enabled. Skipping the enable() operation\", getShortName());","445","            return;","446","        }"],"delete":[]}]}},"d5167025a204750633c931ea8c1fff8d7561ab9c":{"changes":{"core\/src\/main\/java\/jenkins\/model\/lazy\/AbstractLazyLoadRunMap.java":"MODIFY","core\/src\/test\/java\/jenkins\/model\/lazy\/AbstractLazyLoadRunMapTest.java":"MODIFY"},"diff":{"core\/src\/main\/java\/jenkins\/model\/lazy\/AbstractLazyLoadRunMap.java":[{"add":["355","        synchronized (this) {","356","            if (index.byNumber.containsKey(n)) { \/\/ JENKINS-22767: recheck inside lock","357","                BuildReference<R> ref = index.byNumber.get(n);","358","                if (ref == null) {","359","                    return null;","360","                }","361","                R v = unwrap(ref);","362","                if (v != null) {","363","                    return v;","364","                }","365","            }","366","            return load(n, null);","367","        }","457","    private R load(int n, Index editInPlace) {","458","        assert Thread.holdsLock(this);","475","    private R load(File dataDir, Index editInPlace) {","476","        assert Thread.holdsLock(this);"],"delete":["355","        return load(n, null);","445","    protected R load(int n, Index editInPlace) {","462","    protected synchronized R load(File dataDir, Index editInPlace) {"]}],"core\/src\/test\/java\/jenkins\/model\/lazy\/AbstractLazyLoadRunMapTest.java":[{"add":["25","import java.io.File;","34","import java.util.HashMap;","41","import java.util.concurrent.Callable;","42","import java.util.concurrent.Future;","43","import java.util.concurrent.Semaphore;","44","import java.util.concurrent.atomic.AtomicInteger;","46","import jenkins.util.Timer;","81","    private final Map<Integer,Semaphore> slowBuilderStartSemaphores = new HashMap<>();","82","    private final Map<Integer,Semaphore> slowBuilderEndSemaphores = new HashMap<>();","83","    private final Map<Integer,AtomicInteger> slowBuilderLoadCount = new HashMap<>();","84","    @Rule","85","    public FakeMapBuilder slowBuilder = new FakeMapBuilder() {","86","        @Override","87","        public FakeMap make() {","88","            return new FakeMap(getDir()) {","89","                @Override","90","                protected Build retrieve(File dir) throws IOException {","91","                    Build b = super.retrieve(dir);","92","                    slowBuilderStartSemaphores.get(b.n).release();","93","                    try {","94","                        slowBuilderEndSemaphores.get(b.n).acquire();","95","                    } catch (InterruptedException x) {","96","                        throw new IOException(x);","97","                    }","98","                    slowBuilderLoadCount.get(b.n).incrementAndGet();","99","                    return b;","100","                }","101","            };","102","        }","103","    };","390","","391","    @Issue(\"JENKINS-22767\")","392","    @Test","393","    public void slowRetrieve() throws Exception {","394","        for (int i = 1; i <= 3; i++) {","395","            slowBuilder.add(i);","396","            slowBuilderStartSemaphores.put(i, new Semaphore(0));","397","            slowBuilderEndSemaphores.put(i, new Semaphore(0));","398","            slowBuilderLoadCount.put(i, new AtomicInteger());","399","        }","400","        final FakeMap m = slowBuilder.make();","401","        Future<Build> firstLoad = Timer.get().submit(new Callable<Build>() {","402","            @Override","403","            public Build call() throws Exception {","404","                return m.getByNumber(2);","405","            }","406","        });","407","        Future<Build> secondLoad = Timer.get().submit(new Callable<Build>() {","408","            @Override","409","            public Build call() throws Exception {","410","                return m.getByNumber(2);","411","            }","412","        });","413","        slowBuilderStartSemaphores.get(2).acquire(1);","414","        \/\/ now one of them is inside retrieve(\u2026); the other is waiting for the lock","415","        slowBuilderEndSemaphores.get(2).release(2); \/\/ allow both to proceed","416","        Build first = firstLoad.get();","417","        Build second = secondLoad.get();","418","        assertEquals(1, slowBuilderLoadCount.get(2).get());","419","        assertSame(second, first);","420","    }","421",""],"delete":[]}]}},"930f6308a5e0b29a45b88b626f51b246107e2830":{"changes":{"war\/src\/main\/js\/util\/jenkins.js":"MODIFY","core\/src\/main\/java\/hudson\/model\/UpdateCenter.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/UpdateSite.java":"MODIFY"},"diff":{"war\/src\/main\/js\/util\/jenkins.js":[{"add":["202","\t\t\t\/\/ Define statuses, which need additional check iteration via async job on the Jenkins master","203","\t\t\t\/\/ Statuses like \"OK\" or \"SKIPPED\" are considered as fine.","209","\t\t\t\t\/\/ Update site should be always reachable, but we do not require the internet connection","210","\t\t\t\t\/\/ if it's explicitly skipped by the update center","211","\t\t\t\tif(response.status !== 'ok' || response.data.updatesite !== 'OK' || ","212","\t\t\t\t\t\t\t(response.data.internet !== 'OK' && response.data.internet !== 'SKIPPED')) {"],"delete":["207","\t\t\t\tif(response.status !== 'ok' || response.data.updatesite !== 'OK' || response.data.internet !== 'OK') {"]}],"core\/src\/main\/java\/hudson\/model\/UpdateCenter.java":[{"add":["200","         * Connection status check has been skipped.","201","         * As example, it may happen if there is no connection check URL defined for the site.","202","         * @since TODO","203","         *\/","204","        SKIPPED,","205","        \/**","1386","                } else {","1387","                    LOGGER.log(WARNING, \"Update site '{0}' does not declare the connection check URL. \"","1388","                            + \"Skipping the network availability check.\", site.getId());","1389","                    connectionStates.put(ConnectionStatus.INTERNET, ConnectionStatus.SKIPPED);"],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/UpdateSite.java":[{"add":["343","     * Gets a URL for the Internet connection check.","344","     * @return  an \"always up\" server for Internet connectivity testing, or {@code null} if we are going to skip the test.","347","    @CheckForNull"],"delete":["343","     * Returns an \"always up\" server for Internet connectivity testing, or null if we are going to skip the test."]}]}},"20ea8d1092f5642cc889d80f7c2f7d3334e3739e":{"changes":{"core\/src\/main\/resources\/jenkins\/widgets\/BuildQueueWidget\/index.groovy":"MODIFY","changelog.html":"MODIFY","core\/src\/main\/resources\/jenkins\/widgets\/ExecutorsWidget\/index.groovy":"MODIFY"},"diff":{"core\/src\/main\/resources\/jenkins\/widgets\/BuildQueueWidget\/index.groovy":[{"add":["4","t.queue(items:view.approximateQueueItemsQuickly, it:view)"],"delete":["4","t.queue(items:view.approximateQueueItemsQuickly)"]}],"changelog.html":[{"add":["58","    Incorrect filtering of build queue and executors widgets after 1.514.","59","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-20500\">issue 20500<\/a>)","60","  <li class=bug>"],"delete":[]}],"core\/src\/main\/resources\/jenkins\/widgets\/ExecutorsWidget\/index.groovy":[{"add":["4","t.executors(computers:view.computers, it:view)"],"delete":["4","t.executors(computers:view.computers)"]}]}},"be5cd4fd169005f50eea8ccefac4b91a9b4c503c":{"changes":{"core\/src\/main\/java\/hudson\/model\/Job.java":"MODIFY","test\/src\/test\/java\/hudson\/model\/JobTest.java":"MODIFY","changelog.html":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/Job.java":[{"add":["809","        return (RunT)Permalink.LAST_UNSUCCESSFUL_BUILD.resolve(this);","819","        return (RunT)Permalink.LAST_UNSTABLE_BUILD.resolve(this);","829","        return (RunT)Permalink.LAST_STABLE_BUILD.resolve(this);","838","        return (RunT)Permalink.LAST_FAILED_BUILD.resolve(this);"],"delete":["28","import hudson.BulkChange;","66","import jenkins.scm.SCMCheckoutStrategy;","811","        RunT r = getLastBuild();","812","        while (r != null","813","                && (r.isBuilding() || r.getResult() == Result.SUCCESS))","814","            r = r.getPreviousBuild();","815","        return r;","825","        RunT r = getLastBuild();","826","        while (r != null","827","                && (r.isBuilding() || r.getResult() != Result.UNSTABLE))","828","            r = r.getPreviousBuild();","829","        return r;","839","        RunT r = getLastBuild();","840","        while (r != null","841","                && (r.isBuilding() || r.getResult().isWorseThan(Result.SUCCESS)))","842","            r = r.getPreviousBuild();","843","        return r;","852","        RunT r = getLastBuild();","853","        while (r != null && (r.isBuilding() || r.getResult() != Result.FAILURE))","854","            r = r.getPreviousBuild();","855","        return r;"]}],"test\/src\/test\/java\/hudson\/model\/JobTest.java":[{"add":["33","import java.util.concurrent.Callable;","42","import org.jvnet.hudson.test.FailureBuilder;","44","import org.jvnet.hudson.test.RunLoadCounter;","258","","259","    @Bug(16023)","260","    @Test public void getLastFailedBuild() throws Exception {","261","        final FreeStyleProject p = j.createFreeStyleProject();","262","        RunLoadCounter.prepare(p);","263","        p.getBuildersList().add(new FailureBuilder());","264","        j.assertBuildStatus(Result.FAILURE, p.scheduleBuild2(0).get());","265","        j.assertBuildStatus(Result.FAILURE, p.scheduleBuild2(0).get());","266","        j.assertBuildStatus(Result.FAILURE, p.scheduleBuild2(0).get());","267","        p.getBuildersList().remove(FailureBuilder.class);","268","        j.assertBuildStatusSuccess(p.scheduleBuild2(0));","269","        j.assertBuildStatusSuccess(p.scheduleBuild2(0));","270","        j.assertBuildStatusSuccess(p.scheduleBuild2(0));","271","        assertEquals(6, p.getLastSuccessfulBuild().getNumber());","272","        assertEquals(3, RunLoadCounter.assertMaxLoads(p, 1, new Callable<Integer>() {","273","            @Override public Integer call() throws Exception {","274","                return p.getLastFailedBuild().getNumber();","275","            }","276","        }).intValue());","277","    }","278",""],"delete":[]}],"changelog.html":[{"add":["66","  <li class='major bug'>","67","    Finding the last failed build for a job (e.g. from a view column) broke lazy loading.","68","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-16023\">issue 16023<\/a>)"],"delete":[]}]}},"73130a3853433e588fa69f22d7c45efa792c3fa4":{"changes":{"core\/src\/main\/java\/hudson\/org\/apache\/tools\/ant\/taskdefs\/cvslib\/ChangeLogTask.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/UpdateCenter.java":"MODIFY","core\/src\/main\/java\/hudson\/scm\/CVSSCM.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/org\/apache\/tools\/ant\/taskdefs\/cvslib\/ChangeLogTask.java":[{"add":["439","            \/\/if tag was specified, it takes care of branches or HEAD, because it does not go out of one. Otherwise HEAD or specified Brach should be filtered","440","            if (null == getTag() && !cvsEntry.containsBranch(branch)) {","442","                log(\"Filtering out \"+cvsEntry+\" because it didn't match the branch '\"+branch+\"'\",Project.MSG_VERBOSE);"],"delete":["439","            if (!cvsEntry.containsBranch(branch)) {","441","                log(\"Filtering out \"+cvsEntry+\" because it didn't match the branch\",Project.MSG_VERBOSE);"]}],"core\/src\/main\/java\/hudson\/model\/UpdateCenter.java":[{"add":["695",""],"delete":["695","        "]}],"core\/src\/main\/java\/hudson\/scm\/CVSSCM.java":[{"add":["870","                    \/\/ It's to enforce ChangeLogParser find a \"branch\". If tag was specified, branch does not matter (see documentation for 'cvs log -r:tag').","871","                    if (!isTag()){","872","                        task.setBranch(branch);","873","                    }","874","                    \/\/ It's to enforce ChangeLogTask use \"baranch\" in CVS command (cvs log -r...)."],"delete":[]}]}},"218676d01960455b6247ab2d4a4fd35ff2a7efad":{"changes":{"changelog.html":"MODIFY"},"diff":{"changelog.html":[{"add":["73","  <li class=\"bug\">","74","    Polling no longer triggers builds (regression 1.560)","75","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-22750\">issue 22750<\/a>)"],"delete":["93","  <li class=\"bug\">","94","    Polling no longer triggers builds (regression 1.560)","95","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-22750\">issue 22750<\/a>)"]}]}},"7232798611b66f4a03ad8670c07cb58220f4d866":{"changes":{"core\/src\/main\/java\/hudson\/model\/Descriptor.java":"MODIFY","test\/src\/test\/groovy\/jenkins\/bugs\/Jenkins19124Test.groovy":"ADD","core\/src\/main\/resources\/lib\/form\/prepareDatabinding.jelly":"MODIFY","core\/src\/main\/java\/hudson\/Functions.java":"MODIFY","changelog.html":"MODIFY","test\/src\/main\/java\/org\/jvnet\/hudson\/test\/JenkinsRule.java":"MODIFY","test\/src\/test\/resources\/jenkins\/bugs\/Jenkins19124Test\/Foo\/config.groovy":"ADD","core\/src\/main\/resources\/lib\/form\/readOnlyTextbox.jelly":"MODIFY","war\/src\/main\/webapp\/scripts\/hudson-behavior.js":"MODIFY","core\/src\/main\/java\/hudson\/util\/FormValidation.java":"MODIFY","core\/src\/main\/resources\/lib\/form\/textarea.jelly":"MODIFY","core\/src\/main\/resources\/lib\/form\/checkbox.jelly":"MODIFY","core\/src\/main\/resources\/lib\/form\/editableComboBox.jelly":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/Descriptor.java":[{"add":["33","import hudson.util.FormValidation.CheckMethod;","129","    private transient final Map<String,CheckMethod> checkMethods = new ConcurrentHashMap<String,CheckMethod>();","364","     * @deprecated since 1.528","365","     *      Use {@link #getCheckMethod(String)}","368","        return getCheckMethod(fieldName).toCheckUrl();","372","     * If the field \"xyz\" of a {@link Describable} has the corresponding \"doCheckXyz\" method,","373","     * return the model of the check method.","374","     * <p>","375","     * This method is used to hook up the form validation method to the corresponding HTML input element.","377","    public CheckMethod getCheckMethod(String fieldName) {","378","        CheckMethod method = checkMethods.get(fieldName);","379","        if(method==null) {","380","            method = new CheckMethod(this,fieldName);","381","            checkMethods.put(fieldName,method);","383","","384","        return method;"],"delete":["46","import static hudson.Functions.*;","129","    private transient final Map<String,String> checkMethods = new ConcurrentHashMap<String,String>();","364","     * If the field \"xyz\" of a {@link Describable} has the corresponding \"doCheckXyz\" method,","365","     * return the form-field validation string. Otherwise null.","366","     * <p>","367","     * This method is used to hook up the form validation method to the corresponding HTML input element.","370","        String method = checkMethods.get(fieldName);","371","        if(method==null) {","372","            method = calcCheckUrl(fieldName);","373","            checkMethods.put(fieldName,method);","374","        }","375","","376","        if (method.equals(NONE)) \/\/ == would do, but it makes IDE flag a warning","377","            return null;","378","","379","        \/\/ put this under the right contextual umbrella.","380","        \/\/ a is always non-null because we already have Hudson as the sentinel","381","        return '\\'' + jsStringEscape(getCurrentDescriptorByNameUrl()) + \"\/'+\" + method;","382","    }","383","","384","    private String calcCheckUrl(String fieldName) {","385","        String capitalizedFieldName = StringUtils.capitalize(fieldName);","386","","387","        Method method = ReflectionUtils.getPublicMethodNamed(getClass(),\"doCheck\"+ capitalizedFieldName);","388","","389","        if(method==null)","390","            return NONE;","391","","392","        return '\\'' + getDescriptorUrl() + \"\/check\" + capitalizedFieldName + '\\'' + buildParameterList(method, new StringBuilder()).append(\".toString()\");","396","     * Builds query parameter line by figuring out what should be submitted","398","    private StringBuilder buildParameterList(Method method, StringBuilder query) {","399","        for (Parameter p : ReflectionUtils.getParameters(method)) {","400","            QueryParameter qp = p.annotation(QueryParameter.class);","401","            if (qp!=null) {","402","                String name = qp.value();","403","                if (name.length()==0) name = p.name();","404","                if (name==null || name.length()==0)","405","                    continue;   \/\/ unknown parameter name. we'll report the error when the form is submitted.","406","","407","                RelativePath rp = p.annotation(RelativePath.class);","408","                if (rp!=null)","409","                    name = rp.value()+'\/'+name;","410","","411","                if (query.length()==0)  query.append(\"+qs(this)\");","412","","413","                if (name.equals(\"value\")) {","414","                    \/\/ The special 'value' parameter binds to the the current field","415","                    query.append(\".addThis()\");","416","                } else {","417","                    query.append(\".nearBy('\"+name+\"')\");","418","                }","419","                continue;","420","            }","421","","422","            Method m = ReflectionUtils.getPublicMethodNamed(p.type(), \"fromStapler\");","423","            if (m!=null)    buildParameterList(m,query);","425","        return query;","1022","     * Used in {@link #checkMethods} to indicate that there's no check method.","1023","     *\/","1024","    private static final String NONE = \"\\u0000\";","1025","","1026","    \/**"]}],"test\/src\/test\/groovy\/jenkins\/bugs\/Jenkins19124Test.groovy":[{"add":[],"delete":[]}],"core\/src\/main\/resources\/lib\/form\/prepareDatabinding.jelly":[{"add":["35","  <j:expr value=\"${h.calcCheckUrl(pattrs,  pattrs.checkUrl,descriptor,pattrs.field)}\" \/>"],"delete":["35","  <j:set target=\"${pattrs}\" property=\"checkUrl\"","36","         value=\"${h.getCheckUrl(pattrs.checkUrl,descriptor,pattrs.field)}\" \/>"]}],"core\/src\/main\/java\/hudson\/Functions.java":[{"add":["75","import hudson.util.FormValidation.CheckMethod;","1534","     *","1535","     * @deprecated","1536","     *      Use {@link #calcCheckUrl}","1548","     * Determines the parameters that client-side needs for a form validation check. See prepareDatabinding.jelly","1549","     *","1550","     * @deprecated","1551","     *      Use {@link #calcCheckUrl}","1552","     *\/","1553","    public void calcCheckUrl(Map attributes, String userDefined, Object descriptor, String field) {","1554","        if(userDefined!=null || field==null)   return;","1555","","1556","        if (descriptor instanceof Descriptor) {","1557","            Descriptor d = (Descriptor) descriptor;","1558","            CheckMethod m = d.getCheckMethod(field);","1559","            attributes.put(\"checkUrl\",m.toStemUrl());","1560","            attributes.put(\"checkDependsOn\",m.getDependsOn());","1561","        }","1562","    }","1563","","1564","    \/**"],"delete":[]}],"changelog.html":[{"add":["59","  <li class=bug>","60","    Form validation methods weren't getting triggered when one of its dependency controls change.","61","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-19124\">issue 19124<\/a>)"],"delete":[]}],"test\/src\/main\/java\/org\/jvnet\/hudson\/test\/JenkinsRule.java":[{"add":["569","        if (System.getProperty(\"port\")!=null)","570","            connector.setPort(Integer.parseInt(System.getProperty(\"port\")));"],"delete":[]}],"test\/src\/test\/resources\/jenkins\/bugs\/Jenkins19124Test\/Foo\/config.groovy":[{"add":[],"delete":[]}],"core\/src\/main\/resources\/lib\/form\/readOnlyTextbox.jelly":[{"add":["70","         checkUrl=\"${attrs.checkUrl}\" checkDependsOn=\"${attrs.checkDependsOn}\" checkMethod=\"${attrs.checkMethod}\""],"delete":["70","         checkUrl=\"${attrs.checkUrl}\" checkMethod=\"${attrs.checkMethod}\""]}],"war\/src\/main\/webapp\/scripts\/hudson-behavior.js":[{"add":["411","        var url = this.getAttribute(\"checkUrl\");","412","        var depends = this.getAttribute(\"checkDependsOn\");","413","","414","        if (depends==null) {\/\/ legacy behaviour where checkUrl is a JavaScript","415","            return eval(url); \/\/ need access to 'this', so no 'geval'","416","        } else {","417","            var q = qs(this).addThis();","418","            if (depends.length>0)","419","                depends.split(\" \").each(function (n) {","420","                    q.nearBy(n);","421","                });","422","            return url+ q.toString();","423","        }","425","    var method = e.getAttribute(\"checkMethod\") || \"get\";","454","    var v = e.getAttribute(\"checkDependsOn\");","455","    if (v) {","456","        v.split(\" \").each(function (name) {","457","            var c = findNearBy(e,name);","458","            if (c==null) {","459","                if (window.console!=null)  console.warn(\"Unable to find nearby \"+name);","460","                if (window.YUI!=null)      YUI.log(\"Unable to find a nearby control of the name \"+name,\"warn\")","461","                return;","462","            }","463","            $(c).observe(\"change\",checker.bind(e));","464","        });","465","    }","466","","921","        var checkbox = e.down().down();","1027","        var checkbox = e.down().down();"],"delete":["411","        return eval(this.getAttribute(\"checkUrl\")); \/\/ need access to 'this'","413","    var method = e.getAttribute(\"checkMethod\");","414","    if (!method) method = \"get\";","897","        var checkbox = e.firstChild.firstChild;","1003","        var checkbox = e.firstChild.firstChild;"]}],"core\/src\/main\/java\/hudson\/util\/FormValidation.java":[{"add":["29","import hudson.RelativePath;","34","import hudson.model.Descriptor;","36","","37","import hudson.util.ReflectionUtils.Parameter;","40","import org.kohsuke.stapler.QueryParameter;","44","import org.springframework.util.StringUtils;","51","import java.lang.reflect.Method;","54","import java.util.ArrayList;","55","import java.util.List;","58","import static hudson.Functions.jsStringEscape;","59","import static hudson.Util.*;","60","","519","","520","    \/**","521","     * Builds up the check URL for the client-side JavaScript to call back.","522","     *\/","523","    public static class CheckMethod {","524","        private final Descriptor descriptor;","525","        private final Method method;","526","        private final String capitalizedFieldName;","527","","528","        \/**","529","         * Names of the parameters to pass from the client.","530","         *\/","531","        private final List<String> names;","532","","533","        private volatile String checkUrl;    \/\/ cached once computed","534","        private volatile String dependsOn;  \/\/  cached once computed","535","","536","        public CheckMethod(Descriptor descriptor, String fieldName) {","537","            this.descriptor = descriptor;","538","            this.capitalizedFieldName = StringUtils.capitalize(fieldName);","539","","540","            method = ReflectionUtils.getPublicMethodNamed(descriptor.getClass(), \"doCheck\" + capitalizedFieldName);","541","            if(method !=null) {","542","                names = new ArrayList<String>();","543","                findParameters(method);","544","            } else {","545","                names = null;","546","            }","547","        }","548","","549","        \/**","550","         * Builds query parameter line by figuring out what should be submitted","551","         *\/","552","        private void findParameters(Method method) {","553","            for (Parameter p : ReflectionUtils.getParameters(method)) {","554","                QueryParameter qp = p.annotation(QueryParameter.class);","555","                if (qp!=null) {","556","                    String name = qp.value();","557","                    if (name.length()==0) name = p.name();","558","                    if (name==null || name.length()==0)","559","                        continue;   \/\/ unknown parameter name. we'll report the error when the form is submitted.","560","                    if (name.equals(\"value\"))","561","                        continue;   \/\/ 'value' parameter is implicit","562","","563","                    RelativePath rp = p.annotation(RelativePath.class);","564","                    if (rp!=null)","565","                        name = rp.value()+'\/'+name;","566","","567","                    names.add(name);","568","                    continue;","569","                }","570","","571","                Method m = ReflectionUtils.getPublicMethodNamed(p.type(), \"fromStapler\");","572","                if (m!=null)    findParameters(m);","573","            }","574","        }","575","","576","        \/**","577","         * Obtains the 1.526-compatible single string representation.","578","         *","579","         * This method computes JavaScript expression, which evaluates to the URL that the client should request","580","         * the validation to.","581","         * A modern version depends on {@link #toStemUrl()} and {@link #getDependsOn()}","582","         *\/","583","        public String toCheckUrl() {","584","            if (names==null)    return null;","585","","586","            if (checkUrl==null) {","587","                StringBuilder buf = new StringBuilder(singleQuote(relativePath()));","588","                if (!names.isEmpty()) {","589","                    buf.append(\"+qs(this).addThis()\");","590","","591","                    for (String name : names) {","592","                        buf.append(\".nearBy('\"+name+\"')\");","593","                    }","594","                    buf.append(\".toString()\");","595","                }","596","                checkUrl = buf.toString();","597","            }","598","","599","            \/\/ put this under the right contextual umbrella.","600","            \/\/ 'a' in getCurrentDescriptorByNameUrl is always non-null because we already have Hudson as the sentinel","601","            return '\\'' + jsStringEscape(Descriptor.getCurrentDescriptorByNameUrl()) + \"\/'+\" + checkUrl;","602","        }","603","","604","        \/**","605","         * Returns the URL that the JavaScript should hit to perform form validation, except","606","         * the query string portion (which is built on the client side.)","607","         *\/","608","        public String toStemUrl() {","609","            if (names==null)    return null;","610","            return jsStringEscape(Descriptor.getCurrentDescriptorByNameUrl()) + '\/' + relativePath();","611","        }","612","","613","        public String getDependsOn() {","614","            if (names==null)    return null;","615","","616","            if (dependsOn==null)","617","                dependsOn = join(names,\" \");","618","            return dependsOn;","619","        }","620","","621","        private String relativePath() {","622","            return descriptor.getDescriptorUrl() + \"\/check\" + capitalizedFieldName;","623","        }","624","","625","    }"],"delete":["34","import static hudson.Util.fixEmpty;"]}],"core\/src\/main\/resources\/lib\/form\/textarea.jelly":[{"add":["84","            checkUrl=\"${attrs.checkUrl}\" checkDependsOn=\"${attrs.checkDependsOn}\" checkMethod=\"${attrs.checkMethod}\""],"delete":["84","            checkUrl=\"${attrs.checkUrl}\" checkMethod=\"${attrs.checkMethod}\""]}],"core\/src\/main\/resources\/lib\/form\/checkbox.jelly":[{"add":["63","         checkUrl=\"${attrs.checkUrl}\" checkDependsOn=\"${attrs.checkDependsOn}\" json=\"${attrs.json}\""],"delete":["63","         checkUrl=\"${attrs.checkUrl}\" json=\"${attrs.json}\""]}],"core\/src\/main\/resources\/lib\/form\/editableComboBox.jelly":[{"add":["51","         checkUrl=\"${attrs.checkUrl}\" checkDependsOn=\"${attrs.checkDependsOn}\" \/>"],"delete":["51","         checkUrl=\"${attrs.checkUrl}\" \/>"]}]}},"a1e93bf5c903d9a993c554c4dc2c05f7807dde14":{"changes":{"core\/src\/main\/java\/hudson\/tasks\/junit\/TestResultAction.java":"MODIFY","core\/src\/main\/resources\/hudson\/tasks\/junit\/ClassResult\/body.jelly":"MODIFY","core\/src\/main\/resources\/hudson\/tasks\/junit\/MetaTabulatedResult\/list.jelly":"ADD","core\/src\/main\/resources\/hudson\/tasks\/junit\/ClassResult\/list.jelly":"ADD","maven-plugin\/src\/main\/java\/hudson\/maven\/MavenTestDataPublisher.java":"ADD","core\/src\/main\/java\/hudson\/tasks\/junit\/ClassResult.java":"MODIFY","core\/src\/main\/java\/hudson\/tasks\/junit\/History.java":"ADD","core\/src\/main\/resources\/hudson\/tasks\/junit\/CaseResult\/list.jelly":"ADD","core\/src\/main\/java\/hudson\/tasks\/junit\/TestObject.java":"MODIFY","core\/src\/main\/java\/hudson\/tasks\/junit\/TestAction.java":"ADD","core\/src\/main\/java\/hudson\/tasks\/junit\/TestResult.java":"MODIFY","core\/src\/main\/java\/hudson\/tasks\/junit\/JUnitResultArchiver.java":"MODIFY","maven-plugin\/src\/main\/resources\/hudson\/maven\/MavenTestDataPublisher\/config.jelly":"ADD","core\/src\/main\/java\/hudson\/tasks\/junit\/TabulatedResult.java":"MODIFY","core\/src\/main\/resources\/hudson\/tasks\/junit\/CaseResult\/index.jelly":"MODIFY","core\/src\/main\/resources\/hudson\/tasks\/junit\/TestObject\/sidepanel.jelly":"ADD","core\/src\/main\/resources\/hudson\/tasks\/junit\/History\/index.jelly":"ADD","core\/src\/main\/resources\/hudson\/tasks\/junit\/CaseResult\/summary.jelly":"ADD","test\/src\/test\/java\/hudson\/tasks\/junit\/JUnitResultArchiverTest.java":"ADD","core\/src\/main\/resources\/hudson\/model\/AbstractBuild\/sidepanel.jelly":"MODIFY","core\/src\/main\/java\/hudson\/tasks\/junit\/CaseResult.java":"MODIFY","test\/src\/test\/resources\/hudson\/tasks\/junit\/JUnitResultArchiverTest.zip":"ADD","core\/src\/main\/java\/hudson\/tasks\/junit\/PackageResult.java":"MODIFY","core\/src\/main\/resources\/hudson\/tasks\/test\/MatrixTestResult\/index.jelly":"MODIFY","core\/src\/main\/resources\/hudson\/tasks\/junit\/MetaTabulatedResult\/body.jelly":"MODIFY","core\/src\/main\/resources\/hudson\/tasks\/junit\/JUnitResultArchiver\/config.jelly":"MODIFY","core\/src\/main\/resources\/hudson\/tasks\/junit\/TabulatedResult\/index.jelly":"MODIFY","core\/src\/main\/java\/hudson\/tasks\/junit\/TestDataPublisher.java":"ADD","core\/src\/main\/java\/hudson\/tasks\/junit\/SuiteResult.java":"MODIFY","core\/src\/main\/resources\/hudson\/model\/AbstractBuild\/tasks.jelly":"ADD"},"diff":{"core\/src\/main\/java\/hudson\/tasks\/junit\/TestResultAction.java":[{"add":["3"," * Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi, Daniel Dyer, Red Hat, Inc., Tom Huybrechts","36","import java.util.ArrayList;","37","import java.util.Collections;","38","import java.util.List;","39","import java.util.Map;","40","import java.util.concurrent.ConcurrentHashMap;","44","import org.kohsuke.stapler.StaplerProxy;","45","","46","import com.thoughtworks.xstream.XStream;","47","","65","    private List<Data> testData;","66","    private Map<String,String> descriptions = new ConcurrentHashMap<String, String>();","162","    ","163","    public String getDescription(TestObject object) {","164","    \treturn descriptions.get(object.getId());","165","    }","166","    ","167","    public void setDescription(TestObject object, String description) {","168","    \tdescriptions.put(object.getId(), description);","169","    }","170","    ","171","    public List<TestAction> getActions(TestObject object) {","172","    \tList<TestAction> result = new ArrayList<TestAction>();","173","    \tfor (Data data: testData) {","174","\t\t\tresult.addAll(data.getTestAction(object));","175","    \t}","176","\t\treturn Collections.unmodifiableList(result);","177","    }","178","    ","179","\tpublic void setData(List<Data> testData) {","180","\t\tthis.testData = testData;","181","\t}","182","    ","183","    public static abstract class Data {","184","    \t\/**","185","    \t * Returns all TestActions for the testObject. Always non-null","186","    \t *\/","187","    \tpublic abstract List<TestAction> getTestAction(TestObject testObject);","188","    }","190","    public Object readResolve() {","191","    \tif (descriptions == null) {","192","    \t\tdescriptions = new ConcurrentHashMap<String, String>();","193","    \t}","194","    \tif (testData == null) {","195","    \t\ttestData = new ArrayList<Data>();","196","    \t}","197","    \t","198","    \treturn this;","199","    }","200","    ","212",""],"delete":["3"," * Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi, Daniel Dyer, Red Hat, Inc.","25","import com.thoughtworks.xstream.XStream;","33","import java.util.List;","34","import org.kohsuke.stapler.StaplerProxy;","35","import org.kohsuke.stapler.export.Exported;","60","","157","","158",""]}],"core\/src\/main\/resources\/hudson\/tasks\/junit\/ClassResult\/body.jelly":[{"add":["36","            <td class=\"pane\">","37","            \t<a href=\"${p.safeName}\"><span style='${p.previousResult==null?\"font-weight:bold\":\"\"}'>${p.name}<\/span><\/a>","38","\t          \t<st:nbsp\/>","39","\t\t        <j:forEach var=\"badge\" items=\"${p.testActions}\">","40","\t\t          <st:include it=\"${badge}\" page=\"badge.jelly\" optional=\"true\"\/>","41","\t\t        <\/j:forEach>","42","            <\/td>"],"delete":["36","            <td class=\"pane\"><a href=\"${p.safeName}\">${p.name}<\/a><\/td>"]}],"core\/src\/main\/resources\/hudson\/tasks\/junit\/MetaTabulatedResult\/list.jelly":[{"add":[],"delete":[]}],"core\/src\/main\/resources\/hudson\/tasks\/junit\/ClassResult\/list.jelly":[{"add":[],"delete":[]}],"maven-plugin\/src\/main\/java\/hudson\/maven\/MavenTestDataPublisher.java":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/tasks\/junit\/ClassResult.java":[{"add":["3"," * Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi, Daniel Dyer, id:cactusman, Tom Huybrechts","40","    private final String className; \/\/ simple name","62","        return pr.getClassResult(getName());","63","    }","64","","65","    @Override","66","    public ClassResult getResultInBuild(AbstractBuild<?, ?> build) {","67","        PackageResult pr = getParent().getResultInBuild(build);","68","        if(pr==null)    return null;","69","        return pr.getClassResult(getName());","86","    ","87","    public CaseResult getCaseResult(String name) {","95","    public Object getDynamic(String name, StaplerRequest req, StaplerResponse rsp) {","96","    \tCaseResult c = getCaseResult(name);","97","    \tif (c != null) {","98","    \t\treturn c;","99","    \t} else {","100","    \t\treturn super.getDynamic(name, req, rsp);","101","    \t}","102","    }","103","","153","    public String getClassName() {","154","    \treturn className;","155","    }","164","    ","165","    public String getFullName() {","166","    \treturn getParent().getDisplayName() + \".\" + className;","167","    }","168","","169","    \/**","170","     * Gets the relative path to this test case from the given object.","171","     *\/","172","    public String getRelativePathFrom(TestObject it) {","173","        if(it==this)","174","            return \".\";","175","        ","176","        if (it instanceof TestResult) {","177","        \treturn getParent().getSafeName() + \"\/\" + getSafeName();","178","        } else if (it instanceof PackageResult) {","179","        \treturn getSafeName();","180","        } else if (it instanceof CaseResult) {","181","        \treturn \"..\";","182","        } else {","183","        \tthrow new UnsupportedOperationException();","184","        }","185","","186","    }"],"delete":["3"," * Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi, Daniel Dyer, id:cactusman","40","    private final String className;","59","    public AbstractBuild<?,?> getOwner() {","60","        return parent.getOwner();","61","    }","62","","66","        return pr.getDynamic(getName(),null,null);","83","","84","    public CaseResult getDynamic(String name, StaplerRequest req, StaplerResponse rsp) {"]}],"core\/src\/main\/java\/hudson\/tasks\/junit\/History.java":[{"add":[],"delete":[]}],"core\/src\/main\/resources\/hudson\/tasks\/junit\/CaseResult\/list.jelly":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/tasks\/junit\/TestObject.java":[{"add":["3"," * Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi, Tom Huybrechts","26","import hudson.model.AbstractBuild;","27","import hudson.model.AbstractModelObject;","28","import hudson.model.Action;","29","import hudson.model.Api;","30","import hudson.model.Build;","31","import hudson.model.Item;","32","import hudson.model.Messages;","33","import hudson.model.Result;","34","import hudson.model.Run;","35","import hudson.util.ChartUtil;","36","import hudson.util.ColorPalette;","37","import hudson.util.DataSetBuilder;","38","import hudson.util.ShiftedCategoryAxis;","39","import hudson.util.StackedAreaRenderer2;","41","import java.awt.Color;","42","import java.awt.Paint;","43","import java.io.IOException;","46","import java.util.List;","49","","50","import javax.servlet.ServletException;","51","","52","import org.jfree.chart.ChartFactory;","53","import org.jfree.chart.JFreeChart;","54","import org.jfree.chart.axis.CategoryAxis;","55","import org.jfree.chart.axis.CategoryLabelPositions;","56","import org.jfree.chart.axis.NumberAxis;","57","import org.jfree.chart.plot.CategoryPlot;","58","import org.jfree.chart.plot.PlotOrientation;","59","import org.jfree.chart.renderer.category.StackedAreaRenderer;","60","import org.jfree.data.category.CategoryDataset;","61","import org.jfree.ui.RectangleInsets;","62","import org.kohsuke.stapler.HttpRedirect;","63","import org.kohsuke.stapler.HttpResponse;","64","import org.kohsuke.stapler.QueryParameter;","65","import org.kohsuke.stapler.StaplerRequest;","66","import org.kohsuke.stapler.StaplerResponse;","71"," * ","75","public abstract class TestObject extends AbstractModelObject implements Serializable {","76","\tpublic AbstractBuild<?, ?> getOwner() {","77","\t\treturn getParent().getOwner();","78","\t}","79","","80","\tprivate volatile transient String id;","81","","82","\tpublic abstract TestObject getParent();","83","","84","\tpublic String getId() {","85","\t\tif (id == null) {","86","\t\t\tid = getParent().getId() + \"\/\" + getSafeName();","87","\t\t}","88","\t\treturn id;","89","\t}","90","\t","91","\t\/**","92","\t * Returns url relative to TestResult","93","\t *\/","94","\tpublic String getUrl() {","95","\t\treturn getId();","96","\t}","97","","98","\tpublic TestResult getTestResult() {","99","\t\treturn getParent().getTestResult();","100","\t}","101","","102","\tpublic TestResultAction getTestResultAction() {","103","\t\treturn getOwner().getAction(TestResultAction.class);","104","\t}","105","","106","\tpublic List<TestAction> getTestActions() {","107","\t\treturn getTestResultAction().getActions(this);","108","\t}","109","","110","\tpublic <T> T getTestAction(Class<T> klazz) {","111","\t\tfor (TestAction action : getTestActions()) {","112","\t\t\tif (klazz.isAssignableFrom(action.getClass())) {","113","\t\t\t\treturn klazz.cast(action);","114","\t\t\t}","115","\t\t}","116","\t\treturn null;","117","\t}","118","","119","\t\/**","120","\t * Gets the counter part of this {@link TestObject} in the previous run.","121","\t * ","122","\t * @return null if no such counter part exists.","123","\t *\/","124","\tpublic abstract TestObject getPreviousResult();","125","\t","126","\tpublic abstract TestObject getResultInBuild(AbstractBuild<?,?> build); ","127","","128","\t\/**","129","\t * Time took to run this test. In seconds.","130","\t *\/","131","\tpublic abstract float getDuration();","132","","133","\t\/**","134","\t * Returns the string representation of the {@link #getDuration()}, in a","135","\t * human readable format.","136","\t *\/","137","\tpublic String getDurationString() {","138","\t\treturn Util.getTimeSpanString((long) (getDuration() * 1000));","139","\t}","140","\t","141","\tpublic String getDescription() {","142","\t\treturn getTestResultAction().getDescription(this);","143","\t}","144","\t","145","\tpublic void setDescription(String description) {","146","\t\tgetTestResultAction().setDescription(this, description);","147","\t}","148","","149","\t\/**","150","\t * Exposes this object through the remote API.","151","\t *\/","152","\tpublic Api getApi() {","153","\t\treturn new Api(this);","154","\t}","155","","156","\t\/**","157","\t * Gets the name of this object.","158","\t *\/","159","\tpublic\/* abstract *\/String getName() {","160","\t\treturn \"\";","161","\t}","162","","163","\t\/**","164","\t * Gets the version of {@link #getName()} that's URL-safe.","165","\t *\/","166","\tpublic String getSafeName() {","167","\t\treturn safe(getName());","168","\t}","169","\t","170","\tpublic String getSearchUrl() {","171","\t\treturn getSafeName();","172","\t}","173","","174","\t\/**","175","\t * #2988: uniquifies a {@link #getSafeName} amongst children of the parent.","176","\t *\/","177","\tprotected final synchronized String uniquifyName(","178","\t\t\tCollection<? extends TestObject> siblings, String base) {","179","\t\tString uniquified = base;","180","\t\tint sequence = 1;","181","\t\tfor (TestObject sibling : siblings) {","182","\t\t\tif (sibling != this","183","\t\t\t\t\t&& uniquified.equals(UNIQUIFIED_NAMES.get(sibling))) {","184","\t\t\t\tuniquified = base + '_' + ++sequence;","185","\t\t\t}","186","\t\t}","187","\t\tUNIQUIFIED_NAMES.put(this, uniquified);","188","\t\treturn uniquified;","189","\t}","190","","191","\tprivate static final Map<TestObject, String> UNIQUIFIED_NAMES = new WeakHashMap<TestObject, String>();","192","","193","\t\/**","194","\t * Replaces URL-unsafe characters.","195","\t *\/","196","\tprotected static String safe(String s) {","197","\t\t\/\/ 3 replace calls is still 2-3x faster than a regex replaceAll","198","\t\treturn s.replace('\/', '_').replace('\\\\', '_').replace(':', '_');","199","\t}","200","\t","201","    \/**","202","     * Gets the total number of passed tests.","203","     *\/","204","    public abstract int getPassCount();","207","     * Gets the total number of failed tests.","209","    public abstract int getFailCount();","212","     * Gets the total number of skipped tests.","214","    public abstract int getSkipCount();","217","     * Gets the total number of tests.","219","    public final int getTotalCount() {","220","        return getPassCount()+getFailCount()+getSkipCount();","222","\t","223","\tpublic History getHistory() {","224","\t\treturn new History(this);","225","\t}","226","\t","227","\tpublic Object getDynamic(String token, StaplerRequest req,","228","\t\t\tStaplerResponse rsp) {","229","\t\tfor (Action a : getTestActions()) {","230","\t\t\tif (a == null)","231","\t\t\t\tcontinue; \/\/ be defensive","232","\t\t\tString urlName = a.getUrlName();","233","\t\t\tif (urlName == null)","234","\t\t\t\tcontinue;","235","\t\t\tif (urlName.equals(token))","236","\t\t\t\treturn a;","237","\t\t}","238","\t\treturn null;","239","\t}","241","\tpublic synchronized HttpResponse doSubmitDescription(","242","\t\t\t@QueryParameter String description) throws IOException,","243","\t\t\tServletException {","244","\t\tgetOwner().checkPermission(Item.BUILD);","246","\t\tsetDescription(description);","247","\t\tgetOwner().save();","248","\t\t","249","\t\treturn new HttpRedirect(\".\");","250","\t}","252","\tprivate static final long serialVersionUID = 1L;"],"delete":["3"," * Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi","25","import hudson.model.AbstractBuild;","26","import hudson.model.ModelObject;","27","import hudson.model.Api;","31","","39"," *","43","public abstract class TestObject implements ModelObject, Serializable {","44","    public abstract AbstractBuild<?,?> getOwner();","47","     * Gets the counter part of this {@link TestObject} in the previous run.","48","     *","49","     * @return null","50","     *      if no such counter part exists.","52","    public abstract TestObject getPreviousResult();","55","     * Time took to run this test. In seconds.","57","    public abstract float getDuration();","60","     * Returns the string representation of the {@link #getDuration()},","61","     * in a human readable format.","63","    public String getDurationString() {","64","        return Util.getTimeSpanString((long)(getDuration()*1000));","67","    \/**","68","     * Exposes this object through the remote API.","69","     *\/","70","    public Api getApi() {","71","        return new Api(this);","72","    }","74","    \/**","75","     * Gets the name of this object.","76","     *\/","77","    public \/*abstract*\/ String getName() {return \"\";}","79","    \/**","80","     * Gets the version of {@link #getName()} that's URL-safe.","81","     *\/","82","    public String getSafeName() {","83","        return safe(getName());","84","    }","85","","86","    \/**","87","     * #2988: uniquifies a {@link #getSafeName} amongst children of the parent.","88","     *\/","89","    protected final synchronized String uniquifyName(Collection<? extends TestObject> siblings, String base) {","90","        String uniquified = base;","91","        int sequence = 1;","92","        for (TestObject sibling : siblings) {","93","            if (sibling != this && uniquified.equals(UNIQUIFIED_NAMES.get(sibling))) {","94","                uniquified = base + '_' + ++sequence;","95","            }","96","        }","97","        UNIQUIFIED_NAMES.put(this, uniquified);","98","        return uniquified;","99","    }","100","    private static final Map<TestObject,String> UNIQUIFIED_NAMES = new WeakHashMap<TestObject,String>();","101","","102","    \/**","103","     * Replaces URL-unsafe characters.","104","     *\/","105","    protected static String safe(String s) {","106","        \/\/ 3 replace calls is still 2-3x faster than a regex replaceAll","107","        return s.replace('\/','_').replace('\\\\', '_').replace(':','_');","108","    }","109","","110","    private static final long serialVersionUID = 1L;"]}],"core\/src\/main\/java\/hudson\/tasks\/junit\/TestAction.java":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/tasks\/junit\/TestResult.java":[{"add":["3"," * Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi, Daniel Dyer, id:cactusman, Tom Huybrechts","25","import hudson.AbortException;","26","import hudson.Util;","32","import java.io.PrintWriter;","33","import java.io.StringWriter;","42","import org.apache.tools.ant.DirectoryScanner;","43","import org.dom4j.DocumentException;","44","import org.kohsuke.stapler.StaplerRequest;","45","import org.kohsuke.stapler.StaplerResponse;","46","import org.kohsuke.stapler.export.Exported;","47","","86","    ","100","    ","101","    public TestObject getParent() {","102","    \treturn null;","103","    }","104","    ","105","    public String getId() {","106","    \treturn \"\";","107","    }","108","    ","109","    @Override","110","    public TestResult getTestResult() {","111","    \treturn this;","112","    }","183","            if (!reportFile.getPath().endsWith(\".xml\")) {","186","            } else {","187","                SuiteResult sr = new SuiteResult(reportFile.getName(), \"\", \"\");","188","                StringWriter writer = new StringWriter();","189","                e.printStackTrace(new PrintWriter(writer));","190","                String error = \"Failed to read test report file \"+reportFile.getAbsolutePath()+\"\\n\"+writer.toString();","191","                sr.addCase(new CaseResult(sr,\"<init>\",error));","192","                add(sr);","194","            }","215","    @Override","216","    public TestResult getResultInBuild(AbstractBuild<?, ?> build) {","217","        TestResultAction tra = build.getAction(TestResultAction.class);","218","        if (tra == null) return null;","219","        return tra.getResult();","220","    }","221","    ","273","    public Object getDynamic(String token, StaplerRequest req, StaplerResponse rsp) {","274","        PackageResult result = byPackage(token);","275","        if (result != null) {","276","        \treturn result;","277","        } else {","278","        \treturn super.getDynamic(token, req, rsp);","279","        }","289","    "],"delete":["3"," * Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi, Daniel Dyer, id:cactusman","27","import hudson.*;","28","import org.apache.tools.ant.DirectoryScanner;","29","import org.dom4j.DocumentException;","30","import org.kohsuke.stapler.StaplerRequest;","31","import org.kohsuke.stapler.StaplerResponse;","32","import org.kohsuke.stapler.export.Exported;","82","","166","            if(!reportFile.getPath().endsWith(\".xml\"))","169","            else","242","    public PackageResult getDynamic(String packageName, StaplerRequest req, StaplerResponse rsp) {","243","        return byPackage(packageName);","253",""]}],"core\/src\/main\/java\/hudson\/tasks\/junit\/JUnitResultArchiver.java":[{"add":["3"," * Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi, Martin Eigenbrodt, Tom Huybrechts","25","import hudson.AbortException;","30","import hudson.FilePath.FileCallable;","39","import hudson.model.Descriptor;","40","import hudson.model.Result;","41","import hudson.model.Saveable;","44","import hudson.tasks.BuildStepMonitor;","47","import hudson.tasks.junit.TestResultAction.Data;","50","import hudson.util.DescribableList;","52","","53","import java.io.File;","54","import java.io.IOException;","55","import java.io.Serializable;","56","import java.util.ArrayList;","57","import java.util.List;","58","","59","import net.sf.json.JSONObject;","60","","66","import org.kohsuke.stapler.StaplerRequest;","70"," * ","73","public class JUnitResultArchiver extends Recorder implements Serializable,","74","\t\tMatrixAggregatable {","76","\t\/**","77","\t * {@link FileSet} \"includes\" string, like \"foo\/bar\/*.xml\"","78","\t *\/","79","\tprivate final String testResults;","81","\tprivate final DescribableList<TestDataPublisher, Descriptor<TestDataPublisher>> testDataPublishers;","83","\t\/**","84","\t * left for backwards compatibility","85","\t * ","86","\t * @param testResults","87","\t *\/","88","\t@Deprecated","89","\tpublic JUnitResultArchiver(String testResults) {","90","\t\tthis(testResults, null);","91","\t}","92","\t","93","\t@DataBoundConstructor","94","\tpublic JUnitResultArchiver(","95","\t\t\tString testResults,","96","\t\t\tDescribableList<TestDataPublisher, Descriptor<TestDataPublisher>> testDataPublishers) {","97","\t\tthis.testResults = testResults;","98","\t\tthis.testDataPublishers = testDataPublishers;","99","\t}","101","\tpublic boolean perform(AbstractBuild build, Launcher launcher,","102","\t\t\tBuildListener listener) throws InterruptedException, IOException {","103","\t\tlistener.getLogger().println(Messages.JUnitResultArchiver_Recording());","104","\t\tTestResultAction action;","105","\t\t","106","\t\tfinal String testResults = build.getEnvironment(listener).expand(this.testResults);","108","\t\ttry {","109","\t\t\tfinal long buildTime = build.getTimestamp().getTimeInMillis();","110","\t\t\tfinal long nowMaster = System.currentTimeMillis();","112","\t\t\tTestResult result = build.getWorkspace().act(","113","\t\t\t\t\tnew FileCallable<TestResult>() {","114","\t\t\t\t\t\tpublic TestResult invoke(File ws, VirtualChannel channel)","115","\t\t\t\t\t\t\t\tthrows IOException {","116","\t\t\t\t\t\t\tfinal long nowSlave = System.currentTimeMillis();","118","\t\t\t\t\t\t\tFileSet fs = Util.createFileSet(ws, testResults);","119","\t\t\t\t\t\t\tDirectoryScanner ds = fs.getDirectoryScanner();","121","\t\t\t\t\t\t\tString[] files = ds.getIncludedFiles();","122","\t\t\t\t\t\t\tif (files.length == 0) {","123","\t\t\t\t\t\t\t\t\/\/ no test result. Most likely a configuration","124","\t\t\t\t\t\t\t\t\/\/ error or fatal problem","125","\t\t\t\t\t\t\t\tthrow new AbortException(","126","\t\t\t\t\t\t\t\t\t\tMessages","127","\t\t\t\t\t\t\t\t\t\t\t\t.JUnitResultArchiver_NoTestReportFound());","128","\t\t\t\t\t\t\t}","130","\t\t\t\t\t\t\treturn parseResult(ds, buildTime","131","\t\t\t\t\t\t\t\t\t+ (nowSlave - nowMaster));","132","\t\t\t\t\t\t}","133","\t\t\t\t\t});","135","\t\t\taction = new TestResultAction(build, result, listener);","136","\t\t\tif (result.getPassCount() == 0 && result.getFailCount() == 0)","137","\t\t\t\tthrow new AbortException(Messages","138","\t\t\t\t\t\t.JUnitResultArchiver_ResultIsEmpty());","140","\t\t\tList<Data> data = new ArrayList<Data>();","141","\t\t\tif (testDataPublishers != null) {","142","\t\t\t\tfor (TestDataPublisher tdp : testDataPublishers) {","143","\t\t\t\t\tData d = tdp.getTestData(build, launcher, listener, result);","144","\t\t\t\t\tif (d != null) {","145","\t\t\t\t\t\tdata.add(d);","146","\t\t\t\t\t}","147","\t\t\t\t}","148","\t\t\t}","150","\t\t\taction.setData(data);","152","\t\t\tCHECKPOINT.block();","154","\t\t} catch (AbortException e) {","155","\t\t\tif (build.getResult() == Result.FAILURE)","156","\t\t\t\t\/\/ most likely a build failed before it gets to the test phase.","157","\t\t\t\t\/\/ don't report confusing error message.","158","\t\t\t\treturn true;","160","\t\t\tlistener.getLogger().println(e.getMessage());","161","\t\t\tbuild.setResult(Result.FAILURE);","162","\t\t\treturn true;","163","\t\t} catch (IOException e) {","164","\t\t\te.printStackTrace(listener.error(\"Failed to archive test reports\"));","165","\t\t\tbuild.setResult(Result.FAILURE);","166","\t\t\treturn true;","167","\t\t}","169","\t\tbuild.getActions().add(action);","170","\t\tCHECKPOINT.report();","172","\t\tif (action.getResult().getFailCount() > 0)","173","\t\t\tbuild.setResult(Result.UNSTABLE);","175","\t\treturn true;","176","\t}","178","\tprotected TestResult parseResult(DirectoryScanner ds, long buildTime)","179","\t\t\tthrows IOException {","180","\t\treturn new TestResult(buildTime, ds);","181","\t}","183","\t\/**","184","\t * This class does explicit checkpointing.","185","\t *\/","186","\tpublic BuildStepMonitor getRequiredMonitorService() {","187","\t\treturn BuildStepMonitor.NONE;","188","\t}","190","\tpublic String getTestResults() {","191","\t\treturn testResults;","192","\t}","194","\tpublic DescribableList<TestDataPublisher, Descriptor<TestDataPublisher>> getTestDataPublishers() {","195","\t\treturn testDataPublishers;","196","\t}","198","\t@Override","199","\tpublic Action getProjectAction(AbstractProject<?, ?> project) {","200","\t\treturn new TestResultProjectAction(project);","201","\t}","202","","203","\tpublic MatrixAggregator createAggregator(MatrixBuild build,","204","\t\t\tLauncher launcher, BuildListener listener) {","205","\t\treturn new TestResultAggregator(build, launcher, listener);","206","\t}","207","","208","\t\/**","209","\t * Test result tracks the diff from the previous run, hence the checkpoint.","210","\t *\/","211","\tprivate static final CheckPoint CHECKPOINT = new CheckPoint(","212","\t\t\t\"JUnit result archiving\");","213","","214","\tprivate static final long serialVersionUID = 1L;","215","","216","\t@Extension","217","\tpublic static class DescriptorImpl extends BuildStepDescriptor<Publisher> {","218","\t\tpublic String getDisplayName() {","219","\t\t\treturn Messages.JUnitResultArchiver_DisplayName();","220","\t\t}","221","","222","\t\tpublic String getHelpFile() {","223","\t\t\treturn \"\/help\/tasks\/junit\/report.html\";","224","\t\t}","225","","226","\t\t@Override","227","\t\tpublic Publisher newInstance(StaplerRequest req, JSONObject formData)","228","\t\t\t\tthrows hudson.model.Descriptor.FormException {","229","\t\t\tString testResults = formData.getString(\"testResults\");","230","\t\t\tDescribableList<TestDataPublisher, Descriptor<TestDataPublisher>> testDataPublishers = new DescribableList<TestDataPublisher, Descriptor<TestDataPublisher>>(","231","\t\t\t\t\tnew Saveable() {","232","\t\t\t\t\t\tpublic void save() throws IOException {","233","\t\t\t\t\t\t\t\/\/ no-op","234","\t\t\t\t\t\t}","235","\t\t\t\t\t});","236","\t\t\ttestDataPublishers.rebuild(req, formData, TestDataPublisher.all());","237","","238","\t\t\treturn new JUnitResultArchiver(testResults, testDataPublishers);","239","\t\t}","240","","241","\t\t\/**","242","\t\t * Performs on-the-fly validation on the file mask wildcard.","243","\t\t *\/","244","\t\tpublic FormValidation doCheckTestResults(","245","\t\t\t\t@AncestorInPath AbstractProject project,","246","\t\t\t\t@QueryParameter String value) throws IOException {","247","\t\t\treturn FilePath.validateFileMask(project.getSomeWorkspace(), value);","248","\t\t}","249","","250","\t\tpublic boolean isApplicable(Class<? extends AbstractProject> jobType) {","251","\t\t\treturn true;","252","\t\t}","253","\t}"],"delete":["3"," * Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi, Martin Eigenbrodt","27","import hudson.FilePath.FileCallable;","30","import hudson.AbortException;","38","import hudson.model.Result;","44","import hudson.tasks.BuildStepMonitor;","53","","54","import java.io.File;","55","import java.io.IOException;","56","import java.io.Serializable;","60"," *","63","public class JUnitResultArchiver extends Recorder implements Serializable, MatrixAggregatable {","65","    \/**","66","     * {@link FileSet} \"includes\" string, like \"foo\/bar\/*.xml\"","67","     *\/","68","    private final String testResults;","69","    ","70","    @DataBoundConstructor","71","    public JUnitResultArchiver(String testResults) {","72","        this.testResults = testResults;","73","    }","75","    public boolean perform(AbstractBuild build, Launcher launcher, BuildListener listener) throws InterruptedException, IOException {","76","        listener.getLogger().println(Messages.JUnitResultArchiver_Recording());","77","        TestResultAction action;","79","        try {","80","            final long buildTime = build.getTimestamp().getTimeInMillis();","81","            final long nowMaster = System.currentTimeMillis();","83","            TestResult result = build.getWorkspace().act(new FileCallable<TestResult>() {","84","                public TestResult invoke(File ws, VirtualChannel channel) throws IOException {","85","                    final long nowSlave = System.currentTimeMillis();","87","                    FileSet fs = Util.createFileSet(ws,testResults);","88","                    DirectoryScanner ds = fs.getDirectoryScanner();","90","                    String[] files = ds.getIncludedFiles();","91","                    if(files.length==0) {","92","                        \/\/ no test result. Most likely a configuration error or fatal problem","93","                        throw new AbortException(Messages.JUnitResultArchiver_NoTestReportFound());","94","                    }","96","                    return parseResult(ds, buildTime + (nowSlave - nowMaster));","97","                }","98","            });","100","            CHECKPOINT.block();","101","            action = new TestResultAction(build, result, listener);","102","            if(result.getPassCount()==0 && result.getFailCount()==0)","103","                throw new AbortException(Messages.JUnitResultArchiver_ResultIsEmpty());","104","        } catch (AbortException e) {","105","            if(build.getResult()==Result.FAILURE)","106","                \/\/ most likely a build failed before it gets to the test phase.","107","                \/\/ don't report confusing error message.","108","                return true;","110","            listener.getLogger().println(e.getMessage());","111","            build.setResult(Result.FAILURE);","112","            return true;","113","        } catch (IOException e) {","114","            e.printStackTrace(listener.error(\"Failed to archive test reports\"));","115","            build.setResult(Result.FAILURE);","116","            return true;","117","        }","119","        build.getActions().add(action);","120","        CHECKPOINT.report();","122","        if(action.getResult().getFailCount()>0)","123","            build.setResult(Result.UNSTABLE);","125","        return true;","126","    }","128","    protected TestResult parseResult(DirectoryScanner ds, long buildTime) throws IOException {","129","        return new TestResult(buildTime, ds);","130","    }","132","    \/**","133","     * This class does explicit checkpointing.","134","     *\/","135","    public BuildStepMonitor getRequiredMonitorService() {","136","        return BuildStepMonitor.NONE;","137","    }","139","    public String getTestResults() {","140","        return testResults;","141","    }","143","    @Override","144","    public Action getProjectAction(AbstractProject<?, ?> project) {","145","        return new TestResultProjectAction(project);","146","    }","149","    public MatrixAggregator createAggregator(MatrixBuild build, Launcher launcher, BuildListener listener) {","150","        return new TestResultAggregator(build,launcher,listener);","151","    }","152","    \/**","153","     * Test result tracks the diff from the previous run, hence the checkpoint.","154","     *\/","155","    private static final CheckPoint CHECKPOINT = new CheckPoint(\"JUnit result archiving\");","157","    private static final long serialVersionUID = 1L;","159","    @Extension","160","    public static class DescriptorImpl extends BuildStepDescriptor<Publisher> {","161","        public String getDisplayName() {","162","            return Messages.JUnitResultArchiver_DisplayName();","163","        }","165","        public String getHelpFile() {","166","            return \"\/help\/tasks\/junit\/report.html\";","167","        }","169","        \/**","170","         * Performs on-the-fly validation on the file mask wildcard.","171","         *\/","172","        public FormValidation doCheckTestResults(@AncestorInPath AbstractProject project, @QueryParameter String value) throws IOException {","173","            return FilePath.validateFileMask(project.getSomeWorkspace(),value);","174","        }","176","        public boolean isApplicable(Class<? extends AbstractProject> jobType) {","177","            return true;","178","        }","179","    }"]}],"maven-plugin\/src\/main\/resources\/hudson\/maven\/MavenTestDataPublisher\/config.jelly":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/tasks\/junit\/TabulatedResult.java":[{"add":["3"," * Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi, Daniel Dyer, Tom Huybrechts"],"delete":["3"," * Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi, Daniel Dyer","40","     * Gets the total number of passed tests.","41","     *\/","42","    public abstract int getPassCount();","43","","44","    \/**","45","     * Gets the total number of failed tests.","46","     *\/","47","    public abstract int getFailCount();","48","","49","    \/**","50","     * Gets the total number of skipped tests.","51","     *\/","52","    public abstract int getSkipCount();","53","","54","    \/**","55","     * Gets the total number of tests.","56","     *\/","57","    public final int getTotalCount() {","58","        return getPassCount()+getFailCount()+getSkipCount();","59","    }","60","","61","    \/**"]}],"core\/src\/main\/resources\/hudson\/tasks\/junit\/CaseResult\/index.jelly":[{"add":["3","Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi, Daniel Dyer, Seiji Sogabe, Tom Huybrechts","27","    <st:include page=\"sidepanel.jelly\" \/>","56","        <a href=\"history\">","58","        <\/a>","61","      <t:editableDescription permission=\"${it.owner.BUILD}\"\/>","62","","63","      <table style=\"margin-top: 1em; margin-left:0em;\">","64","\t\t  <j:forEach var=\"action\" items=\"${it.testActions}\">","65","\t          <st:include page=\"summary.jelly\" from=\"${action}\" optional=\"true\" it=\"${action}\" \/>","66","\t\t  <\/j:forEach>","67","\t  <\/table>","70","      <pre>\"${it.annotate(it.errorDetails)}<\/pre>","72","      <pre><lo:out value=\"${it.annotate(it.errorStackTrace)}\"\/><\/pre>","76","        <pre>${it.annotate(it.stdout)}<\/pre>","81","        <pre>${it.annotate(it.stderr)}<\/pre>"],"delete":["3","Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi, Daniel Dyer, Seiji Sogabe","27","    <st:include it=\"${it.owner}\" page=\"sidepanel.jelly\" \/>","59","    <d:taglib uri=\"hudson:linkout\">","60","        <d:bean name=\"out\" className=\"hudson.util.HyperlinkingOutTag\"\/>","61","    <\/d:taglib>","64","      <pre><lo:out value=\"${it.errorDetails}\"\/><\/pre>","66","      <pre><lo:out value=\"${it.errorStackTrace}\"\/><\/pre>","70","        <pre><lo:out value=\"${it.stdout}\"\/><\/pre>","75","        <pre><lo:out value=\"${it.stderr}\"\/><\/pre>"]}],"core\/src\/main\/resources\/hudson\/tasks\/junit\/TestObject\/sidepanel.jelly":[{"add":[],"delete":[]}],"core\/src\/main\/resources\/hudson\/tasks\/junit\/History\/index.jelly":[{"add":[],"delete":[]}],"core\/src\/main\/resources\/hudson\/tasks\/junit\/CaseResult\/summary.jelly":[{"add":[],"delete":[]}],"test\/src\/test\/java\/hudson\/tasks\/junit\/JUnitResultArchiverTest.java":[{"add":[],"delete":[]}],"core\/src\/main\/resources\/hudson\/model\/AbstractBuild\/sidepanel.jelly":[{"add":["3","Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi, Tom Huybrechts","32","      <st:include page=\"tasks.jelly\"\/>"],"delete":["3","Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi","32","      <l:task icon=\"images\/24x24\/up.gif\" href=\"${it.upUrl}\" title=\"${%Back to Project}\" \/>","33","      <l:task icon=\"images\/24x24\/search.gif\" href=\"${buildUrl.baseUrl}\/\" title=\"${%Status}\" \/>","34","      <l:task icon=\"images\/24x24\/notepad.gif\" href=\"${buildUrl.baseUrl}\/changes\" title=\"${%Changes}\" \/>","35","      <j:choose>","36","        <j:when test=\"${it.logFile.length() > 200000}\">","37","          <!-- Show raw link directly so user need not click through live console page. -->","38","          <div class=\"task\">","39","            <a href=\"${buildUrl.baseUrl}\/console\">","40","              <img width=\"24\" height=\"24\" style=\"margin: 2px;\" src=\"${imagesURL}\/24x24\/terminal.gif\" alt=\"\"\/>","41","            <\/a>","42","            <st:nbsp \/>","43","            <a href=\"${buildUrl.baseUrl}\/console\">${%Console Output}<\/a>","44","            <st:nbsp \/>","45","            <a href=\"${buildUrl.baseUrl}\/consoleText\">[${%raw}]<\/a>","46","          <\/div>","47","        <\/j:when>","48","        <j:otherwise>","49","          <l:task icon=\"images\/24x24\/terminal.gif\" href=\"${buildUrl.baseUrl}\/console\" title=\"${%Console Output}\" \/>","50","        <\/j:otherwise>","51","      <\/j:choose>"]}],"core\/src\/main\/java\/hudson\/tasks\/junit\/CaseResult.java":[{"add":["3"," * Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi, Daniel Dyer, Seiji Sogabe, Tom Huybrechts","26","import hudson.model.Run;","30","import java.util.Comparator;","31","","32","import org.dom4j.Element;","33","import org.kohsuke.stapler.export.Exported;","143","    ","144","    public ClassResult getParent() {","145","    \treturn classResult;","146","    }","241","","242","\t@Override","243","\tpublic int getFailCount() {","244","\t\tif (!isPassed() && !isSkipped()) return 1; else return 0;","245","\t}","246","","247","\t@Override","248","\tpublic int getSkipCount() {","249","\t\tif (isSkipped()) return 1; else return 0;","250","\t}","251","\t","252","\t@Override","253","\tpublic int getPassCount() {","254","\t\treturn isPassed() ? 1 : 0; ","255","\t}","256","\t","265","    ","266","    public Run<?,?> getFailedSinceRun() {","267","    \treturn getOwner().getParent().getBuildByNumber(failedSince);","268","    }","298","        return getSuiteResult().getStdout();","310","        return getSuiteResult().getStderr();","319","    ","320","    @Override","321","    public CaseResult getResultInBuild(AbstractBuild<?, ?> build) {","322","        ClassResult pr = getParent().getResultInBuild(build);","323","        if(pr==null)    return null;","324","        return pr.getCaseResult(getName());","325","    }","361","    public SuiteResult getSuiteResult() {","364","    ","365","\tpublic String annotate(String text) {","366","\t\tif (text == null)","367","\t\t\treturn null;","368","\t\ttext = text.replace(\"&\", \"&amp;\").replace(\"<\", \"&lt;\").replaceAll(","369","\t\t\t\t\"\\\\b(https?:\/\/[^\\\\s)>]+)\", \"<a href=\\\"$1\\\">$1<\/a>\");","370","\t\t","371","\t\tfor (TestAction action: getTestActions()) {","372","\t\t\ttext = action.annotate(text);","373","\t\t}","374","\t\t","375","\t\treturn text;","376","\t}","379","        return getSuiteResult().getParent().getOwner();"],"delete":["3"," * Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi, Daniel Dyer, Seiji Sogabe","26","import org.dom4j.Element;","27","import org.kohsuke.stapler.export.Exported;","29","import java.util.Comparator;","272","        return getParent().getStdout();","284","        return getParent().getStderr();","328","    public SuiteResult getParent() {","333","        return parent.getParent().getOwner();"]}],"test\/src\/test\/resources\/hudson\/tasks\/junit\/JUnitResultArchiverTest.zip":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/tasks\/junit\/PackageResult.java":[{"add":["3"," * Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi, Daniel Dyer, id:cactusman, Tom Huybrechts","59","    ","60","    public TestResult getParent() {","61","    \treturn parent;","62","    }","79","    @Override","80","    public PackageResult getResultInBuild(AbstractBuild<?, ?> build) {","81","        TestResult tr = parent.getResultInBuild(build);","82","        if(tr==null)    return null;","83","        return tr.byPackage(getName());","84","    }","85","","114","    public Object getDynamic(String name, StaplerRequest req, StaplerResponse rsp) {","115","        ClassResult result = getClassResult(name);","116","        if (result != null) {","117","        \treturn result;","118","        } else {","119","        \treturn super.getDynamic(name, req, rsp);","120","        }","123","\tpublic ClassResult getClassResult(String name) {","124","\t\treturn classes.get(name);","125","\t}","126","","146","        ClassResult c = getClassResult(sn);"],"delete":["3"," * Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi, Daniel Dyer, id:cactusman","69","    public AbstractBuild<?,?> getOwner() {","70","        return parent.getOwner();","71","    }","72","","107","    public ClassResult getDynamic(String name, StaplerRequest req, StaplerResponse rsp) {","108","        return classes.get(name);","130","        ClassResult c = classes.get(sn);"]}],"core\/src\/main\/resources\/hudson\/tasks\/test\/MatrixTestResult\/index.jelly":[{"add":["3","Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi, Red Hat, Inc., Tom Huybrechts","43","              <a href=\"..\/${report.child.project.shortUrl}\/testReport\">${report.child.project.name}<\/a>","75","            <a href=\"..\/${report.child.project.shortUrl}\/testReport\">${report.child.project.name}<\/a>","89","\t\t          \t<st:nbsp\/>","90","\t\t\t        <j:forEach var=\"badge\" items=\"${f.testActions}\">","91","\t\t\t          <st:include it=\"${badge}\" page=\"badge.jelly\" optional=\"true\"\/>","92","\t\t\t        <\/j:forEach>"],"delete":["3","Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi, Red Hat, Inc.","43","              <a href=\"..\/${report.child.project.shortUrl}\">${report.child.project.name}<\/a>","75","            <a href=\"..\/${report.child.project.shortUrl}\">${report.child.project.name}<\/a>"]}],"core\/src\/main\/resources\/hudson\/tasks\/junit\/MetaTabulatedResult\/body.jelly":[{"add":["3","Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi, id:cactusman, Tom Huybrechts","25","","26","\t<script type=\"text\/javascript\">","27","\t\t<!-- TODO make sure load doesn't happen every time -->","28","\t\tfunction showStackTrace(id,query) {","29","\t\t\tvar element = document.getElementById(id)","30","\t\t\telement.style.display = \"\";","31","\t\t\tdocument.getElementById(id + \"-showlink\").style.display = \"none\";","32","\t\t\tdocument.getElementById(id + \"-hidelink\").style.display = \"\";","33","\t\t\t","34","\t\t\tvar rqo = new XMLHttpRequest();","35","\t\t\trqo.open('GET', query, true);","36","\t\t\trqo.onreadystatechange = function() { element.innerHTML = rqo.responseText; }  ","37","\t\t\trqo.send(null);","38","\t\t}","39","\t\t","40","\t\tfunction hideStackTrace(id) {","41","\t\t\tdocument.getElementById(id).style.display = \"none\";","42","\t\t\tdocument.getElementById(id + \"-showlink\").style.display = \"\";","43","\t\t\tdocument.getElementById(id + \"-hidelink\").style.display = \"none\";","44","\t\t}","45","  <\/script>","46","","53","        <td class=\"pane-header\" style=\"width:3em\">${%Age}<\/td>","58","\t\t\t<a id=\"test-${f.fullName}-showlink\" href=\"#\"","59","\t\t\t\tonclick='javascript:showStackTrace(\"test-${f.fullName}\",\"${f.getRelativePathFrom(it)}\/summary\")'>&gt;&gt;&gt;<\/a>","60","\t\t\t<a id=\"test-${f.fullName}-hidelink\" href=\"#\" style=\"display:none\"","61","\t\t\t\tonclick='javascript:hideStackTrace(\"test-${f.fullName}\")'>&lt;&lt;&lt;<\/a>","62","          \t<st:nbsp\/>","64","          \t<st:nbsp\/>","65","\t        <j:forEach var=\"badge\" items=\"${f.testActions}\">","66","\t          <st:include it=\"${badge}\" page=\"badge.jelly\" optional=\"true\"\/>","67","\t        <\/j:forEach>","68","\t\t\t<div id=\"test-${f.fullName}\" class=\"hidden\" style=\"display:none\">","69","\t\t\t${%Loading...}","70","\t\t\t<\/div>","72","          ","77","            <a href=\"${rootUrl}\/${f.failedSinceRun.url}\">${f.age}<\/a>","92","        <td class=\"pane-header\" style=\"width:5em\">${%Skip}<\/td>","93","        <td class=\"pane-header\" style=\"width:1em; font-size:smaller; white-space:nowrap;\">(${%diff})<\/td>","101","            <td class=\"pane\">","102","\t            <a href=\"${p.safeName}\/\"><span style='${prev==null?\"font-weight:bold\":\"\"}'>${p.name}<\/span><\/a>","103","\t          \t<st:nbsp\/>","104","\t\t        <j:forEach var=\"badge\" items=\"${p.testActions}\">","105","\t\t          <st:include it=\"${badge}\" page=\"badge.jelly\" optional=\"true\"\/>","106","\t\t        <\/j:forEach>","107","            <\/td>","113","            <td class=\"pane\" style=\"text-align:right\">${p.skipCount}<\/td>","114","            <td class=\"pane\" style=\"text-align:right\">","115","              ${h.getDiffString2(p.skipCount-prev.skipCount)}","116","            <\/td>"],"delete":["3","Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi, id:cactusman","31","        <td class=\"pane-header\" style=\"width:4em\">${%Age}<\/td>","42","            ${f.age}","64","            <td class=\"pane\"><a href=\"${p.safeName}\/\">${p.name}<\/a><\/td>"]}],"core\/src\/main\/resources\/hudson\/tasks\/junit\/JUnitResultArchiver\/config.jelly":[{"add":["3","Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi, Tom Huybrechts","24","<j:jelly xmlns:j=\"jelly:core\" xmlns:st=\"jelly:stapler\" xmlns:d=\"jelly:define\"","25","\txmlns:l=\"\/lib\/layout\" xmlns:t=\"\/lib\/hudson\" xmlns:f=\"\/lib\/form\">","26","\t<f:entry title=\"${%Test report XMLs}\" description=\"${%description}\"","27","\t\tfield=\"testResults\">","28","\t\t<f:textbox \/>","29","\t<\/f:entry>","30","\t<j:invokeStatic var=\"testDataPublisherDescriptors\"","31","\t\tclassName=\"hudson.tasks.junit.TestDataPublisher\" method=\"all\" \/>","32","\t<j:if test=\"${testDataPublisherDescriptors.size() > 0}\">","33","\t<f:entry title=\"Additional test report features\" field=\"testDataPublishers\">","34","\t\t<j:set var=\"testDataPublisherInstances\" value=\"${instance.testDataPublishers}\"\/>","35","\t\t<table>","36","\t\t\t<j:forEach var=\"tdpd\" items=\"${testDataPublisherDescriptors}\">","37","\t\t\t\t<f:optionalBlock name=\"${tdpd.jsonSafeClassName}\" help=\"${tdpd.helpFile}\"","38","\t\t\t\t\ttitle=\"${tdpd.displayName}\" checked=\"${testDataPublisherInstances.get(tdpd)!=null}\">","39","\t\t\t\t\t<j:set var=\"descriptor\" value=\"${tdpd}\" \/>","40","\t\t\t\t\t<j:set var=\"instance\" value=\"${testDataPublisherInstances.get(tdpd)}\" \/>","41","\t\t\t\t\t<st:include from=\"${tdpd}\" page=\"${tdpd.configPage}\" optional=\"true\" \/>","42","\t\t\t\t<\/f:optionalBlock>","43","\t\t\t<\/j:forEach>","44","\t\t<\/table>","45","\t<\/f:entry>","46","\t<\/j:if>"],"delete":["3","Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi","24","<j:jelly xmlns:j=\"jelly:core\" xmlns:st=\"jelly:stapler\" xmlns:d=\"jelly:define\" xmlns:l=\"\/lib\/layout\" xmlns:t=\"\/lib\/hudson\" xmlns:f=\"\/lib\/form\">","25","  <f:entry title=\"${%Test report XMLs}\" description=\"${%description}\" field=\"testResults\">","26","    <f:textbox \/>","27","  <\/f:entry>"]}],"core\/src\/main\/resources\/hudson\/tasks\/junit\/TabulatedResult\/index.jelly":[{"add":["3","Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi, Tom Huybrechts","26","    <st:include page=\"sidepanel.jelly\" \/>","34","        <div style=\"text-align:right;\">","35","        <a href=\"history\">","36","          Took ${it.durationString} ","37","        <\/a>","38","        <\/div>","39","","40","      <t:editableDescription permission=\"${it.owner.BUILD}\"\/>","41","","42","      <table style=\"margin-top: 1em; margin-left:0em;\">","43","\t  <j:forEach var=\"action\" items=\"${it.testActions}\">","44","          <st:include page=\"summary.jelly\" from=\"${action}\" optional=\"true\" it=\"${action}\" \/>","45","\t  <\/j:forEach>","46","\t  <\/table>","47",""],"delete":["3","Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi","26","    <st:include it=\"${it.owner}\" page=\"sidepanel.jelly\" \/>"]}],"core\/src\/main\/java\/hudson\/tasks\/junit\/TestDataPublisher.java":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/tasks\/junit\/SuiteResult.java":[{"add":["3"," * Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi, Erik Ramfelt, Xavier Le Vourch, Tom Huybrechts","25","import java.io.File;","26","import java.io.Serializable;","27","import java.util.ArrayList;","28","import java.util.HashSet;","29","import java.util.List;","30","import java.util.Set;","31","","54","\tprivate final String file;","75","        this.file = null;","108","    \tthis.file = xmlReport.getAbsolutePath();","190","    ","191","    \/**","192","     * The absolute path to the original test report. OS-dependent.","193","     *\/","194","    public String getFile() {","195","\t\treturn file;","196","\t}","198","\tpublic TestResult getParent() {","232","    ","233","\tpublic Set<String> getClassNames() {","234","\t\tSet<String> result = new HashSet<String>();","235","\t\tfor (CaseResult c : cases) {","236","\t\t\tresult.add(c.getClassName());","237","\t\t}","238","\t\treturn result;","239","\t}"],"delete":["3"," * Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi, Erik Ramfelt, Xavier Le Vourch","32","import java.io.File;","33","import java.io.Serializable;","34","import java.util.ArrayList;","35","import java.util.List;","36","","186","    public TestResult getParent() {"]}],"core\/src\/main\/resources\/hudson\/model\/AbstractBuild\/tasks.jelly":[{"add":[],"delete":[]}]}},"d6f72a3b6bf720f341ad09788c7cafa10b4203fe":{"changes":{"test\/src\/test\/java\/hudson\/util\/AlternativeUiTextProviderTest.java":"MODIFY"},"diff":{"test\/src\/test\/java\/hudson\/util\/AlternativeUiTextProviderTest.java":[{"add":["34","import org.jvnet.hudson.test.Issue;","75","    @Issue(\"JENKINS-41757\")"],"delete":[]}]}},"44e6b5d76211bc40e1a608ae3aa93c083befaeba":{"changes":{"core\/src\/main\/resources\/hudson\/widgets\/BuildHistoryWidget\/entries.jelly":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/widgets\/BuildHistoryWidget\/entries.jelly":[{"add":["42","            <div class=\"display-name\" title=\"${%Expected build number}\">","57","          <j:if test=\"${!item.params.isEmpty()}\">","58","            <div style=\"float:right;margin-right:10px;\">","59","              <a href=\"#\" tooltip=\"Build Parameters:${h.escape(item.params)}\"><l:icon class=\"icon-notepad icon-sm\" \/><\/a>","60","            <\/div>","61","          <\/j:if>"],"delete":["42","            <div class=\"display-name\">","57","            ${item.params}"]}]}},"adf8305f8b128c856a6de33409595fe14e01fd73":{"changes":{"core\/src\/main\/java\/jenkins\/model\/Jenkins.java":"MODIFY"},"diff":{"core\/src\/main\/java\/jenkins\/model\/Jenkins.java":[{"add":["2951","            long waitUntil = timeout;","2952","            if (timeout > 0) waitUntil += System.currentTimeMillis();","2954","                   && (timeout <= 0 || System.currentTimeMillis() < waitUntil)"],"delete":["2951","            if (timeout > 0) timeout += System.currentTimeMillis();","2953","                   && (timeout <= 0 || System.currentTimeMillis() < timeout)"]}]}},"707d4ba135ec9e3e6a681f1acb4e243e2b5aa9b6":{"changes":{"core\/src\/test\/java\/jenkins\/model\/JDKNameTest.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/JDK.java":"MODIFY"},"diff":{"core\/src\/test\/java\/jenkins\/model\/JDKNameTest.java":[{"add":["38","    public void nullIsDefaultName() {","39","        assertThat(JDK.isDefaultName(null), is(true));"],"delete":["38","    public void nullIsNotDefaultName() {","39","        assertThat(JDK.isDefaultName(null), is(false));"]}],"core\/src\/main\/java\/hudson\/model\/JDK.java":[{"add":["69","        return DEFAULT_NAME.equals(name) || name == null;"],"delete":["69","        return DEFAULT_NAME.equals(name);"]}]}},"b6e4fb4b821eb623993914ecd3c24f8d934802f3":{"changes":{"pom.xml":"MODIFY"},"diff":{"pom.xml":[{"add":["178","        <version>3.7<\/version>"],"delete":["178","        <version>3.5<\/version>"]}]}},"e31f8dc2d361990194cb559395c55866092b35cb":{"changes":{"core\/src\/main\/java\/hudson\/model\/View.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/AbstractProject.java":"MODIFY","test\/src\/test\/java\/hudson\/model\/ViewTest.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/View.java":[{"add":["450","            if (l != null && l.contains(node))"],"delete":["450","            if (l.contains(node))"]}],"core\/src\/main\/java\/hudson\/model\/AbstractProject.java":[{"add":["403","    public @CheckForNull Label getAssignedLabel() {"],"delete":["403","    public Label getAssignedLabel() {"]}],"test\/src\/test\/java\/hudson\/model\/ViewTest.java":[{"add":["40","import hudson.model.Node.Mode;","46","import hudson.slaves.DumbSlave;","305","    @Test","306","    @Bug(21474)","307","    public void testGetComputersNPE() throws Exception {","308","        ListView view = listView(\"aView\");","309","        view.filterExecutors = true;","310","","311","        DumbSlave dedicatedSlave = j.createOnlineSlave();","312","        dedicatedSlave.setMode(Mode.EXCLUSIVE);","313","        view.add(j.createFreeStyleProject());","314","","315","        FreeStyleProject tiedJob = j.createFreeStyleProject();","316","        tiedJob.setAssignedNode(dedicatedSlave);","317","        view.add(tiedJob);","318","","319","        DumbSlave notIncludedSlave = j.createOnlineSlave();","320","        notIncludedSlave.setMode(Mode.EXCLUSIVE);","321","","322","        assertContainsNodes(view, j.jenkins, dedicatedSlave);","323","        assertNotContainsNodes(view, notIncludedSlave);","324","    }","325",""],"delete":[]}]}},"05ae0809cccaa1ea714a5b8685e7d996e0e9b3a5":{"changes":{"debian\/debian\/jenkins.postinst":"MODIFY"},"diff":{"debian\/debian\/jenkins.postinst":[{"add":["27","        # Create jenkins group and user if they don't exist.","30","        if ! getent group \"$JENKINS_GROUP\" > \/dev\/null; then","31","            addgroup --system --quiet \"$JENKINS_GROUP\"","32","        fi","33","        if ! id \"$JENKINS_USER\" >\/dev\/null 2>&1 ; then","34","            adduser --system --quiet --home \/var\/lib\/jenkins --no-create-home \\","35","                --ingroup \"$JENKINS_GROUP\" --disabled-password --shell \/bin\/bash \\","36","                --gecos 'Jenkins' \\","37","                \"$JENKINS_USER\"","38","        fi","39",""],"delete":["27","        # Create jenkins user if it doesn't exist.","30","        addgroup --system --quiet $JENKINS_GROUP","31","        adduser --system --quiet --home \/var\/lib\/jenkins --no-create-home \\","32","            --ingroup $JENKINS_GROUP --disabled-password --shell \/bin\/bash \\","33","            --gecos 'Jenkins' \\","34","            $JENKINS_USER","35","\t"]}]}},"9f1796e3ea8034e4a45d63e706b1c087b8f7f2e8":{"changes":{"core\/src\/main\/java\/hudson\/cli\/CLIAction.java":"MODIFY","changelog.html":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/cli\/CLIAction.java":[{"add":["33","import hudson.util.IOException2;","38","import org.kohsuke.stapler.HttpResponses.HttpResponseException;","39","import org.kohsuke.stapler.Stapler;","40","import org.kohsuke.stapler.StaplerProxy;","50"," * Shows usage of CLI and commands.","51"," *","56","public class CLIAction implements RootAction, StaplerProxy {","89","    @Override","90","    public Object getTarget() {","91","        StaplerRequest req = Stapler.getCurrentRequest();","92","        if (req.getRestOfPath().length()==0 && \"POST\".equals(req.getMethod())) {","93","            \/\/ CLI connection request","94","            throw new CliEndpointResponse();","96","            return this;","97","        }","98","    }","99","","100","    \/**","101","     * Serves CLI-over-HTTP response.","102","     *\/","103","    private class CliEndpointResponse extends HttpResponseException {","104","        @Override","105","        public void generateResponse(StaplerRequest req, StaplerResponse rsp, Object node) throws IOException, ServletException {","106","            try {","107","                \/\/ do not require any permission to establish a CLI connection","108","                \/\/ the actual authentication for the connecting Channel is done by CLICommand","109","","110","                UUID uuid = UUID.fromString(req.getHeader(\"Session\"));","111","                rsp.setHeader(\"Hudson-Duplex\",\"\"); \/\/ set the header so that the client would know","112","","113","                FullDuplexHttpChannel server;","114","                if(req.getHeader(\"Side\").equals(\"download\")) {","115","                    duplexChannels.put(uuid,server=new FullDuplexHttpChannel(uuid, !Jenkins.getInstance().hasPermission(Jenkins.ADMINISTER)) {","116","                        @Override","117","                        protected void main(Channel channel) throws IOException, InterruptedException {","118","                            \/\/ capture the identity given by the transport, since this can be useful for SecurityRealm.createCliAuthenticator()","119","                            channel.setProperty(CLICommand.TRANSPORT_AUTHENTICATION, Jenkins.getAuthentication());","120","                            channel.setProperty(CliEntryPoint.class.getName(),new CliManagerImpl(channel));","121","                        }","122","                    });","123","                    try {","124","                        server.download(req,rsp);","125","                    } finally {","126","                        duplexChannels.remove(uuid);","127","                    }","128","                } else {","129","                    duplexChannels.get(uuid).upload(req,rsp);","130","                }","131","            } catch (InterruptedException e) {","132","                throw new IOException2(e);","133","            }"],"delete":["50","public class CLIAction implements RootAction {","64","","84","    \/**","85","     * Handles HTTP requests for duplex channels for CLI.","86","     *\/","87","    public void doIndex(StaplerRequest req, StaplerResponse rsp) throws IOException, ServletException, InterruptedException {","88","        final Jenkins jenkins = Jenkins.getInstance();","89","        if (!\"POST\".equals(req.getMethod())) {","90","            \/\/ for GET request, serve _cli.jelly, assuming this is a browser","91","            jenkins.checkPermission(Jenkins.READ);","92","            req.setAttribute(\"command\", CLICommand.clone(\"help\"));","93","            req.getView(this,\"index.jelly\").forward(req,rsp);","94","            return;","95","        }","96","","97","        \/\/ do not require any permission to establish a CLI connection","98","        \/\/ the actual authentication for the connecting Channel is done by CLICommand","99","","100","        UUID uuid = UUID.fromString(req.getHeader(\"Session\"));","101","        rsp.setHeader(\"Hudson-Duplex\",\"\"); \/\/ set the header so that the client would know","102","","103","        FullDuplexHttpChannel server;","104","        if(req.getHeader(\"Side\").equals(\"download\")) {","105","            duplexChannels.put(uuid,server=new FullDuplexHttpChannel(uuid, !jenkins.hasPermission(Jenkins.ADMINISTER)) {","106","                @Override","107","                protected void main(Channel channel) throws IOException, InterruptedException {","108","                    \/\/ capture the identity given by the transport, since this can be useful for SecurityRealm.createCliAuthenticator()","109","                    channel.setProperty(CLICommand.TRANSPORT_AUTHENTICATION, Jenkins.getAuthentication());","110","                    channel.setProperty(CliEntryPoint.class.getName(),new CliManagerImpl(channel));","111","                }","112","            });","113","            try {","114","                server.download(req,rsp);","115","            } finally {","116","                duplexChannels.remove(uuid);","117","            }","119","            duplexChannels.get(uuid).upload(req,rsp);"]}],"changelog.html":[{"add":["58","    CLI over HTTP was not working since 1.535.","59","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-20128\">issue 20128<\/a>)","60","  <li class=bug>"],"delete":[]}]}},"211b57e8b002b4da92743dfac3a1b902835e7652":{"changes":{"test\/src\/test\/java\/hudson\/model\/MyViewsPropertyTest.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/MyViewsProperty.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/ViewGroupMixIn.java":"MODIFY"},"diff":{"test\/src\/test\/java\/hudson\/model\/MyViewsPropertyTest.java":[{"add":["35","import org.jvnet.hudson.test.Issue;","291","","292","    @Test","293","    @Issue(\"JENKINS-48157\")","294","    public void shouldNotFailWhenMigratingLegacyViewsWithoutPrimaryOne() throws IOException {","295","        rule.jenkins.setSecurityRealm(rule.createDummySecurityRealm());","296","        User user = User.get(\"User\");","297","","298","        \/\/ Emulates creation of a new object with Reflection in User#load() does.","299","        MyViewsProperty property = new MyViewsProperty(null);","300","        user.addProperty(property);","301","","302","        \/\/ At AllView with non-default to invoke NPE path in AllView.migrateLegacyPrimaryAllViewLocalizedName()","303","        property.addView(new AllView(\"foobar\"));","304","        property.readResolve();","305","    }"],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/MyViewsProperty.java":[{"add":["41","import javax.annotation.CheckForNull;","64","","65","    \/**","66","     * Name of the primary view defined by the user.","67","     * {@code null} means that the View is not defined.","68","     *\/","69","    @CheckForNull","80","    public MyViewsProperty(@CheckForNull String primaryViewName) {","82","        readResolve(); \/\/ initialize fields","86","        this(null);","98","        if (primaryViewName != null) {","99","            \/\/ It may happen when the default constructor is invoked","100","            primaryViewName = AllView.migrateLegacyPrimaryAllViewLocalizedName(views, primaryViewName);","101","        }","112","    @CheckForNull","117","    \/**","118","     * Sets the primary view.","119","     * @param primaryViewName Name of the primary view to be set.","120","     *                        {@code null} to make the primary view undefined.","121","     *\/","122","    public void setPrimaryViewName(@CheckForNull String primaryViewName) {"],"delete":["73","    public MyViewsProperty(String primaryViewName) {","78","        readResolve();","90","        primaryViewName = AllView.migrateLegacyPrimaryAllViewLocalizedName(views, primaryViewName);","105","    public void setPrimaryViewName(String primaryViewName) {"]}],"core\/src\/main\/java\/hudson\/model\/ViewGroupMixIn.java":[{"add":["38","import javax.annotation.Nonnull;","69","     * Returns all views in the group. This list must be modifiable and concurrently iterable.","71","    @Nonnull","73","","74","    \/**","75","     * Gets primary view of the mix-in.","76","     * @return Name of the primary view, {@code null} if there is no primary one defined.","77","     *\/","78","    @CheckForNull","80","","81","    \/**","82","     * Sets the primary view.","83","     * @param newName Name of the primary view to be set.","84","     *                {@code null} to make the primary view undefined.","85","     *\/","92","    public void addView(@Nonnull View v) throws IOException {","98","    public boolean canDelete(@Nonnull View view) {","102","    public synchronized void deleteView(@Nonnull View view) throws IOException {","117","        if (name == null) {","118","            return null;","119","        }","124","        if (!name.equals(primaryView())) {"],"delete":["68","     * Returns all the views. This list must be concurrently iterable.","78","    public void addView(View v) throws IOException {","84","    public boolean canDelete(View view) {","88","    public synchronized void deleteView(View view) throws IOException {","107","        if (name != null && !name.equals(primaryView())) {"]}]}},"478d11e84d264cc84b5a90c62ac86392190d61bf":{"changes":{"CONTRIBUTING.md":"MODIFY",".github\/PULL_REQUEST_TEMPLATE.md":"MODIFY","docs\/MAINTAINERS.adoc":"ADD","README.md":"MODIFY"},"diff":{"CONTRIBUTING.md":[{"add":["109","  * If you do not get feedback after 3 days, feel free to ping `@jenkinsci\/core-pr-reviewers` in the comments.","110","  * Usually we merge pull requests after 2 approvals from reviewers, no requested changes, and having waited some more time to give others an opportunity to provide more feedback.","111","    See [this page](\/docs\/MAINTAINERS.adoc) for more information about our review process"],"delete":["109","  * If you do not get feedback after 3 days, feel free to ping `@jenkinsci\/code-reviewers` to CC.","110","  * Usually we merge pull requests after 2 votes from reviewers or after 1 vote and 1-week delay without extra reviews."]}],".github\/PULL_REQUEST_TEMPLATE.md":[{"add":["29","- [ ] (If applicable) Jira issue is well described","54","- [ ] If it would make sense to backport the change to LTS, a Jira issue must exist, be a _Bug_ or _Improvement_, and be labeled as `lts-candidate` to be considered (see [query](https:\/\/issues.jenkins-ci.org\/issues\/?filter=12146))."],"delete":["29","- [ ] JIRA issue is well described","54","- [ ] If it would make sense to backport the change to LTS, a JIRA issue should exist and be labeled as `lts-candidate`","55",""]}],"docs\/MAINTAINERS.adoc":[{"add":[],"delete":[]}],"README.md":[{"add":["30","Follow the [contributing guidelines](CONTRIBUTING.md) if you want to propose a change in the Jenkins core."],"delete":["30","Follow the [contributing](CONTRIBUTING.md) file.","45","[wiki]: https:\/\/wiki.jenkins-ci.org"]}]}},"6276c7402ea0d4c3dff30a44474aa4b38f2eed63":{"changes":{"core\/src\/main\/java\/hudson\/maven\/MavenModule.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/maven\/MavenModule.java":[{"add":["244","        \/\/ in case two modules with the same name is defined, modules in this MavenModuleSet","245","        \/\/ takes precedence","246","","247","        for (MavenModule m : getParent().getModules()) {","248","            if(m.isDisabled())  continue;","249","            modules.put(m.getModuleName(),m);","250","        }","251",""],"delete":[]}]}},"aefd3fc8b3b1a8c5449664c1f9b88d14f4d0e8da":{"changes":{"core\/src\/main\/java\/hudson\/model\/AbstractItem.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/AbstractItem.java":[{"add":["107","    public void setDescription(String description) throws IOException {","109","        save();"],"delete":["107","    public void setDescription(String description) {","238","        save();"]}]}},"a713bc0d95d6bcff0b163fca9c5cec5a494a2bfa":{"changes":{"test\/src\/test\/java\/hudson\/console\/HyperlinkNoteTest.java":"ADD","core\/src\/main\/java\/hudson\/console\/HyperlinkNote.java":"MODIFY","core\/src\/main\/java\/hudson\/console\/ModelHyperlinkNote.java":"MODIFY"},"diff":{"test\/src\/test\/java\/hudson\/console\/HyperlinkNoteTest.java":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/console\/HyperlinkNote.java":[{"add":["29","import org.kohsuke.accmod.Restricted;","30","import org.kohsuke.accmod.restrictions.NoExternalUse;","35","import java.util.function.BiFunction;","80","        return encodeTo(url, text, HyperlinkNote::new);","81","    }","82","","83","    @Restricted(NoExternalUse.class)","84","    static String encodeTo(String url, String text, BiFunction<String, Integer, ConsoleNote> constructor) {","85","        \/\/ If text contains newlines, then its stored length will not match its length when being","86","        \/\/ displayed, since the display length will only include text up to the first newline,","87","        \/\/ which will cause an IndexOutOfBoundsException in MarkupText#rangeCheck when","88","        \/\/ ConsoleAnnotationOutputStream converts the note into markup. That stream treats '\\n' as","89","        \/\/ the sole end-of-line marker on all platforms, so we ignore '\\r' because it will not","90","        \/\/ break the conversion.","91","        text = text.replace('\\n', ' ');","93","            return constructor.apply(url,text.length()).encode()+text;"],"delete":["78","            return new HyperlinkNote(url,text.length()).encode()+text;"]}],"core\/src\/main\/java\/hudson\/console\/ModelHyperlinkNote.java":[{"add":["57","        return HyperlinkNote.encodeTo(url, text, ModelHyperlinkNote::new);"],"delete":["7","import java.io.IOException;","8","import java.util.logging.Level;","59","        try {","60","            return new ModelHyperlinkNote(url,text.length()).encode()+text;","61","        } catch (IOException e) {","62","            \/\/ impossible, but don't make this a fatal problem","63","            LOGGER.log(Level.WARNING, \"Failed to serialize \"+ModelHyperlinkNote.class,e);","64","            return text;","65","        }"]}]}},"a016f3da07958202b13dd247dcac6766ea03a2aa":{"changes":{"core\/src\/main\/java\/hudson\/Util.java":"MODIFY","core\/src\/main\/java\/hudson\/util\/jna\/Kernel32Utils.java":"MODIFY","changelog.html":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/Util.java":[{"add":["1067","                } catch (UnsatisfiedLinkError e) {","1068","                    \/\/ not available on this Windows","1069","                    return;"],"delete":[]}],"core\/src\/main\/java\/hudson\/util\/jna\/Kernel32Utils.java":[{"add":["82","     * @throws UnsatisfiedLinkError","83","     *      If the function is not exported by kernel32.","84","     *      See http:\/\/msdn.microsoft.com\/en-us\/library\/windows\/desktop\/aa363866(v=vs.85).aspx","85","     *      for compatibility info."],"delete":[]}],"changelog.html":[{"add":["66","    <tt>UnsatisfiedLinkError<\/tt> on <tt>CreateSymbolicLinkw<\/tt> on Windows XP.","67","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-17343\">issue 17343<\/a>)","68","  <li class=bug>"],"delete":[]}]}},"24408ed660d3e36fa9e31fec93d6d767042e77d7":{"changes":{"core\/src\/main\/java\/hudson\/model\/Hudson.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/Hudson.java":[{"add":["2475","    public HttpRedirect doQuietDown(","2478","        synchronized (this) {","2479","            checkPermission(ADMINISTER);","2480","            isQuietingDown = true;","2481","        }","2483","            if (timeout > 0) timeout += System.currentTimeMillis();","2484","            while (isQuietingDown","2485","                   && (overallLoad.computeTotalExecutors() > overallLoad.computeIdleExecutors())","2486","                   && (timeout <= 0 || System.currentTimeMillis() < timeout)) {"],"delete":["2475","    public synchronized HttpRedirect doQuietDown(","2478","        checkPermission(ADMINISTER);","2479","        isQuietingDown = true;","2481","            LOGGER.info(\"Entering the blocking quiet down mode\");","2482","            long start = System.currentTimeMillis();","2483","            int cnt=0;","2484","            while (true) {","2485","                if (!isQuietingDown) {","2486","                    LOGGER.info(\"Quiet mode cancelled\");","2487","                    break;","2488","                }","2489","                if (overallLoad.computeTotalExecutors() <= overallLoad.computeIdleExecutors()) {\/\/ should be really == but be defensive","2490","                    LOGGER.info(\"System became fully quiet\");","2491","                    break;","2492","                }","2493","                if (timeout>0 && start+timeout<=System.currentTimeMillis()) {","2494","                    LOGGER.info(\"Quiet mode time out after \"+timeout+\"ms\");","2495","                    break;","2496","                }","2497","","2499","                if (((cnt++)%60)==0)","2500","                    LOGGER.info(\"Waiting for all the jobs to finish. Total=\"+overallLoad.computeTotalExecutors()+\" idle=\"+overallLoad.computeIdleExecutors());"]}]}},"ef08900292726bb35be269ce6d41d8dc141c6dea":{"changes":{"core\/src\/main\/java\/hudson\/model\/AbstractProject.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/AbstractProject.java":[{"add":["301","            Item current;","302","            try {","303","                current = parent.getItem(name);","304","            } catch (RuntimeException x) {","305","                LOGGER.log(Level.WARNING, \"failed to look up \" + name + \" in \" + parent, x);","306","                current = null;","307","            }"],"delete":["301","            Item current = parent.getItem(name);"]}]}},"67c13dab316130468f101a300a3f0f388b8d6736":{"changes":{"changelog.html":"MODIFY"},"diff":{"changelog.html":[{"add":["78","  <li class=\"bug\">","79","    Fix the footer behavior in particular cases.  ","80","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-30304\">issue 30304<\/a>, ","81","    <a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-31395\">issue 31395<\/a>)"],"delete":[]}]}},"c0742b8bff9fe407e568da7ed860f30d9ea8aedc":{"changes":{"core\/src\/main\/java\/jenkins\/model\/PeepholePermalink.java":"MODIFY"},"diff":{"core\/src\/main\/java\/jenkins\/model\/PeepholePermalink.java":[{"add":["169","        Util.createSymlink(cache.getParentFile(),target,cache.getName(),listener);","170","        \/\/ Avoid calling resolveSymlink on a nonexistent file as it will probably throw an IOException:","171","        if (!exists(cache) || Util.resolveSymlink(cache)==null) {","172","          \/\/ symlink not supported. use a regular file","173","          AtomicFileWriter cw = new AtomicFileWriter(cache);","174","          try {","175","              cw.write(target);","176","              cw.commit();","177","          } finally {","178","              cw.abort();","179","          }"],"delete":["169","        File tmp = new File(cache.getPath()+\".tmp\");","170","        try {","171","            Util.createSymlink(tmp.getParentFile(),target,tmp.getName(),listener);","172","            \/\/ Avoid calling resolveSymlink on a nonexistent file as it will probably throw an IOException:","173","            if (!exists(tmp) || Util.resolveSymlink(tmp)==null) {","174","                \/\/ symlink not supported. use a regular file","175","                AtomicFileWriter cw = new AtomicFileWriter(cache);","176","                try {","177","                    cw.write(target);","178","                    cw.commit();","179","                } finally {","180","                    cw.abort();","181","                }","182","            } else {","183","                cache.delete();","184","                tmp.renameTo(cache);","185","            }","186","        } finally {","187","            tmp.delete();"]}]}},"09f9010efd6811a14abe834f00b87dd3260147ef":{"changes":{"war\/pom.xml":"MODIFY"},"diff":{"war\/pom.xml":[{"add":["101","      <version>5.9<\/version>"],"delete":["101","      <version>5.8<\/version>"]}]}},"5fdf33ba9b7382db3a8c833a94436b87eeb87bb6":{"changes":{"core\/src\/main\/java\/hudson\/util\/io\/TarArchiver.java":"MODIFY","core\/src\/test\/java\/hudson\/util\/io\/TarArchiverTest.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/util\/io\/TarArchiver.java":[{"add":["35","","38","import org.apache.commons.compress.archivers.tar.TarConstants;","39","import org.apache.commons.compress.utils.BoundedInputStream;","59","        TarArchiveEntry e = new TarArchiveEntry(relativePath, TarConstants.LF_SYMLINK);","91","        long size = 0;","94","            size = file.length();","95","            te.setSize(size);","97","        tar.putArchiveEntry(te);","98","        try {","99","            if (!file.isDirectory()) {","100","                \/\/ ensure we don't write more bytes than the declared when we created the entry","101","                ","102","                try (FileInputStream fin = new FileInputStream(file);","103","                     BoundedInputStream in = new BoundedInputStream(fin, size)) {","104","                    int len;","105","                    while ((len = in.read(buf)) >= 0) {","106","                        tar.write(buf, 0, len);","107","                    }","108","                } catch (IOException e) {\/\/ log the exception in any case","109","                    IOException ioE = new IOException(\"Error writing to tar file from: \" + file, e);","110","                    throw ioE;","111","                }","112","            }","113","        } finally { \/\/ always close the entry","114","            tar.closeArchiveEntry();","115","        }"],"delete":["38","import static org.apache.tools.tar.TarConstants.LF_SYMLINK;","57","        TarArchiveEntry e = new TarArchiveEntry(relativePath, LF_SYMLINK);","89","        if(!file.isDirectory())","90","            te.setSize(file.length());","91","","92","        tar.putArchiveEntry(te);","95","            FileInputStream in = new FileInputStream(file);","96","            try {","97","                int len;","98","                while((len=in.read(buf))>=0)","99","                    tar.write(buf,0,len);","100","            } finally {","101","                in.close();","102","            }","104","","105","        tar.closeArchiveEntry();"]}],"core\/src\/test\/java\/hudson\/util\/io\/TarArchiverTest.java":[{"add":["118","    ","119","    ","120","    \/**","121","     * Test backing up an open file","122","     *\/","123","    ","124","    @Issue(\"JENKINS-20187\")","125","    @Test public void growingFileTar() throws Exception {","126","        File file=new File(tmp.getRoot(),\"growing.file\");","127","        GrowingFileRunnable runnable1 = new GrowingFileRunnable(file);","128","        Thread t1 = new Thread(runnable1);","129","        t1.start();","130","","131","        new FilePath(tmp.getRoot()).tar(new NullStream(), \"**\");","132","        ","133","        runnable1.doFinish();","134","        t1.join();","135","    }","136","","137","    private class GrowingFileRunnable implements Runnable {","138","        private boolean finish = false;","139","        private Exception ex = null;","140","        private File file;","141","","142","        public GrowingFileRunnable(File file) {","143","            this.file = file;","144","        }","145","","146","        @Override","147","        public void run() {","148","            File openFile = file;","149","            try {","150","                openFile.createNewFile();","151","                FileOutputStream fos = new FileOutputStream(openFile);","152","                for (int i = 0; !finish && i < 5000000; i++) { \/\/ limit the max size, just in case.","153","                    fos.write(0);","154","                    \/\/ Thread.sleep(5);","155","                }","156","                fos.close();","157","            } catch (Exception e) {","158","                ex = e;","159","            }","160","        }","161","","162","        public void doFinish() throws Exception {","163","            finish = true;","164","            if (ex != null) {","165","                throw ex;","166","            }","167","        }","168","    };"],"delete":[]}]}},"47c254aa32ef8f846f07a0200dee5b4bf10571c1":{"changes":{"core\/pom.xml":"MODIFY"},"diff":{"core\/pom.xml":[{"add":["104","      <version>3.0.1<\/version>"],"delete":["104","      <version>3.0.0<\/version>","106","    <!-- TODO JENKINS-19192 try when released to Central:","107","    <dependency>","108","      <groupId>com.github.jnr<\/groupId>","109","      <artifactId>jnr-ffi<\/artifactId>","110","      <version>1.0.6<\/version>","111","    <\/dependency>","112","    -->"]}]}},"31b9a2f48dd849c83e2d376aa51f8c7c8c087341":{"changes":{"core\/src\/main\/java\/hudson\/model\/Hudson.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/Hudson.java":[{"add":["1733","        \/\/ If this view was the default view, change reference","1734","        if (oldName.equals(primaryView)) {","1735","            primaryView = newName;","1736","        }"],"delete":["1733","        \/\/ implementation of Hudson is immune to view name change."]}]}},"03b31a2361b4bc00cac6c1545ee8300fca5bd8a3":{"changes":{"changelog.html":"MODIFY","core\/src\/main\/java\/jenkins\/widgets\/RunListProgressiveRendering.java":"MODIFY"},"diff":{"changelog.html":[{"add":["57","  <li class=bug>","58","    <code>ConcurrentModificationException<\/code> in <code>RunListProgressiveRendering<\/code>.","59","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-21437\">issue 21437<\/a>)"],"delete":["57","  <li class=>"]}],"core\/src\/main\/java\/jenkins\/widgets\/RunListProgressiveRendering.java":[{"add":["65","            synchronized (this) {"],"delete":["65","            synchronized (results) {"]}]}},"972db2a593fc978b8fb16a8d14cf485b8679c6e2":{"changes":{"core\/src\/main\/java\/hudson\/tools\/DownloadFromUrlInstaller.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/tools\/DownloadFromUrlInstaller.java":[{"add":["124","            return new Downloadable(getId());","132","        public String getId() {","146","            JSONObject d = Downloadable.get(getId()).getData();"],"delete":["124","            return new Downloadable(getDownloadableId());","131","         * @since 1.610","133","        public String getDownloadableId() {","147","            JSONObject d = Downloadable.get(getDownloadableId()).getData();"]}]}},"5670006ddf7fd9ec0a1b719de8b76e594ae482e2":{"changes":{"war\/pom.xml":"MODIFY"},"diff":{"war\/pom.xml":[{"add":["132","                <resolveArtifact type=\"hpi\" groupId=\"org.jvnet.hudson.plugins\" artifactId=\"ssh-slaves\" version=\"0.12\" tofile=\"${basedir}\/target\/generated-resources\/WEB-INF\/plugins\/ssh-slaves.hpi\" \/>","134","                <resolveArtifact type=\"hpi\" groupId=\"org.jvnet.hudson.plugins\" artifactId=\"cvs\" version=\"1.2\" tofile=\"${basedir}\/target\/generated-resources\/WEB-INF\/plugins\/cvs.hpi\" \/>"],"delete":["132","                <resolveArtifact type=\"hpi\" groupId=\"org.jvnet.hudson.plugins\" artifactId=\"ssh-slaves\" version=\"0.10\" tofile=\"${basedir}\/target\/generated-resources\/WEB-INF\/plugins\/ssh-slaves.hpi\" \/>","134","                <resolveArtifact type=\"hpi\" groupId=\"org.jvnet.hudson.plugins\" artifactId=\"cvs\" version=\"1.1\" tofile=\"${basedir}\/target\/generated-resources\/WEB-INF\/plugins\/cvs.hpi\" \/>"]}]}},"5f06dfe852075e1daeac823352004c22a3cd2510":{"changes":{"core\/src\/main\/java\/hudson\/util\/spring\/BeanBuilder.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/util\/spring\/BeanBuilder.java":[{"add":["127","        if (script==null)","128","            throw new IllegalArgumentException(\"No script is provided\");"],"delete":[]}]}},"bdbac284723940e5b2dfd37dd194524305de29c2":{"changes":{"core\/src\/main\/java\/hudson\/model\/ListView.java":"MODIFY","changelog.html":"MODIFY","test\/src\/test\/java\/hudson\/model\/ListViewTest.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/ListView.java":[{"add":["188","        for (TopLevelItem item : items) {","190","                ItemGroup<? extends Item> ig = (ItemGroup<? extends Item>) item;","191","                expand(Util.filter(ig.getItems(), TopLevelItem.class), allItems);","193","            allItems.add(item);"],"delete":["188","        for (Item item : items) {","190","                ItemGroup<TopLevelItem> ig = (ItemGroup<TopLevelItem>) item;","191","                expand(ig.getItems(), allItems);","193","            if (item instanceof TopLevelItem) {","194","                allItems.add((TopLevelItem) item);","195","            }"]}],"changelog.html":[{"add":["71","  <li class=bug>","72","      <code>ClassCastException<\/code>s sometimes shown from views set to be recursive.","73","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-20415\">issue 20415<\/a>)"],"delete":[]}],"test\/src\/test\/java\/hudson\/model\/ListViewTest.java":[{"add":["42","import hudson.matrix.AxisList;","43","import hudson.matrix.MatrixProject;","44","import hudson.matrix.TextAxis;","45","import java.util.Collections;","101","    @Bug(20415)","102","    @Test public void nonTopLevelItemGroup() throws Exception {","103","        MatrixProject mp = j.createMatrixProject();","104","        mp.setAxes(new AxisList(new TextAxis(\"axis\", \"one\", \"two\")));","105","        assertEquals(2, mp.getItems().size());","106","        ListView v = new ListView(\"v\");","107","        j.jenkins.addView(v);","108","        v.setIncludeRegex(\".*\");","109","        v.setRecurse(true);","110","        \/\/ Note: did not manage to reproduce CCE until I changed expand to use \u2018for (TopLevelItem item : items)\u2019 rather than \u2018for (Item item : items)\u2019; perhaps a compiler-specific issue?","111","        assertEquals(Collections.singletonList(mp), v.getItems());","112","    }","113",""],"delete":[]}]}},"95a432ee33ad062cc3787d37f1b661f71d1edc51":{"changes":{"core\/src\/main\/resources\/hudson\/PluginManager\/table_fr.properties":"MODIFY","core\/src\/main\/resources\/hudson\/slaves\/DumbSlave\/newInstanceDetail_fr.properties":"MODIFY","maven-plugin\/src\/main\/resources\/hudson\/maven\/Messages_fr.properties":"MODIFY","war\/src\/main\/webapp\/help\/system-config\/usage-statistics_fr.html":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/PluginManager\/table_fr.properties":[{"add":["29","coreWarning=Ce plugin est construit pour Jenkins {0} ou une version plus r\\u00E9cente. Il pourrait ne pas fonctionner avec votre version de Jenkins."],"delete":["29","coreWarning=Ce plugin est construit pour Jenkins {0} ou une version plus r\\u00E9cente. Il pourrait ne pas fonctionner avec votre version d''Jenkins."]}],"core\/src\/main\/resources\/hudson\/slaves\/DumbSlave\/newInstanceDetail_fr.properties":[{"add":["26","  ajoutez un ordinateur physique, une machine virtuelle gre sparment de Jenkins, etc."],"delete":["26","  ajoutez un ordinateur physique, une machine virtuelle gre sparment d''Jenkins, etc."]}],"maven-plugin\/src\/main\/resources\/hudson\/maven\/Messages_fr.properties":[{"add":["27","MavenBuilder.Waiting=En attente que Jenkins finisse de rcuprer les donnes"],"delete":["27","MavenBuilder.Waiting=En attente qu''Jenkins finisse de rcuprer les donnes"]}],"war\/src\/main\/webapp\/help\/system-config\/usage-statistics_fr.html":[{"add":["13","    <li>Le nombre de jobs pour chaque type de job dans votre installation de Jenkins"],"delete":["13","    <li>Le nombre de jobs pour chaque type de job dans votre installation d'Jenkins"]}]}},"f4567eb822a29fc86f9600e3d325def146f973ac":{"changes":{"core\/src\/main\/java\/hudson\/FilePath.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/FilePath.java":[{"add":["1516","    private static interface ArchiverFactory extends Serializable {"],"delete":["1516","    private static interface ArchiverFactory {"]}]}},"58c8a9393fbe31e4533343229603cae47723cc6e":{"changes":{"core\/src\/main\/java\/hudson\/matrix\/Layouter.java":"MODIFY","changelog.html":"MODIFY","core\/src\/main\/java\/hudson\/matrix\/Axis.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/matrix\/Layouter.java":[{"add":["203","            for (Axis a : trivial) {","204","                if (a.size() > 0) {","205","                    m.put(a.name, a.value(0));","206","                }","207","            }"],"delete":["203","            for (Axis a : trivial)","204","                m.put(a.name,a.value(0));"]}],"changelog.html":[{"add":["58","    Ungraceful handling of empty matrix project axes.","59","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-19135\">issue 19135<\/a>)","60","  <li class=bug>"],"delete":[]}],"core\/src\/main\/java\/hudson\/matrix\/Axis.java":[{"add":["78","        if (values == null || values.isEmpty()) {","79","            values = Collections.emptyList();","80","        }"],"delete":["80","        if(values.isEmpty())","81","            throw new IllegalArgumentException(); \/\/ bug in the code"]}]}},"a4e427123024afa3773e9a44d44e93c94694c5f8":{"changes":{"changelog.html":"MODIFY"},"diff":{"changelog.html":[{"add":["70","  <li class=bug>","71","    Replace description in error dialog instead of appending","72","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-21457\">issue 21457<\/a>)"],"delete":["70","  <\/li>","84","  <li class=bug>","85","    Replace description in error dialog instead of appending","86","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-21457\">issue 21457<\/a>)"]}]}},"96ceca6d0e1cae8af5d5f5c242a310a2dae949b1":{"changes":{"war\/src\/main\/webapp\/scripts\/prototype.js":"MODIFY"},"diff":{"war\/src\/main\/webapp\/scripts\/prototype.js":[{"add":["744","  function toJSON() {","745","    return this.inspect(true);","746","  }","747","","833","    toJSON:         toJSON,","1222","  function toJSON() {","1223","    var results = [];","1224","    this.each(function(object) {","1225","      var value = Object.toJSON(object);","1226","      if (value !== undefined) results.push(value);","1227","    });","1228","    return '[' + results.join(', ') + ']';","1229","  }","1230","","1425","    toJSON:    toJSON,","1544","  function toJSON() {","1545","    return this.toObject().toJSON();","1546","  }","1547","","1567","    toJSON:                 toJSON,","1592","  function toJSON() {","1593","    return isFinite(this) ? this.toString() : 'null';","1594","  }","1595","","1617","    toJSON:         toJSON,","1742",""],"delete":["1548","    toJSON:                 toObject,","1718","  "]}]}},"52eb56d9bf61f191fbff3e9517751e3befaaaf5e":{"changes":{"changelog.html":"MODIFY"},"diff":{"changelog.html":[{"add":["42","  <li class=bug> Parsing poms fails if a module is a path to a pom (and not to a directory)","43","   (<a href=\"http:\/\/issues.hudson-ci.org\/browse\/HUDSON-8445\">issue 8445<\/a>) "],"delete":["42","  <li class=>"]}]}},"22188600b41d97990bcb77ce3bc477ff0ffe82b1":{"changes":{"core\/src\/main\/java\/hudson\/model\/ListView.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/ListView.java":[{"add":["168","        rsp.sendRedirect2(\"..\/\"+name);"],"delete":["168","        rsp.sendRedirect(\"..\/\"+name);"]}]}},"740f9eb3ede9b76f0b4126e581870c6659822386":{"changes":{"test\/src\/test\/java\/jenkins\/telemetry\/MissingClassTelemetryTest.java":"ADD","core\/src\/main\/java\/jenkins\/telemetry\/impl\/java11\/MissingClassEvent.java":"ADD","core\/src\/main\/java\/jenkins\/telemetry\/impl\/java11\/MissingClassTelemetry.java":"ADD","core\/src\/main\/java\/jenkins\/telemetry\/impl\/java11\/CatcherClassLoader.java":"ADD","core\/src\/main\/java\/jenkins\/util\/AntClassLoader.java":"MODIFY","core\/src\/main\/java\/hudson\/init\/impl\/InstallUncaughtExceptionHandler.java":"MODIFY","core\/src\/main\/java\/hudson\/PluginManager.java":"MODIFY","core\/src\/main\/java\/jenkins\/model\/Jenkins.java":"MODIFY","test\/src\/test\/java\/jenkins\/telemetry\/impl\/java11\/MissingClassTelemetryFasterTest.java":"ADD","core\/src\/main\/java\/jenkins\/telemetry\/impl\/java11\/MissingClassEvents.java":"ADD"},"diff":{"test\/src\/test\/java\/jenkins\/telemetry\/MissingClassTelemetryTest.java":[{"add":[],"delete":[]}],"core\/src\/main\/java\/jenkins\/telemetry\/impl\/java11\/MissingClassEvent.java":[{"add":[],"delete":[]}],"core\/src\/main\/java\/jenkins\/telemetry\/impl\/java11\/MissingClassTelemetry.java":[{"add":[],"delete":[]}],"core\/src\/main\/java\/jenkins\/telemetry\/impl\/java11\/CatcherClassLoader.java":[{"add":[],"delete":[]}],"core\/src\/main\/java\/jenkins\/util\/AntClassLoader.java":[{"add":["19","import jenkins.telemetry.impl.java11.MissingClassTelemetry;","42","import java.nio.file.Files;","1073","","1074","        \/\/Surround the former logic with a try-catch to report missing class exceptions via Java11 telemetry","1075","        try {","1076","            if (isParentFirst(classname)) {","1077","                try {","1078","                    theClass = findBaseClass(classname);","1079","                    log(\"Class \" + classname + \" loaded from parent loader \" + \"(parentFirst)\",","1080","                            Project.MSG_DEBUG);","1081","                } catch (ClassNotFoundException cnfe) {","1082","                    theClass = findClass(classname);","1083","                    log(\"Class \" + classname + \" loaded from ant loader \" + \"(parentFirst)\",","1084","                            Project.MSG_DEBUG);","1086","            } else {","1087","                try {","1088","                    theClass = findClass(classname);","1089","                    log(\"Class \" + classname + \" loaded from ant loader\", Project.MSG_DEBUG);","1090","                } catch (ClassNotFoundException cnfe) {","1091","                    if (ignoreBase) {","1092","                        throw cnfe;","1093","                    }","1094","                    theClass = findBaseClass(classname);","1095","                    log(\"Class \" + classname + \" loaded from parent loader\", Project.MSG_DEBUG);","1096","                }","1098","        } catch (ClassNotFoundException cnfe) {","1099","            \/\/To catch CNFE thrown from this.getClass().getClassLoader().loadClass(classToLoad); from a plugin step or","1100","            \/\/a plugin page","1101","            MissingClassTelemetry.reportException(classname, cnfe);","1102","            throw cnfe;"],"delete":["19","import java.nio.file.Files;","1072","        if (isParentFirst(classname)) {","1073","            try {","1074","                theClass = findBaseClass(classname);","1075","                log(\"Class \" + classname + \" loaded from parent loader \" + \"(parentFirst)\",","1076","                        Project.MSG_DEBUG);","1077","            } catch (ClassNotFoundException cnfe) {","1078","                theClass = findClass(classname);","1079","                log(\"Class \" + classname + \" loaded from ant loader \" + \"(parentFirst)\",","1080","                        Project.MSG_DEBUG);","1081","            }","1082","        } else {","1083","            try {","1084","                theClass = findClass(classname);","1085","                log(\"Class \" + classname + \" loaded from ant loader\", Project.MSG_DEBUG);","1086","            } catch (ClassNotFoundException cnfe) {","1087","                if (ignoreBase) {","1088","                    throw cnfe;","1090","                theClass = findBaseClass(classname);","1091","                log(\"Class \" + classname + \" loaded from parent loader\", Project.MSG_DEBUG);"]}],"core\/src\/main\/java\/hudson\/init\/impl\/InstallUncaughtExceptionHandler.java":[{"add":["4","import jenkins.telemetry.impl.java11.MissingClassTelemetry;","5","import org.kohsuke.stapler.Stapler;","10","import java.io.EOFException;","31","                    \/\/ If we have an exception, let's see if it's related with missing classes on Java 11. We reach","32","                    \/\/ here with a ClassNotFoundException in an action, for example. Setting the report here is the only","33","                    \/\/ way to catch the missing classes when the plugin uses Thread.currentThread().getContextClassLoader().loadClass","34","                    MissingClassTelemetry.reportExceptionInside(e);","48","                                                       \"Failed to set the default UncaughtExceptionHandler.  \" +","50","                                                       \"The lack of this diagnostic information will make it harder to track down issues which will reduce the supportability of Jenkins.  \" +","51","                                                       \"It is highly recommended that you consult the documentation that comes with you servlet container on how to allow the \" +","76","","77","            \/\/ If we have an exception, let's see if it's related with missing classes on Java 11. We reach","78","            \/\/ here with a ClassNotFoundException in an action, for example. Setting the report here is the only","79","            \/\/ way to catch the missing classes when the plugin uses Thread.currentThread().getContextClassLoader().loadClass","80","            MissingClassTelemetry.reportExceptionInside(ex);"],"delete":["3","import java.io.EOFException;","13","import org.kohsuke.stapler.Stapler;","14","","44","                                                       \"Failed to set the default UncaughtExceptionHandler.  \" + ","46","                                                       \"The lack of this diagnostic information will make it harder to track down issues which will reduce the supportability of Jenkins.  \" + ","47","                                                       \"It is highly recommended that you consult the documentation that comes with you servlet container on how to allow the \" + ","77",""]}],"core\/src\/main\/java\/hudson\/PluginManager.java":[{"add":["66","import jenkins.telemetry.impl.java11.MissingClassTelemetry;","2068","            ClassNotFoundException cnfe = new ClassNotFoundException(name);","2069","            MissingClassTelemetry.reportException(name, cnfe);","2070","            throw cnfe;"],"delete":["2067","            throw new ClassNotFoundException(name);"]}],"core\/src\/main\/java\/jenkins\/model\/Jenkins.java":[{"add":["45","import jenkins.telemetry.impl.java11.CatcherClassLoader;","46","import jenkins.telemetry.impl.java11.MissingClassTelemetry;","874","            \/\/Telemetry: add interceptor classloader","875","            \/\/These lines allow the catcher to be present on Thread.currentThread().getContextClassLoader() in every plugin which","876","            \/\/allow us to detect failures in every plugin loading classes by this way.","877","            if (MissingClassTelemetry.enabled() && !(Thread.currentThread().getContextClassLoader() instanceof CatcherClassLoader)) {","878","                Thread.currentThread().setContextClassLoader(new CatcherClassLoader(Thread.currentThread().getContextClassLoader()));","879","            }","920","","921","            \/\/Telemetry: add interceptor classloader","922","            \/\/These lines allows the catcher to be present on Thread.currentThread().getContextClassLoader() in every plugin which","923","            \/\/allow us to detect failures in every plugin loading classes by this way.","925","","926","            ClassLoader classLoaderToAssign;","927","            if (MissingClassTelemetry.enabled() && !(pluginManager.uberClassLoader instanceof CatcherClassLoader)) {","928","                classLoaderToAssign = new CatcherClassLoader(pluginManager.uberClassLoader);","929","            } else {","930","                classLoaderToAssign = pluginManager.uberClassLoader;","931","            }","932","            webApp.setClassLoader(classLoaderToAssign);","933","","946","            \/\/Telemetry: add interceptor classloader","947","            \/\/These lines allows the catcher to be present on Thread.currentThread().getContextClassLoader() in every plugin which","948","            \/\/allow us to detect failures in every plugin loading classes at this way.","949","            adjuncts = new AdjunctManager(servletContext, classLoaderToAssign, \"adjuncts\/\" + SESSION_HASH, TimeUnit.DAYS.toMillis(365));"],"delete":["913","            webApp.setClassLoader(pluginManager.uberClassLoader);","926","            adjuncts = new AdjunctManager(servletContext, pluginManager.uberClassLoader,\"adjuncts\/\"+SESSION_HASH, TimeUnit.DAYS.toMillis(365));"]}],"test\/src\/test\/java\/jenkins\/telemetry\/impl\/java11\/MissingClassTelemetryFasterTest.java":[{"add":[],"delete":[]}],"core\/src\/main\/java\/jenkins\/telemetry\/impl\/java11\/MissingClassEvents.java":[{"add":[],"delete":[]}]}},"4f3a285ab41a306520b1a1fe7ec50ca2c0821841":{"changes":{"maven-plugin\/src\/main\/java\/hudson\/maven\/Maven3Builder.java":"MODIFY","changelog.html":"MODIFY","maven-plugin\/src\/main\/java\/hudson\/maven\/MojoInfo.java":"MODIFY"},"diff":{"maven-plugin\/src\/main\/java\/hudson\/maven\/Maven3Builder.java":[{"add":["52","import java.util.logging.Logger;","316","            debug(\"Projects to build: \" + projects);","337","            debug( \"sessionEnded\" );","345","            debug(\"projectSkipped \" + event.getProject().getGroupId()","355","            debug( \"projectStarted \" + event.getProject().getGroupId() + \":\"","356","                                                            + event.getProject().getArtifactId() + \":\" + event.getProject().getVersion() );","400","            debug( \"projectSucceeded \"","446","            debug(\"projectFailed \" + event.getProject().getGroupId()","490","            debug(\"mojoSkipped \" + event.getMojoExecution().getGroupId() + \":\"","501","            debug(\"mojoStarted \" + event.getMojoExecution().getGroupId() + \":\"","502","                                                                      + event.getMojoExecution().getArtifactId() + \":\"","503","                                                                      + event.getMojoExecution().getVersion()","504","                                                                      + \"(\" + event.getMojoExecution().getExecutionId() + \")\");","516","                new MojoInfo( event.getMojoExecution(), null, xmlPlexusConfiguration,","540","            debug(\"mojoSucceeded \" + event.getMojoExecution().getGroupId() + \":\"","541","                                                       + event.getMojoExecution().getArtifactId() + \":\"","542","                                                       + event.getMojoExecution().getVersion()","543","                                                       + \"(\" + event.getMojoExecution().getExecutionId() + \")\");","596","            debug(\"mojoFailed \" + event.getMojoExecution().getGroupId() + \":\"","603","","604","        private void debug(String msg) {","605","            LOGGER.fine(msg);","606","            if (DEBUG)","607","                maven3Builder.listener.getLogger().println(msg);","608","        }","664","            LOGGER.fine(\"mojo forkStarted \" + event.getMojoExecution().getGroupId() + \":\"","675","            LOGGER.fine(\"mojo forkSucceeded \" + event.getMojoExecution().getGroupId() + \":\"","686","            LOGGER.fine(\"mojo forkFailed \" + event.getMojoExecution().getGroupId() + \":\"","697","            LOGGER.fine( \"forkedProjectStarted \" + event.getProject().getGroupId() + \":\"","707","            LOGGER.fine( \"forkedProjectSucceeded \"","719","            LOGGER.fine(\"forkedProjectFailed \" + event.getProject().getGroupId()","723","        }","724","    }","725","","728","    private static final long serialVersionUID = 1L;","729","","730","    public static boolean DEBUG = false;","731","","732","    private static final Logger LOGGER = Logger.getLogger(Maven3Builder.class.getName());"],"delete":["280","        \/\/ FIXME really used somewhere ???","281","        \/\/ FIXME MojoInfo need the real mojo ?? ","282","        \/\/ so tricky to do. need to use MavenPluginManager on the current Maven Build","283","        private Mojo getMojo(MojoExecution mojoExecution, MavenSession mavenSession) {","284","            return null;","285","        }","286","        ","322","            \/\/maven3Builder.listener.getLogger().println(\"Projects to build: \" + projects);","343","            maven3Builder.listener.getLogger().println( \"sessionEnded\" );","351","            maven3Builder.listener.getLogger().println(\"projectSkipped \" + event.getProject().getGroupId() ","361","            \/\/maven3Builder.listener.getLogger().println( \"projectStarted \" + event.getProject().getGroupId() + \":\"","362","            \/\/                                                + event.getProject().getArtifactId() + \":\" + event.getProject().getVersion() );","406","            maven3Builder.listener.getLogger().println( \"projectSucceeded \"","452","            maven3Builder.listener.getLogger().println(\"projectFailed \" + event.getProject().getGroupId() ","496","            maven3Builder.listener.getLogger().println(\"mojoSkipped \" + event.getMojoExecution().getGroupId() + \":\"","507","            \/\/maven3Builder.listener.getLogger().println(\"mojoStarted \" + event.getMojoExecution().getGroupId() + \":\"","508","            \/\/                                                          + event.getMojoExecution().getArtifactId() + \":\"","509","            \/\/                                                          + event.getMojoExecution().getVersion()","510","            \/\/                                                          + \"(\" + event.getMojoExecution().getExecutionId() + \")\");","521","            Mojo mojo = null;\/\/getMojo( event.getMojoExecution(), event.getSession() );","522","            ","524","                new MojoInfo( event.getMojoExecution(), mojo, xmlPlexusConfiguration,","548","            \/\/maven3Builder.listener.getLogger().println(\"mojoSucceeded \" + event.getMojoExecution().getGroupId() + \":\"","549","            \/\/                                           + event.getMojoExecution().getArtifactId() + \":\"","550","            \/\/                                           + event.getMojoExecution().getVersion()","551","            \/\/                                           + \"(\" + event.getMojoExecution().getExecutionId() + \")\");","604","            maven3Builder.listener.getLogger().println(\"mojoFailed \" + event.getMojoExecution().getGroupId() + \":\"","666","            maven3Builder.listener.getLogger().println(\"mojo forkStarted \" + event.getMojoExecution().getGroupId() + \":\"","677","            maven3Builder.listener.getLogger().println(\"mojo forkSucceeded \" + event.getMojoExecution().getGroupId() + \":\"","688","            maven3Builder.listener.getLogger().println(\"mojo forkFailed \" + event.getMojoExecution().getGroupId() + \":\"","699","            maven3Builder.listener.getLogger().println( \"forkedProjectStarted \" + event.getProject().getGroupId() + \":\"","709","            maven3Builder.listener.getLogger().println( \"forkedProjectSucceeded \"","721","            maven3Builder.listener.getLogger().println(\"forkedProjectFailed \" + event.getProject().getGroupId() ","725","        }        ","726","        ","727","    }    ","728","    ","731","    private static final long serialVersionUID = 1L;    ","732","    "]}],"changelog.html":[{"add":["60","  <li class=bug>","61","    Fixed NPE in running <tt>assembly:assembly<\/tt> with Maven3","62","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-8837\">issue 8837<\/a>)"],"delete":[]}],"maven-plugin\/src\/main\/java\/hudson\/maven\/MojoInfo.java":[{"add":["25","import org.apache.maven.plugin.AbstractMojo;","28","import org.apache.maven.plugin.MojoExecutionException;","29","import org.apache.maven.plugin.MojoFailureException;","74","     *","75","     * @deprecated as of 1.427","76","     *      Maven3 can no longer provide this information, so plugins cannot rely on this value being present.","77","     *      For the time being we are setting a dummy value to avoid NPE. Use {@link #configuration} to access","78","     *      configuration values, but otherwise the ability to inject values is lost and there's no viable","79","     *      alternative.","103","        \/\/ in Maven3 there's no easy way to get the Mojo instance that's being executed,","104","        \/\/ so we just can't pass it in.","105","        if (mojo==null) mojo = new Maven3ProvidesNoAccessToMojo();","179","     * @deprecated as of 1.427","180","     *      See the discussion in {@link #mojo}","219","     * @deprecated as of 1.427","220","     *      See the discussion in {@link #mojo}","258","","259","    \/**","260","     * Instance will be set to {@link MojoInfo#mojo} to avoid NPE in plugins.","261","     *\/","262","    public static class Maven3ProvidesNoAccessToMojo extends AbstractMojo {","263","        public void execute() throws MojoExecutionException, MojoFailureException {","264","            throw new UnsupportedOperationException();","265","        }","266","    }"],"delete":["94","        if (mojo==null)     throw new IllegalArgumentException();","95","        \/\/ TODO: exactly what other variables are always non-null?"]}]}},"cc932c49afa8c2946a32555285e1aa52dc724ddf":{"changes":{"core\/src\/main\/java\/hudson\/slaves\/NodeProvisioner.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/slaves\/NodeProvisioner.java":[{"add":["692","                            for (CloudProvisioningListener cl : CloudProvisioningListener.all()) {","694","                                    \/\/ consider displaying reasons in a future cloud ux","695","                                    continue CLOUD;"],"delete":["692","                            for (CloudProvisioningListener cl : CloudProvisioningListener.all())","693","                            \/\/ consider displaying reasons in a future cloud ux","694","                            {","696","                                    break CLOUD;"]}]}},"6c1d61aaff5cc1dd5bd6d4f1a70a813c12bb421a":{"changes":{"test\/src\/test\/java\/hudson\/util\/RobustReflectionConverterTest.java":"MODIFY"},"diff":{"test\/src\/test\/java\/hudson\/util\/RobustReflectionConverterTest.java":[{"add":["74","        assertTrue(\"There should be no triggers\", p.getTriggers().isEmpty());"],"delete":["74","        assertEquals(Collections.emptyMap(), p.getTriggers());"]}]}},"693b60ba6f7cbba0d59213f2a3e929d4e287c8ea":{"changes":{"remoting\/src\/main\/java\/hudson\/remoting\/RemoteClassLoader.java":"MODIFY"},"diff":{"remoting\/src\/main\/java\/hudson\/remoting\/RemoteClassLoader.java":[{"add":["260","        File tmpFile = createTempDir();","273","    private File createTempDir() throws IOException {","274","    \t\/\/ work around sun bug 6325169 on windows","275","    \t\/\/ see http:\/\/bugs.sun.com\/bugdatabase\/view_bug.do?bug_id=6325169","276","        int nRetry=0;","277","        while (true) {","278","            try {","279","                File tmpFile = File.createTempFile(\"hudson-remoting\", \"\");","280","                tmpFile.delete();","281","                tmpFile.mkdir();","282","                return tmpFile;","283","            } catch (IOException e) {","284","                if (nRetry++ < 100)","285","                    continue;","286","                throw e;","287","            }","288","        }","289","    }","290",""],"delete":["260","        File tmpFile = File.createTempFile(\"hudson-remoting\", \"\");","261","        tmpFile.delete();"]}]}},"26cca1a97348deaa601b0b198e7fce06be7cdebe":{"changes":{"core\/src\/main\/java\/hudson\/model\/View.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/View.java":[{"add":["222","        return (owner!=null ? owner.getUrl() : \"\") + \"view\/\" + getViewName() + '\/';"],"delete":["222","        return owner.getUrl()+\"view\/\"+getViewName()+'\/';"]}]}},"ce2d0f97bdbb5fb171443559d210dffef7961dc2":{"changes":{"core\/src\/test\/java\/hudson\/model\/ViewTest.java":"MODIFY","core\/src\/test\/java\/hudson\/model\/MockItem.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/View.java":"MODIFY"},"diff":{"core\/src\/test\/java\/hudson\/model\/ViewTest.java":[{"add":["24","import org.powermock.reflect.Whitebox;","115","    @Test","116","    public void buildQueueFiltering() throws Exception {","117","        \/\/ Mimic a freestyle job","118","        FreeStyleProject singleItemJob = Mockito.mock(FreeStyleProject.class);","119","        Mockito.when(singleItemJob.getOwnerTask()).thenReturn(singleItemJob);","120","        Queue.Item singleItemQueueItem = new MockItem(singleItemJob);","121","","122","        \/\/ Mimic pattern of a Matrix job, i.e. with root item in view and sub","123","        \/\/ items in queue.","124","        FreeStyleProject multiItemJob = Mockito.mock(FreeStyleProject.class);","125","        Project multiItemSubJob = Mockito.mock(Project.class);","126","        Mockito.when(multiItemSubJob.getRootProject()).thenReturn(multiItemJob);","127","        Mockito.when(multiItemSubJob.getOwnerTask()).thenReturn(multiItemSubJob);","128","        Queue.Item multiItemQueueItem = new MockItem(multiItemSubJob);","129","","130","        \/\/ Mimic pattern of a Pipeline job, i.e. with item in view and","131","        \/\/ sub-steps in queue.","132","        BuildableTopLevelItem multiStepJob","133","                = Mockito.mock(BuildableTopLevelItem.class);","134","        Mockito.when(multiStepJob.getOwnerTask()).thenReturn(multiStepJob);","135","        BuildableItem multiStepSubStep = Mockito.mock(BuildableItem.class);","136","        Mockito.when(multiStepSubStep.getOwnerTask()).thenReturn(multiStepJob);","137","        Queue.Item multiStepQueueItem = new MockItem(multiStepSubStep);","138","","139","        \/\/ Construct the view","140","        View view = Mockito.mock(View.class);","141","        List<Queue.Item> queue = Arrays.asList(singleItemQueueItem,","142","                multiItemQueueItem, multiStepQueueItem);","143","        Mockito.when(view.isFilterQueue()).thenReturn(true);","144","","145","        \/\/ Positive test, ensure that queue items are included","146","        List<TopLevelItem> viewJobs = Arrays.asList(singleItemJob, multiItemJob, multiStepJob);","147","        Mockito.when(view.getItems()).thenReturn(viewJobs);","148","        assertEquals(","149","                Arrays.asList(singleItemQueueItem,","150","                        multiItemQueueItem, multiStepQueueItem),","151","                Whitebox.invokeMethod(view, \"filterQueue\", queue)","152","        );","153","","154","        \/\/ Negative test, ensure that queue items are excluded","155","        Mockito.when(view.getItems()).thenReturn(Collections.emptyList());","156","        List<Queue.Item> expected = Arrays.asList(singleItemQueueItem,","157","                multiItemQueueItem, multiStepQueueItem);","158","        assertEquals(","159","                Collections.emptyList(),","160","                Whitebox.<List<Queue.Item>>invokeMethod(view, \"filterQueue\", queue)","161","        );","162","    }","163","","164","    \/**","165","     * This interface fulfills both TopLevelItem and BuildableItem interface,","166","     * this allows it for being present in a view as well as the build queue!","167","     *\/","168","    private interface BuildableTopLevelItem extends TopLevelItem, BuildableItem {","169","    }","170",""],"delete":[]}],"core\/src\/test\/java\/hudson\/model\/MockItem.java":[{"add":["39","    public MockItem(Queue.Task task) {","40","        super(task, Collections.emptyList(), -1, null);","41","    }","42",""],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/View.java":[{"add":["116","import java.util.stream.Collectors;","458","    private final static int FILTER_LOOP_MAX_COUNT = 10;","459","","465","        return base.stream().filter(qi -> filterQueueItemTest(qi, items))","466","                .collect(Collectors.toList());","467","    }","468","","469","    private boolean filterQueueItemTest(Queue.Item item, Collection<TopLevelItem> viewItems) {","470","        \/\/ Check if the task of parent tasks are in the list of viewItems.","471","        \/\/ Pipeline jobs and other jobs which allow parts require us to","472","        \/\/ check owner tasks as well.","473","        Queue.Task currentTask = item.task;","474","        for (int count = 1;; count++) {","475","            if (viewItems.contains(currentTask)) {","476","                return true;","477","            }","478","            Queue.Task next = currentTask.getOwnerTask();","479","            if (next == currentTask) {","480","                break;","481","            } else {","482","                currentTask = next;","483","            }","484","            if (count == FILTER_LOOP_MAX_COUNT) {","485","                LOGGER.warning(String.format(","486","                        \"Failed to find root task for queue item '%s' for \" +","487","                        \"view '%s' in under %d iterations, aborting!\",","488","                        item.getDisplayName(), getDisplayName(),","489","                        FILTER_LOOP_MAX_COUNT));","490","                break;","493","        \/\/ Check root project for sub-job projects (e.g. matrix jobs).","494","        if (item.task instanceof AbstractProject<?, ?>) {","495","            AbstractProject<?,?> project = (AbstractProject<?, ?>) item.task;","496","            if (viewItems.contains(project.getRootProject())) {","497","                return true;","498","            }","499","        }","500","        return false;"],"delete":["461","","463","        List<Queue.Item> result = new ArrayList<Queue.Item>();","464","        for (Queue.Item qi : base) {","465","            if (items.contains(qi.task)) {","466","                result.add(qi);","467","            } else","468","            if (qi.task instanceof AbstractProject<?, ?>) {","469","                AbstractProject<?,?> project = (AbstractProject<?, ?>) qi.task;","470","                if (items.contains(project.getRootProject())) {","471","                    result.add(qi);","472","                }","475","        return result;"]}]}},"72f6f684297b68be19289149d0eed3d76a88f6f5":{"changes":{"changelog.html":"MODIFY","core\/src\/main\/java\/hudson\/tasks\/Mailer.java":"MODIFY"},"diff":{"changelog.html":[{"add":["68","  <li class=bug>","69","    Empty emailAddress causes Mailer error.","70","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-10300\">issue 10300<\/a>)"],"delete":[]}],"core\/src\/main\/java\/hudson\/tasks\/Mailer.java":[{"add":["480","            if(Util.fixEmptyAndTrim(emailAddress)!=null)"],"delete":["480","            if(emailAddress!=null)"]}]}},"b2f13179f53888156a6b03df8b2800461fb80be6":{"changes":{"core\/src\/main\/java\/hudson\/model\/Hudson.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/PageDecorator.java":"MODIFY","test\/src\/test\/resources\/hudson\/pages\/SystemConfigurationTestCase\/PageDecoratorImpl\/global.jelly":"MODIFY","test\/src\/test\/java\/hudson\/pages\/SystemConfigurationTestCase.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/Hudson.java":[{"add":["1633","            for( PageDecorator d : PageDecorator.ALL )","1634","                result &= configureDescriptor(req,json,d);","1635",""],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/PageDecorator.java":[{"add":["2","import java.util.ArrayList;","3","import java.util.List;","4","","68","    public static final List<PageDecorator> ALL = new ArrayList<PageDecorator>();"],"delete":["4","import hudson.util.DescriptorList;","66","    public static final DescriptorList<PageDecorator> ALL = new DescriptorList<PageDecorator>();"]}],"test\/src\/test\/resources\/hudson\/pages\/SystemConfigurationTestCase\/PageDecoratorImpl\/global.jelly":[{"add":["1","  <f:section title=\"PageDecorator\">\r","2","    <f:entry title=\"PageDecoratorId\">\r","3","      <f:textbox field=\"decoratorId\"\/>\r","4","    <\/f:entry>\r","5","  <\/f:section>\r"],"delete":["1","\r"]}],"test\/src\/test\/java\/hudson\/pages\/SystemConfigurationTestCase.java":[{"add":["5","import net.sf.json.JSONObject;\r","7","import org.jvnet.hudson.test.HudsonTestCase;\r","8","import org.kohsuke.stapler.StaplerRequest;\r","9","\r","10","import com.gargoylesoftware.htmlunit.html.HtmlButton;\r","11","import com.gargoylesoftware.htmlunit.html.HtmlForm;\r","34","        \r","35","        HtmlForm form = page.getFormByName(\"config\");\r","36","        form.getInputByName(\"_.decoratorId\").setValueAttribute(\"this_is_a_profile\");\r","37","        form.submit((HtmlButton)last(form.getHtmlElementsByTagName(\"button\")));\r","38","        assertEquals(\"The decorator field was incorrect\", \"this_is_a_profile\", pageDecoratorImpl.getDecoratorId());\r","45","        private String decoratorId;\r","46","\r","52","        public boolean configure(StaplerRequest req, JSONObject json) throws FormException {\r","53","            decoratorId = json.getString(\"decoratorId\");\r","54","            return true;\r","55","        }\r","56","\r","57","        @Override\r","61","        \r","62","        public String getDecoratorId() {\r","63","            return decoratorId;\r","64","        }\r"],"delete":["5","import org.jvnet.hudson.test.HudsonTestCase;\r"]}]}},"3b860c4affb06ace83c8f50e136121b905060a80":{"changes":{"core\/src\/main\/java\/hudson\/model\/LoadBalancer.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/LoadBalancer.java":[{"add":["38","import java.util.logging.Level;","39","import java.util.logging.Logger;","120","                LOGGER.log(Level.FINE, null, e);","179","    private static final Logger LOGGER = Logger.getLogger(LoadBalancer.class.getName());","180",""],"delete":[]}]}},"ea04ff2e8f60a9cffa477653a158e8c312008d95":{"changes":{"core\/src\/main\/java\/hudson\/model\/AbstractProject.java":"MODIFY","core\/src\/main\/resources\/hudson\/model\/Messages.properties":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/AbstractProject.java":[{"add":["1168","        if (scm==null) {","1172","        if (isDisabled()) {","1180","            return isInQueue() ? NO_CHANGES : BUILD_NOW;","1199","            if (scm.requiresWorkspaceForPolling()) {","1215","                    if (isInQueue()) {","1216","                        listener.getLogger().println(Messages.AbstractProject_AwaitingBuildForWorkspace());","1217","                        return NO_CHANGES;","1218","                    } else {","1219","                        listener.getLogger().println(Messages.AbstractProject_NewBuildForWorkspace());","1220","                        return BUILD_NOW;","1221","                    }"],"delete":["1168","        if(scm==null) {","1172","        if(isDisabled()) {","1180","            return BUILD_NOW;","1199","            if(scm.requiresWorkspaceForPolling()) {","1215","                    listener.getLogger().println(Messages.AbstractProject_NewBuildForWorkspace());","1216","                    return BUILD_NOW;"]}],"core\/src\/main\/resources\/hudson\/model\/Messages.properties":[{"add":["29","AbstractProject.AwaitingBuildForWorkspace=Awaiting build to get a workspace."],"delete":[]}]}},"609392414f1060fb67d69db026b6f40478784345":{"changes":{"core\/src\/main\/java\/hudson\/model\/Run.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/Run.java":[{"add":["1402","                    Computer computer = Computer.currentComputer();","1403","                    Charset charset = null;","1404","                    if (computer != null) {","1405","                        charset = computer.getDefaultCharset();","1406","                        this.charset = charset.name();","1407","                    }"],"delete":["1402","                    Charset charset = Computer.currentComputer().getDefaultCharset();","1403","                    this.charset = charset.name();"]}]}},"2a97bf41fbb5bd8158355e4d885d0799f2391d3e":{"changes":{"core\/src\/main\/java\/hudson\/model\/ParameterValue.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/ParameterValue.java":[{"add":["38","import javax.annotation.CheckForNull;","305","     * @return if there is no natural value for this parameter type, {@code this} may be used;","306","     *         {@code null} may be used when the value is normally defined but missing in this case for various reasons","309","    @CheckForNull"],"delete":["304","     * If there's nothing that really fits the bill, the callee can return {@code this}."]}]}},"229f536cbafadde6d1be07b92b367d2a7eba8609":{"changes":{"core\/src\/main\/java\/hudson\/model\/Descriptor.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/Hudson.java":"MODIFY","core\/src\/main\/resources\/hudson\/diagnosis\/NullIdDescriptorMonitor\/message.jelly":"ADD","core\/src\/main\/resources\/hudson\/diagnosis\/NullIdDescriptorMonitor\/message.properties":"ADD","changelog.html":"MODIFY","core\/src\/main\/java\/hudson\/PluginManager.java":"MODIFY","core\/src\/main\/java\/hudson\/diagnosis\/NullIdDescriptorMonitor.java":"ADD"},"diff":{"core\/src\/main\/java\/hudson\/model\/Descriptor.java":[{"add":["32","import hudson.init.InitMilestone;","33","import hudson.init.Initializer;","45","import static hudson.init.InitMilestone.EXTENSIONS_AUGMENTED;","52","import java.text.MessageFormat;"],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/Hudson.java":[{"add":["1684","            return \"\";"],"delete":["1684","            throw new UnsupportedOperationException();"]}],"core\/src\/main\/resources\/hudson\/diagnosis\/NullIdDescriptorMonitor\/message.jelly":[{"add":[],"delete":[]}],"core\/src\/main\/resources\/hudson\/diagnosis\/NullIdDescriptorMonitor\/message.properties":[{"add":[],"delete":[]}],"changelog.html":[{"add":["62","  <li class=rfe>","63","    Proactively watch out for incomplete extensions to avoid cryptic NPE.","64","    (<a href=\"http:\/\/issues.jenkins-ci.org\/browse\/JENKINS-8866\">issue 8866<\/a>)"],"delete":["62","  <li class=>"]}],"core\/src\/main\/java\/hudson\/PluginManager.java":[{"add":["458","     * Return the {@link PluginWrapper} that loaded the given class 'c'.","459","     *","460","     * @since 1.402.","461","     *\/","462","    public PluginWrapper whichPlugin(Class c) {","463","        ClassLoader cl = c.getClassLoader();","464","        for (PluginWrapper p : activePlugins) {","465","            if (p.classLoader==cl)","466","                return p;","467","        }","468","        return null;","469","    }","470","","471","    \/**"],"delete":[]}],"core\/src\/main\/java\/hudson\/diagnosis\/NullIdDescriptorMonitor.java":[{"add":[],"delete":[]}]}},"578b60a41b2c20a84a15a97d12a857bd10f1d0d3":{"changes":{"core\/src\/main\/java\/hudson\/maven\/PomInfo.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/maven\/PomInfo.java":[{"add":["92","        if ((ciMgmt != null) && (ciMgmt.getSystem()==null || ciMgmt.getSystem().equals(\"hudson\"))) {"],"delete":["92","        if ((ciMgmt != null) && (ciMgmt.getSystem().equals(\"hudson\"))) {"]}]}},"2f20efbee91b38a2de7971feb507c2e2f8de21c3":{"changes":{"core\/src\/main\/java\/hudson\/FilePath.java":"MODIFY","core\/src\/main\/java\/jenkins\/util\/VirtualFile.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/FilePath.java":[{"add":["129","import java.util.Collections;","1639","    @Nonnull","1649","    @Nonnull","1670","    @Nonnull","1679","                if (children == null) {","1680","                    return Collections.emptyList();","1681","                }","1700","    @Nonnull","1715","    @Nonnull","1731","    @Nonnull","1753","    @Nonnull"],"delete":["1675","                if(children ==null)     return null;"]}],"core\/src\/main\/java\/jenkins\/util\/VirtualFile.java":[{"add":[],"delete":["367","                    if (kids == null) {","368","                        return new VirtualFile[0];","369","                    }"]}]}},"ee862b8cc3c8da236983e29dfc25535e4203f08a":{"changes":{"core\/src\/main\/resources\/jenkins\/security\/whitelisted-classes.txt":"MODIFY"},"diff":{"core\/src\/main\/resources\/jenkins\/security\/whitelisted-classes.txt":[{"add":["38","java.lang.StringBuffer","39","java.lang.StringBuilder"],"delete":[]}]}},"35a38f0ce69596f7aff2a4b3de14739d5cb78dbc":{"changes":{"core\/src\/main\/java\/hudson\/model\/User.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/User.java":[{"add":["1094","                    if (subdir.equals(getRootDir())) {","1095","                        continue; \/\/ ignore the parent directory in case of stray config.xml","1096","                    }"],"delete":[]}]}},"f0a959943417766eaf2dd1c86ea72d513ab96ceb":{"changes":{"test\/src\/test\/java\/hudson\/jobs\/CreateItemTest.java":"ADD","core\/src\/main\/java\/hudson\/model\/View.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/ItemGroupMixIn.java":"MODIFY"},"diff":{"test\/src\/test\/java\/hudson\/jobs\/CreateItemTest.java":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/View.java":[{"add":["1160","        String mode = req.getParameter(\"mode\");","1161","","1163","        if (requestContentType == null","1164","                && !(mode != null && mode.equals(\"copy\")))","1167","        boolean isXmlSubmission = requestContentType != null","1168","                && (requestContentType.startsWith(\"application\/xml\")","1169","                        || requestContentType.startsWith(\"text\/xml\"));"],"delete":["1161","        if(requestContentType==null)","1164","        boolean isXmlSubmission = requestContentType.startsWith(\"application\/xml\") || requestContentType.startsWith(\"text\/xml\");","1171","        String mode = req.getParameter(\"mode\");"]}],"core\/src\/main\/java\/hudson\/model\/ItemGroupMixIn.java":[{"add":["144","        String mode = req.getParameter(\"mode\");","145","        if (requestContentType == null","146","                && !(mode != null && mode.equals(\"copy\")))","149","        boolean isXmlSubmission = requestContentType != null","150","            && (requestContentType.startsWith(\"application\/xml\")","151","                    || requestContentType.startsWith(\"text\/xml\"));"],"delete":["144","        if(requestContentType==null)","147","        boolean isXmlSubmission = requestContentType.startsWith(\"application\/xml\") || requestContentType.startsWith(\"text\/xml\");","160","        String mode = req.getParameter(\"mode\");"]}]}},"722d24edba345b53474510df2273733f3addbbf8":{"changes":{"core\/src\/main\/resources\/hudson\/model\/ComputerSet\/new.jelly":"MODIFY","core\/src\/main\/resources\/hudson\/model\/View\/newJob.jelly":"MODIFY","core\/src\/main\/resources\/lib\/hudson\/newFromList\/form.jelly":"MODIFY","core\/src\/main\/java\/hudson\/model\/ComputerSet.java":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/model\/ComputerSet\/new.jelly":[{"add":["33","    <st:include page=\"sidepanel.jelly\" \/>","34","    <l:main-panel>","37","              descriptors=\"${slaves}\" checkUrl=\"computer\/checkName\" xmlns:n=\"\/lib\/hudson\/newFromList\" \/>","40","<\/j:jelly>"],"delete":["33","\t\t<st:include page=\"sidepanel.jelly\" \/>","34","\t\t<l:main-panel>","37","              descriptors=\"${slaves}\" xmlns:n=\"\/lib\/hudson\/newFromList\" \/>","40","<\/j:jelly>"]}],"core\/src\/main\/resources\/hudson\/model\/View\/newJob.jelly":[{"add":["28","  <j:getStatic var=\"permission\" className=\"hudson.model.Item\" field=\"CREATE\"\/>","29","  <l:layout norefresh=\"true\" permission=\"${permission}\">","30","    <st:include page=\"sidepanel.jelly\" \/>","31","    <l:main-panel>","34","              descriptors=\"${jobs}\" checkUrl=\"itemExistsCheck\" xmlns:n=\"\/lib\/hudson\/newFromList\" \/>","36","  <\/l:layout>","37","<\/j:jelly>"],"delete":["28","\t<j:getStatic var=\"permission\" className=\"hudson.model.Item\" field=\"CREATE\"\/>","29","\t<l:layout norefresh=\"true\" permission=\"${permission}\">","30","\t\t<st:include page=\"sidepanel.jelly\" \/>","31","\t\t<l:main-panel>","34","              descriptors=\"${jobs}\" xmlns:n=\"\/lib\/hudson\/newFromList\" \/>","36","\t<\/l:layout>","37","<\/j:jelly>"]}],"core\/src\/main\/resources\/lib\/hudson\/newFromList\/form.jelly":[{"add":["32","    @checkUrl    : form field validation url","37","      <s:textbox id=\"name\" name=\"name\" checkUrl=\"'${rootURL}\/${checkUrl}?value='+escape(this.value)\"","91","<\/j:jelly>"],"delete":["36","      <s:textbox id=\"name\" name=\"name\" checkUrl=\"'${rootURL}\/itemExistsCheck?value='+escape(this.value)\"","90","<\/j:jelly>"]}],"core\/src\/main\/java\/hudson\/model\/ComputerSet.java":[{"add":["29","import hudson.util.FormFieldValidator;","168","        try {","169","            checkName(name);","170","        } catch (ParseException e) {","171","            rsp.setStatus(SC_BAD_REQUEST);","172","            sendError(e,req,rsp);","173","            return;","174","        }","217","            checkName(name);","224","        } catch (ParseException e) {","225","            rsp.setStatus(SC_BAD_REQUEST);","226","            sendError(e,req,rsp);","235","    private void checkName(String name) throws ParseException {","236","        if(name==null)","237","            throw new ParseException(\"Query parameter 'name' is required\",0);","238","","240","        Hudson.checkGoodName(name);","242","        if(Hudson.getInstance().getNode(name)!=null)","243","            throw new ParseException(Messages.ComputerSet_SlaveAlreadyExists(name),0);","245","        \/\/ looks good","246","    }","247","","248","    \/**","249","     * Makes sure that the given name is good as a slave name.","250","     *\/","251","    public void doCheckName(StaplerRequest req, StaplerResponse rsp, @QueryParameter final String value) throws IOException, ServletException {","252","        new FormFieldValidator(req,rsp,Hudson.ADMINISTER) {  \/\/ TODO: new permission?","253","            protected void check() throws IOException, ServletException {","254","                if(Util.fixEmpty(value)==null)","255","                    ok(); \/\/ nothing is entered yet","256","                else try {","257","                    checkName(value);","258","                    ok();","259","                } catch (ParseException e) {","260","                    error(e.getMessage());","261","                }","262","            }","263","        }.process();"],"delete":["167","        if (checkName(req, rsp, name)) return;","210","","211","            if (checkName(req, rsp, name)) return;","226","    private boolean checkName(StaplerRequest req, StaplerResponse rsp, String name) throws IOException, ServletException {","227","        if(name==null) {","228","            rsp.sendError(HttpServletResponse.SC_BAD_REQUEST,\"Query parameter 'name' is required\");","229","            return true;","230","        }","233","        try {","234","            Hudson.checkGoodName(name);","235","        } catch (ParseException e) {","236","            rsp.setStatus(SC_BAD_REQUEST);","237","            sendError(e,req,rsp);","238","            return true;","239","        }","241","        if(Hudson.getInstance().getNode(name)!=null) {","242","            rsp.setStatus(SC_BAD_REQUEST);","243","            sendError(Messages.ComputerSet_SlaveAlreadyExists(name),req,rsp);","244","            return true;","245","        }","246","        return false;"]}]}},"9b4e831c139a32cd53dd42419f7780d8cd7616ac":{"changes":{"war\/src\/main\/js\/pluginSetupWizardGui.js":"MODIFY"},"diff":{"war\/src\/main\/js\/pluginSetupWizardGui.js":[{"add":["891","\t\tvar responseText = data.responseText;","892","\t\tvar $page = $(responseText);","897","\t\t\t\tresponseText = responseText.replace(\/body([^>]*)[>](.|[\\r\\n])+[<][\/]body\/,'body$1>'+$main.html()+'<\/body');","901","\t\t\tdoc.write(responseText);"],"delete":["891","\t\tvar $page = $(data);","896","\t\t\t\tdata = data.replace(\/body([^>]*)[>](.|[\\r\\n])+[<][\/]body\/,'body$1>'+$main.html()+'<\/body');","900","\t\t\tdoc.write(data);"]}]}},"28bef5f366c2ebf6efdb4a71c920fe1d8bb28d3e":{"changes":{"test\/src\/main\/java\/org\/jvnet\/hudson\/test\/JenkinsRule.java":"MODIFY"},"diff":{"test\/src\/main\/java\/org\/jvnet\/hudson\/test\/JenkinsRule.java":[{"add":["323","        if (Thread.interrupted()) { \/\/ JENKINS-30395","324","            System.err.println(\"was interrupted before start\");","325","        }","326",""],"delete":[]}]}},"7f572c15fc81bcaa51589cb932e0a4f627787c59":{"changes":{"core\/src\/main\/java\/hudson\/model\/Hudson.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/Hudson.java":[{"add":["892","        if(getRootDir().exists())","893","            \/\/ if we are aborting because we failed to create HUDSON_HOME,","894","            \/\/ don't try to save. Issue #536","895","            getQueue().save();"],"delete":["892","        getQueue().save();"]}]}},"35206987910151e8663e3afc1222bf4d97f34a35":{"changes":{"core\/src\/main\/java\/hudson\/slaves\/EnvironmentVariablesNodeProperty.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/slaves\/EnvironmentVariablesNodeProperty.java":[{"add":["104","        if (entries!=null)\r","105","            for (Entry entry: entries)\r","106","                map.put(entry.key,entry.value);\r"],"delete":["104","\t\tfor (Entry entry: entries) {\r","105","\t\t\tmap.put(entry.key,entry.value);\r","106","\t\t}\r"]}]}},"8a91a0bd375c7c3bc731a62ae94648d5082f0b00":{"changes":{"war\/src\/main\/webapp\/scripts\/hudson-behavior.js":"MODIFY"},"diff":{"war\/src\/main\/webapp\/scripts\/hudson-behavior.js":[{"add":["1517","                    if (!rsp.responseText) {","1518","                        console.log(\"Failed to retrieve response for ID \" + id + \", perhaps Jenkins is unavailable\");","1519","                        return;","1520","                    }"],"delete":[]}]}},"accab15c1a8fdbcb68710a2c4f43620eaab82b96":{"changes":{"core\/src\/main\/java\/hudson\/model\/Hudson.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/User.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/Hudson.java":[{"add":["1303","        User.reload();"],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/User.java":[{"add":["174","     * Reloads the configuration from disk.","175","     *\/","176","    public static void reload() {","177","        \/\/ iterate over an array to be concurrency-safe","178","        for( User u : byName.values().toArray(new User[0]) )","179","            u.load();","180","    }","181","","182","    \/**"],"delete":[]}]}},"027edac3a766459a320669a59057d7ee2ec87a3c":{"changes":{"core\/src\/main\/java\/hudson\/model\/ParametersDefinitionProperty.java":"MODIFY","core\/src\/main\/resources\/hudson\/model\/ParametersDefinitionProperty\/index.jelly":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/ParametersDefinitionProperty.java":[{"add":["129","                owner, owner.getDelay(req), new ParametersAction(values), new CauseAction(new Cause.UserCause()));","147","                owner, owner.getDelay(req), new ParametersAction(values), new CauseAction(new Cause.UserCause()));"],"delete":["129","    \t\t\towner, 0, new ParametersAction(values), new CauseAction(new Cause.UserCause()));","147","    \t\t\towner, owner.getDelay(req), new ParametersAction(values), new CauseAction(new Cause.UserCause()));"]}],"core\/src\/main\/resources\/hudson\/model\/ParametersDefinitionProperty\/index.jelly":[{"add":["3","Copyright (c) 2004-2010, Sun Microsystems, Inc., Kohsuke Kawaguchi, Tom Huybrechts","36","    <st:include page=\"sidepanel.jelly\" it=\"${it.project}\" \/>","37","    <l:main-panel>","38","      <h1>${it.owner.pronoun} ${it.owner.displayName}<\/h1>","41","        <j:forEach var=\"parameterDefinition\" items=\"${it.parameterDefinitions}\">","42","          <st:include it=\"${parameterDefinition}\"","43","                      page=\"${parameterDefinition.descriptor.valuePage}\" \/>","44","        <\/j:forEach>","45","        <f:block>","46","          <j:set var=\"delay\" value=\"${request.getParameter('delay')}\" \/>","47","          <j:if test=\"${!empty(delay)}\">","48","            <input type=\"hidden\" name=\"delay\" value=\"${delay}\" \/>","49","          <\/j:if>","50","          <f:submit value=\"${%Build}\" \/>","51","        <\/f:block>","52","      <\/f:form>","53","    <\/l:main-panel>","54","  <\/l:layout>","55","<\/j:jelly>"],"delete":["3","Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi, Tom Huybrechts","36","\t<st:include page=\"sidepanel.jelly\" it=\"${it.project}\" \/>","37","\t\t<l:main-panel>","38","\t\t\t<h1>${it.owner.pronoun} ${it.owner.displayName}<\/h1>","41","\t\t\t\t<j:forEach var=\"parameterDefinition\" items=\"${it.parameterDefinitions}\">","42","\t\t\t\t\t<st:include it=\"${parameterDefinition}\"","43","\t\t\t\t\t\tpage=\"${parameterDefinition.descriptor.valuePage}\" \/>","44","\t\t\t\t<\/j:forEach>","45","\t\t\t\t<f:block>","46","\t\t\t\t\t<f:submit value=\"${%Build}\" \/>","47","\t\t\t\t<\/f:block>","48","\t\t\t<\/f:form>","49","\t\t<\/l:main-panel>","50","\t<\/l:layout>","51","<\/j:jelly>"]}]}},"1d04efb9816c0a0e72bbe8f9efc24c3aec7e4e07":{"changes":{"core\/src\/main\/resources\/lib\/form\/repeatable.jelly":"MODIFY"},"diff":{"core\/src\/main\/resources\/lib\/form\/repeatable.jelly":[{"add":["115","      <j:set var=\"items\" value=\"${attrs.items}\"\/>"],"delete":[]}]}},"07b3f2cccb077df85617f2748f9b329528bc263b":{"changes":{"changelog.html":"MODIFY"},"diff":{"changelog.html":[{"add":["57","  <li class=bug>","58","    Quiet period is blocking other jobs in queue.","59","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-12994\">issue 12994<\/a>)  "],"delete":["57","  <li class=>"]}]}},"c60147658cd3fb1b05771ecb6cb87f04a5ad64d1":{"changes":{"changelog.html":"MODIFY"},"diff":{"changelog.html":[{"add":["56","   (<a href=\"http:\/\/issues.hudson-ci.org\/browse\/HUDSON-7046\">issue 7046<\/a>)  ","57","   <li class=bug> nonRecursive option is not honored anymore when parsing pom","58","   (<a href=\"http:\/\/issues.hudson-ci.org\/browse\/HUDSON-8484\">issue 8484<\/a>)           "],"delete":["56","   (<a href=\"http:\/\/issues.hudson-ci.org\/browse\/HUDSON-7046\">issue 7046<\/a>)          "]}]}},"86c28ea056236ee9125af7cc85b256cb65643a2f":{"changes":{"core\/src\/main\/java\/hudson\/model\/Executor.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/Executor.java":[{"add":["446","            LOGGER.log(SEVERE, getName()+\": Unexpected executor death\", e);"],"delete":["446","            LOGGER.log(SEVERE, \"Unexpected executor death\", e);"]}]}},"669d34ed94f103426b764c6e285e8bd2bc34337b":{"changes":{"core\/src\/main\/java\/hudson\/model\/UsageStatistics.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/UsageStatistics.java":[{"add":["158","        List<TopLevelItem> items = j.getAllItems(TopLevelItem.class);"],"delete":["158","        List<TopLevelItem> items = j.getItems();"]}]}},"401c06aad5cccb1bcef42afd1b3dc9884039ac58":{"changes":{"maven-agent\/pom.xml":"MODIFY","test\/pom.xml":"MODIFY","remoting\/pom.xml":"MODIFY","core\/pom.xml":"MODIFY","ui-samples-plugin\/pom.xml":"MODIFY","cli\/pom.xml":"MODIFY","maven-plugin\/pom.xml":"MODIFY","debian\/debian\/changelog":"MODIFY","maven-interceptor\/pom.xml":"MODIFY","pom.xml":"MODIFY","war\/pom.xml":"MODIFY","core\/src\/main\/resources\/hudson\/matrix\/LabelAxis\/config.jelly":"MODIFY"},"diff":{"maven-agent\/pom.xml":[{"add":["29","    <version>1.382-SNAPSHOT<\/version>"],"delete":["29","    <version>1.381-SNAPSHOT<\/version>"]}],"test\/pom.xml":[{"add":["29","    <version>1.382-SNAPSHOT<\/version>"],"delete":["29","    <version>1.381-SNAPSHOT<\/version>"]}],"remoting\/pom.xml":[{"add":["29","    <version>1.382-SNAPSHOT<\/version>"],"delete":["29","    <version>1.381-SNAPSHOT<\/version>"]}],"core\/pom.xml":[{"add":["30","    <version>1.382-SNAPSHOT<\/version>"],"delete":["30","    <version>1.381-SNAPSHOT<\/version>"]}],"ui-samples-plugin\/pom.xml":[{"add":["29","    <version>1.382-SNAPSHOT<\/version>"],"delete":["29","    <version>1.381-SNAPSHOT<\/version>"]}],"cli\/pom.xml":[{"add":["6","    <version>1.382-SNAPSHOT<\/version>"],"delete":["6","    <version>1.381-SNAPSHOT<\/version>"]}],"maven-plugin\/pom.xml":[{"add":["29","    <version>1.382-SNAPSHOT<\/version>"],"delete":["29","    <version>1.381-SNAPSHOT<\/version>"]}],"debian\/debian\/changelog":[{"add":["0","hudson (1.381) unstable; urgency=low","1","","2","  * See http:\/\/hudson.dev.java.net\/changelog.html for more details.","3","","4"," -- Kohsuke Kawaguchi <kk@kohsuke.org>  Sat, 16 Oct 2010 10:23:08 -0700","5",""],"delete":[]}],"maven-interceptor\/pom.xml":[{"add":["29","    <version>1.382-SNAPSHOT<\/version>"],"delete":["29","    <version>1.381-SNAPSHOT<\/version>"]}],"pom.xml":[{"add":["35","  <version>1.382-SNAPSHOT<\/version>"],"delete":["35","  <version>1.381-SNAPSHOT<\/version>"]}],"war\/pom.xml":[{"add":["29","    <version>1.382-SNAPSHOT<\/version>","121","                <resolveArtifact groupId=\"org.jvnet.hudson.winstone\" artifactId=\"winstone\" version=\"0.9.10-hudson-24\" type=\"jar\" tofile=\"${basedir}\/target\/generated-resources\/winstone.jar\" \/>"],"delete":["29","    <version>1.381-SNAPSHOT<\/version>","121","                <resolveArtifact groupId=\"org.jvnet.hudson.winstone\" artifactId=\"winstone\" version=\"0.9.10-hudson-23\" type=\"jar\" tofile=\"${basedir}\/target\/generated-resources\/winstone.jar\" \/>"]}],"core\/src\/main\/resources\/hudson\/matrix\/LabelAxis\/config.jelly":[{"add":["37","        var values = (e.getAttribute(\"values\") || \"\").split(\/[ \\n]\/);"],"delete":["37","        var values = (e.getAttribute(\"values\") || \"\").split(\" \");"]}]}},"3c09a0c43ac85c2f85a6fd25fc12c2ab357f1461":{"changes":{"core\/src\/main\/java\/hudson\/Util.java":"MODIFY","core\/src\/test\/java\/hudson\/UtilTest.java":"MODIFY","changelog.html":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/Util.java":[{"add":["525","                while(in.read(new byte[1024])>0)","705","                int c = s.charAt(i);"],"delete":["512","     * Write-only buffer.","513","     *\/","514","    private static final byte[] garbage = new byte[8192];","515","","516","    \/**","530","                while(in.read(garbage)>0)","710","                int c = (int) s.charAt(i);"]}],"core\/src\/test\/java\/hudson\/UtilTest.java":[{"add":["34","import org.jvnet.hudson.test.Bug;","35","","181","    ","182","    \/**","183","     * Compute 'known-correct' digests and see if I still get them when computed concurrently","184","     * to another digest.","185","     *\/","186","    @Bug(10346)","187","    public void testDigestThreadSafety() throws InterruptedException {","188","    \tString a = \"abcdefgh\";","189","    \tString b = \"123456789\";","190","    \t","191","    \tString digestA = Util.getDigestOf(a);","192","    \tString digestB = Util.getDigestOf(b);","193","    \t","194","    \tDigesterThread t1 = new DigesterThread(a, digestA);","195","    \tDigesterThread t2 = new DigesterThread(b, digestB);","196","    \t","197","    \tt1.start();","198","    \tt2.start();","199","    \t","200","    \tt1.join();","201","    \tt2.join();","202","    \t","203","    \tif (t1.error != null) {","204","    \t\tfail(t1.error);","205","    \t}","206","    \tif (t2.error != null) {","207","    \t\tfail(t2.error);","208","    \t}","209","    }","210","    ","211","    private static class DigesterThread extends Thread {","212","    \tprivate String string;","213","\t\tprivate String expectedDigest;","214","\t\t","215","\t\tprivate String error;","216","","217","\t\tpublic DigesterThread(String string, String expectedDigest) {","218","    \t\tthis.string = string;","219","    \t\tthis.expectedDigest = expectedDigest;","220","    \t}","221","\t\t","222","\t\tpublic void run() {","223","\t\t\tfor (int i=0; i < 1000; i++) {","224","\t\t\t\tString digest = Util.getDigestOf(this.string);","225","\t\t\t\tif (!this.expectedDigest.equals(digest)) {","226","\t\t\t\t\tthis.error = \"Expected \" + this.expectedDigest + \", but got \" + digest;","227","\t\t\t\t\tbreak;","228","\t\t\t\t}","229","\t\t\t}","230","\t\t}","231","    }"],"delete":[]}],"changelog.html":[{"add":["57","  <li class=bug>","58","    Fixed a race condition in the fingerprint computation ","59","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-10346\">issue 10346<\/a>)"],"delete":["57","  <li class=>"]}]}},"d482f7cca6c11b65a182b83e3b69e039fc07bad3":{"changes":{"core\/pom.xml":"MODIFY"},"diff":{"core\/pom.xml":[{"add":["190","      <version>1.3.1-jenkins-9<\/version>"],"delete":["190","      <version>1.3.1-hudson-8<\/version>"]}]}},"6ca99ff8c241769959dec4b31257a54a22e340a6":{"changes":{"core\/src\/main\/java\/jenkins\/model\/DirectlyModifiableTopLevelItemGroup.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/Items.java":"MODIFY","changelog.html":"MODIFY","core\/src\/main\/java\/hudson\/model\/listeners\/ItemListener.java":"MODIFY"},"diff":{"core\/src\/main\/java\/jenkins\/model\/DirectlyModifiableTopLevelItemGroup.java":[{"add":["33"," * @since 1.548"],"delete":["33"," * @since TODO"]}],"core\/src\/main\/java\/hudson\/model\/Items.java":[{"add":["364","     * @since 1.548"],"delete":["364","     * @since TODO"]}],"changelog.html":[{"add":["57","  <li class='major rfe'>","58","    Added infrastructure for moving items into or out of folders.","59","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-20008\">issue 20008<\/a>)","60","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-18028\">issue 18028<\/a>)","61","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-18680\">issue 18680<\/a>)"],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/listeners\/ItemListener.java":[{"add":["116","     * @since 1.548","168","    \/** @since 1.548 *\/","179","     * @since 1.548"],"delete":["116","     * @since TODO","168","    \/** @since TODO *\/","179","     * @since TODO"]}]}},"ff48fbf976dd28afd6662423eb2e8c091dea812c":{"changes":{"core\/src\/main\/resources\/hudson\/matrix\/MatrixProject\/ajaxMatrix.jelly":"MODIFY","core\/src\/main\/resources\/lib\/hudson\/project\/matrix.jelly":"MODIFY","core\/src\/main\/resources\/hudson\/matrix\/MatrixBuild\/ajaxMatrix.jelly":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/matrix\/MatrixProject\/ajaxMatrix.jelly":[{"add":["30","      <j:choose>","31","        <j:when test=\"${p==null}\">","32","          <img src=\"${imagesURL}\/24x24\/grey.gif\" tooltip=\"${%Not configured}\" alt=\"${%Not configured}\"\/>","33","        <\/j:when>","34","        <j:otherwise>","35","          <a href=\"${p.shortUrl}\">","36","            <img src=\"${imagesURL}\/24x24\/${p.buildStatusUrl}\" tooltip=\"${p.iconColor.description}\" alt=\"${p.iconColor.description}\"\/>","37","            <j:if test=\"${empty(o.x) and empty(o.y)}\">","38","              ${p.combination.toString(o.z)}","39","            <\/j:if>","40","          <\/a>","41","        <\/j:otherwise>","42","      <\/j:choose>"],"delete":["30","      <a href=\"${p.shortUrl}\">","31","        <img src=\"${imagesURL}\/24x24\/${p.buildStatusUrl}\" tooltip=\"${p.iconColor.description}\" alt=\"${p.iconColor.description}\"\/>","32","        <j:if test=\"${empty(o.x) and empty(o.y)}\">","33","          ${p.combination.toString(o.z)}","34","        <\/j:if>","35","      <\/a>"]}],"core\/src\/main\/resources\/lib\/hudson\/project\/matrix.jelly":[{"add":["45","      <!-- Optimized case when there's only one dimension to the axis (or zero dimension) -->","100","<\/j:jelly>"],"delete":["45","      <!-- Optimized case when there's only dimention to the axis (or zero dimension) -->","100","<\/j:jelly>"]}],"core\/src\/main\/resources\/hudson\/matrix\/MatrixBuild\/ajaxMatrix.jelly":[{"add":["31","      <j:choose>","32","        <j:when test=\"${b==null}\">","33","          <img src=\"${imagesURL}\/24x24\/grey.gif\" tooltip=\"${%Not run}\" alt=\"${%Not run}\"\/>","34","        <\/j:when>","35","        <j:otherwise>","36","          <a href=\"${p.combination}\/\">","37","            <img src=\"${imagesURL}\/24x24\/${b.buildStatusUrl}\" tooltip=\"${p.tooltip}\" alt=\"${p.tooltip}\"\/>","38","            <j:if test=\"${empty(o.x) and empty(o.y)}\">","39","              ${p.combination.toString(o.z)}","40","            <\/j:if>","41","          <\/a>","42","        <\/j:otherwise>","43","      <\/j:choose>"],"delete":["31","      <a href=\"${p.combination}\/\">","32","        <img src=\"${imagesURL}\/24x24\/${h.ifThenElse(b!=null,b.buildStatusUrl,'grey.gif')}\"","33","             tooltip=\"${p.tooltip}\" alt=\"${p.tooltip}\"\/>","34","        <j:if test=\"${empty(o.x) and empty(o.y)}\">","35","          ${p.combination.toString(o.z)}","36","        <\/j:if>","37","      <\/a>"]}]}},"fc05e5cb6b498f7f1cd6e3ec3b9048e395ce5a4f":{"changes":{"war\/src\/main\/js\/add-item.js":"MODIFY"},"diff":{"war\/src\/main\/js\/add-item.js":[{"add":["132","        switch (e.which) {","136","            e.stopPropagation();","198","        $('#createItem').find('input[type=\"radio\"][value=\"copy\"]').removeAttr('checked');","199","      } else {","200","        $('.categories').find('li[role=\"radio\"]').attr(\"aria-checked\", \"false\");","201","        $('#createItem').find('input[type=\"radio\"][name=\"mode\"]').removeAttr('checked');","202","        $('.categories').find('.active').removeClass('active');","203","        $('#createItem').find('input[type=\"radio\"][value=\"copy\"]').prop('checked', true);"],"delete":["132","        switch (e.keyCode) {","133","          case 0:","139","        e.stopPropagation();","197","    $('input[name=\"from\"]', '#createItem').focus(function() {","198","      $('#createItem').find('input[type=\"radio\"][value=\"copy\"]').prop('checked', true);","199","      $('.categories').find('.active').removeClass('active');","200","    });","201","","204","        $('#createItem').find('input[type=\"radio\"][value=\"copy\"]').prop('checked', false);"]}]}},"312ca05bc7b89dc7a2cff9ded0568e1924dd8b94":{"changes":{"maven-interceptor\/src\/main\/java\/hudson\/maven\/agent\/PluginManagerInterceptor.java":"MODIFY"},"diff":{"maven-interceptor\/src\/main\/java\/hudson\/maven\/agent\/PluginManagerInterceptor.java":[{"add":["78","                        if(configuratorFilter==null)","79","                            return c; \/\/ not activated","145","        } finally {","146","            configuratorFilter = null;"],"delete":[]}]}},"a6a3d5e1660735edc18d331500f7ce9850fbc724":{"changes":{"core\/src\/main\/java\/hudson\/model\/ListView.java":"MODIFY","changelog.html":"MODIFY","core\/src\/main\/java\/hudson\/model\/Fingerprint.java":"MODIFY","core\/src\/main\/java\/hudson\/tasks\/BuildTrigger.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/listeners\/ItemListener.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/ListView.java":[{"add":["31","import hudson.security.ACL;","434","        @Override public void onLocationChanged(final Item item, final String oldFullName, final String newFullName) {","435","            ACL.impersonate(ACL.SYSTEM, new Runnable() {","436","                @Override public void run() {","437","                    locationChanged(item, oldFullName, newFullName);","438","                }","439","            });","440","        }","441","        private void locationChanged(Item item, String oldFullName, String newFullName) {","479","        @Override public void onDeleted(final Item item) {","480","            ACL.impersonate(ACL.SYSTEM, new Runnable() {","481","                @Override public void run() {","482","                    deleted(item);","483","                }","484","            });","485","        }","486","        private void deleted(Item item) {"],"delete":["433","        @Override public void onLocationChanged(Item item, String oldFullName, String newFullName) {","471","        @Override public void onDeleted(Item item) {"]}],"changelog.html":[{"add":["58","    Some plugins broken since 1.584 if they expected certain events to be fired under a specific user ID.","59","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-25400\">issue 25400<\/a>)","60","  <li class=bug>"],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/Fingerprint.java":[{"add":["41","import hudson.security.ACL;","732","        public void onLocationChanged(final Item item, final String oldName, final String newName) {","733","            ACL.impersonate(ACL.SYSTEM, new Runnable() {","734","                @Override public void run() {","735","                    locationChanged(item, oldName, newName);","736","                }","737","            });","738","        }","739","        private void locationChanged(Item item, String oldName, String newName) {"],"delete":["731","        public void onLocationChanged(Item item, String oldName, String newName) {"]}],"core\/src\/main\/java\/hudson\/tasks\/BuildTrigger.java":[{"add":["408","            public void onLocationChanged(final Item item, final String oldFullName, final String newFullName) {","409","                ACL.impersonate(ACL.SYSTEM, new Runnable() {","410","                    @Override public void run() {","411","                        locationChanged(item, oldFullName, newFullName);","412","                    }","413","                });","414","            }","415","            private void locationChanged(Item item, String oldFullName, String newFullName) {"],"delete":["408","            public void onLocationChanged(Item item, String oldFullName, String newFullName) {"]}],"core\/src\/main\/java\/hudson\/model\/listeners\/ItemListener.java":[{"add":["33","import java.util.List;","36","import jenkins.security.NotReallyRoleSensitiveCallable;","162","    private static void forAll(final \/* java.util.function.Consumer<ItemListener> *\/Function<ItemListener,Void> consumer) {","163","        for (ItemListener l : all()) {","164","            try {","165","                consumer.apply(l);","166","            } catch (RuntimeException x) {","167","                LOGGER.log(Level.WARNING, \"failed to send event to listener of \" + l.getClass(), x);","178","        });","187","        });","196","        });","206","        });","232","            });","239","        });","241","            for (final Item child : ACL.impersonate(ACL.SYSTEM, new NotReallyRoleSensitiveCallable<List<Item>,RuntimeException>() {","242","                @Override public List<Item> call() {","243","                    return Items.getAllItems((ItemGroup) rootItem, Item.class);","244","                }","245","            })) {","255","                });"],"delete":["160","    private static void forAll(final \/* java.util.function.Consumer<ItemListener> *\/Function<ItemListener,Void> consumer, boolean asSystem) {","161","        Runnable r = new Runnable() {","162","            @Override public void run() {","163","                for (ItemListener l : all()) {","164","                    try {","165","                        consumer.apply(l);","166","                    } catch (RuntimeException x) {","167","                        LOGGER.log(Level.WARNING, \"failed to send event to listener of \" + l.getClass(), x);","168","                    }","169","                }","171","        };","172","        if (asSystem) {","173","            ACL.impersonate(ACL.SYSTEM, r);","174","        } else {","175","            r.run();","185","        }, true);","194","        }, true);","203","        }, true);","213","        }, true);","223","        ACL.impersonate(ACL.SYSTEM, new Runnable() {","224","            @Override public void run() {","225","                doFireLocationChange(rootItem, oldFullName);","226","            }","227","        });","228","    }","229","    private static void doFireLocationChange(final Item rootItem, final String oldFullName) {","246","            }, false);","253","        }, false);","255","            for (final Item child : Items.getAllItems((ItemGroup) rootItem, Item.class)) {","265","                }, false);"]}]}},"e7c3a58e7d0285fbb74e7a77f572576eb0535666":{"changes":{"core\/pom.xml":"MODIFY","changelog.html":"MODIFY"},"diff":{"core\/pom.xml":[{"add":["460","      <version>3.3.0-jenkins-3<\/version>"],"delete":["460","      <version>3.3.0-jenkins-2<\/version>"]}],"changelog.html":[{"add":["65","  <li class=bug>","66","    Jenkins unable to start if the \/tmp\/jna catalogue exists and is owned by a different user","67","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-10774\">issue 10774<\/a>)"],"delete":[]}]}},"2eda7816e8007851ced3d618cd0fe42c78a486e2":{"changes":{"war\/src\/main\/webapp\/scripts\/hudson-behavior.js":"MODIFY","core\/src\/main\/resources\/jenkins\/model\/MasterBuildConfiguration\/config.groovy":"MODIFY","core\/src\/main\/resources\/jenkins\/model\/Jenkins\/MasterComputer\/configure.jelly":"MODIFY","core\/src\/main\/java\/hudson\/model\/Computer.java":"MODIFY","core\/src\/main\/java\/jenkins\/model\/MasterBuildConfiguration.java":"MODIFY","core\/src\/main\/java\/jenkins\/model\/Jenkins.java":"MODIFY","core\/src\/main\/resources\/jenkins\/model\/Messages.properties":"MODIFY"},"diff":{"war\/src\/main\/webapp\/scripts\/hudson-behavior.js":[{"add":["696","    \"INPUT.number\" : function(e) { registerRegexpValidator(e,\/^\\-?(\\d+)$\/,\"Not an integer\"); },","697","    \"INPUT.non-negative-number\" : function(e) {","698","        registerRegexpValidator(e,\/^\\d+$\/,\"Not a non-negative number\");","699","    },","701","        registerRegexpValidator(e,\/^[1-9]\\d*$\/,\"Not a positive integer\");"],"delete":["696","    \"INPUT.number\" : function(e) { registerRegexpValidator(e,\/^(\\d+|)$\/,\"Not an integer\"); },","698","        registerRegexpValidator(e,\/^(\\d*[1-9]\\d*|)$\/,\"Not a positive integer\");"]}],"core\/src\/main\/resources\/jenkins\/model\/MasterBuildConfiguration\/config.groovy":[{"add":["5","    f.number(clazz:\"non-negative-number\", min:0, step:1)"],"delete":["5","    f.number(clazz:\"number\", min:0, step:1)"]}],"core\/src\/main\/resources\/jenkins\/model\/Jenkins\/MasterComputer\/configure.jelly":[{"add":["44","          <f:number clazz=\"non-negative-number\" min=\"0\" step=\"1\"\/>"],"delete":["44","          <f:number clazz=\"positive-number\" min=\"0\" step=\"1\"\/>"]}],"core\/src\/main\/java\/hudson\/model\/Computer.java":[{"add":["1474","        String nExecutors = req.getSubmittedForm().getString(\"numExecutors\");","1475","        if (Integer.parseInt(nExecutors)<=0) {","1476","            throw new FormException(Messages.Slave_InvalidConfig_Executors(nodeName), \"numExecutors\");","1477","        }","1478",""],"delete":[]}],"core\/src\/main\/java\/jenkins\/model\/MasterBuildConfiguration.java":[{"add":["53","            String num = json.getString(\"numExecutors\");","54","            if (!num.matches(\"\\\\d+\")) {","55","                throw new FormException(Messages.Hudson_Computer_IncorrectNumberOfExecutors(),\"numExecutors\");","56","            }","57","            "],"delete":[]}],"core\/src\/main\/java\/jenkins\/model\/Jenkins.java":[{"add":["292","import javax.annotation.Nonnegative;","2716","    \/**","2717","     * Sets a number of executors.","2718","     * @param n Number of executors","2719","     * @throws IOException Failed to save the configuration","2720","     * @throws IllegalArgumentException Negative value has been passed","2721","     *\/","2722","    public void setNumExecutors(@Nonnegative int n) throws IOException, IllegalArgumentException {","2723","        if (n < 0) {","2724","            throw new IllegalArgumentException(\"Incorrect field \\\"# of executors\\\": \" + n +\". It should be a non-negative number.\");","2725","        }"],"delete":["2715","    public void setNumExecutors(int n) throws IOException {"]}],"core\/src\/main\/resources\/jenkins\/model\/Messages.properties":[{"add":["28","Hudson.Computer.IncorrectNumberOfExecutors=Incorrect field \"# of executors\". It should be a non-negative number."],"delete":[]}]}},"fe60cc4ebb3941cbc4860afc313773faa6fb8aec":{"changes":{"core\/src\/main\/java\/hudson\/tasks\/LogRotator.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/tasks\/LogRotator.java":[{"add":["129","                LOGGER.log(FINER,r.getFullDisplayName()+\" is to be removed\");","155","                LOGGER.log(FINER,r.getFullDisplayName()+\" is to be removed\");"],"delete":[]}]}},"397ab3e2ca1d04cc14bd862d06dec45fcb9f85b3":{"changes":{"war\/src\/main\/js\/api\/pluginManager.js":"MODIFY"},"diff":{"war\/src\/main\/js\/api\/pluginManager.js":[{"add":["48","    return plugins.recommendedPlugins.slice(); \/\/ copy this"],"delete":["48","    return plugins.recommendedPlugins;"]}]}},"5ea48db3d21247c75a019d372c4054e0b1549786":{"changes":{"test\/src\/test\/resources\/hudson\/maven\/foobar_eclipse_with_fix.zip":"ADD","test\/src\/test\/java\/hudson\/maven\/Maven3BuildTest.java":"MODIFY"},"diff":{"test\/src\/test\/resources\/hudson\/maven\/foobar_eclipse_with_fix.zip":[{"add":[],"delete":[]}],"test\/src\/test\/java\/hudson\/maven\/Maven3BuildTest.java":[{"add":["223","","224","    @Bug(9326)","225","    public void testTychoEclipseTestResults() throws Exception {","226","        MavenInstallation mavenInstallation = configureMaven3();","227","        MavenModuleSet m = createMavenProject();","228","        m.setRootPOM( \"org.foobar.build\/pom.xml\" );","229","        m.setMaven( mavenInstallation.getName() );","230","        m.getReporters().add(new TestReporter());","231","        m.setScm(new ExtractResourceSCM(getClass().getResource(\"foobar_eclipse_with_fix.zip\"),\"foobar_eclipse\"));","232","        m.setGoals(\"verify\");","233","        buildAndAssertSuccess(m);","234","","235","        System.out.println(\"modules size \" + m.getModules());","236","","237","","238","        MavenModule testModule = null;","239","        for (MavenModule mavenModule : m.getModules()) {","240","            System.out.println(\"module \" + mavenModule.getName() + \"\/\" + mavenModule.getDisplayName());","241","            if (\"org.foobar:org.foobar.test\".equals( mavenModule.getName() )) testModule = mavenModule;","242","        }","243","","244","        AbstractTestResultAction trpa = testModule.getLastBuild().getTestResultAction();","245","","246","        int totalCount = trpa.getTotalCount();","247","        assertEquals(1, totalCount);","248","    }"],"delete":[]}]}},"1e6afbae3b82936602f28c402379e04d0b00a47e":{"changes":{"core\/src\/main\/java\/hudson\/PluginManager.java":"MODIFY","core\/src\/main\/java\/jenkins\/util\/JSONSignatureValidator.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/PluginManager.java":[{"add":["1410","        try {","1411","            for (UpdateSite site : Jenkins.getInstance().getUpdateCenter().getSites()) {","1412","                FormValidation v = site.updateDirectlyNow(DownloadService.signatureCheck);","1413","                if (v.kind != FormValidation.Kind.OK) {","1414","                    \/\/ TODO crude but enough for now","1415","                    return v;","1416","                }","1418","            for (DownloadService.Downloadable d : DownloadService.Downloadable.all()) {","1419","                FormValidation v = d.updateNow();","1420","                if (v.kind != FormValidation.Kind.OK) {","1421","                    return v;","1422","                }","1424","            return HttpResponses.forwardToPreviousPage();","1425","        } catch(RuntimeException ex) {","1426","            throw new IOException(\"Unhandled exception during updates server check\", ex);"],"delete":["1410","        for (UpdateSite site : Jenkins.getInstance().getUpdateCenter().getSites()) {","1411","            FormValidation v = site.updateDirectlyNow(DownloadService.signatureCheck);","1412","            if (v.kind != FormValidation.Kind.OK) {","1413","                \/\/ TODO crude but enough for now","1414","                return v;","1416","        }","1417","        for (DownloadService.Downloadable d : DownloadService.Downloadable.all()) {","1418","            FormValidation v = d.updateNow();","1419","            if (v.kind != FormValidation.Kind.OK) {","1420","                return v;","1423","        return HttpResponses.forwardToPreviousPage();"]}],"core\/src\/main\/java\/jenkins\/util\/JSONSignatureValidator.java":[{"add":["84","            if (certs.isEmpty()) {","85","                return FormValidation.error(\"No certificate found in %s. Cannot verify the signature\", name);","86","            } else {    ","87","                sig.initVerify(certs.get(0));","88","            }"],"delete":["84","            sig.initVerify(certs.get(0));"]}]}},"b06e2aa3414d480d8b44459b0632226921be85f6":{"changes":{"core\/src\/main\/java\/hudson\/lifecycle\/Lifecycle.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/lifecycle\/Lifecycle.java":[{"add":["160","        if (f == null || !f.canWrite()) {","161","            return false;","162","        }","163","        File parent = f.getParentFile();","164","        if (parent == null || !parent.canWrite()) {","165","            return false;","166","        }","167","        return true;"],"delete":["160","        return f!=null && f.canWrite();"]}]}},"d062392108b2cd54eb445da603a83beac7f39b25":{"changes":{"core\/src\/main\/resources\/lib\/form\/select\/select.js":"MODIFY"},"diff":{"core\/src\/main\/resources\/lib\/form\/select\/select.js":[{"add":["45","            \/\/ seems like a race condition allows this to fire before the 'selectEl' is defined. If that happens, exit..","46","            if(!selectEl || !selectEl.options || !selectEl[0]) ","47","              return false;"],"delete":[]}]}},"e27b05f0e0f85996f212145f5d02635194e288f3":{"changes":{"core\/src\/main\/resources\/hudson\/model\/RunParameterDefinition\/index.jelly":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/model\/RunParameterDefinition\/index.jelly":[{"add":["33","                <option value=\"${run.externalizableId}\">${run.fullDisplayName}<\/option>","38","<\/j:jelly>"],"delete":["33","                <option value=\"${run.externalizableId}\">${run}<\/option>","38","<\/j:jelly>"]}]}},"f568a43170d070fda257e0fdbfb34b6419b4f9f8":{"changes":{"maven-plugin\/src\/main\/java\/hudson\/maven\/MavenModuleSetBuild.java":"MODIFY"},"diff":{"maven-plugin\/src\/main\/java\/hudson\/maven\/MavenModuleSetBuild.java":[{"add":["285","     * ","286","     * @return the estimated duration in milliseconds","287","     * @since 1.383","299","        ","300","        boolean noModuleBuildsYet = true; ","301","        ","304","                noModuleBuildsYet = false;","312","        if (noModuleBuildsYet) {","313","            \/\/ modules not determined, yet, i.e. POM not parsed.","314","            \/\/ Use best estimation we have:","315","            return super.getEstimatedDuration();","316","        }","317","        "],"delete":[]}]}},"aef102cb727fe65305a5f66fc5949096c9a5b473":{"changes":{"core\/src\/main\/java\/hudson\/model\/Hudson.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/Hudson.java":[{"add":["1396","                File mac = new File(f,\"lib\/dt.jar\");"],"delete":["1396","                File mac = new File(f,\"Classes\/classes.jar\");"]}]}},"b4ff724c0ca83039fcfdbb431ad173709437350d":{"changes":{"core\/src\/main\/resources\/lib\/hudson\/scriptConsole_de.properties":"MODIFY"},"diff":{"core\/src\/main\/resources\/lib\/hudson\/scriptConsole_de.properties":[{"add":["28","  verwenden, gehen die Ausgaben auf die Standardausgabe (STDOUT) des Servers, die schwieriger \\"],"delete":["28","  verwenden, gehen die Ausgaben auf die Standardausgabe (STDOUT) des Servers, die schwieriger "]}]}},"5db90b704f27a8ffab79e0b317ce39aa0e485197":{"changes":{"core\/src\/main\/resources\/hudson\/model\/AllView\/noJob.properties":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/model\/AllView\/noJob.properties":[{"add":["25","  <a href=\"https:\/\/jenkins.io\/redirect\/distributed-builds\" target=\"_blank\">Learn more<\/a>.","28","  <a href=\"https:\/\/jenkins.io\/redirect\/distributed-builds\" target=\"_blank\">Learn more<\/a>."],"delete":["25","  <a href=\"https:\/\/jenkins.io\/redirects\/distributed-builds\">Learn more<\/a>.","28","  <a href=\"https:\/\/jenkins.io\/redirects\/distributed-builds\">Learn more<\/a>."]}]}},"0959c863264142ade523df1b8578ba316235c78c":{"changes":{"core\/src\/main\/resources\/hudson\/tasks\/Messages_de.properties":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/tasks\/Messages_de.properties":[{"add":["42","BuildTrigger.Disabled={0} ist deaktiviert. Keine Auslsung des Builds."],"delete":["42","BuildTrigger.Disabled={0} is deaktiviert. Keine Auslsung des Builds."]}]}},"db7f7b42f63a39787b13f8ddc2b1cefc1b06c0b6":{"changes":{"war\/src\/main\/webapp\/css\/style.css":"MODIFY"},"diff":{"war\/src\/main\/webapp\/css\/style.css":[{"add":["459","table.stripped tr:nth-of-type(even) {","462",""],"delete":["459","table.stripped tr:nth-child(even) {"]}]}},"b086943a3577aa325767b6be643256e8c84ebd07":{"changes":{"changelog.html":"MODIFY"},"diff":{"changelog.html":[{"add":["275","  <li class=bug>","276","    Incorrect URL computation broke context menu for computers with spaces in their names.","277","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-18236\">issue 18236<\/a>)"],"delete":[]}]}},"7e0d7c0acba504b8bd205cdb228346bbfa09ddfa":{"changes":{"core\/src\/main\/java\/hudson\/cli\/BuildCommand.java":"MODIFY","test\/src\/test\/groovy\/hudson\/cli\/BuildCommandTest.groovy":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/cli\/BuildCommand.java":[{"add":["93","            List<ParameterValue> values = new ArrayList<ParameterValue>();","103","","104","            \/\/ handle missing parameters by adding as default values ISSUE JENKINS-7162","105","            for(ParameterDefinition pd :  pdp.getParameterDefinitions()) {","106","                if (parameters.containsKey(pd.getName()))","107","                    continue;","108","","109","                \/\/ not passed in use default","110","                values.add(pd.getDefaultParameterValue());","111","            }","112","","156","","158","","162","","166",""],"delete":["93","            List<ParameterValue> values = new ArrayList<ParameterValue>(); ","103","            ","147","    \t","149","    \t","153","    \t","157","    \t"]}],"test\/src\/test\/groovy\/hudson\/cli\/BuildCommandTest.groovy":[{"add":["100","    void testDefaultParameters() {","101","        def p = createFreeStyleProject();","102","        p.addProperty(new ParametersDefinitionProperty([new StringParameterDefinition(\"key\",\"default\"), new StringParameterDefinition(\"key2\",\"default2\") ]));","103","","104","        def cli = new CLI(getURL())","105","        try {","106","            cli.execute([\"build\",\"-s\",\"-p\",\"key=foobar\",p.name])","107","            def b = assertBuildStatusSuccess(p.getBuildByNumber(1))","108","            assertEquals(\"foobar\",b.getAction(ParametersAction.class).getParameter(\"key\").value)","109","            assertEquals(\"default2\",b.getAction(ParametersAction.class).getParameter(\"key2\").value)","110","        } finally {","111","            cli.close();","112","        }","113","    }","114",""],"delete":[]}]}},"e7eac75978b111dc8e9634860bf97bc3379ae0d4":{"changes":{"core\/src\/test\/java\/hudson\/scheduler\/CronTabDayOfWeekLocaleTest.java":"ADD","core\/src\/main\/java\/hudson\/scheduler\/CronTab.java":"MODIFY"},"diff":{"core\/src\/test\/java\/hudson\/scheduler\/CronTabDayOfWeekLocaleTest.java":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/scheduler\/CronTab.java":[{"add":["220","                cal.add(Calendar.DAY_OF_WEEK, 7 * i);","226","                int was = c.get(field);","228","                final int firstDayOfWeek = c.getFirstDayOfWeek();","229","                if (v < firstDayOfWeek && was >= firstDayOfWeek) {","234","                } else if (was < firstDayOfWeek && firstDayOfWeek <= v) {","235","                    \/\/ If we wrap the other way around, we need to adjust in the opposite direction of above.","236","                    addTo(c, 7);"],"delete":["220","                cal.add(Calendar.DAY_OF_WEEK,7);","227","                if (v<c.getFirstDayOfWeek()) {"]}]}},"a101330ebd81c4755414a70eb32956c571a89f2f":{"changes":{"core\/src\/main\/resources\/lib\/layout\/layout.jelly":"MODIFY"},"diff":{"core\/src\/main\/resources\/lib\/layout\/layout.jelly":[{"add":["3","Copyright (c) 2004-2010, Sun Microsystems, Inc., Kohsuke Kawaguchi,","4","Daniel Dyer, Seiji Sogabe, Tom Huybrechts","24","<?jelly escape-by-default='true'?>","187","                  ${anc.object.displayName}"],"delete":["3","Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi, Daniel Dyer, Seiji Sogabe, Tom Huybrechts","23","","186","                  ${h.escape(anc.object.displayName)}"]}]}},"f74d573328f1a2e8a0afc218e3141197f71dfa92":{"changes":{"core\/src\/main\/java\/hudson\/triggers\/SCMTrigger.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/triggers\/SCMTrigger.java":[{"add":["286","","287","                AbstractBuild b = job.asProject().getLastBuild();","288","                if(b!=null && b.isBuilding())","289","                    return; \/\/ build in progress","290",""],"delete":["286","                "]}]}},"af832b83d3c9728083d5b26b7f5990d7bd8a0fd3":{"changes":{"core\/src\/main\/java\/hudson\/model\/Hudson.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/Hudson.java":[{"add":["2963","                    doQuietDown(true, 0);"],"delete":["2963","                    doQuietDown(true, 5000);"]}]}},"6065a957bce84773cc113f710156e36de4c12e31":{"changes":{"core\/src\/main\/java\/hudson\/lifecycle\/UnixLifecycle.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/Hudson.java":"MODIFY","core\/src\/main\/java\/hudson\/Platform.java":"MODIFY","changelog.html":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/lifecycle\/UnixLifecycle.java":[{"add":["33","","34","import hudson.Platform;","90","        \/\/","91","        \/\/ according to http:\/\/www.mail-archive.com\/wine-devel@winehq.org\/msg66797.html this now works on Snow Leopard","92","        if (Platform.isDarwin() && !Platform.isSnowLeopardOrLater())"],"delete":["88","        if (Hudson.isDarwin())"]}],"core\/src\/main\/java\/hudson\/model\/Hudson.java":[{"add":["42","import hudson.Platform;","3490","    \/**","3491","     * @deprecated","3492","     *      Use {@link Platform#isDarwin()}","3493","     *\/","3495","        return Platform.isDarwin();"],"delete":["3490","        \/\/ according to http:\/\/developer.apple.com\/technotes\/tn2002\/tn2110.html","3491","        return System.getProperty(\"os.name\").toLowerCase(Locale.ENGLISH).startsWith(\"mac\");"]}],"core\/src\/main\/java\/hudson\/Platform.java":[{"add":["25","import hudson.util.VersionNumber;","26","","28","import java.util.Locale;","57","","58","    public static boolean isDarwin() {","59","        \/\/ according to http:\/\/developer.apple.com\/technotes\/tn2002\/tn2110.html","60","        return System.getProperty(\"os.name\").toLowerCase(Locale.ENGLISH).startsWith(\"mac\");","61","    }","62","","63","    \/**","64","     * Returns true if we run on Mac OS X >= 10.6","65","     *\/","66","    public static boolean isSnowLeopardOrLater() {","67","        try {","68","            return isDarwin() && new VersionNumber(System.getProperty(\"os.version\")).compareTo(new VersionNumber(\"10.6\"))>=0;","69","        } catch (IllegalArgumentException e) {","70","            \/\/ failed to parse the version","71","            return false;","72","        }","73","    }"],"delete":[]}],"changelog.html":[{"add":["73","  <li class=rfe>","74","    Support self restart on Mac OS X 10.6 and onward","75","    (<a href=\"http:\/\/issues.jenkins-ci.org\/browse\/JENKINS-7537\">issue 7537<\/a>)"],"delete":[]}]}},"c1852a759dbe139535c40400e6b5688d1dc9e2e2":{"changes":{"core\/pom.xml":"MODIFY"},"diff":{"core\/pom.xml":[{"add":["713","      <version>1.2<\/version>"],"delete":["713","      <version>1.1<\/version>"]}]}},"d760216d1e3a927b971edf27c7af317a5de71e20":{"changes":{"core\/src\/main\/java\/hudson\/slaves\/SlaveComputer.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/slaves\/SlaveComputer.java":[{"add":["39","import hudson.remoting.ChannelBuilder;","45","import hudson.util.IOUtils;","51","import jenkins.model.Jenkins;","52","import jenkins.security.ChannelConfigurator;","53","import jenkins.security.MasterToSlaveCallable;","55","import jenkins.slaves.JnlpSlaveAgentProtocol;","59","import org.kohsuke.stapler.HttpRedirect;","60","import org.kohsuke.stapler.HttpResponse;","61","import org.kohsuke.stapler.QueryParameter;","62","import org.kohsuke.stapler.StaplerRequest;","63","import org.kohsuke.stapler.StaplerResponse;","67","import javax.annotation.CheckForNull;","85","import static hudson.slaves.SlaveComputer.LogHolder.SLAVE_LOG_HANDLER;","483","                try {","484","                    launcher.afterDisconnect(SlaveComputer.this, taskListener);","485","                } catch (Throwable t) {","486","                    LogRecord lr = new LogRecord(Level.SEVERE,","487","                            \"Launcher {0}'s afterDisconnect method propagated an exception when {1}'s connection was closed: {2}\");","488","                    lr.setThrown(t);","489","                    lr.setParameters(new Object[]{launcher, SlaveComputer.this, t.getMessage()});","490","                    logger.log(lr);","491","                }"],"delete":["28","import hudson.remoting.ChannelBuilder;","29","import hudson.util.IOUtils;","55","import org.apache.commons.io.FilenameUtils;","76","import javax.annotation.CheckForNull;","77","import jenkins.model.Jenkins;","78","import static hudson.slaves.SlaveComputer.LogHolder.*;","79","import jenkins.security.ChannelConfigurator;","80","import jenkins.security.MasterToSlaveCallable;","81","import jenkins.slaves.JnlpSlaveAgentProtocol;","82","import org.kohsuke.stapler.StaplerRequest;","83","import org.kohsuke.stapler.StaplerResponse;","84","import org.kohsuke.stapler.QueryParameter;","85","import org.kohsuke.stapler.HttpResponse;","86","import org.kohsuke.stapler.HttpRedirect;","484","                launcher.afterDisconnect(SlaveComputer.this, taskListener);"]}]}},"fb5540e38c935676d7f58e9d2ce7a84275bb898f":{"changes":{"core\/src\/main\/java\/hudson\/model\/AbstractItem.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/AbstractItem.java":[{"add":["218","        String oldName = this.name;","219","        String oldFullName = getFullName();","327","        ItemListener.fireLocationChange(this, oldFullName);"],"delete":["250","","251","                String oldName = this.name;","252","                String oldFullName = getFullName();","326","","327","                ItemListener.fireLocationChange(this, oldFullName);"]}]}},"df831325b6623c479dcf4b215415f4523d10530b":{"changes":{"core\/src\/main\/java\/hudson\/model\/Computer.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/Computer.java":[{"add":["1157","                    LOGGER.log(Level.FINE, \"{0} is not an IPv4 address\", address);","1161","                    LOGGER.log(Level.FINE, \"{0} didn't respond to ping\", address);","1169","                LogRecord lr = new LogRecord(Level.FINE, \"Failed to parse {0}\");","1170","                lr.setThrown(e);","1171","                lr.setParameters(new Object[]{address});","1172","                LOGGER.log(lr);","1196","        private static final Logger LOGGER = Logger.getLogger(ListPossibleNames.class.getName());","1197","        ","1204","                LOGGER.log(Level.FINE, \"Listing up IP addresses for {0}\", ni.getDisplayName());","1209","                        LOGGER.log(Level.FINE, \"{0} is a loopback address\", ia);","1214","                        LOGGER.log(Level.FINE, \"{0} is not an IPv4 address\", ia);","1218","                    LOGGER.log(Level.FINE, \"{0} is a viable candidate\", ia);"],"delete":["1157","                    LOGGER.fine(address+\" is not an IPv4 address\");","1161","                    LOGGER.fine(address+\" didn't respond to ping\");","1169","                LOGGER.log(Level.FINE, \"Failed to parse \"+address,e);","1199","                LOGGER.fine(\"Listing up IP addresses for \"+ni.getDisplayName());","1204","                        LOGGER.fine(ia+\" is a loopback address\");","1209","                        LOGGER.fine(ia+\" is not an IPv4 address\");","1213","                    LOGGER.fine(ia+\" is a viable candidate\");"]}]}},"45e09682401f2274d1143c62971c5664e5a73b20":{"changes":{"changelog.html":"MODIFY"},"diff":{"changelog.html":[{"add":["51","   (<a href=\"http:\/\/issues.hudson-ci.org\/browse\/HUDSON-8418\">issue 8418<\/a>)","52","  <li class=rfe> maven2 build fails due to 'RELEASE' plugin version.","53","   (<a href=\"http:\/\/issues.hudson-ci.org\/browse\/HUDSON-8462\">issue 8462<\/a>)          "],"delete":["51","   (<a href=\"http:\/\/issues.hudson-ci.org\/browse\/HUDSON-8418\">issue 8418<\/a>)       "]}]}},"c62f4f753d16210b67ec381b9e5d1d60145594d8":{"changes":{"core\/src\/test\/java\/hudson\/util\/XStream2Test.java":"MODIFY","core\/src\/main\/java\/hudson\/util\/RobustReflectionConverter.java":"MODIFY"},"diff":{"core\/src\/test\/java\/hudson\/util\/XStream2Test.java":[{"add":["25","import static org.hamcrest.CoreMatchers.is;","35","import java.util.ArrayList;","36","import java.util.Arrays;","42","import jenkins.model.Jenkins;","302","","303","    @Issue(\"JENKINS-21017\")","304","    @Test","305","    public void unmarshalToDefault_populated() {","306","        String populatedXml = \"<hudson.util.XStream2Test_-WithDefaults>\\n\"","307","                + \"  <stringDefaultValue>my string<\/stringDefaultValue>\\n\"","308","                + \"  <stringDefaultNull>not null<\/stringDefaultNull>\\n\"","309","                + \"  <arrayDefaultValue>\\n\"","310","                + \"    <string>1<\/string>\\n\"","311","                + \"    <string>2<\/string>\\n\"","312","                + \"    <string>3<\/string>\\n\"","313","                + \"  <\/arrayDefaultValue>\\n\"","314","                + \"  <arrayDefaultEmpty>\\n\"","315","                + \"    <string>1<\/string>\\n\"","316","                + \"    <string>2<\/string>\\n\"","317","                + \"    <string>3<\/string>\\n\"","318","                + \"  <\/arrayDefaultEmpty>\\n\"","319","                + \"  <arrayDefaultNull>\\n\"","320","                + \"    <string>1<\/string>\\n\"","321","                + \"    <string>2<\/string>\\n\"","322","                + \"    <string>3<\/string>\\n\"","323","                + \"  <\/arrayDefaultNull>\\n\"","324","                + \"  <listDefaultValue>\\n\"","325","                + \"    <string>1<\/string>\\n\"","326","                + \"    <string>2<\/string>\\n\"","327","                + \"    <string>3<\/string>\\n\"","328","                + \"  <\/listDefaultValue>\\n\"","329","                + \"  <listDefaultEmpty>\\n\"","330","                + \"    <string>1<\/string>\\n\"","331","                + \"    <string>2<\/string>\\n\"","332","                + \"    <string>3<\/string>\\n\"","333","                + \"  <\/listDefaultEmpty>\\n\"","334","                + \"  <listDefaultNull>\\n\"","335","                + \"    <string>1<\/string>\\n\"","336","                + \"    <string>2<\/string>\\n\"","337","                + \"    <string>3<\/string>\\n\"","338","                + \"  <\/listDefaultNull>\\n\"","339","                + \"<\/hudson.util.XStream2Test_-WithDefaults>\";","340","","341","        WithDefaults existingInstance = new WithDefaults(\"foobar\",","342","                \"foobar\",","343","                new String[]{\"foobar\", \"barfoo\", \"fumanchu\"},","344","                new String[]{\"foobar\", \"barfoo\", \"fumanchu\"},","345","                new String[]{\"foobar\", \"barfoo\", \"fumanchu\"},","346","                Arrays.asList(\"foobar\", \"barfoo\", \"fumanchu\"),","347","                Arrays.asList(\"foobar\", \"barfoo\", \"fumanchu\"),","348","                Arrays.asList(\"foobar\", \"barfoo\", \"fumanchu\")","349","        );","350","","351","        WithDefaults newInstance = new WithDefaults();","352","","353","        String xmlA = Jenkins.XSTREAM2.toXML(Jenkins.XSTREAM2.fromXML(populatedXml, existingInstance));","354","        String xmlB = Jenkins.XSTREAM2.toXML(Jenkins.XSTREAM2.fromXML(populatedXml, newInstance));","355","        String xmlC = Jenkins.XSTREAM2.toXML(Jenkins.XSTREAM2.fromXML(populatedXml, null));","356","","357","        assertThat(\"Deserializing over an existing instance is the same as with no root\", xmlA, is(xmlC));","358","        assertThat(\"Deserializing over an new instance is the same as with no root\", xmlB, is(xmlC));","359","    }","360","","361","","362","    @Issue(\"JENKINS-21017\")","363","    @Test","364","    public void unmarshalToDefault_default() {","365","        String defaultXml = \"<hudson.util.XStream2Test_-WithDefaults>\\n\"","366","                + \"  <stringDefaultValue>defaultValue<\/stringDefaultValue>\\n\"","367","                + \"  <arrayDefaultValue>\\n\"","368","                + \"    <string>first<\/string>\\n\"","369","                + \"    <string>second<\/string>\\n\"","370","                + \"  <\/arrayDefaultValue>\\n\"","371","                + \"  <arrayDefaultEmpty\/>\\n\"","372","                + \"  <listDefaultValue>\\n\"","373","                + \"    <string>first<\/string>\\n\"","374","                + \"    <string>second<\/string>\\n\"","375","                + \"  <\/listDefaultValue>\\n\"","376","                + \"  <listDefaultEmpty\/>\\n\"","377","                + \"<\/hudson.util.XStream2Test_-WithDefaults>\";","378","","379","        WithDefaults existingInstance = new WithDefaults(\"foobar\",","380","                \"foobar\",","381","                new String[]{\"foobar\", \"barfoo\", \"fumanchu\"},","382","                new String[]{\"foobar\", \"barfoo\", \"fumanchu\"},","383","                new String[]{\"foobar\", \"barfoo\", \"fumanchu\"},","384","                Arrays.asList(\"foobar\", \"barfoo\", \"fumanchu\"),","385","                Arrays.asList(\"foobar\", \"barfoo\", \"fumanchu\"),","386","                Arrays.asList(\"foobar\", \"barfoo\", \"fumanchu\")","387","        );","388","","389","        WithDefaults newInstance = new WithDefaults();","390","","391","        String xmlA = Jenkins.XSTREAM2.toXML(Jenkins.XSTREAM2.fromXML(defaultXml, existingInstance));","392","        String xmlB = Jenkins.XSTREAM2.toXML(Jenkins.XSTREAM2.fromXML(defaultXml, newInstance));","393","        String xmlC = Jenkins.XSTREAM2.toXML(Jenkins.XSTREAM2.fromXML(defaultXml, null));","394","","395","        assertThat(\"Deserializing over an existing instance is the same as with no root\", xmlA, is(xmlC));","396","        assertThat(\"Deserializing over an new instance is the same as with no root\", xmlB, is(xmlC));","397","    }","398","","399","","400","    @Issue(\"JENKINS-21017\")","401","    @Test","402","    public void unmarshalToDefault_empty() {","403","        String emptyXml = \"<hudson.util.XStream2Test_-WithDefaults\/>\";","404","","405","        WithDefaults existingInstance = new WithDefaults(\"foobar\",","406","                \"foobar\",","407","                new String[]{\"foobar\", \"barfoo\", \"fumanchu\"},","408","                new String[]{\"foobar\", \"barfoo\", \"fumanchu\"},","409","                new String[]{\"foobar\", \"barfoo\", \"fumanchu\"},","410","                Arrays.asList(\"foobar\", \"barfoo\", \"fumanchu\"),","411","                Arrays.asList(\"foobar\", \"barfoo\", \"fumanchu\"),","412","                Arrays.asList(\"foobar\", \"barfoo\", \"fumanchu\")","413","        );","414","","415","        WithDefaults newInstance = new WithDefaults();","416","","417","        String xmlA = Jenkins.XSTREAM2.toXML(Jenkins.XSTREAM2.fromXML(emptyXml, existingInstance));","418","        String xmlB = Jenkins.XSTREAM2.toXML(Jenkins.XSTREAM2.fromXML(emptyXml, newInstance));","419","        String xmlC = Jenkins.XSTREAM2.toXML(Jenkins.XSTREAM2.fromXML(emptyXml, null));","420","","421","        assertThat(\"Deserializing over an existing instance is the same as with no root\", xmlA, is(xmlC));","422","        assertThat(\"Deserializing over an new instance is the same as with no root\", xmlB, is(xmlC));","423","    }","424","","425","    public static class WithDefaults {","426","        private String stringDefaultValue = \"defaultValue\";","427","        private String stringDefaultNull;","428","        private String[] arrayDefaultValue = { \"first\", \"second\" };","429","        private String[] arrayDefaultEmpty = new String[0];","430","        private String[] arrayDefaultNull;","431","        private List<String> listDefaultValue = new ArrayList<>(Arrays.asList(\"first\", \"second\"));","432","        private List<String> listDefaultEmpty = new ArrayList<>();","433","        private List<String> listDefaultNull;","434","","435","        public WithDefaults() {","436","        }","437","","438","        public WithDefaults(String stringDefaultValue, String stringDefaultNull, String[] arrayDefaultValue,","439","                            String[] arrayDefaultEmpty, String[] arrayDefaultNull,","440","                            List<String> listDefaultValue, List<String> listDefaultEmpty,","441","                            List<String> listDefaultNull) {","442","            this.stringDefaultValue = stringDefaultValue;","443","            this.stringDefaultNull = stringDefaultNull;","444","            this.arrayDefaultValue = arrayDefaultValue == null ? null : arrayDefaultValue.clone();","445","            this.arrayDefaultEmpty = arrayDefaultEmpty == null ? null : arrayDefaultEmpty.clone();","446","            this.arrayDefaultNull = arrayDefaultNull == null ? null : arrayDefaultNull.clone();","447","            this.listDefaultValue = listDefaultValue == null ? null : new ArrayList<>(listDefaultValue);","448","            this.listDefaultEmpty = listDefaultEmpty == null ? null : new ArrayList<>(listDefaultEmpty);","449","            this.listDefaultNull = listDefaultNull == null ? null : new ArrayList<>(listDefaultNull);","450","        }","451","","452","        public String getStringDefaultValue() {","453","            return stringDefaultValue;","454","        }","455","","456","        public void setStringDefaultValue(String stringDefaultValue) {","457","            this.stringDefaultValue = stringDefaultValue;","458","        }","459","","460","        public String getStringDefaultNull() {","461","            return stringDefaultNull;","462","        }","463","","464","        public void setStringDefaultNull(String stringDefaultNull) {","465","            this.stringDefaultNull = stringDefaultNull;","466","        }","467","","468","        public String[] getArrayDefaultValue() {","469","            return arrayDefaultValue;","470","        }","471","","472","        public void setArrayDefaultValue(String[] arrayDefaultValue) {","473","            this.arrayDefaultValue = arrayDefaultValue;","474","        }","475","","476","        public String[] getArrayDefaultEmpty() {","477","            return arrayDefaultEmpty;","478","        }","479","","480","        public void setArrayDefaultEmpty(String[] arrayDefaultEmpty) {","481","            this.arrayDefaultEmpty = arrayDefaultEmpty;","482","        }","483","","484","        public String[] getArrayDefaultNull() {","485","            return arrayDefaultNull;","486","        }","487","","488","        public void setArrayDefaultNull(String[] arrayDefaultNull) {","489","            this.arrayDefaultNull = arrayDefaultNull;","490","        }","491","","492","        public List<String> getListDefaultValue() {","493","            return listDefaultValue;","494","        }","495","","496","        public void setListDefaultValue(List<String> listDefaultValue) {","497","            this.listDefaultValue = listDefaultValue;","498","        }","499","","500","        public List<String> getListDefaultEmpty() {","501","            return listDefaultEmpty;","502","        }","503","","504","        public void setListDefaultEmpty(List<String> listDefaultEmpty) {","505","            this.listDefaultEmpty = listDefaultEmpty;","506","        }","507","","508","        public List<String> getListDefaultNull() {","509","            return listDefaultNull;","510","        }","511","","512","        public void setListDefaultNull(List<String> listDefaultNull) {","513","            this.listDefaultNull = listDefaultNull;","514","        }","515","    }"],"delete":[]}],"core\/src\/main\/java\/hudson\/util\/RobustReflectionConverter.java":[{"add":["273","    private static final class FieldExpectation {","274","        private final Class definingClass;","275","        private final String name;","276","","277","        public FieldExpectation(Class definingClass, String name) {","278","            this.definingClass = definingClass;","279","            this.name = name;","280","        }","281","","282","        public Class getDefiningClass() {","283","            return definingClass;","284","        }","285","","286","        public String getName() {","287","            return name;","288","        }","289","","290","        @Override","291","        public boolean equals(Object o) {","292","            if (this == o) {","293","                return true;","294","            }","295","            if (o == null || getClass() != o.getClass()) {","296","                return false;","297","            }","298","","299","            FieldExpectation that = (FieldExpectation) o;","300","","301","            if (definingClass != null ? !definingClass.equals(that.definingClass) : that.definingClass != null) {","302","                return false;","303","            }","304","            return name.equals(that.name);","305","        }","306","","307","        @Override","308","        public int hashCode() {","309","            int result = definingClass != null ? definingClass.hashCode() : 0;","310","            result = 31 * result + name.hashCode();","311","            return result;","312","        }","313","","314","        @Override","315","        public String toString() {","316","            return \"FieldExpectation{\" +","317","                    \"definingClass=\" + definingClass +","318","                    \", name='\" + name + '\\'' +","319","                    '}';","320","        }","321","","322","","323","    }","324","","327","        final boolean existingObject = context.currentObject() != null;","328","        final Map<FieldExpectation, Object> expectedFields = existingObject ? new HashMap<FieldExpectation, Object>() : null;","329","        final Object cleanInstance = existingObject ? reflectionProvider.newInstance(result.getClass()) : null;","330","        if (existingObject) {","331","            reflectionProvider.visitSerializableFields(cleanInstance, new ReflectionProvider.Visitor() {","332","                @Override","333","                public void visit(String name, Class type, Class definedIn, Object value) {","334","                    expectedFields.put(new FieldExpectation(definedIn, name), value);","335","                }","336","            });","337","        }","366","                    if (existingObject) {","367","                        expectedFields.remove(new FieldExpectation(","368","                                classDefiningField == null ? result.getClass() : classDefiningField, attrName));","369","                    }","411","                    if (existingObject) {","412","                        expectedFields.remove(new FieldExpectation(","413","                                classDefiningField == null ? result.getClass() : classDefiningField, fieldName));","414","                    }","444","        if (existingObject) {","445","            for (Map.Entry<FieldExpectation, Object> entry : expectedFields.entrySet()) {","446","                reflectionProvider.writeField(result, entry.getKey().getName(), entry.getValue(),","447","                        entry.getKey().getDefiningClass());","448","            }","449","        }"],"delete":[]}]}},"dbeda50abaa9c1a23cd4be6938e28c3d0193c745":{"changes":{"core\/src\/main\/resources\/jenkins\/model\/RenameAction\/action.jelly":"MODIFY"},"diff":{"core\/src\/main\/resources\/jenkins\/model\/RenameAction\/action.jelly":[{"add":["28","      <l:task href=\"${h.getActionUrl(it.url, action)}\" icon=\"icon-notepad icon-md\" enabled=\"${it.nameEditable}\" title=\"${%Rename}\"\/>"],"delete":["28","      <l:task href=\"${url}\/confirm-rename\" icon=\"icon-notepad icon-md\" enabled=\"${it.nameEditable}\" title=\"${%Rename}\"\/>"]}]}},"022544dc5347818da7e92ce6b6485f2e1e159866":{"changes":{"changelog.html":"MODIFY","core\/src\/main\/java\/jenkins\/model\/ModelObjectWithContextMenu.java":"MODIFY"},"diff":{"changelog.html":[{"add":["57","  <li class=bug>","58","    Some of the context menu items have wrong links","59","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-12945\">issue 12945<\/a>)"],"delete":[]}],"core\/src\/main\/java\/jenkins\/model\/ModelObjectWithContextMenu.java":[{"add":["26","import java.net.URI;","166","            this.url = URI.create(Stapler.getCurrentRequest().getRequestURI()).resolve(url).toString();"],"delete":["165","            this.url = url;"]}]}},"f89ff9ac8c25cea4f286773c544fffb0baa68ec9":{"changes":{"core\/src\/main\/resources\/hudson\/security\/GlobalMatrixAuthorizationStrategy\/config.jelly":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/security\/GlobalMatrixAuthorizationStrategy\/config.jelly":[{"add":["3","Copyright (c) 2004-2011, Sun Microsystems, Inc., Kohsuke Kawaguchi, Seiji Sogabe","23","<?jelly escape-by-default='true'?>","153","          <j:set var=\"descriptorPath\" value=\"${descriptor.descriptorFullUrl}\"\/>"],"delete":["3","Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi, Seiji Sogabe","23","","153","          <j:set var=\"descriptorPath\" value=\"${rootURL}${descriptor.descriptorFullUrl}\"\/>"]}]}},"4bca0b5934739a05780795652bd085c9c289d70d":{"changes":{"core\/src\/main\/resources\/hudson\/model\/Hudson\/newView.jelly":"MODIFY","core\/src\/main\/resources\/hudson\/model\/View\/newJob.jelly":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/model\/Hudson\/newView.jelly":[{"add":["4","  <l:layout norefresh=\"true\" permission=\"${app.primaryView.CREATE}\">"],"delete":["4","  <l:layout norefresh=\"true\">"]}],"core\/src\/main\/resources\/hudson\/model\/View\/newJob.jelly":[{"add":["4","\t<j:getStatic var=\"permission\" className=\"hudson.model.Item\" field=\"CREATE\"\/>","5","\t<l:layout norefresh=\"true\" permission=\"${permission}\">"],"delete":["4","\t<l:layout norefresh=\"true\">"]}]}},"86319de87b8469c06cf56ed933cfe85bade4eee4":{"changes":{"core\/src\/main\/resources\/lib\/form\/dropdownDescriptorSelector.jelly":"MODIFY"},"diff":{"core\/src\/main\/resources\/lib\/form\/dropdownDescriptorSelector.jelly":[{"add":["44","    <st:attribute name=\"capture\">","45","      Config fragments from descriptors are rendered lazily by default, which means","46","      variables seen in the caller aren't visible to them. This attribute allows you","47","      to nominate additional variables and their values to be captured for descriptors.","48","    <\/st:attribute>","58","    <j:set var=\"capture\" value=\"${attrs.capture?:''}\" \/>","62","        lazy=\"descriptor,it,${capture}\">"],"delete":["56","        lazy=\"descriptor\">"]}]}},"846ec90dd396416d70a50086a357950d1d9e2bcf":{"changes":{"changelog.html":"MODIFY"},"diff":{"changelog.html":[{"add":["74","  <li class=\"bug\">","75","    Update JNA library to 4.2.1 in order to integrate fixes for linux-ppc64 and linux-arm platforms.","76","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-15792\">issue 15792<\/a>)"],"delete":[]}]}},"850485acf3f1e95c92231aa0dfb577d132bdc647":{"changes":{"core\/src\/main\/resources\/hudson\/model\/AbstractProject\/sidepanel.jelly":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/model\/AbstractProject\/sidepanel.jelly":[{"add":["39","      <j:choose>","40","        <j:when test=\"${it.parent==app}\">","41","          <l:task icon=\"images\/24x24\/up.png\" href=\"${rootURL}\/\" title=\"${%Back to Dashboard}\" contextMenu=\"false\" \/>","42","        <\/j:when>","43","        <j:otherwise>","44","          <l:task icon=\"images\/24x24\/up.png\" href=\"${url}\/..\/..\/\" title=\"${%Up}\" contextMenu=\"false\" \/>","45","        <\/j:otherwise>","46","      <\/j:choose>"],"delete":["39","      <l:task icon=\"images\/24x24\/up.png\" href=\"${rootURL}\/\" title=\"${%Back to Dashboard}\" contextMenu=\"false\" \/>"]}]}},"e442bdf88d857489e439a4e0fb3637fdeedae000":{"changes":{"core\/src\/main\/resources\/hudson\/model\/View\/noJob.properties":"MODIFY","changelog.html":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/model\/View\/noJob.properties":[{"add":["23","description_2=You can either <a href=\"configure\">add some existing jobs<\/a> to this view or create a <a href=\"newJob\">new job<\/a> in this view."],"delete":["23","description_2=Please <a href=\"configure\">add some<\/a>."]}],"changelog.html":[{"add":["75","  <li class=rfe>","76","    Fixed unclear text for Tabs with no jobs","77","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-9330\">issue 9330<\/a>)"],"delete":[]}]}},"96a782853eb006d76eb8eb2aad68d3046a5f9756":{"changes":{"core\/pom.xml":"MODIFY"},"diff":{"core\/pom.xml":[{"add":["43","    <groovy.version>2.4.7<\/groovy.version>"],"delete":["43","    <groovy.version>2.4.6-jenkins-1<\/groovy.version>"]}]}},"1c1d5a95d9d5aa86b5ae890942553fbcb0f1a641":{"changes":{"\/dev\/null":"DELETE","core\/src\/main\/resources\/hudson\/model\/AbstractProject\/help-label_zh_TW.html":"ADD","core\/src\/main\/resources\/hudson\/model\/AbstractProject\/help-label.html":"ADD"},"diff":{"\/dev\/null":[{"add":[],"delete":[]}],"core\/src\/main\/resources\/hudson\/model\/AbstractProject\/help-label_zh_TW.html":[{"add":[],"delete":[]}],"core\/src\/main\/resources\/hudson\/model\/AbstractProject\/help-label.html":[{"add":[],"delete":[]}]}},"1083a3f5c648e87464e25815779690eed1fb3296":{"changes":{"core\/src\/main\/java\/hudson\/model\/Queue.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/Queue.java":[{"add":["1569","            if (s != null) {","1570","                try {","1571","                    s.sortBuildableItems(buildables);","1572","                } catch (Throwable e) {","1573","                    \/\/ We don't really care if the sort doesn't sort anything, we still should","1574","                    \/\/ continue to do our job. We'll complain about it and continue.","1575","                    LOGGER.log(Level.WARNING, \"s.sortBuildableItems() threw Throwable: {0}\", e);","1576","                }","1577","            }"],"delete":["1569","            if (s != null)","1570","                s.sortBuildableItems(buildables);"]}]}},"495779d4ca7d04179d7e34c9624c0387d3d340c9":{"changes":{"changelog.html":"MODIFY"},"diff":{"changelog.html":[{"add":["64","  <li class=bug>","65","    Do not expose the proxy password in the HTML for Update Center","66","    (<a href=\"http:\/\/issues.jenkins-ci.org\/browse\/JENKINS-4000\">issue 4000<\/a>)","83","    Strongly encrypt the proxy password"],"delete":["80","    Strongly encrypt proxy credentials"]}]}},"aebb876cc82d405022dd3317ece199017d3b7aa8":{"changes":{"changelog.html":"MODIFY","pom.xml":"MODIFY"},"diff":{"changelog.html":[{"add":["57","  <li class=\"major bug\">","58","    Memory exhausion in remoting channel since 1.560.","59","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-22734\">issue 22734<\/a>)"],"delete":["57","  <li class=>"]}],"pom.xml":[{"add":["174","        <version>2.41<\/version>"],"delete":["174","        <version>2.40<\/version>"]}]}},"119d8aa2861c01324fb560ff36140cecb7f722b5":{"changes":{"test\/src\/test\/java\/hudson\/maven\/MavenMultiModuleTest.java":"MODIFY","maven-plugin\/src\/main\/java\/hudson\/maven\/MavenModuleSetBuild.java":"MODIFY","test\/src\/test\/resources\/hudson\/maven\/maven-multimod.zip":"MODIFY","test\/src\/test\/resources\/hudson\/maven\/maven-multimod-rel-base.zip":"ADD"},"diff":{"test\/src\/test\/java\/hudson\/maven\/MavenMultiModuleTest.java":[{"add":["12","import hudson.scm.ChangeLogSet;","28","        configureDefaultMaven(\"apache-maven-2.2.1\", MavenInstallation.MAVEN_21);","75","    @Bug(5357","76","    public void testIncrRelMultiModMaven() throws Exception {","77","        configureDefaultMaven(\"apache-maven-2.2.1\", MavenInstallation.MAVEN_21);","78","        MavenModuleSet m = createMavenProject();","79","        m.setRootPOM(\"parent\/pom.xml\");","80","        m.getReporters().add(new TestReporter());","81","\tm.setScm(new ExtractResourceWithChangesSCM(getClass().getResource(\"maven-multimod-rel-base.zip\"),","82","\t\t\t\t\t\t   getClass().getResource(\"maven-multimod-changes.zip\")));","83","        ","84","\tbuildAndAssertSuccess(m);","85","        ","86","\t\/\/ Now run a second build with the changes.","87","\tm.setIncrementalBuild(true);","88","        buildAndAssertSuccess(m);","89","        ","90","\tMavenModuleSetBuild pBuild = m.getLastBuild();","91","\tExtractChangeLogSet changeSet = (ExtractChangeLogSet) pBuild.getChangeSet();","92","        ","93","\tassertFalse(\"ExtractChangeLogSet should not be empty.\", changeSet.isEmptySet());","94","","95","\tfor (MavenBuild modBuild : pBuild.getModuleLastBuilds().values()) {","96","\t    String parentModuleName = modBuild.getParent().getModuleName().toString();","97","            if (parentModuleName.equals(\"org.jvnet.hudson.main.test.multimod:moduleA\")) {","98","\t\tassertEquals(\"moduleA should have Result.NOT_BUILT\", Result.NOT_BUILT, modBuild.getResult());","99","\t    }","100","\t    else if (parentModuleName.equals(\"org.jvnet.hudson.main.test.multimod:moduleB\")) {","101","\t\tassertEquals(\"moduleB should have Result.SUCCESS\", Result.SUCCESS, modBuild.getResult());","102","\t    }","103","\t    else if (parentModuleName.equals(\"org.jvnet.hudson.main.test.multimod:moduleC\")) {","104","\t\tassertEquals(\"moduleC should have Result.SUCCESS\", Result.SUCCESS, modBuild.getResult());","105","\t    }","106","\t}\t","107","\t","108","        long summedModuleDuration = 0;","109","        for (MavenBuild modBuild : pBuild.getModuleLastBuilds().values()) {","110","            summedModuleDuration += modBuild.getDuration();","111","        }","112","        assertTrue(\"duration of moduleset build should be greater-equal than sum of the module builds\",","113","                   pBuild.getDuration() >= summedModuleDuration);","114","    }","115","    "],"delete":["27","        configureDefaultMaven();"]}],"maven-plugin\/src\/main\/java\/hudson\/maven\/MavenModuleSetBuild.java":[{"add":["52","import org.apache.commons.io.FilenameUtils;","167","                    if(path.startsWith(FilenameUtils.normalize(sub.getRelativePath())))","176","                for (String path : e.getAffectedPaths()) {","177","                    if(path.startsWith(FilenameUtils.normalize(mod.getRelativePath())))","179","                }"],"delete":["166","                    if(path.startsWith(sub.getRelativePath()))","175","                for (String path : e.getAffectedPaths())","176","                    if(path.startsWith(mod.getRelativePath()))"]}],"test\/src\/test\/resources\/hudson\/maven\/maven-multimod.zip":[{"add":[],"delete":[]}],"test\/src\/test\/resources\/hudson\/maven\/maven-multimod-rel-base.zip":[{"add":[],"delete":[]}]}},"b5fe89cc9873a1c16c580ced43054b62ef70589b":{"changes":{"core\/src\/main\/java\/hudson\/TcpSlaveAgentListener.java":"MODIFY","core\/src\/main\/resources\/hudson\/TcpSlaveAgentListener\/index.jelly":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/TcpSlaveAgentListener.java":[{"add":["25","import edu.umd.cs.findbugs.annotations.SuppressFBWarnings;","60","import org.kohsuke.accmod.Restricted;","61","import org.kohsuke.accmod.restrictions.NoExternalUse;","64"," * Listens to incoming TCP connections from JNLP agents and Remoting CLI.","100","        LOGGER.log(Level.FINE, \"TCP agent listener started on port {0}\", getPort());","160","                LOGGER.log(Level.SEVERE,\"Failed to accept TCP connections\", e);","246","                } catch (IOException ex) {","253","                } catch (IOException ex) {","297","            LOGGER.log(Level.WARNING, \"Connection #{0} is aborted: {1}\", new Object[]{id, msg});","403","    @SuppressFBWarnings(value = \"MS_SHOULD_BE_FINAL\", justification = \"Accessible via System Groovy Scripts\")","404","    @Restricted(NoExternalUse.class)","417","    @SuppressFBWarnings(value = \"MS_SHOULD_BE_FINAL\", justification = \"Accessible via System Groovy Scripts\")","418","    @Restricted(NoExternalUse.class)"],"delete":["61"," * Listens to incoming TCP connections from JNLP agents and CLI.","97","        LOGGER.log(Level.FINE, \"JNLP agent listener started on TCP port {0}\", getPort());","157","                LOGGER.log(Level.SEVERE,\"Failed to accept JNLP agent connections\",e);","243","                } catch (IOException _) {","250","                } catch (IOException _) {","294","            LOGGER.log(Level.WARNING,\"Connection #\"+id+\" is aborted: \"+msg);"]}],"core\/src\/main\/resources\/hudson\/TcpSlaveAgentListener\/index.jelly":[{"add":["28","    Publicize the TCP port number for TCP agents and Remoting CLI so that they know where to connect."],"delete":["28","    Publicize the TCP port number for JNLP agents so that they know where to connect."]}]}},"ca5b9b667231fb4805e6001910dee1a26c5d4c68":{"changes":{"core\/src\/main\/java\/hudson\/model\/Run.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/Run.java":[{"add":["1782","                    RunListener.fireCompleted(this,listener);"],"delete":["1788","                    RunListener.fireCompleted(this,listener);"]}]}},"ebb84da617a989d9d1bff8660d9903d89ca3ea41":{"changes":{"core\/src\/main\/java\/hudson\/PluginManager.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/PluginManager.java":[{"add":["562","                    \/\/ And then add the current plugin ","563","                    dependencySet.add(dependencyURL);"],"delete":["560","                    dependencySet.add(dependencyURL);"]}]}},"b10b645ff6f82fad24a430f19cd8acbc59f4f38f":{"changes":{"core\/src\/main\/resources\/hudson\/security\/HudsonPrivateSecurityRealm\/index_es.properties":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/security\/HudsonPrivateSecurityRealm\/index_es.properties":[{"add":["23","   Estos usuarios pueden entrar en Jenkins. Este es un subconjunto de <a href=\"..\/asynchPeople\">esta lista<\/a>, \\"],"delete":["23","   Estos usuarios pueden entrar en Jenkins. Este es un subconjunto de <a href=\"..\/asynchPeople\">esta list<\/a>, \\"]}]}},"9c96f3dcca1784094f28ccd6df6abed1d229a1d4":{"changes":{"debian\/debian\/jenkins.default":"MODIFY","changelog.html":"MODIFY"},"diff":{"debian\/debian\/jenkins.default":[{"add":["42","#   027 makes files read-only for group and inaccessible for others, which some security sensitive users","43","#   might consider benefitial, especially if Jenkins runs in a box that's used for multiple purposes.","44","#   Beware that 027 permission would interfere with sudo scripts that run on the master (JENKINS-25065.)","45","#","46","#   Note also that the particularly sensitive part of $JENKINS_HOME (such as credentials) are always","47","#   written without 'others' access. So the umask values only affect job configuration, build records,","48","#   that sort of things.","49","#","50","#   If commented out, the value from the OS is inherited,  which is normally 022 (as of Ubuntu 12.04,","51","#   by default umask comes from pam_umask(8) and \/etc\/login.defs","52","","53","# UMASK=027"],"delete":["42","#   027 makes files read-only for group and inaccessible for others. comment this out to inherit setting","43","#   (as of Ubuntu 12.04, by default umask comes from pam_umask(8) and \/etc\/login.defs","44","UMASK=027"]}],"changelog.html":[{"add":["62","  <li class=bug>","63","    Due to the reaction, default umask in debian package is set back to 022","64","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-25065\">issue 25065<\/a>)"],"delete":[]}]}},"3087d4cdbac67b3454f4c406699643714d576b0c":{"changes":{"war\/pom.xml":"MODIFY"},"diff":{"war\/pom.xml":[{"add":["150","                  <version>0.9.10-hudson-6<\/version>"],"delete":["150","                  <version>0.9.10-hudson-5<\/version>"]}]}},"313fb5940f63ca7e13281f4bba1cdbcfcfd8f2c3":{"changes":{"core\/src\/main\/java\/hudson\/console\/ConsoleNote.java":"MODIFY","changelog.html":"MODIFY","core\/src\/main\/java\/hudson\/console\/AnnotatedLargeText.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/console\/ConsoleNote.java":[{"add":["224","            try {","225","                return (ConsoleNote) ois.readObject();","226","            } finally {","227","                ois.close();","228","            }"],"delete":["224","            return (ConsoleNote) ois.readObject();"]}],"changelog.html":[{"add":["66","    Fixed random OutOfMemoryError with console annotations","67","  (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-9349\">issue 9349<\/a>)","68","  <li class=bug>"],"delete":[]}],"core\/src\/main\/java\/hudson\/console\/AnnotatedLargeText.java":[{"add":["123","                try {","124","                    long timestamp = ois.readLong();","125","                    if (TimeUnit2.HOURS.toMillis(1) > abs(System.currentTimeMillis()-timestamp))","126","                        \/\/ don't deserialize something too old to prevent a replay attack","127","                        return (ConsoleAnnotator)ois.readObject();","128","                } finally {","129","                    ois.close();","130","                }"],"delete":["123","                long timestamp = ois.readLong();","124","                if (TimeUnit2.HOURS.toMillis(1) > abs(System.currentTimeMillis()-timestamp))","125","                    \/\/ don't deserialize something too old to prevent a replay attack","126","                    return (ConsoleAnnotator)ois.readObject();"]}]}},"9dca500e22b2eafad02e8d38a98e1aa5484a5495":{"changes":{"core\/pom.xml":"MODIFY","changelog.html":"MODIFY"},"diff":{"core\/pom.xml":[{"add":["44","    <stapler.version>1.173<\/stapler.version>"],"delete":["44","    <stapler.version>1.172<\/stapler.version>"]}],"changelog.html":[{"add":["69","  <li class=bug>","70","    Fixed a possible NPE during the boot sequence","71","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-10799\">issue 10799<\/a>)"],"delete":[]}]}},"18027c5b0c4ab9f0dc1fe180282742c0144e672a":{"changes":{"core\/pom.xml":"MODIFY"},"diff":{"core\/pom.xml":[{"add":["111","      <version>3.0.45<\/version>"],"delete":["111","      <version>3.0.41<\/version>"]}]}},"4d0def46ccf9e97074b3f4b4e66ebfe9ead9b74b":{"changes":{"test\/src\/test\/java\/hudson\/model\/AbstractProjectTest.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/AbstractBuild.java":"MODIFY"},"diff":{"test\/src\/test\/java\/hudson\/model\/AbstractProjectTest.java":[{"add":["345","        assertEquals(b1.getRootDir().getAbsolutePath(), resolveAll(link).getAbsolutePath());","348","        assertEquals(b2.getRootDir().getAbsolutePath(), resolveAll(link).getAbsolutePath());","351","        assertEquals(b1.getRootDir().getAbsolutePath(), resolveAll(link).getAbsolutePath());","356","    private File resolveAll(File link) throws InterruptedException, IOException {","357","        while (true) {","358","            File f = Util.resolveSymlinkToFile(link);","359","            if (f==null)    return link;","360","            link = f;","361","        }","362","    }","363",""],"delete":["345","        assertEquals(b1.getRootDir().getAbsolutePath(), Util.resolveSymlink(link));","348","        assertEquals(b2.getRootDir().getAbsolutePath(), Util.resolveSymlink(link));","351","        assertEquals(b1.getRootDir().getAbsolutePath(), Util.resolveSymlink(link));"]}],"core\/src\/main\/java\/hudson\/model\/AbstractBuild.java":[{"add":["485","            targetDir = getProject().getBuildDir()+\"\/\"+target.getId();"],"delete":["485","            targetDir = getProject().getBuildDir()+target.getId();"]}]}},"cefc36448c4922266e6ce2615c563fade23a5ba4":{"changes":{"core\/src\/main\/java\/hudson\/model\/Job.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/Job.java":[{"add":["73"," * ","76"," * ","79","public abstract class Job<JobT extends Job<JobT, RunT>, RunT extends Run<JobT, RunT>>","80","\t\textends AbstractItem implements ExtensionPoint {","82","\t\/**","83","\t * Next build number. Kept in a separate file because this is the only","84","\t * information that gets updated often. This allows the rest of the","85","\t * configuration to be in the VCS.","86","\t * <p>","87","\t * In 1.28 and earlier, this field was stored in the project configuration","88","\t * file, so even though this is marked as transient, don't move it around.","89","\t *\/","90","\tprotected transient volatile int nextBuildNumber = 1;","92","\tprivate volatile LogRotator logRotator;","94","\t\/**","95","\t * Not all plugins are good at calculating their health report quickly.","96","\t * These fields are used to cache the health reports to speed up rendering","97","\t * the main page.","98","\t *\/","99","\tprivate transient Integer cachedBuildHealthReportsBuildNumber = null;","100","\tprivate transient List<HealthReport> cachedBuildHealthReports = null;","102","\tprivate boolean keepDependencies;","104","\t\/**","105","\t * List of {@link UserProperty}s configured for this project.","106","\t *\/","107","\tprotected CopyOnWriteList<JobProperty<? super JobT>> properties = new CopyOnWriteList<JobProperty<? super JobT>>();","109","\tprotected Job(ItemGroup parent, String name) {","110","\t\tsuper(parent, name);","111","\t}","113","\tpublic void onLoad(ItemGroup<? extends Item> parent, String name)","114","\t\t\tthrows IOException {","115","\t\tsuper.onLoad(parent, name);","117","\t\tTextFile f = getNextBuildNumberFile();","118","\t\tif (f.exists()) {","119","\t\t\t\/\/ starting 1.28, we store nextBuildNumber in a separate file.","120","\t\t\t\/\/ but old Hudson didn't do it, so if the file doesn't exist,","121","\t\t\t\/\/ assume that nextBuildNumber was read from config.xml","122","\t\t\ttry {","123","\t\t\t\tthis.nextBuildNumber = Integer.parseInt(f.readTrim());","124","\t\t\t} catch (NumberFormatException e) {","125","\t\t\t\tthrow new IOException2(f + \" doesn't contain a number\", e);","126","\t\t\t}","127","\t\t} else {","128","\t\t\t\/\/ this must be the old Hudson. create this file now.","129","\t\t\tsaveNextBuildNumber();","130","\t\t\tsave(); \/\/ and delete it from the config.xml","131","\t\t}","133","\t\tif (properties == null) \/\/ didn't exist < 1.72","134","\t\t\tproperties = new CopyOnWriteList<JobProperty<? super JobT>>();","136","\t\tfor (JobProperty p : properties)","137","\t\t\tp.setOwner(this);","138","\t}","140","\t@Override","141","\tpublic void onCopiedFrom(Item src) {","142","\t\tsuper.onCopiedFrom(src);","143","\t\tthis.nextBuildNumber = 1; \/\/ reset the next build number","144","\t}","146","\tprotected void performDelete() throws IOException {","147","\t\t\/\/ if a build is in progress. Cancel it.","148","\t\tRunT lb = getLastBuild();","149","\t\tif (lb != null) {","150","\t\t\tExecutor e = lb.getExecutor();","151","\t\t\tif (e != null) {","152","\t\t\t\te.interrupt();","153","\t\t\t\t\/\/ should we block until the build is cancelled?","154","\t\t\t}","155","\t\t}","156","\t\tsuper.performDelete();","157","\t}","159","\tprivate TextFile getNextBuildNumberFile() {","160","\t\treturn new TextFile(new File(this.getRootDir(), \"nextBuildNumber\"));","161","\t}","163","\tprotected void saveNextBuildNumber() throws IOException {","164","\t\tgetNextBuildNumberFile().write(String.valueOf(nextBuildNumber) + '\\n');","165","\t}","167","\t@Exported","168","\tpublic boolean isInQueue() {","169","\t\treturn false;","170","\t}","172","\t\/**","173","\t * If this job is in the build queue, return its item.","174","\t *\/","175","\t@Exported","176","\tpublic Queue.Item getQueueItem() {","177","\t\treturn null;","178","\t}","180","\t\/**","181","\t * Get the term used in the UI to represent this kind of","182","\t * {@link AbstractProject}. Must start with a capital letter.","183","\t *\/","184","\tpublic String getPronoun() {","185","\t\treturn Messages.Job_Pronoun();","186","\t}","188","\t\/**","189","\t * Returns whether the name of this job can be changed by user.","190","\t *\/","191","\tpublic boolean isNameEditable() {","192","\t\treturn true;","193","\t}","195","\t\/**","196","\t * If true, it will keep all the build logs of dependency components.","197","\t *\/","198","\t@Exported","199","\tpublic boolean isKeepDependencies() {","200","\t\treturn keepDependencies;","201","\t}","203","\t\/**","204","\t * Allocates a new buildCommand number.","205","\t *\/","206","\tpublic synchronized int assignBuildNumber() throws IOException {","207","\t\tint r = nextBuildNumber++;","208","\t\tsaveNextBuildNumber();","209","\t\treturn r;","210","\t}","212","\t\/**","213","\t * Peeks the next build number.","214","\t *\/","215","\t@Exported","216","\tpublic int getNextBuildNumber() {","217","\t\treturn nextBuildNumber;","218","\t}","220","\t\/**","221","\t * Programatically updates the next build number.","222","\t * ","223","\t * <p>","224","\t * Much of Hudson assumes that the build number is unique and monotonic, so","225","\t * this method can only accept a new value that's bigger than","226","\t * {@link #getNextBuildNumber()} returns. Otherwise it'll be no-op.","227","\t * ","228","\t * @since 1.199 (before that, this method was package private.)","229","\t *\/","230","\tpublic void updateNextBuildNumber(int next) throws IOException {","231","\t\tif (next > nextBuildNumber) {","232","\t\t\tthis.nextBuildNumber = next;","233","\t\t\tsaveNextBuildNumber();","234","\t\t}","235","\t}","237","\t\/**","238","\t * Returns the log rotator for this job, or null if none.","239","\t *\/","240","\tpublic LogRotator getLogRotator() {","241","\t\treturn logRotator;","242","\t}","244","\tpublic void setLogRotator(LogRotator logRotator) {","245","\t\tthis.logRotator = logRotator;","246","\t}","248","\t\/**","249","\t * Perform log rotation.","250","\t *\/","251","\tpublic void logRotate() throws IOException {","252","\t\tLogRotator lr = getLogRotator();","253","\t\tif (lr != null)","254","\t\t\tlr.perform(this);","255","\t}","257","\t\/**","258","\t * True if this instance supports log rotation configuration.","259","\t *\/","260","\tpublic boolean supportsLogRotator() {","261","\t\treturn true;","262","\t}","264","\tprotected SearchIndexBuilder makeSearchIndex() {","265","\t\treturn super.makeSearchIndex().add(new SearchIndex() {","266","\t\t\tpublic void find(String token, List<SearchItem> result) {","267","\t\t\t\ttry {","268","\t\t\t\t\tif (token.startsWith(\"#\"))","269","\t\t\t\t\t\ttoken = token.substring(1); \/\/ ignore leading '#'","270","\t\t\t\t\tint n = Integer.parseInt(token);","271","\t\t\t\t\tRun b = getBuildByNumber(n);","272","\t\t\t\t\tif (b == null)","273","\t\t\t\t\t\treturn; \/\/ no such build","274","\t\t\t\t\tresult.add(SearchItems.create(\"#\" + n, \"\" + n, b));","275","\t\t\t\t} catch (NumberFormatException e) {","276","\t\t\t\t\t\/\/ not a number.","277","\t\t\t\t}","278","\t\t\t}","280","\t\t\tpublic void suggest(String token, List<SearchItem> result) {","281","\t\t\t\tfind(token, result);","282","\t\t\t}","283","\t\t}).add(\"configure\", \"config\", \"configure\");","284","\t}","286","\tpublic Collection<? extends Job> getAllJobs() {","287","\t\treturn Collections.<Job> singleton(this);","288","\t}","290","\t\/**","291","\t * Adds {@link JobProperty}.","292","\t * ","293","\t * @since 1.188","294","\t *\/","295","\tpublic void addProperty(JobProperty<? super JobT> jobProp)","296","\t\t\tthrows IOException {","297","\t\tproperties.add(jobProp);","298","\t\tsave();","299","\t}","301","\t\/**","302","\t * Gets all the job properties configured for this job.","303","\t *\/","304","\t@SuppressWarnings(\"unchecked\")","305","\tpublic Map<JobPropertyDescriptor, JobProperty<? super JobT>> getProperties() {","306","\t\treturn Descriptor.toMap((Iterable) properties);","307","\t}","309","\t\/**","310","\t * Gets the specific property, or null if the propert is not configured for","311","\t * this job.","312","\t *\/","313","\tpublic <T extends JobProperty> T getProperty(Class<T> clazz) {","314","\t\tfor (JobProperty p : properties) {","315","\t\t\tif (clazz.isInstance(p))","316","\t\t\t\treturn clazz.cast(p);","317","\t\t}","318","\t\treturn null;","319","\t}","321","\tpublic List<Widget> getWidgets() {","322","\t\tArrayList<Widget> r = new ArrayList<Widget>();","323","\t\tr.add(createHistoryWidget());","324","\t\treturn r;","325","\t}","327","\tprotected HistoryWidget createHistoryWidget() {","328","\t\treturn new HistoryWidget<Job, RunT>(this, getBuilds(), HISTORY_ADAPTER);","329","\t}","331","\tprotected static final HistoryWidget.Adapter<Run> HISTORY_ADAPTER = new Adapter<Run>() {","332","\t\tpublic int compare(Run record, String key) {","333","\t\t\ttry {","334","\t\t\t\tint k = Integer.parseInt(key);","335","\t\t\t\treturn record.getNumber() - k;","336","\t\t\t} catch (NumberFormatException nfe) {","337","\t\t\t\treturn String.valueOf(record.getNumber()).compareTo(key);","338","\t\t\t}","339","\t\t}","341","\t\tpublic String getKey(Run record) {","342","\t\t\treturn String.valueOf(record.getNumber());","343","\t\t}","345","\t\tpublic boolean isBuilding(Run record) {","346","\t\t\treturn record.isBuilding();","347","\t\t}","349","\t\tpublic String getNextKey(String key) {","350","\t\t\ttry {","351","\t\t\t\tint k = Integer.parseInt(key);","352","\t\t\t\treturn String.valueOf(k + 1);","353","\t\t\t} catch (NumberFormatException nfe) {","354","\t\t\t\treturn \"-unable to determine next key-\";","355","\t\t\t}","356","\t\t}","357","\t};","359","\t\/**","360","\t * Renames a job.","361","\t * ","362","\t * <p>","363","\t * This method is defined on {@link Job} but really only applicable for","364","\t * {@link Job}s that are top-level items.","365","\t *\/","366","\tpublic void renameTo(String newName) throws IOException {","367","\t\t\/\/ always synchronize from bigger objects first","368","\t\tfinal Hudson parent = Hudson.getInstance();","369","\t\tassert this instanceof TopLevelItem;","370","\t\tsynchronized (parent) {","371","\t\t\tsynchronized (this) {","372","\t\t\t\t\/\/ sanity check","373","\t\t\t\tif (newName == null)","374","\t\t\t\t\tthrow new IllegalArgumentException(\"New name is not given\");","375","\t\t\t\tif (parent.getItem(newName) != null)","376","\t\t\t\t\tthrow new IllegalArgumentException(\"Job \" + newName","377","\t\t\t\t\t\t\t+ \" already exists\");","379","\t\t\t\t\/\/ noop?","380","\t\t\t\tif (this.name.equals(newName))","381","\t\t\t\t\treturn;","383","\t\t\t\tString oldName = this.name;","384","\t\t\t\tFile oldRoot = this.getRootDir();","386","\t\t\t\tdoSetName(newName);","387","\t\t\t\tFile newRoot = this.getRootDir();","389","\t\t\t\tboolean success = false;","391","\t\t\t\ttry {\/\/ rename data files","392","\t\t\t\t\tboolean interrupted = false;","393","\t\t\t\t\tboolean renamed = false;","395","\t\t\t\t\t\/\/ try to rename the job directory.","396","\t\t\t\t\t\/\/ this may fail on Windows due to some other processes","397","\t\t\t\t\t\/\/ accessing a file.","398","\t\t\t\t\t\/\/ so retry few times before we fall back to copy.","399","\t\t\t\t\tfor (int retry = 0; retry < 5; retry++) {","400","\t\t\t\t\t\tif (oldRoot.renameTo(newRoot)) {","401","\t\t\t\t\t\t\trenamed = true;","402","\t\t\t\t\t\t\tbreak; \/\/ succeeded","403","\t\t\t\t\t\t}","404","\t\t\t\t\t\ttry {","405","\t\t\t\t\t\t\tThread.sleep(500);","406","\t\t\t\t\t\t} catch (InterruptedException e) {","407","\t\t\t\t\t\t\t\/\/ process the interruption later","408","\t\t\t\t\t\t\tinterrupted = true;","409","\t\t\t\t\t\t}","410","\t\t\t\t\t}","412","\t\t\t\t\tif (interrupted)","413","\t\t\t\t\t\tThread.currentThread().interrupt();","415","\t\t\t\t\tif (!renamed) {","416","\t\t\t\t\t\t\/\/ failed to rename. it must be that some lengthy","417","\t\t\t\t\t\t\/\/ process is going on","418","\t\t\t\t\t\t\/\/ to prevent a rename operation. So do a copy. Ideally","419","\t\t\t\t\t\t\/\/ we'd like to","420","\t\t\t\t\t\t\/\/ later delete the old copy, but we can't reliably do","421","\t\t\t\t\t\t\/\/ so, as before the VM","422","\t\t\t\t\t\t\/\/ shuts down there might be a new job created under the","423","\t\t\t\t\t\t\/\/ old name.","424","\t\t\t\t\t\tCopy cp = new Copy();","425","\t\t\t\t\t\tcp.setProject(new org.apache.tools.ant.Project());","426","\t\t\t\t\t\tcp.setTodir(newRoot);","427","\t\t\t\t\t\tFileSet src = new FileSet();","428","\t\t\t\t\t\tsrc.setDir(getRootDir());","429","\t\t\t\t\t\tcp.addFileset(src);","430","\t\t\t\t\t\tcp.setOverwrite(true);","431","\t\t\t\t\t\tcp.setPreserveLastModified(true);","432","\t\t\t\t\t\tcp.setFailOnError(false); \/\/ keep going even if","433","\t\t\t\t\t\t\t\t\t\t\t\t\t\/\/ there's an error","434","\t\t\t\t\t\tcp.execute();","436","\t\t\t\t\t\t\/\/ try to delete as much as possible","437","\t\t\t\t\t\ttry {","438","\t\t\t\t\t\t\tUtil.deleteRecursive(oldRoot);","439","\t\t\t\t\t\t} catch (IOException e) {","440","\t\t\t\t\t\t\t\/\/ but ignore the error, since we expect that","441","\t\t\t\t\t\t\te.printStackTrace();","442","\t\t\t\t\t\t}","443","\t\t\t\t\t}","445","\t\t\t\t\tsuccess = true;","446","\t\t\t\t} finally {","447","\t\t\t\t\t\/\/ if failed, back out the rename.","448","\t\t\t\t\tif (!success)","449","\t\t\t\t\t\tdoSetName(oldName);","450","\t\t\t\t}","452","\t\t\t\tparent.onRenamed((TopLevelItem) this, oldName, newName);","454","\t\t\t\tfor (ItemListener l : Hudson.getInstance().getJobListeners())","455","\t\t\t\t\tl.onRenamed(this, oldName, newName);","456","\t\t\t}","457","\t\t}","458","\t}","460","\t\/**","461","\t * Returns true if we should display \"build now\" icon","462","\t *\/","463","\t@Exported","464","\tpublic abstract boolean isBuildable();","466","\t\/**","467","\t * Gets all the builds.","468","\t * ","469","\t * @return never null. The first entry is the latest build.","470","\t *\/","471","\tpublic List<RunT> getBuilds() {","472","\t\treturn new ArrayList<RunT>(_getRuns().values());","473","\t}","475","\t\/**","476","\t * Gets all the builds in a map.","477","\t *\/","478","\tpublic SortedMap<Integer, RunT> getBuildsAsMap() {","479","\t\treturn Collections.unmodifiableSortedMap(_getRuns());","480","\t}","482","\t\/**","483","\t * @deprecated This is only used to support backward compatibility with old","484","\t *             URLs.","485","\t *\/","486","\t@Deprecated","487","\tpublic RunT getBuild(String id) {","488","\t\tfor (RunT r : _getRuns().values()) {","489","\t\t\tif (r.getId().equals(id))","490","\t\t\t\treturn r;","491","\t\t}","492","\t\treturn null;","493","\t}","495","\t\/**","496","\t * @param n","497","\t *            The build number.","498","\t * @return null if no such build exists.","499","\t * @see Run#getNumber()","500","\t *\/","501","\tpublic RunT getBuildByNumber(int n) {","502","\t\treturn _getRuns().get(n);","503","\t}","505","\t\/**","506","\t * Gets the youngest build #m that satisfies <tt>n&lt;=m<\/tt>.","507","\t * ","508","\t * This is useful when you'd like to fetch a build but the exact build might","509","\t * be already gone (deleted, rotated, etc.)","510","\t *\/","511","\tpublic final RunT getNearestBuild(int n) {","512","\t\tSortedMap<Integer, ? extends RunT> m = _getRuns().headMap(n - 1); \/\/ the","513","\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\/\/ map","514","\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\/\/ should","515","\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\/\/ include","516","\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\/\/ n,","517","\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\/\/ so","518","\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\/\/ n-1","519","\t\tif (m.isEmpty())","520","\t\t\treturn null;","521","\t\treturn m.get(m.lastKey());","522","\t}","524","\t\/**","525","\t * Gets the latest build #m that satisfies <tt>m&lt;=n<\/tt>.","526","\t * ","527","\t * This is useful when you'd like to fetch a build but the exact build might","528","\t * be already gone (deleted, rotated, etc.)","529","\t *\/","530","\tpublic final RunT getNearestOldBuild(int n) {","531","\t\tSortedMap<Integer, ? extends RunT> m = _getRuns().tailMap(n);","532","\t\tif (m.isEmpty())","533","\t\t\treturn null;","534","\t\treturn m.get(m.firstKey());","535","\t}","537","\tpublic Object getDynamic(String token, StaplerRequest req,","538","\t\t\tStaplerResponse rsp) {","539","\t\ttry {","540","\t\t\t\/\/ try to interpret the token as build number","541","\t\t\treturn _getRuns().get(Integer.valueOf(token));","542","\t\t} catch (NumberFormatException e) {","543","\t\t\t\/\/ try to map that to widgets","544","\t\t\tfor (Widget w : getWidgets()) {","545","\t\t\t\tif (w.getUrlName().equals(token))","546","\t\t\t\t\treturn w;","547","\t\t\t}","549","\t\t\treturn super.getDynamic(token, req, rsp);","550","\t\t}","551","\t}","553","\t\/**","554","\t * Directory for storing {@link Run} records.","555","\t * <p>","556","\t * Some {@link Job}s may not have backing data store for {@link Run}s, but","557","\t * those {@link Job}s that use file system for storing data should use this","558","\t * directory for consistency.","559","\t * ","560","\t * @see RunMap","561","\t *\/","562","\tprotected File getBuildDir() {","563","\t\treturn new File(getRootDir(), \"builds\");","564","\t}","565","","566","\t\/**","567","\t * Gets all the runs.","568","\t * ","569","\t * The resulting map must be immutable (by employing copy-on-write","570","\t * semantics.) The map is descending order, with newest builds at the top.","571","\t *\/","572","\tprotected abstract SortedMap<Integer, ? extends RunT> _getRuns();","573","","574","\t\/**","575","\t * Called from {@link Run} to remove it from this job.","576","\t * ","577","\t * The files are deleted already. So all the callee needs to do is to remove","578","\t * a reference from this {@link Job}.","579","\t *\/","580","\tprotected abstract void removeRun(RunT run);","581","","582","\t\/**","583","\t * Returns the last build.","584","\t *\/","585","\t@Exported","586","\t@QuickSilver","587","\tpublic RunT getLastBuild() {","588","\t\tSortedMap<Integer, ? extends RunT> runs = _getRuns();","589","","590","\t\tif (runs.isEmpty())","591","\t\t\treturn null;","592","\t\treturn runs.get(runs.firstKey());","593","\t}","594","","595","\t\/**","596","\t * Returns the oldest build in the record.","597","\t *\/","598","\t@Exported","599","\t@QuickSilver","600","\tpublic RunT getFirstBuild() {","601","\t\tSortedMap<Integer, ? extends RunT> runs = _getRuns();","603","\t\tif (runs.isEmpty())","604","\t\t\treturn null;","605","\t\treturn runs.get(runs.lastKey());","606","\t}","608","\t\/**","609","\t * Returns the last successful build, if any. Otherwise null. A stable build","610","\t * would include either {@link Result#SUCCESS} or {@link Result#UNSTABLE}.","611","\t * ","612","\t * @see #getLastStableBuild()","613","\t *\/","614","\t@Exported","615","\t@QuickSilver","616","\tpublic RunT getLastSuccessfulBuild() {","617","\t\tRunT r = getLastBuild();","618","\t\t\/\/ temporary hack till we figure out what's causing this bug","619","\t\twhile (r != null","620","\t\t\t\t&& (r.isBuilding() || r.getResult() == null || r.getResult()","621","\t\t\t\t\t\t.isWorseThan(Result.UNSTABLE)))","622","\t\t\tr = r.getPreviousBuild();","623","\t\treturn r;","624","\t}","626","\t\/**","627","\t * Returns the last stable build, if any. Otherwise null.","628","\t *\/","629","\t@Exported","630","\t@QuickSilver","631","\tpublic RunT getLastStableBuild() {","632","\t\tRunT r = getLastBuild();","633","\t\twhile (r != null","634","\t\t\t\t&& (r.isBuilding() || r.getResult().isWorseThan(Result.SUCCESS)))","635","\t\t\tr = r.getPreviousBuild();","636","\t\treturn r;","637","\t}","639","\t\/**","640","\t * Returns the last failed build, if any. Otherwise null.","641","\t *\/","642","\t@Exported","643","\t@QuickSilver","644","\tpublic RunT getLastFailedBuild() {","645","\t\tRunT r = getLastBuild();","646","\t\twhile (r != null && (r.isBuilding() || r.getResult() != Result.FAILURE))","647","\t\t\tr = r.getPreviousBuild();","648","\t\treturn r;","649","\t}","651","\t\/**","652","\t * Returns the last completed build, if any. Otherwise null.","653","\t *\/","654","\t@Exported","655","\t@QuickSilver","656","\tpublic RunT getLastCompletedBuild() {","657","\t\tRunT r = getLastBuild();","658","\t\twhile (r != null && r.isBuilding())","659","\t\t\tr = r.getPreviousBuild();","660","\t\treturn r;","661","\t}","663","\t\/**","664","\t * Used as the color of the status ball for the project.","665","\t *\/","666","\t@Exported(visibility = 2, name = \"color\")","667","\tpublic BallColor getIconColor() {","668","\t\tRunT lastBuild = getLastBuild();","669","\t\twhile (lastBuild != null && lastBuild.hasntStartedYet())","670","\t\t\tlastBuild = lastBuild.getPreviousBuild();","672","\t\tif (lastBuild != null)","673","\t\t\treturn lastBuild.getIconColor();","674","\t\telse","675","\t\t\treturn BallColor.GREY;","676","\t}","678","\t\/**","679","\t * Get the current health report for a job.","680","\t * ","681","\t * @return the health report. Never returns null","682","\t *\/","683","\tpublic HealthReport getBuildHealth() {","684","\t\tList<HealthReport> reports = getBuildHealthReports();","685","\t\treturn reports.isEmpty() ? new HealthReport() : reports.get(0);","686","\t}","688","\t@Exported(name = \"healthReport\")","689","\tpublic List<HealthReport> getBuildHealthReports() {","690","\t\tList<HealthReport> reports = new ArrayList<HealthReport>();","691","\t\tRunT lastBuild = getLastBuild();","693","\t\tif (lastBuild != null && lastBuild.isBuilding()) {","694","\t\t\t\/\/ show the previous build's report until the current one is","695","\t\t\t\/\/ finished building.","696","\t\t\tlastBuild = lastBuild.getPreviousBuild();","697","\t\t}","699","\t\t\/\/ check the cache","700","\t\tif (cachedBuildHealthReportsBuildNumber != null","701","\t\t\t\t&& cachedBuildHealthReports != null","702","\t\t\t\t&& lastBuild != null","703","\t\t\t\t&& cachedBuildHealthReportsBuildNumber.intValue() == lastBuild","704","\t\t\t\t\t\t.getNumber()) {","705","\t\t\treports.addAll(cachedBuildHealthReports);","706","\t\t} else if (lastBuild != null) {","707","\t\t\tfor (HealthReportingAction healthReportingAction : lastBuild","708","\t\t\t\t\t.getActions(HealthReportingAction.class)) {","709","\t\t\t\tfinal HealthReport report = healthReportingAction","710","\t\t\t\t\t\t.getBuildHealth();","711","\t\t\t\tif (report != null) {","712","\t\t\t\t\tif (report.isAggregateReport()) {","713","\t\t\t\t\t\treports.addAll(report.getAggregatedReports());","714","\t\t\t\t\t} else {","715","\t\t\t\t\t\treports.add(report);","716","\t\t\t\t\t}","717","\t\t\t\t}","718","\t\t\t}","719","\t\t\tfinal HealthReport report = getBuildStabilityHealthReport();","720","\t\t\tif (report != null) {","721","\t\t\t\tif (report.isAggregateReport()) {","722","\t\t\t\t\treports.addAll(report.getAggregatedReports());","723","\t\t\t\t} else {","724","\t\t\t\t\treports.add(report);","725","\t\t\t\t}","726","\t\t\t}","728","\t\t\tCollections.sort(reports);","730","\t\t\t\/\/ store the cache","731","\t\t\tcachedBuildHealthReportsBuildNumber = lastBuild.getNumber();","732","\t\t\tcachedBuildHealthReports = new ArrayList<HealthReport>(reports);","733","\t\t}","735","\t\treturn reports;","736","\t}","738","\tprivate HealthReport getBuildStabilityHealthReport() {","739","\t\t\/\/ we can give a simple view of build health from the last five builds","740","\t\tint failCount = 0;","741","\t\tint totalCount = 0;","742","\t\tRunT i = getLastBuild();","743","\t\twhile (totalCount < 5 && i != null) {","744","\t\t\tswitch (i.getIconColor()) {","745","\t\t\tcase BLUE:","746","\t\t\tcase YELLOW:","747","\t\t\t\t\/\/ failCount stays the same","748","\t\t\t\ttotalCount++;","749","\t\t\t\tbreak;","750","\t\t\tcase RED:","751","\t\t\t\tfailCount++;","752","\t\t\t\ttotalCount++;","753","\t\t\t\tbreak;","755","\t\t\tdefault:","756","\t\t\t\t\/\/ do nothing as these are inconclusive statuses","757","\t\t\t\tbreak;","758","\t\t\t}","759","\t\t\ti = i.getPreviousBuild();","760","\t\t}","761","\t\tif (totalCount > 0) {","762","\t\t\tint score = (int) ((100.0 * (totalCount - failCount)) \/ totalCount);","763","\t\t\tif (score < 100 && score > 0) {","764","\t\t\t\t\/\/ HACK","765","\t\t\t\t\/\/ force e.g. 4\/5 to be in the 60-79 range","766","\t\t\t\tscore--;","767","\t\t\t}","769","\t\t\tString description;","770","\t\t\tif (failCount == 0) {","771","\t\t\t\tdescription = Messages.Job_NoRecentBuildFailed();","772","\t\t\t} else if (totalCount == failCount) {","773","\t\t\t\t\/\/ this should catch the case where totalCount == 1","774","\t\t\t\t\/\/ as failCount must be between 0 and totalCount","775","\t\t\t\t\/\/ and we can't get here if failCount == 0","776","\t\t\t\tdescription = Messages.Job_AllRecentBuildFailed();","777","\t\t\t} else {","778","\t\t\t\tdescription = Messages.Job_NOfMFailed(failCount, totalCount);","779","\t\t\t}","780","\t\t\treturn new HealthReport(score, Messages","781","\t\t\t\t\t.Job_BuildStability(description));","782","\t\t}","783","\t\treturn null;","784","\t}","786","\t\/\/","787","\t\/\/","788","\t\/\/ actions","789","\t\/\/","790","\t\/\/","791","\t\/**","792","\t * Accepts submission from the configuration page.","793","\t *\/","794","\tpublic synchronized void doConfigSubmit(StaplerRequest req,","795","\t\t\tStaplerResponse rsp) throws IOException, ServletException {","796","\t\tcheckPermission(CONFIGURE);","798","\t\treq.setCharacterEncoding(\"UTF-8\");","800","\t\tdescription = req.getParameter(\"description\");","802","\t\tif (req.getParameter(\"logrotate\") != null)","803","\t\t\tlogRotator = LogRotator.DESCRIPTOR.newInstance(req);","804","\t\telse","805","\t\t\tlogRotator = null;","807","\t\tkeepDependencies = req.getParameter(\"keepDependencies\") != null;","809","\t\ttry {","810","\t\t\tproperties.clear();","812","\t\t\tJSONObject json = StructuredForm.get(req);","814","\t\t\tint i = 0;","815","\t\t\tfor (JobPropertyDescriptor d : JobPropertyDescriptor","816","\t\t\t\t\t.getPropertyDescriptors(Job.this.getClass())) {","817","\t\t\t\tString name = \"jobProperty\" + (i++);","818","\t\t\t\tJobProperty prop = d.newInstance(req, json.getJSONObject(name));","819","\t\t\t\tif (prop != null) {","820","\t\t\t\t\tprop.setOwner(this);","821","\t\t\t\t\tproperties.add(prop);","822","\t\t\t\t}","823","\t\t\t}","825","\t\t\tsubmit(req, rsp);","827","\t\t\tsave();","829","\t\t\tString newName = req.getParameter(\"name\");","830","\t\t\tif (newName != null && !newName.equals(name)) {","831","\t\t\t\t\/\/ check this error early to avoid HTTP response splitting.","832","\t\t\t\ttry {","833","\t\t\t\t\tHudson.checkGoodName(newName);","834","\t\t\t\t} catch (ParseException e) {","835","\t\t\t\t\tsendError(e, req, rsp);","836","\t\t\t\t\treturn;","837","\t\t\t\t}","838","\t\t\t\trsp.sendRedirect(\"rename?newName=\" + newName);","839","\t\t\t} else {","840","\t\t\t\trsp.sendRedirect(\".\");","841","\t\t\t}","842","\t\t} catch (FormException e) {","843","\t\t\trsp.setStatus(SC_BAD_REQUEST);","844","\t\t\tsendError(e, req, rsp);","845","\t\t} catch (JSONException e) {","846","\t\t\tStringWriter sw = new StringWriter();","847","\t\t\tPrintWriter pw = new PrintWriter(sw);","848","\t\t\tpw","849","\t\t\t\t\t.println(\"Failed to parse form data. Please report this probelm as a bug\");","850","\t\t\tpw.println(\"JSON=\" + StructuredForm.get(req));","851","\t\t\tpw.println();","852","\t\t\te.printStackTrace(pw);","854","\t\t\trsp.setStatus(SC_BAD_REQUEST);","855","\t\t\tsendError(sw.toString(), req, rsp);","856","\t\t}","857","\t}","859","\t\/**","860","\t * Accepts <tt>config.xml<\/tt> submission, as well as serve it.","861","\t *\/","862","\t@WebMethod(name = \"config.xml\")","863","\tpublic void doConfigDotXml(StaplerRequest req, StaplerResponse rsp)","864","\t\t\tthrows IOException {","865","\t\tcheckPermission(CONFIGURE);","867","\t\tif (req.getMethod().equals(\"GET\")) {","868","\t\t\t\/\/ read","869","\t\t\trsp.setContentType(\"application\/xml;charset=UTF-8\");","870","\t\t\tgetConfigFile().writeRawTo(rsp.getWriter());","871","\t\t\treturn;","872","\t\t}","873","\t\tif (req.getMethod().equals(\"POST\")) {","874","\t\t\t\/\/ submission","875","\t\t\tXmlFile configXmlFile = getConfigFile();","876","\t\t\tAtomicFileWriter out = new AtomicFileWriter(configXmlFile.getFile());","878","\t\t\ttry {","879","\t\t\t\t\/\/ this allows us to use UTF-8 for storing data,","880","\t\t\t\t\/\/ plus it checks any well-formedness issue in the submitted","881","\t\t\t\t\/\/ data","882","\t\t\t\tTransformer t = TransformerFactory.newInstance()","883","\t\t\t\t\t\t.newTransformer();","884","\t\t\t\tt.transform(new StreamSource(req.getReader()),","885","\t\t\t\t\t\tnew StreamResult(out));","886","\t\t\t\tout.close();","887","\t\t\t} catch (TransformerException e) {","888","\t\t\t\tthrow new IOException2(\"Failed to persist configuration.xml\", e);","889","\t\t\t}","891","\t\t\t\/\/ try to reflect the changes by reloading","892","\t\t\tnew XmlFile(Items.XSTREAM, out.getTemporaryFile()).unmarshal(this);","893","\t\t\tonLoad(getParent(), getRootDir().getName());","895","\t\t\t\/\/ if everything went well, commit this new version","896","\t\t\tout.commit();","897","\t\t\treturn;","898","\t\t}","900","\t\t\/\/ huh?","901","\t\trsp.sendError(SC_BAD_REQUEST);","902","\t}","904","\t\/**","905","\t * Derived class can override this to perform additional config submission","906","\t * work.","907","\t *\/","908","\tprotected void submit(StaplerRequest req, StaplerResponse rsp)","909","\t\t\tthrows IOException, ServletException, FormException {","910","\t}","912","\t\/**","913","\t * Returns the image that shows the current buildCommand status.","914","\t *\/","915","\tpublic void doBuildStatus(StaplerRequest req, StaplerResponse rsp)","916","\t\t\tthrows IOException {","917","\t\trsp.sendRedirect2(req.getContextPath() + \"\/nocacheImages\/48x48\/\"","918","\t\t\t\t+ getBuildStatusUrl());","919","\t}","921","\tpublic String getBuildStatusUrl() {","922","\t\treturn getIconColor().getImage();","923","\t}","925","\t\/**","926","\t * Returns the graph that shows how long each build took.","927","\t *\/","928","\tpublic void doBuildTimeGraph(StaplerRequest req, StaplerResponse rsp)","929","\t\t\tthrows IOException {","930","\t\tif (getLastBuild() == null) {","931","\t\t\trsp.setStatus(HttpServletResponse.SC_NOT_FOUND);","932","\t\t\treturn;","933","\t\t}","934","\t\tif (req.checkIfModified(getLastBuild().getTimestamp(), rsp))","935","\t\t\treturn;","936","\t\tChartUtil","937","\t\t\t\t.generateGraph(req, rsp, createBuildTimeTrendChart(), 500, 400);","938","\t}","940","\t\/**","941","\t * Returns the clickable map for the build time graph. Loaded lazily by","942","\t * AJAX.","943","\t *\/","944","\tpublic void doBuildTimeGraphMap(StaplerRequest req, StaplerResponse rsp)","945","\t\t\tthrows IOException {","946","\t\tif (getLastBuild() == null) {","947","\t\t\trsp.setStatus(HttpServletResponse.SC_NOT_FOUND);","948","\t\t\treturn;","949","\t\t}","950","\t\tif (req.checkIfModified(getLastBuild().getTimestamp(), rsp))","951","\t\t\treturn;","952","\t\tChartUtil.generateClickableMap(req, rsp, createBuildTimeTrendChart(),","953","\t\t\t\t500, 400);","954","\t}","956","\tprivate JFreeChart createBuildTimeTrendChart() {","957","\t\tclass ChartLabel implements Comparable<ChartLabel> {","958","\t\t\tfinal Run run;","960","\t\t\tpublic ChartLabel(Run r) {","961","\t\t\t\tthis.run = r;","962","\t\t\t}","964","\t\t\tpublic int compareTo(ChartLabel that) {","965","\t\t\t\treturn this.run.number - that.run.number;","966","\t\t\t}","968","\t\t\tpublic boolean equals(Object o) {","969","\t\t\t\tChartLabel that = (ChartLabel) o;","970","\t\t\t\treturn run == that.run;","971","\t\t\t}","973","\t\t\tpublic Color getColor() {","974","\t\t\t\t\/\/ TODO: consider gradation. See","975","\t\t\t\t\/\/ http:\/\/www.javadrive.jp\/java2d\/shape\/index9.html","976","\t\t\t\tResult r = run.getResult();","977","\t\t\t\tif (r == Result.FAILURE || r == Result.ABORTED)","978","\t\t\t\t\treturn ColorPalette.RED;","979","\t\t\t\telse","980","\t\t\t\t\treturn ColorPalette.BLUE;","981","\t\t\t}","983","\t\t\tpublic int hashCode() {","984","\t\t\t\treturn run.hashCode();","985","\t\t\t}","987","\t\t\tpublic String toString() {","988","\t\t\t\tString l = run.getDisplayName();","989","\t\t\t\tif (run instanceof Build) {","990","\t\t\t\t\tString s = ((Build) run).getBuiltOnStr();","991","\t\t\t\t\tif (s != null)","992","\t\t\t\t\t\tl += ' ' + s;","993","\t\t\t\t}","994","\t\t\t\treturn l;","995","\t\t\t}","997","\t\t}","999","\t\tDataSetBuilder<String, ChartLabel> data = new DataSetBuilder<String, ChartLabel>();","1000","\t\tfor (Run r : getBuilds()) {","1001","\t\t\tif (r.isBuilding())","1002","\t\t\t\tcontinue;","1003","\t\t\tdata.add(((double) r.getDuration()) \/ (1000 * 60), \"min\",","1004","\t\t\t\t\tnew ChartLabel(r));","1005","\t\t}","1007","\t\tfinal CategoryDataset dataset = data.build();","1009","\t\tfinal JFreeChart chart = ChartFactory.createStackedAreaChart(null, \/\/ chart","1010","\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\/\/ title","1011","\t\t\t\tnull, \/\/ unused","1012","\t\t\t\tMessages.Job_minutes(), \/\/ range axis label","1013","\t\t\t\tdataset, \/\/ data","1014","\t\t\t\tPlotOrientation.VERTICAL, \/\/ orientation","1015","\t\t\t\tfalse, \/\/ include legend","1016","\t\t\t\ttrue, \/\/ tooltips","1017","\t\t\t\tfalse \/\/ urls","1018","\t\t\t\t);","1020","\t\tchart.setBackgroundPaint(Color.white);","1022","\t\tfinal CategoryPlot plot = chart.getCategoryPlot();","1024","\t\t\/\/ plot.setAxisOffset(new Spacer(Spacer.ABSOLUTE, 5.0, 5.0, 5.0, 5.0));","1025","\t\tplot.setBackgroundPaint(Color.WHITE);","1026","\t\tplot.setOutlinePaint(null);","1027","\t\tplot.setForegroundAlpha(0.8f);","1028","\t\t\/\/ plot.setDomainGridlinesVisible(true);","1029","\t\t\/\/ plot.setDomainGridlinePaint(Color.white);","1030","\t\tplot.setRangeGridlinesVisible(true);","1031","\t\tplot.setRangeGridlinePaint(Color.black);","1033","\t\tCategoryAxis domainAxis = new ShiftedCategoryAxis(null);","1034","\t\tplot.setDomainAxis(domainAxis);","1035","\t\tdomainAxis.setCategoryLabelPositions(CategoryLabelPositions.UP_90);","1036","\t\tdomainAxis.setLowerMargin(0.0);","1037","\t\tdomainAxis.setUpperMargin(0.0);","1038","\t\tdomainAxis.setCategoryMargin(0.0);","1040","\t\tfinal NumberAxis rangeAxis = (NumberAxis) plot.getRangeAxis();","1041","\t\tChartUtil.adjustChebyshev(dataset, rangeAxis);","1042","\t\trangeAxis.setStandardTickUnits(NumberAxis.createIntegerTickUnits());","1044","\t\tStackedAreaRenderer ar = new StackedAreaRenderer2() {","1045","\t\t\t@Override","1046","\t\t\tpublic Paint getItemPaint(int row, int column) {","1047","\t\t\t\tChartLabel key = (ChartLabel) dataset.getColumnKey(column);","1048","\t\t\t\treturn key.getColor();","1049","\t\t\t}","1051","\t\t\t@Override","1052","\t\t\tpublic String generateURL(CategoryDataset dataset, int row,","1053","\t\t\t\t\tint column) {","1054","\t\t\t\tChartLabel label = (ChartLabel) dataset.getColumnKey(column);","1055","\t\t\t\treturn String.valueOf(label.run.number);","1056","\t\t\t}","1058","\t\t\t@Override","1059","\t\t\tpublic String generateToolTip(CategoryDataset dataset, int row,","1060","\t\t\t\t\tint column) {","1061","\t\t\t\tChartLabel label = (ChartLabel) dataset.getColumnKey(column);","1062","\t\t\t\treturn label.run.getDisplayName() + \" : \"","1063","\t\t\t\t\t\t+ label.run.getDurationString();","1064","\t\t\t}","1065","\t\t};","1066","\t\tplot.setRenderer(ar);","1068","\t\t\/\/ crop extra space around the graph","1069","\t\tplot.setInsets(new RectangleInsets(0, 0, 0, 5.0));","1071","\t\treturn chart;","1072","\t}","1074","\t\/**","1075","\t * Renames this job.","1076","\t *\/","1077","\tpublic\/* not synchronized. see renameTo() *\/void doDoRename(","1078","\t\t\tStaplerRequest req, StaplerResponse rsp) throws IOException,","1079","\t\t\tServletException {","1080","\t\t\/\/ rename is essentially delete followed by a create","1081","\t\tcheckPermission(CREATE);","1082","\t\tcheckPermission(DELETE);","1084","\t\tString newName = req.getParameter(\"newName\");","1085","\t\ttry {","1086","\t\t\tHudson.checkGoodName(newName);","1087","\t\t} catch (ParseException e) {","1088","\t\t\tsendError(e, req, rsp);","1089","\t\t\treturn;","1090","\t\t}","1092","\t\trenameTo(newName);","1093","\t\t\/\/ send to the new job page","1094","\t\t\/\/ note we can't use getUrl() because that would pick up old name in the","1095","\t\t\/\/ Ancestor.getUrl()","1096","\t\trsp.sendRedirect2(req.getContextPath() + '\/' + getParent().getUrl()","1097","\t\t\t\t+ getShortUrl());","1098","\t}","1100","\tpublic void doRssAll(StaplerRequest req, StaplerResponse rsp)","1101","\t\t\tthrows IOException, ServletException {","1102","\t\trss(req, rsp, \" all builds\", new RunList(this));","1103","\t}","1105","\tpublic void doRssFailed(StaplerRequest req, StaplerResponse rsp)","1106","\t\t\tthrows IOException, ServletException {","1107","\t\trss(req, rsp, \" failed builds\", new RunList(this).failureOnly());","1108","\t}","1110","\tprivate void rss(StaplerRequest req, StaplerResponse rsp, String suffix,","1111","\t\t\tRunList runs) throws IOException, ServletException {","1112","\t\tRSS.forwardToRss(getDisplayName() + suffix, getUrl(), runs.newBuilds(),","1113","\t\t\t\tRun.FEED_ADAPTER, req, rsp);","1114","\t}"],"delete":["73"," *","76"," *","79","public abstract class Job<JobT extends Job<JobT,RunT>, RunT extends Run<JobT,RunT>>","80","        extends AbstractItem implements ExtensionPoint {","82","    \/**","83","     * Next build number.","84","     * Kept in a separate file because this is the only information","85","     * that gets updated often. This allows the rest of the configuration","86","     * to be in the VCS.","87","     * <p>","88","     * In 1.28 and earlier, this field was stored in the project configuration file,","89","     * so even though this is marked as transient, don't move it around.","90","     *\/","91","    protected transient volatile int nextBuildNumber = 1;","93","    private volatile LogRotator logRotator;","94","    ","95","    \/**","96","     * Not all plugins are good at calculating their health report quickly.","97","     * These fields are used to cache the health reports to speed up rendering the main page.","98","     *\/","99","    private transient Integer cachedBuildHealthReportsBuildNumber = null;","100","    private transient List<HealthReport> cachedBuildHealthReports = null;","102","    private boolean keepDependencies;","104","    \/**","105","     * List of {@link UserProperty}s configured for this project.","106","     *\/","107","    protected CopyOnWriteList<JobProperty<? super JobT>> properties = new CopyOnWriteList<JobProperty<? super JobT>>();","109","    protected Job(ItemGroup parent,String name) {","110","        super(parent,name);","111","    }","113","    public void onLoad(ItemGroup<? extends Item> parent, String name) throws IOException {","114","        super.onLoad(parent, name);","116","        TextFile f = getNextBuildNumberFile();","117","        if(f.exists()) {","118","            \/\/ starting 1.28, we store nextBuildNumber in a separate file.","119","            \/\/ but old Hudson didn't do it, so if the file doesn't exist,","120","            \/\/ assume that nextBuildNumber was read from config.xml","121","            try {","122","                this.nextBuildNumber = Integer.parseInt(f.readTrim());","123","            } catch (NumberFormatException e) {","124","                throw new IOException2(f+\" doesn't contain a number\",e);","125","            }","126","        } else {","127","            \/\/ this must be the old Hudson. create this file now.","128","            saveNextBuildNumber();","129","            save(); \/\/ and delete it from the config.xml","130","        }","132","        if(properties==null) \/\/ didn't exist < 1.72","133","            properties = new CopyOnWriteList<JobProperty<? super JobT>>();","135","        for (JobProperty p : properties)","136","            p.setOwner(this);","137","    }","139","    @Override","140","    public void onCopiedFrom(Item src) {","141","        super.onCopiedFrom(src);","142","        this.nextBuildNumber = 1;     \/\/ reset the next build number","143","    }","145","    protected void performDelete() throws IOException {","146","        \/\/ if a build is in progress. Cancel it.","147","        RunT lb = getLastBuild();","148","        if(lb!=null) {","149","            Executor e = lb.getExecutor();","150","            if(e!=null) {","151","                e.interrupt();","152","                \/\/ should we block until the build is cancelled?","153","            }","154","        }","155","        super.performDelete();","156","    }","158","    private TextFile getNextBuildNumberFile() {","159","        return new TextFile(new File(this.getRootDir(),\"nextBuildNumber\"));","160","    }","162","    protected void saveNextBuildNumber() throws IOException {","163","        getNextBuildNumberFile().write(String.valueOf(nextBuildNumber)+'\\n');","164","    }","166","    @Exported","167","    public boolean isInQueue() {","168","        return false;","169","    }","171","    \/**","172","     * If this job is in the build queue, return its item.","173","     *\/","174","    @Exported","175","    public Queue.Item getQueueItem() {","176","        return null;","177","    }","179","    \/**","180","     * Get the term used in the UI to represent this kind of {@link AbstractProject}.","181","     * Must start with a capital letter.","182","     *\/","183","    public String getPronoun() {","184","        return Messages.Job_Pronoun();","185","    }","187","    \/**","188","     * Returns whether the name of this job can be changed by user.","189","     *\/","190","    public boolean isNameEditable() {","191","        return true;","192","    }","194","    \/**","195","     * If true, it will keep all the build logs of dependency components.","196","     *\/","197","    @Exported","198","    public boolean isKeepDependencies() {","199","        return keepDependencies;","200","    }","202","    \/**","203","     * Allocates a new buildCommand number.","204","     *\/","205","    public synchronized int assignBuildNumber() throws IOException {","206","        int r = nextBuildNumber++;","207","        saveNextBuildNumber();","208","        return r;","209","    }","211","    \/**","212","     * Peeks the next build number.","213","     *\/","214","    @Exported","215","    public int getNextBuildNumber() {","216","        return nextBuildNumber;","217","    }","219","    \/**","220","     * Programatically updates the next build number.","221","     *","222","     * <p>","223","     * Much of Hudson assumes that the build number is unique and monotonic,","224","     * so this method can only accept a new value that's bigger than","225","     * {@link #getNextBuildNumber()} returns. Otherwise it'll be no-op.","226","     *","227","     * @since 1.199","228","     *      (before that, this method was package private.)","229","     *\/","230","    public void updateNextBuildNumber(int next) throws IOException {","231","        if(next>nextBuildNumber) {","232","            this.nextBuildNumber = next;","233","            saveNextBuildNumber();","234","        }","235","    }","237","    \/**","238","     * Returns the log rotator for this job, or null if none.","239","     *\/","240","    public LogRotator getLogRotator() {","241","        return logRotator;","242","    }","244","    public void setLogRotator(LogRotator logRotator) {","245","        this.logRotator = logRotator;","246","    }","248","    \/**","249","     * Perform log rotation.","250","     *\/","251","    public void logRotate() throws IOException {","252","        LogRotator lr = getLogRotator();","253","        if(lr!=null)","254","            lr.perform(this);","255","    }","257","    \/**","258","     * True if this instance supports log rotation configuration.","259","     *\/","260","    public boolean supportsLogRotator() {","261","        return true;","262","    }","264","    protected SearchIndexBuilder makeSearchIndex() {","265","        return super.makeSearchIndex()","266","            .add(new SearchIndex() {","267","                public void find(String token, List<SearchItem> result) {","268","                    try {","269","                        if(token.startsWith(\"#\"))   token=token.substring(1);   \/\/ ignore leading '#'","270","                        int n = Integer.parseInt(token);","271","                        Run b = getBuildByNumber(n);","272","                        if(b==null) return; \/\/ no such build","273","                        result.add(SearchItems.create(\"#\"+n,\"\"+n,b));","274","                    } catch (NumberFormatException e) {","275","                        \/\/ not a number.","276","                    }","277","                }","279","                public void suggest(String token, List<SearchItem> result) {","280","                    find(token,result);","281","                }","282","            }).add(\"configure\",\"config\",\"configure\");","283","    }","285","    public Collection<? extends Job> getAllJobs() {","286","        return Collections.<Job>singleton(this);","287","    }","289","    \/**","290","     * Adds {@link JobProperty}.","291","     * @since 1.188","292","     *\/","293","    public void addProperty(JobProperty<? super JobT> jobProp) throws IOException {","294","        properties.add(jobProp);","295","        save();","296","    }","297","    \/**","298","     * Gets all the job properties configured for this job.","299","     *\/","300","    @SuppressWarnings(\"unchecked\")","301","    public Map<JobPropertyDescriptor,JobProperty<? super JobT>> getProperties() {","302","        return Descriptor.toMap((Iterable)properties);","303","    }","305","    \/**","306","     * Gets the specific property, or null if the propert is not configured for this job.","307","     *\/","308","    public <T extends JobProperty> T getProperty(Class<T> clazz) {","309","        for (JobProperty p : properties) {","310","            if(clazz.isInstance(p))","311","                return clazz.cast(p);","312","        }","313","        return null;","314","    }","316","    public List<Widget> getWidgets() {","317","        ArrayList<Widget> r = new ArrayList<Widget>();","318","        r.add(createHistoryWidget());","319","        return r;","320","    }","322","    protected HistoryWidget createHistoryWidget() {","323","        return new HistoryWidget<Job,RunT>(this,getBuilds(),HISTORY_ADAPTER);","324","    }","326","    protected static final HistoryWidget.Adapter<Run> HISTORY_ADAPTER = new Adapter<Run>() {","327","        public int compare(Run record, String key) {","328","            return record.getNumber()-Integer.parseInt(key);","329","        }","331","        public String getKey(Run record) {","332","            return String.valueOf(record.getNumber());","333","        }","335","        public boolean isBuilding(Run record) {","336","            return record.isBuilding();","337","        }","339","        public String getNextKey(String key) {","340","            return String.valueOf(Integer.parseInt(key)+1);","341","        }","342","    };","344","    \/**","345","     * Renames a job.","346","     *","347","     * <p>","348","     * This method is defined on {@link Job} but really only applicable","349","     * for {@link Job}s that are top-level items.","350","     *\/","351","    public void renameTo(String newName) throws IOException {","352","        \/\/ always synchronize from bigger objects first","353","        final Hudson parent = Hudson.getInstance();","354","        assert this instanceof TopLevelItem;","355","        synchronized(parent) {","356","            synchronized(this) {","357","                \/\/ sanity check","358","                if(newName==null)","359","                    throw new IllegalArgumentException(\"New name is not given\");","360","                if(parent.getItem(newName)!=null)","361","                    throw new IllegalArgumentException(\"Job \"+newName+\" already exists\");","363","                \/\/ noop?","364","                if(this.name.equals(newName))","365","                    return;","368","                String oldName = this.name;","369","                File oldRoot = this.getRootDir();","371","                doSetName(newName);","372","                File newRoot = this.getRootDir();","374","                boolean success = false;","376","                try {\/\/ rename data files","377","                    boolean interrupted=false;","378","                    boolean renamed = false;","380","                    \/\/ try to rename the job directory.","381","                    \/\/ this may fail on Windows due to some other processes accessing a file.","382","                    \/\/ so retry few times before we fall back to copy.","383","                    for( int retry=0; retry<5; retry++ ) {","384","                        if(oldRoot.renameTo(newRoot)) {","385","                            renamed = true;","386","                            break; \/\/ succeeded","387","                        }","388","                        try {","389","                            Thread.sleep(500);","390","                        } catch (InterruptedException e) {","391","                            \/\/ process the interruption later","392","                            interrupted = true;","393","                        }","394","                    }","396","                    if(interrupted)","397","                        Thread.currentThread().interrupt();","399","                    if(!renamed) {","400","                        \/\/ failed to rename. it must be that some lengthy process is going on","401","                        \/\/ to prevent a rename operation. So do a copy. Ideally we'd like to","402","                        \/\/ later delete the old copy, but we can't reliably do so, as before the VM","403","                        \/\/ shuts down there might be a new job created under the old name.","404","                        Copy cp = new Copy();","405","                        cp.setProject(new org.apache.tools.ant.Project());","406","                        cp.setTodir(newRoot);","407","                        FileSet src = new FileSet();","408","                        src.setDir(getRootDir());","409","                        cp.addFileset(src);","410","                        cp.setOverwrite(true);","411","                        cp.setPreserveLastModified(true);","412","                        cp.setFailOnError(false);   \/\/ keep going even if there's an error","413","                        cp.execute();","415","                        \/\/ try to delete as much as possible","416","                        try {","417","                            Util.deleteRecursive(oldRoot);","418","                        } catch (IOException e) {","419","                            \/\/ but ignore the error, since we expect that","420","                            e.printStackTrace();","421","                        }","422","                    }","424","                    success = true;","425","                } finally {","426","                    \/\/ if failed, back out the rename.","427","                    if(!success)","428","                        doSetName(oldName);","429","                }","431","                parent.onRenamed((TopLevelItem)this,oldName,newName);","433","                for (ItemListener l : Hudson.getInstance().getJobListeners())","434","                    l.onRenamed(this,oldName,newName);","435","            }","436","        }","437","    }","439","    \/**","440","     * Returns true if we should display \"build now\" icon","441","     *\/","442","    @Exported","443","    public abstract boolean isBuildable();","445","    \/**","446","     * Gets all the builds.","447","     *","448","     * @return","449","     *      never null. The first entry is the latest build.","450","     *\/","451","    public List<RunT> getBuilds() {","452","        return new ArrayList<RunT>(_getRuns().values());","453","    }","455","    \/**","456","     * Gets all the builds in a map.","457","     *\/","458","    public SortedMap<Integer,RunT> getBuildsAsMap() {","459","        return Collections.unmodifiableSortedMap(_getRuns());","460","    }","462","    \/**","463","     * @deprecated","464","     *      This is only used to support backward compatibility with","465","     *      old URLs.","466","     *\/","467","    @Deprecated","468","    public RunT getBuild(String id) {","469","        for (RunT r : _getRuns().values()) {","470","            if(r.getId().equals(id))","471","                return r;","472","        }","473","        return null;","474","    }","476","    \/**","477","     * @param n","478","     *      The build number.","479","     * @return","480","     *      null if no such build exists.","481","     * @see Run#getNumber()","482","     *\/","483","    public RunT getBuildByNumber(int n) {","484","        return _getRuns().get(n);","485","    }","487","    \/**","488","     * Gets the youngest build #m that satisfies <tt>n&lt;=m<\/tt>.","489","     *","490","     * This is useful when you'd like to fetch a build but the exact build might be already","491","     * gone (deleted, rotated, etc.)","492","     *\/","493","    public final RunT getNearestBuild(int n) {","494","        SortedMap<Integer, ? extends RunT> m = _getRuns().headMap(n-1); \/\/ the map should include n, so n-1","495","        if(m.isEmpty()) return null;","496","        return m.get(m.lastKey());","497","    }","499","    \/**","500","     * Gets the latest build #m that satisfies <tt>m&lt;=n<\/tt>.","501","     *","502","     * This is useful when you'd like to fetch a build but the exact build might be already","503","     * gone (deleted, rotated, etc.)","504","     *\/","505","    public final RunT getNearestOldBuild(int n) {","506","        SortedMap<Integer, ? extends RunT> m = _getRuns().tailMap(n);","507","        if(m.isEmpty()) return null;","508","        return m.get(m.firstKey());","509","    }","511","    public Object getDynamic(String token, StaplerRequest req, StaplerResponse rsp) {","512","        try {","513","            \/\/ try to interpret the token as build number","514","            return _getRuns().get(Integer.valueOf(token));","515","        } catch (NumberFormatException e) {","516","            \/\/ try to map that to widgets","517","            for (Widget w : getWidgets()) {","518","                if(w.getUrlName().equals(token))","519","                    return w;","520","            }","521","            ","522","            return super.getDynamic(token,req,rsp);","523","        }","524","    }","526","    \/**","527","     * Directory for storing {@link Run} records.","528","     * <p>","529","     * Some {@link Job}s may not have backing data store for {@link Run}s,","530","     * but those {@link Job}s that use file system for storing data","531","     * should use this directory for consistency.","532","     *","533","     * @see RunMap","534","     *\/","535","    protected File getBuildDir() {","536","        return new File(getRootDir(),\"builds\");","537","    }","539","    \/**","540","     * Gets all the runs.","541","     *","542","     * The resulting map must be immutable (by employing copy-on-write semantics.)","543","     * The map is descending order, with newest builds at the top.","544","     *\/","545","    protected abstract SortedMap<Integer,? extends RunT> _getRuns();","547","    \/**","548","     * Called from {@link Run} to remove it from this job.","549","     *","550","     * The files are deleted already. So all the callee needs to do","551","     * is to remove a reference from this {@link Job}.","552","     *\/","553","    protected abstract void removeRun(RunT run);","555","    \/**","556","     * Returns the last build.","557","     *\/","558","    @Exported @QuickSilver","559","    public RunT getLastBuild() {","560","        SortedMap<Integer,? extends RunT> runs = _getRuns();","562","        if(runs.isEmpty())    return null;","563","        return runs.get(runs.firstKey());","564","    }","566","    \/**","567","     * Returns the oldest build in the record.","568","     *\/","569","    @Exported @QuickSilver","570","    public RunT getFirstBuild() {","571","        SortedMap<Integer,? extends RunT> runs = _getRuns();","573","        if(runs.isEmpty())    return null;","574","        return runs.get(runs.lastKey());","575","    }","577","    \/**","578","     * Returns the last successful build, if any. Otherwise null.","579","     * A stable build would include either {@link Result#SUCCESS} or {@link Result#UNSTABLE}.","580","     * @see #getLastStableBuild()","581","     *\/","582","    @Exported @QuickSilver","583","    public RunT getLastSuccessfulBuild() {","584","        RunT r = getLastBuild();","585","        \/\/ temporary hack till we figure out what's causing this bug","586","        while(r!=null && (r.isBuilding() || r.getResult()==null || r.getResult().isWorseThan(Result.UNSTABLE)))","587","            r=r.getPreviousBuild();","588","        return r;","589","    }","591","    \/**","592","     * Returns the last stable build, if any. Otherwise null.","593","     *\/","594","    @Exported @QuickSilver","595","    public RunT getLastStableBuild() {","596","        RunT r = getLastBuild();","597","        while(r!=null && (r.isBuilding() || r.getResult().isWorseThan(Result.SUCCESS)))","598","            r=r.getPreviousBuild();","599","        return r;","600","    }","602","    \/**","603","     * Returns the last failed build, if any. Otherwise null.","604","     *\/","605","    @Exported @QuickSilver","606","    public RunT getLastFailedBuild() {","607","        RunT r = getLastBuild();","608","        while(r!=null && (r.isBuilding() || r.getResult()!=Result.FAILURE))","609","            r=r.getPreviousBuild();","610","        return r;","611","    }","612","    ","613","    \/**","614","     * Returns the last completed build, if any. Otherwise null.","615","     *\/","616","    @Exported @QuickSilver","617","    public RunT getLastCompletedBuild() {","618","       RunT r = getLastBuild();","619","       while(r!=null && r.isBuilding())","620","           r=r.getPreviousBuild();","621","       return r;","622","    }","624","    \/**","625","     * Used as the color of the status ball for the project.","626","     *\/","627","    @Exported(visibility=2,name=\"color\")","628","    public BallColor getIconColor() {","629","        RunT lastBuild = getLastBuild();","630","        while(lastBuild!=null && lastBuild.hasntStartedYet())","631","            lastBuild = lastBuild.getPreviousBuild();","633","        if(lastBuild!=null)","634","            return lastBuild.getIconColor();","635","        else","636","            return BallColor.GREY;","637","    }","639","    \/**","640","     * Get the current health report for a job.","641","     * @return","642","     *     the health report.  Never returns null","643","     *\/","644","    public HealthReport getBuildHealth() {","645","        List<HealthReport> reports = getBuildHealthReports();","646","        return reports.isEmpty() ? new HealthReport() : reports.get(0);","647","    }","649","    @Exported(name=\"healthReport\")","650","    public List<HealthReport> getBuildHealthReports() {","651","        List<HealthReport> reports = new ArrayList<HealthReport>();","652","        RunT lastBuild = getLastBuild();","654","        if (lastBuild != null && lastBuild.isBuilding()) {","655","            \/\/ show the previous build's report until the current one is finished building.","656","            lastBuild = lastBuild.getPreviousBuild();","657","        }","659","        \/\/ check the cache","660","        if (cachedBuildHealthReportsBuildNumber != null && ","661","                cachedBuildHealthReports != null &&","662","                lastBuild != null &&","663","                cachedBuildHealthReportsBuildNumber.intValue() == lastBuild.getNumber()) {","664","            reports.addAll(cachedBuildHealthReports);","665","        } else if (lastBuild != null) {","666","            for (HealthReportingAction healthReportingAction : lastBuild.getActions(HealthReportingAction.class)) {","667","                final HealthReport report = healthReportingAction.getBuildHealth();","668","                if (report != null) {","669","                    if (report.isAggregateReport()) {","670","                        reports.addAll(report.getAggregatedReports());","671","                    } else {","672","                        reports.add(report);","673","                    }","674","                }","675","            }","676","            final HealthReport report = getBuildStabilityHealthReport();","677","            if (report != null) {","678","                if (report.isAggregateReport()) {","679","                    reports.addAll(report.getAggregatedReports());","680","                } else {","681","                    reports.add(report);","682","                }","683","            }","685","            Collections.sort(reports);","686","    ","687","            \/\/ store the cache","688","            cachedBuildHealthReportsBuildNumber = lastBuild.getNumber();","689","            cachedBuildHealthReports = new ArrayList<HealthReport>(reports);","690","        }","692","        return reports;","693","    }","695","    private HealthReport getBuildStabilityHealthReport() {","696","        \/\/ we can give a simple view of build health from the last five builds","697","        int failCount = 0;","698","        int totalCount = 0;","699","        RunT i = getLastBuild();","700","        while (totalCount < 5 && i != null) {","701","            switch (i.getIconColor()) {","702","                case BLUE:","703","                case YELLOW:","704","                    \/\/failCount stays the same","705","                    totalCount++;","706","                    break;","707","                case RED:","708","                    failCount++;","709","                    totalCount++;","710","                    break;","712","                default:","713","                    \/\/ do nothing as these are inconclusive statuses","714","                    break;","715","            }","716","            i = i.getPreviousBuild();","717","        }","718","        if (totalCount > 0) {","719","            int score = (int) ((100.0 * (totalCount - failCount)) \/ totalCount);","720","            if (score < 100 && score > 0) {","721","                \/\/ HACK","722","                \/\/ force e.g. 4\/5 to be in the 60-79 range","723","                score--;","724","            }","726","            String description;","727","            if (failCount == 0) {","728","                description = Messages.Job_NoRecentBuildFailed();","729","            } else if (totalCount == failCount) {","730","                \/\/ this should catch the case where totalCount == 1","731","                \/\/ as failCount must be between 0 and totalCount","732","                \/\/ and we can't get here if failCount == 0","733","                description = Messages.Job_AllRecentBuildFailed();","734","            } else {","735","                description = Messages.Job_NOfMFailed(failCount,totalCount);","736","            }","737","            return new HealthReport(score, Messages.Job_BuildStability(description));","738","        }","739","        return null;","740","    }","742","\/\/","743","\/\/","744","\/\/ actions","745","\/\/","746","\/\/","747","    \/**","748","     * Accepts submission from the configuration page.","749","     *\/","750","    public synchronized void doConfigSubmit(StaplerRequest req, StaplerResponse rsp) throws IOException, ServletException {","751","        checkPermission(CONFIGURE);","753","        req.setCharacterEncoding(\"UTF-8\");","755","        description = req.getParameter(\"description\");","757","        if (req.getParameter(\"logrotate\") != null)","758","            logRotator = LogRotator.DESCRIPTOR.newInstance(req);","759","        else","760","            logRotator = null;","762","        keepDependencies = req.getParameter(\"keepDependencies\") != null;","764","        try {","765","            properties.clear();","767","            JSONObject json = StructuredForm.get(req);","769","            int i=0;","770","            for (JobPropertyDescriptor d : JobPropertyDescriptor.getPropertyDescriptors(Job.this.getClass())) {","771","                String name = \"jobProperty\"+(i++);","772","                JobProperty prop = d.newInstance(req,json.getJSONObject(name));","773","                if (prop != null) {","774","                    prop.setOwner(this);","775","                    properties.add(prop);","776","                }","777","            }","779","            submit(req,rsp);","781","            save();","783","            String newName = req.getParameter(\"name\");","784","            if(newName!=null && !newName.equals(name)) {","785","                \/\/ check this error early to avoid HTTP response splitting.","786","                try {","787","                    Hudson.checkGoodName(newName);","788","                } catch (ParseException e) {","789","                    sendError(e,req,rsp);","790","                    return;","791","                }","792","                rsp.sendRedirect(\"rename?newName=\"+newName);","793","            } else {","794","                rsp.sendRedirect(\".\");","795","            }","796","        } catch (FormException e) {","797","            rsp.setStatus(SC_BAD_REQUEST);","798","            sendError(e,req,rsp);","799","        } catch (JSONException e) {","800","            StringWriter sw = new StringWriter();","801","            PrintWriter pw = new PrintWriter(sw);","802","            pw.println(\"Failed to parse form data. Please report this probelm as a bug\");","803","            pw.println(\"JSON=\"+StructuredForm.get(req));","804","            pw.println();","805","            e.printStackTrace(pw);","807","            rsp.setStatus(SC_BAD_REQUEST);","808","            sendError(sw.toString(),req,rsp);","809","        }","810","    }","812","    \/**","813","     * Accepts <tt>config.xml<\/tt> submission, as well as serve it.","814","     *\/","815","    @WebMethod(name=\"config.xml\")","816","    public void doConfigDotXml(StaplerRequest req, StaplerResponse rsp) throws IOException {","817","        checkPermission(CONFIGURE);","819","        if(req.getMethod().equals(\"GET\")) {","820","            \/\/ read","821","            rsp.setContentType(\"application\/xml;charset=UTF-8\");","822","            getConfigFile().writeRawTo(rsp.getWriter());","823","            return;","824","        }","825","        if(req.getMethod().equals(\"POST\")) {","826","            \/\/ submission","827","            XmlFile configXmlFile = getConfigFile();","828","            AtomicFileWriter out = new AtomicFileWriter(configXmlFile.getFile());","830","            try {","831","                \/\/ this allows us to use UTF-8 for storing data,","832","                \/\/ plus it checks any well-formedness issue in the submitted data","833","                Transformer t = TransformerFactory.newInstance().newTransformer();","834","                t.transform(new StreamSource(req.getReader()),new StreamResult(out));","835","                out.close();","836","            } catch (TransformerException e) {","837","                throw new IOException2(\"Failed to persist configuration.xml\",e);","838","            }","840","            \/\/ try to reflect the changes by reloading","841","            new XmlFile(Items.XSTREAM, out.getTemporaryFile()).unmarshal(this);","842","            onLoad(getParent(),getRootDir().getName());","844","            \/\/ if everything went well, commit this new version","845","            out.commit();","846","            return;","847","        }","849","        \/\/ huh?","850","        rsp.sendError(SC_BAD_REQUEST);","851","    }","853","    \/**","854","     * Derived class can override this to perform additional config submission work.","855","     *\/","856","    protected void submit(StaplerRequest req, StaplerResponse rsp) throws IOException, ServletException, FormException {","857","    }","859","    \/**","860","     * Returns the image that shows the current buildCommand status.","861","     *\/","862","    public void doBuildStatus( StaplerRequest req, StaplerResponse rsp ) throws IOException {","863","        rsp.sendRedirect2(req.getContextPath()+\"\/nocacheImages\/48x48\/\"+getBuildStatusUrl());","864","    }","866","    public String getBuildStatusUrl() {","867","        return getIconColor().getImage();","868","    }","870","    \/**","871","     * Returns the graph that shows how long each build took.","872","     *\/","873","    public void doBuildTimeGraph( StaplerRequest req, StaplerResponse rsp ) throws IOException {","874","        if(getLastBuild()==null) {","875","            rsp.setStatus(HttpServletResponse.SC_NOT_FOUND);","876","            return;","877","        }","878","        if(req.checkIfModified(getLastBuild().getTimestamp(),rsp))","879","            return;","880","        ChartUtil.generateGraph(req,rsp, createBuildTimeTrendChart(),500,400);","881","    }","883","    \/**","884","     * Returns the clickable map for the build time graph.","885","     * Loaded lazily by AJAX.","886","     *\/","887","    public void doBuildTimeGraphMap( StaplerRequest req, StaplerResponse rsp ) throws IOException {","888","        if(getLastBuild()==null) {","889","            rsp.setStatus(HttpServletResponse.SC_NOT_FOUND);","890","            return;","891","        }","892","        if(req.checkIfModified(getLastBuild().getTimestamp(),rsp))","893","            return;","894","        ChartUtil.generateClickableMap(req,rsp, createBuildTimeTrendChart(),500,400);","895","    }","897","    private JFreeChart createBuildTimeTrendChart() {","898","        class ChartLabel implements Comparable<ChartLabel> {","899","            final Run run;","901","            public ChartLabel(Run r) {","902","                this.run = r;","903","            }","905","            public int compareTo(ChartLabel that) {","906","                return this.run.number-that.run.number;","907","            }","909","            public boolean equals(Object o) {","910","                ChartLabel that = (ChartLabel) o;","911","                return run ==that.run;","912","            }","914","            public Color getColor() {","915","                \/\/ TODO: consider gradation. See http:\/\/www.javadrive.jp\/java2d\/shape\/index9.html","916","                Result r = run.getResult();","917","                if(r ==Result.FAILURE || r== Result.ABORTED)","918","                    return ColorPalette.RED;","919","                else","920","                    return ColorPalette.BLUE;","921","            }","923","            public int hashCode() {","924","                return run.hashCode();","925","            }","927","            public String toString() {","928","                String l = run.getDisplayName();","929","                if(run instanceof Build) {","930","                    String s = ((Build)run).getBuiltOnStr();","931","                    if(s!=null)","932","                        l += ' '+s;","933","                }","934","                return l;","935","            }","937","        }","939","        DataSetBuilder<String,ChartLabel> data = new DataSetBuilder<String, ChartLabel>();","940","        for( Run r : getBuilds() ) {","941","            if(r.isBuilding())  continue;","942","            data.add( ((double)r.getDuration())\/(1000*60), \"min\", new ChartLabel(r));","943","        }","945","        final CategoryDataset dataset = data.build();","947","        final JFreeChart chart = ChartFactory.createStackedAreaChart(","948","            null,                   \/\/ chart title","949","            null,                   \/\/ unused","950","            Messages.Job_minutes(),   \/\/ range axis label","951","            dataset,                  \/\/ data","952","            PlotOrientation.VERTICAL, \/\/ orientation","953","            false,                     \/\/ include legend","954","            true,                     \/\/ tooltips","955","            false                     \/\/ urls","956","        );","958","        chart.setBackgroundPaint(Color.white);","960","        final CategoryPlot plot = chart.getCategoryPlot();","962","        \/\/ plot.setAxisOffset(new Spacer(Spacer.ABSOLUTE, 5.0, 5.0, 5.0, 5.0));","963","        plot.setBackgroundPaint(Color.WHITE);","964","        plot.setOutlinePaint(null);","965","        plot.setForegroundAlpha(0.8f);","966","\/\/        plot.setDomainGridlinesVisible(true);","967","\/\/        plot.setDomainGridlinePaint(Color.white);","968","        plot.setRangeGridlinesVisible(true);","969","        plot.setRangeGridlinePaint(Color.black);","971","        CategoryAxis domainAxis = new ShiftedCategoryAxis(null);","972","        plot.setDomainAxis(domainAxis);","973","        domainAxis.setCategoryLabelPositions(CategoryLabelPositions.UP_90);","974","        domainAxis.setLowerMargin(0.0);","975","        domainAxis.setUpperMargin(0.0);","976","        domainAxis.setCategoryMargin(0.0);","978","        final NumberAxis rangeAxis = (NumberAxis) plot.getRangeAxis();","979","        ChartUtil.adjustChebyshev(dataset,rangeAxis);","980","        rangeAxis.setStandardTickUnits(NumberAxis.createIntegerTickUnits());","982","        StackedAreaRenderer ar = new StackedAreaRenderer2() {","983","            @Override","984","            public Paint getItemPaint(int row, int column) {","985","                ChartLabel key = (ChartLabel) dataset.getColumnKey(column);","986","                return key.getColor();","987","            }","989","            @Override","990","            public String generateURL(CategoryDataset dataset, int row, int column) {","991","                ChartLabel label = (ChartLabel) dataset.getColumnKey(column);","992","                return String.valueOf(label.run.number);","993","            }","995","            @Override","996","            public String generateToolTip(CategoryDataset dataset, int row, int column) {","997","                ChartLabel label = (ChartLabel) dataset.getColumnKey(column);","998","                return label.run.getDisplayName() + \" : \" + label.run.getDurationString();","999","            }","1000","        };","1001","        plot.setRenderer(ar);","1003","        \/\/ crop extra space around the graph","1004","        plot.setInsets(new RectangleInsets(0,0,0,5.0));","1006","        return chart;","1007","    }","1009","    \/**","1010","     * Renames this job.","1011","     *\/","1012","    public \/*not synchronized. see renameTo()*\/ void doDoRename( StaplerRequest req, StaplerResponse rsp ) throws IOException, ServletException {","1013","        \/\/ rename is essentially delete followed by a create","1014","        checkPermission(CREATE);","1015","        checkPermission(DELETE);","1017","        String newName = req.getParameter(\"newName\");","1018","        try {","1019","            Hudson.checkGoodName(newName);","1020","        } catch (ParseException e) {","1021","            sendError(e,req,rsp);","1022","            return;","1023","        }","1025","        renameTo(newName);","1026","        \/\/ send to the new job page","1027","        \/\/ note we can't use getUrl() because that would pick up old name in the Ancestor.getUrl()","1028","        rsp.sendRedirect2(req.getContextPath()+'\/'+getParent().getUrl()+getShortUrl());","1029","    }","1031","    public void doRssAll( StaplerRequest req, StaplerResponse rsp ) throws IOException, ServletException {","1032","        rss(req, rsp, \" all builds\", new RunList(this));","1033","    }","1034","    public void doRssFailed( StaplerRequest req, StaplerResponse rsp ) throws IOException, ServletException {","1035","        rss(req, rsp, \" failed builds\", new RunList(this).failureOnly());","1036","    }","1038","    private void rss(StaplerRequest req, StaplerResponse rsp, String suffix, RunList runs) throws IOException, ServletException {","1039","        RSS.forwardToRss(getDisplayName()+ suffix, getUrl(),","1040","            runs.newBuilds(), Run.FEED_ADAPTER, req, rsp );","1041","    }"]}]}},"5562b2fec6428b730a7b88ad6390a7ed741ba792":{"changes":{"core\/src\/main\/java\/hudson\/FilePath.java":"MODIFY","core\/src\/main\/java\/jenkins\/util\/VirtualFile.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/FilePath.java":[{"add":["134","import org.kohsuke.stapler.Function;","3265","                if (Functions.isWindows()) {","3266","                    parentRealPath = this.windowsToRealPath(parentAbsolutePath);","3267","                } else {","3268","                    parentRealPath = parentAbsolutePath.toRealPath();","3269","                }","3271","            catch (NoSuchFileException e) {","3272","                LOGGER.log(Level.FINE, String.format(\"Cannot find the real path to the parentFile: %s\", parentAbsolutePath), e);","3304","                        LOGGER.log(Level.FINE, \"Child [{0}] does not start with parent [{1}] => not descendant\", new Object[]{ child, parentRealPath });","3308","                    \/\/ nonexistent file \/ Windows Server 2016 + MSFT docker","3331","        ","3332","        private @Nonnull Path windowsToRealPath(@Nonnull Path path) throws IOException {","3333","            try {","3334","                return path.toRealPath();","3335","            }","3336","            catch (IOException e) {","3337","                if (LOGGER.isLoggable(Level.FINE)) {","3338","                    LOGGER.log(Level.FINE, String.format(\"relaxedToRealPath cannot use the regular toRealPath on %s, trying with toRealPath(LinkOption.NOFOLLOW_LINKS)\", path), e);","3339","                }","3340","            }","3341","","3342","            \/\/ that's required for specific environment like Windows Server 2016, running MSFT docker","3343","            \/\/ where the root is a <SYMLINKD>","3344","            return path.toRealPath(LinkOption.NOFOLLOW_LINKS);","3345","        }"],"delete":["3264","                parentRealPath = parentAbsolutePath.toRealPath();","3266","            catch(NoSuchFileException e) {","3301","                    \/\/ nonexistent file"]}],"core\/src\/main\/java\/jenkins\/util\/VirtualFile.java":[{"add":["546","                String myPath = f.toPath().toRealPath().toString();","547","                String rootPath = root.toPath().toRealPath().toString();","548","                if (!myPath.equals(rootPath) && !myPath.startsWith(rootPath + File.separatorChar)) {","549","                    return true;","550","                }"],"delete":["546","                return !this.isDescendant(\"\");"]}]}},"4e1a471936555ecc42a3c43336093d77826235a8":{"changes":{"war\/resources\/help\/shell\/shellexe_ja.html":"ADD"},"diff":{"war\/resources\/help\/shell\/shellexe_ja.html":[{"add":[],"delete":[]}]}},"9309cd39ad44836fba983ae6385e7ab567cd5e3b":{"changes":{"changelog.html":"MODIFY"},"diff":{"changelog.html":[{"add":["82","  <li class=bug>","83","    Fixed side\/main panel scrolling issues.","84","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-26312\">issue 26312<\/a>,","85","     <a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-26298\">issue 26298<\/a>,","86","     <a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-26306\">issue 26306<\/a>)"],"delete":[]}]}},"f10d9f95fc6346858c1204e65b737743f8924597":{"changes":{"core\/src\/main\/java\/hudson\/UDPBroadcastThread.java":"MODIFY","\/dev\/null":"DELETE","core\/pom.xml":"MODIFY","core\/src\/main\/java\/hudson\/DNSMultiCast.java":"MODIFY","core\/src\/main\/java\/jenkins\/model\/Jenkins.java":"MODIFY","war\/pom.xml":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/UDPBroadcastThread.java":[{"add":["4"," * Copyright (c) 2020, CloudBees, Inc","26","import hudson.init.Initializer;","28","import jenkins.util.SystemProperties;","29","import org.kohsuke.accmod.Restricted;","30","import org.kohsuke.accmod.restrictions.NoExternalUse;","35","import static hudson.init.InitMilestone.COMPLETED;","36","","44"," * @deprecated No longer does anything.","46","@Deprecated","47","@Restricted(NoExternalUse.class)","48","public class UDPBroadcastThread {","55","    @Initializer(before=COMPLETED)","56","    public static void warn() {","57","        if (PORT > 0) {","58","            LOGGER.warning(\"UDP broadcast capability has been removed from Jenkins. More information: https:\/\/jenkins.io\/redirect\/udp-broadcast\");","61",""],"delete":["25","import jenkins.util.SystemProperties;","26","import edu.umd.cs.findbugs.annotations.SuppressFBWarnings;","27","import hudson.model.Hudson;","29","import hudson.util.OneShotEvent;","32","import java.net.DatagramPacket;","33","import java.net.InetAddress;","34","import java.net.MulticastSocket;","35","import java.net.SocketAddress;","36","import java.net.SocketException;","37","import java.net.UnknownHostException;","38","import java.nio.channels.ClosedByInterruptException;","39","import java.nio.charset.StandardCharsets;","40","import java.util.logging.Level;","51","public class UDPBroadcastThread extends Thread {","52","    private final Jenkins jenkins;","53","","54","    public final OneShotEvent ready = new OneShotEvent();","55","    private MulticastSocket mcs;","56","    private boolean shutdown;","57","    static boolean udpHandlingProblem; \/\/ for tests","58","","59","    \/**","60","     * @deprecated as of 1.416","61","     *      Use {@link #UDPBroadcastThread(Jenkins)}","62","     *\/","63","    @Deprecated","64","    public UDPBroadcastThread(Hudson jenkins) throws IOException {","65","        this((Jenkins)jenkins);","66","    }","67","","68","    public UDPBroadcastThread(Jenkins jenkins) throws IOException {","69","        super(\"Jenkins UDP \"+PORT+\" monitoring thread\");","70","        this.jenkins = jenkins;","71","        mcs = new MulticastSocket(PORT);","72","    }","73","","74","    @SuppressFBWarnings(\"ST_WRITE_TO_STATIC_FROM_INSTANCE_METHOD\")","75","    @Override","76","    public void run() {","77","        try {","78","            mcs.joinGroup(MULTICAST);","79","            ready.signal();","80","","81","            \/\/noinspection InfiniteLoopStatement","82","            while(true) {","83","                byte[] buf = new byte[2048];","84","                DatagramPacket p = new DatagramPacket(buf,buf.length);","85","                mcs.receive(p);","86","","87","                SocketAddress sender = p.getSocketAddress();","88","","89","                \/\/ prepare a response","90","                TcpSlaveAgentListener tal = jenkins.getTcpSlaveAgentListener();","91","","92","                StringBuilder rsp = new StringBuilder(\"<hudson>\");","93","                tag(rsp,\"version\", Jenkins.VERSION);","94","                tag(rsp,\"url\", jenkins.getRootUrl());","95","                tag(rsp,\"server-id\", jenkins.getLegacyInstanceId());","96","                tag(rsp,\"slave-port\",tal==null?null:tal.getPort());","97","","98","                for (UDPBroadcastFragment f : UDPBroadcastFragment.all())","99","                    f.buildFragment(rsp,sender);","100","","101","                rsp.append(\"<\/hudson>\");","102","","103","                byte[] response = rsp.toString().getBytes(StandardCharsets.UTF_8);","104","                mcs.send(new DatagramPacket(response,response.length,sender));","105","            }","106","        } catch (ClosedByInterruptException e) {","107","            \/\/ shut down","108","        } catch (SocketException e) {","109","            if (shutdown) { \/\/ forcibly closed","110","                return;","111","            }            \/\/ if we failed to listen to UDP, just silently abandon it, as a stack trace","112","            \/\/ makes people unnecessarily concerned, for a feature that currently does no good.","113","            LOGGER.log(Level.INFO, \"Cannot listen to UDP port {0}, skipping: {1}\", new Object[] {PORT, e});","114","            LOGGER.log(Level.FINE, null, e);","115","        } catch (IOException e) {","116","            if (shutdown)   return; \/\/ forcibly closed","117","            LOGGER.log(Level.WARNING, \"UDP handling problem\",e);","118","            udpHandlingProblem = true;","119","        }","120","    }","121","","122","    private void tag(StringBuilder buf, String tag, Object value) {","123","        if(value==null) return;","124","        buf.append('<').append(tag).append('>').append(value).append(\"<\/\").append(tag).append('>');","125","    }","126","","127","    public void shutdown() {","128","        shutdown = true;","129","        mcs.close();","130","        interrupt();","131","    }","138","    \/**","139","     * Multicast socket address.","140","     *\/","141","    public static InetAddress MULTICAST;","142","","143","    static {","144","        try {","145","            MULTICAST = InetAddress.getByAddress(new byte[]{(byte)239, (byte)77, (byte)124, (byte)213});","146","        } catch (UnknownHostException e) {","147","            throw new Error(e);"]}],"\/dev\/null":[{"add":[],"delete":[]}],"core\/pom.xml":[{"add":[],"delete":["536","      <groupId>org.jmdns<\/groupId>","537","      <artifactId>jmdns<\/artifactId>","538","      <version>3.5.5<\/version>","539","    <\/dependency>","540","    <dependency>"]}],"core\/src\/main\/java\/hudson\/DNSMultiCast.java":[{"add":["2","import hudson.init.Initializer;","4","import org.kohsuke.accmod.Restricted;","5","import org.kohsuke.accmod.restrictions.NoExternalUse;","9","import static hudson.init.InitMilestone.COMPLETED;","10","","15"," * @deprecated No longer does anything.","17","@Deprecated","18","@Restricted(NoExternalUse.class)","19","public class DNSMultiCast {","23","","24","    @Initializer(before=COMPLETED)","25","    public static void warn() {","26","        if (!disabled) {","27","            LOGGER.warning(\"DNS multicast capability has been removed from Jenkins. More information: https:\/\/jenkins.io\/redirect\/dns-multicast\");","28","        }","29","    }","30",""],"delete":["3","import jenkins.model.Jenkins;","4","import jenkins.model.Jenkins.MasterComputer;","6","import javax.jmdns.ServiceInfo;","7","import javax.jmdns.impl.JmDNSImpl;","8","import java.io.Closeable;","9","import java.io.IOException;","10","import java.lang.reflect.Field;","11","import java.lang.reflect.InvocationTargetException;","12","import java.lang.reflect.Method;","13","import java.net.InetAddress;","14","import java.net.URL;","15","import java.util.HashMap;","16","import java.util.Map;","17","import java.util.concurrent.Callable;","18","import java.util.concurrent.ExecutorService;","19","import java.util.logging.Level;","27","public class DNSMultiCast implements Closeable {","28","    private JenkinsJmDNS jmdns;","29","","30","    public DNSMultiCast(final Jenkins jenkins) {","31","        if (disabled)   return; \/\/ escape hatch","32","        ","33","        \/\/ the registerService call can be slow. run these asynchronously","34","        MasterComputer.threadPoolForRemoting.submit(new Callable<Object>() {","35","            public Object call() {","36","                try {","37","                    jmdns = new JenkinsJmDNS(null, null);","38","","39","                    Map<String,String> props = new HashMap<>();","40","                    String rootURL = jenkins.getRootUrl();","41","                    if (rootURL==null)  return null;","42","","43","                    props.put(\"url\", rootURL);","44","                    try {","45","                        props.put(\"version\",String.valueOf(Jenkins.getVersion()));","46","                    } catch (IllegalArgumentException e) {","47","                        \/\/ failed to parse the version number","48","                    }","49","","50","                    TcpSlaveAgentListener tal = jenkins.getTcpSlaveAgentListener();","51","                    if (tal!=null)","52","                        props.put(\"slave-port\",String.valueOf(tal.getPort()));","53","","54","                    props.put(\"server-id\", jenkins.getLegacyInstanceId());","55","","56","                    URL jenkins_url = new URL(rootURL);","57","                    int jenkins_port = jenkins_url.getPort();","58","                    if (jenkins_port == -1) {","59","                        jenkins_port = 80;","60","                    }","61","                    if (jenkins_url.getPath().length() > 0) {","62","                        props.put(\"path\", jenkins_url.getPath());","63","                    }","64","","65","                    jmdns.registerService(ServiceInfo.create(\"_hudson._tcp.local.\",\"jenkins\",","66","                            jenkins_port,0,0,props));\t\/\/ for backward compatibility","67","                    jmdns.registerService(ServiceInfo.create(\"_jenkins._tcp.local.\",\"jenkins\",","68","                            jenkins_port,0,0,props));","69","","70","                    \/\/ Make Jenkins appear in Safari's Bonjour bookmarks","71","                    jmdns.registerService(ServiceInfo.create(\"_http._tcp.local.\",\"Jenkins\",","72","                            jenkins_port,0,0,props));","73","                } catch (IOException e) {","74","                    LOGGER.log(Level.INFO, \"Cannot advertise service to DNS multi-cast, skipping: {0}\", e);","75","                    LOGGER.log(Level.FINE, null, e);","76","                }","77","                return null;","78","            }","79","        });","80","    }","81","","82","    public void close() {","83","        if (jmdns!=null) {","84","            try {","85","                jmdns.abort();","86","                jmdns = null;","87","            } catch (final IOException e) {","88","                LOGGER.log(Level.WARNING,\"Failed to close down JmDNS instance!\",e);","89","            }","90","        }","91","    }","92","","95","    \/**","96","     * Class that extends {@link JmDNSImpl} to add an abort method. Since {@link javax.jmdns.JmDNS#close()} might","97","     * make the instance hang during the shutdown, the abort method terminate uncleanly, but rapidly and","98","     * without blocking.","99","     *","100","     * Initially it was part of the jenkinsci\/jmdns forked library, but now this class is responsible for aborting,","101","     * allowing to have a direct and clean dependency to the original library.","102","     *","103","     * The abort() method is pretty similar to close() method. To access private methods and fields uses","104","     * reflection.","105","     *","106","     * @since 2.178","107","     *","108","     * See JENKINS-25369 for further details","109","     *\/","110","    private static class JenkinsJmDNS extends JmDNSImpl {","111","        private static Logger logger = Logger.getLogger(JmDNSImpl.class.getName());","112","        private final Class parent;","113","","114","        \/**","115","         * Create an instance of JmDNS and bind it to a specific network interface given its IP-address.","116","         *","117","         * @param address IP address to bind to.","118","         * @param name    name of the newly created JmDNS","119","         * @throws IOException","120","         *\/","121","        public JenkinsJmDNS(InetAddress address, String name) throws IOException {","122","            super(address, name);","123","            this.parent = this.getClass().getSuperclass();","124","        }","125","","126","        \/**","127","         * Works like {@link #close()} but terminate uncleanly, but rapidly and without blocking.","128","         *\/","129","        public void abort() throws IOException {","130","            if (this.isClosing()) {","131","                return;","132","            }","133","","134","           if (logger.isLoggable(Level.FINER)) {","135","                logger.finer(\"Aborting JmDNS: \" + this);","136","            }","137","            \/\/ Stop JmDNS","138","            \/\/ This protects against recursive calls","139","            if (this.closeState()) {","140","                \/\/ We got the tie break now clean up","141","","142","                \/\/ Stop the timer","143","                logger.finer(\"Canceling the timer\");","144","                this.cancelTimer();","145","","146","                \/\/ Cancel all services","147","                \/\/ KK: this is a blocking call that doesn't fit 'abort'","148","                \/\/ this.unregisterAllServices();","149","                executePrivateParentMethod(\"disposeServiceCollectors\");","150","","151","\/\/ KK: another blocking call","152","\/\/                if (logger.isLoggable(Level.FINER)) {","153","\/\/                    logger.finer(\"Wait for JmDNS cancel: \" + this);","154","\/\/                }","155","\/\/                this.waitForCanceled(DNSConstants.CLOSE_TIMEOUT);","156","","157","                \/\/ Stop the canceler timer","158","                logger.finer(\"Canceling the state timer\");","159","                this.cancelStateTimer();","160","","161","                \/\/ Stop the executor","162","                shutdown();","163","","164","                \/\/ close socket","165","                executePrivateParentMethod(\"closeMulticastSocket\");","166","","167","                \/\/ remove the shutdown hook","168","                if (_shutdown != null) {","169","                    Runtime.getRuntime().removeShutdownHook(_shutdown);","170","                }","171","","172","                if (logger.isLoggable(Level.FINER)) {","173","                    logger.finer(\"JmDNS closed.\");","174","                }","175","            }","176","            advanceState(null);","177","        }","178","","179","        private void shutdown() throws IOException {","180","            try {","181","                Field executor = this.parent.getDeclaredField(\"_executor\");","182","                executor.setAccessible(true);","183","                ExecutorService _executor = (ExecutorService) executor.get(this);","184","                _executor.shutdown();","185","            } catch (NoSuchFieldException | IllegalAccessException e) {","186","                logger.log(Level.SEVERE, \"Error trying to abort JmDNS\", e);","187","                throw new IOException(e);","188","            }","189","        }","190","","191","        private void executePrivateParentMethod(String method) throws IOException {","192","            try {","193","                Method m = this.parent.getDeclaredMethod(method);","194","                m.setAccessible(true);","195","                m.invoke(this);","196","            } catch (NoSuchMethodException | IllegalAccessException | InvocationTargetException e) {","197","                logger.log(Level.SEVERE, \"Error trying to abort JmDNS\", e);","198","                throw new IOException(e);","199","            }","200","        }","201","","202","    }"]}],"core\/src\/main\/java\/jenkins\/model\/Jenkins.java":[{"add":[],"delete":["588","    private transient UDPBroadcastThread udpBroadcastThread;","589","","590","    private transient DNSMultiCast dnsMultiCast;","591","","990","            if (UDPBroadcastThread.PORT != -1) {","991","                try {","992","                    udpBroadcastThread = new UDPBroadcastThread(this);","993","                    udpBroadcastThread.start();","994","                } catch (IOException e) {","995","                    LOGGER.log(Level.WARNING, \"Failed to broadcast over UDP (use -Dhudson.udp=-1 to disable)\", e);","996","                }","997","            }","998","            dnsMultiCast = new DNSMultiCast(this);","999","","3388","            _cleanUpShutdownUDPBroadcast(errors);","3389","","3390","            _cleanUpCloseDNSMulticast(errors);","3391","","3533","    private void _cleanUpShutdownUDPBroadcast(List<Throwable> errors) {","3534","        if(udpBroadcastThread!=null) {","3535","            LOGGER.log(Level.FINE, \"Shutting down {0}\", udpBroadcastThread.getName());","3536","            try {","3537","                udpBroadcastThread.shutdown();","3538","            } catch (OutOfMemoryError e) {","3539","                \/\/ we should just propagate this, no point trying to log","3540","                throw e;","3541","            } catch (LinkageError e) {","3542","                LOGGER.log(SEVERE, \"Failed to shutdown UDP Broadcast Thread\", e);","3543","                \/\/ safe to ignore and continue for this one","3544","            } catch (Throwable e) {","3545","                LOGGER.log(SEVERE, \"Failed to shutdown UDP Broadcast Thread\", e);","3546","                \/\/ save for later","3547","                errors.add(e);","3548","            }","3549","        }","3550","    }","3551","","3552","    private void _cleanUpCloseDNSMulticast(List<Throwable> errors) {","3553","        if(dnsMultiCast!=null) {","3554","            LOGGER.log(Level.FINE, \"Closing DNS Multicast service\");","3555","            try {","3556","                dnsMultiCast.close();","3557","            } catch (OutOfMemoryError e) {","3558","                \/\/ we should just propagate this, no point trying to log","3559","                throw e;","3560","            } catch (LinkageError e) {","3561","                LOGGER.log(SEVERE, \"Failed to close DNS Multicast service\", e);","3562","                \/\/ safe to ignore and continue for this one","3563","            } catch (Throwable e) {","3564","                LOGGER.log(SEVERE, \"Failed to close DNS Multicast service\", e);","3565","                \/\/ save for later","3566","                errors.add(e);","3567","            }","3568","        }","3569","    }","3570",""]}],"war\/pom.xml":[{"add":[],"delete":["519","            <systemProperty>","520","              <!-- this adds 3 sec to the shutdown, and most likely pointless, too -->","521","              <name>hudson.DNSMultiCast.disabled<\/name>","522","              <value>true<\/value>","523","            <\/systemProperty>"]}]}},"8e78ab1c660de81f48beecedced25d9b2cbbf64a":{"changes":{"core\/src\/test\/java\/hudson\/FilePathTest.java":"MODIFY","core\/src\/main\/java\/hudson\/FilePath.java":"MODIFY"},"diff":{"core\/src\/test\/java\/hudson\/FilePathTest.java":[{"add":["61","import static org.junit.Assert.assertEquals;","62","import static org.junit.Assert.assertFalse;","63","import static org.junit.Assert.assertNotNull;","64","import static org.junit.Assert.assertNull;","65","import static org.junit.Assert.assertTrue;","66","import static org.junit.Assert.fail;","70","","627","            assertFalse(d.installIfNecessaryFrom(url, null, \"\"));","646","            assertTrue(d.installIfNecessaryFrom(url, null, \"\"));","764","","795","","796","    @Issue(\"JENKINS-48227\")","797","    @Test","798","    public void testCreateTempDir() throws IOException, InterruptedException  {","799","        final File srcFolder = temp.newFolder(\"src\");","800","        final FilePath filePath = new FilePath(srcFolder);","801","        FilePath x = filePath.createTempDir(\"jdk\", \"dmg\");","802","        FilePath y = filePath.createTempDir(\"jdk\", \"pkg\");","803","        FilePath z = filePath.createTempDir(\"jdk\", null);","804","","805","        assertNotNull(\"FilePath x should not be null\", x);","806","        assertNotNull(\"FilePath y should not be null\", y);","807","        assertNotNull(\"FilePath z should not be null\", z);","808","","809","        assertTrue(x.getName().contains(\"jdk.dmg\"));","810","        assertTrue(y.getName().contains(\"jdk.pkg\"));","811","        assertTrue(z.getName().contains(\"jdk.tmp\"));","812","    }","813",""],"delete":["34","import java.io.FileOutputStream;","41","import java.net.MalformedURLException;","45","import java.net.URLStreamHandlerFactory;","64","import static org.junit.Assert.*;","624","            assertFalse(d.installIfNecessaryFrom(url, null, null));","643","            assertTrue(d.installIfNecessaryFrom(url, null, null));","761","    ","792","    "]}],"core\/src\/main\/java\/hudson\/FilePath.java":[{"add":["79","import java.nio.file.FileSystems;","82","import java.nio.file.Path;","85","import java.nio.file.attribute.FileAttribute;","86","import java.nio.file.attribute.PosixFilePermission;","87","import java.nio.file.attribute.PosixFilePermissions;","90","import java.util.Collections;","92","import java.util.EnumSet;","122","import org.apache.commons.lang.StringUtils;","1413","     * @see Files#createTempDirectory(Path, String, FileAttribute[])","1417","            String[] s;","1418","            if (StringUtils.isBlank(suffix)) {","1419","                s = new String[]{prefix, \"tmp\"}; \/\/ see File.createTempFile - tmp is used if suffix is null","1420","            } else {","1421","                s = new String[]{prefix, suffix};","1422","            }","1423","            String name = StringUtils.join(s, \".\");","1427","","1428","                    Path tempPath;","1429","                    final boolean isPosix = FileSystems.getDefault().supportedFileAttributeViews().contains(\"posix\");","1430","","1431","                    if (isPosix) {","1432","                        tempPath = Files.createTempDirectory(Util.fileToPath(dir), name,","1433","                                PosixFilePermissions.asFileAttribute(EnumSet.allOf(PosixFilePermission.class)));","1434","                    } else {","1435","                        tempPath = Files.createTempDirectory(Util.fileToPath(dir), name, new FileAttribute<?>[] {});","1436","                    }","1437","","1438","                    if (tempPath.toFile() == null) {","1439","                        throw new IOException(\"Failed to obtain file from path \" + dir + \" on \" + remote);","1440","                    }","1441","                    return tempPath.toFile().getName();"],"delete":["1405","     * @see File#createTempFile(String, String)","1412","                    File f = File.createTempFile(prefix, suffix, dir);","1413","                    f.delete();","1414","                    f.mkdir();","1415","                    return f.getName();"]}]}},"399c8ba40ab9ccab8e70dcacfdd396b0c2e654d7":{"changes":{"core\/src\/main\/java\/hudson\/model\/Fingerprint.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/Fingerprint.java":[{"add":["975","    public @CheckForNull Hashtable<String,RangeSet> getUsages() {","1422","        return \"Fingerprint[original=\" + original + \",hash=\" + getHashString() + \",fileName=\" + fileName + \",timestamp=\" + DATE_CONVERTER.toString(timestamp) + \",usages=\" + ((usages == null) ? \"null\" : new TreeMap<String,RangeSet>(getUsages())) + \",facets=\" + facets + \"]\";"],"delete":["975","    public @Nonnull Hashtable<String,RangeSet> getUsages() {","1422","        return \"Fingerprint[original=\" + original + \",hash=\" + getHashString() + \",fileName=\" + fileName + \",timestamp=\" + DATE_CONVERTER.toString(timestamp) + \",usages=\" + new TreeMap<String,RangeSet>(usages) + \",facets=\" + facets + \"]\";"]}]}},"ef4d1553bf12f5ba8d584491f1c118c8797a3846":{"changes":{"test\/src\/test\/java\/hudson\/model\/NodeTest.java":"MODIFY","changelog.html":"MODIFY","core\/src\/main\/java\/hudson\/model\/Computer.java":"MODIFY"},"diff":{"test\/src\/test\/java\/hudson\/model\/NodeTest.java":[{"add":["25","import hudson.EnvVars;","55","import org.jvnet.hudson.test.Issue;","242","    @Issue(\"JENKINS-27188\")","243","    @Test public void envPropertiesImmutable() throws Exception {","244","        Slave slave = j.createSlave();","245","","246","        String propertyKey = \"JENKINS-27188\";","247","        EnvVars envVars = slave.getComputer().getEnvironment();","248","        envVars.put(propertyKey, \"huuhaa\");","249","        assertTrue(envVars.containsKey(propertyKey));","250","        assertFalse(slave.getComputer().getEnvironment().containsKey(propertyKey));","251","","252","        assertNotSame(slave.getComputer().getEnvironment(), slave.getComputer().getEnvironment());","253","    }","254",""],"delete":[]}],"changelog.html":[{"add":["65","  <li class=\"major bug\">","66","    Regression with environment variables in 1.600.","67","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-27188\">issue 27188<\/a>)"],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/Computer.java":[{"add":["944","     * Returns cached environment variables (copy to prevent modification) for the JVM on this computer.","950","            return new EnvVars(cachedEnvironment);","955","        return new EnvVars(cachedEnvironment);"],"delete":["944","     * Gets the environment variables of the JVM on this computer.","950","            return cachedEnvironment;","955","        return cachedEnvironment;"]}]}},"ee64eb920cee5af9f430cfcdfd341714549960ce":{"changes":{"core\/src\/main\/resources\/hudson\/model\/Run\/configure.jelly":"MODIFY","core\/src\/main\/resources\/hudson\/model\/Job\/configure.jelly":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/model\/Run\/configure.jelly":[{"add":["45","      <j:if test=\"${h.hasPermission(it,it.UPDATE)}\">","46","        <st:adjunct includes=\"lib.form.confirm\" \/>","47","      <\/j:if>"],"delete":["45","      <st:adjunct includes=\"lib.form.confirm\" \/>"]}],"core\/src\/main\/resources\/hudson\/model\/Job\/configure.jelly":[{"add":["70","      <j:if test=\"${h.hasPermission(it,it.CONFIGURE)}\">","71","        <st:adjunct includes=\"lib.form.confirm\" \/>","72","      <\/j:if>"],"delete":["70","      <st:adjunct includes=\"lib.form.confirm\" \/>"]}]}},"129e76bf32baf96e9e702606029148e5fa2aa81b":{"changes":{"core\/src\/main\/java\/hudson\/matrix\/MatrixProject.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/matrix\/MatrixProject.java":[{"add":["429","        if(getActiveConfigurations() !=null){","430","            \/\/ update all transient actions in configurations too.","431","            for(MatrixConfiguration configuration: getActiveConfigurations()){","432","                configuration.updateTransientActions();","433","            }"],"delete":["429","        \/\/ update all transient actions in configurations too.","430","        for(MatrixConfiguration configuration: getActiveConfigurations()){","431","            configuration.updateTransientActions();"]}]}},"6d8fd5450a823f0c7abe528bce6a36fd81d2ad5f":{"changes":{"core\/src\/main\/java\/hudson\/tasks\/Shell.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/tasks\/Shell.java":[{"add":["3"," * Copyright (c) 2004-2011, Sun Microsystems, Inc., Kohsuke Kawaguchi, Jene Jasper, Yahoo! Inc., Seiji Sogabe","30","import hudson.remoting.Callable;","31","import hudson.remoting.VirtualChannel;","33","import java.io.IOException;","42","import java.util.logging.Logger;","102","        } else ","103","            return new String[] { getDescriptor().getShellOrDefault(script.getChannel()), \"-xe\", script.getRemote()};","138","        \/**","139","         *  @deprecated 1.403","140","         *      Use {@link #getShellOrDefault(hudson.remoting.VirtualChannel) }.","141","         *\/","148","        public String getShellOrDefault(VirtualChannel channel) {","149","            if (shell != null) ","150","                return shell;","151","","152","            String interpreter = null;","153","            try {","154","                interpreter = channel.call(new Shellinterpreter());","155","            } catch (IOException e) {","156","                LOGGER.warning(e.getMessage());","157","            } catch (InterruptedException e) {","158","                LOGGER.warning(e.getMessage());","159","            }","160","            if (interpreter == null) {","161","                interpreter = getShellOrDefault();","162","            }","163","","164","            return interpreter;","165","        }","166","        ","194","        ","195","        private static final class Shellinterpreter implements Callable<String, IOException> {","196","","197","            private static final long serialVersionUID = 1L;","198","","199","            public String call() throws IOException {","200","                return Functions.isWindows() ? \"sh\" : \"\/bin\/sh\";","201","            }","202","        }","203","        ","205","    ","206","    private static final Logger LOGGER = Logger.getLogger(Shell.class.getName());"],"delete":["3"," * Copyright (c) 2004-2010, Sun Microsystems, Inc., Kohsuke Kawaguchi, Jene Jasper, Yahoo! Inc.","98","        } else","99","            return new String[] { getDescriptor().getShellOrDefault(),\"-xe\",script.getRemote()};"]}]}},"c718516adfddeb10cbf616ce37c619cc6bbafd53":{"changes":{"pom.xml":"MODIFY"},"diff":{"pom.xml":[{"add":["181","        <version>2.60<\/version>"],"delete":["181","        <version>2.59<\/version>"]}]}},"1784f90806c1c1f39e307c722a3dd4f63850877e":{"changes":{"core\/pom.xml":"MODIFY","test\/src\/test\/java\/jenkins\/ClassPathTest.java":"ADD"},"diff":{"core\/pom.xml":[{"add":[],"delete":["598","    <dependency>","599","      <groupId>org.mindrot<\/groupId>","600","      <artifactId>jbcrypt<\/artifactId>","601","      <version>0.4<\/version>","602","    <\/dependency>","603",""]}],"test\/src\/test\/java\/jenkins\/ClassPathTest.java":[{"add":[],"delete":[]}]}},"961ab53ebde317b241116244f523c40b6a6d4b09":{"changes":{"core\/src\/main\/resources\/jenkins\/model\/Messages_es.properties":"MODIFY"},"diff":{"core\/src\/main\/resources\/jenkins\/model\/Messages_es.properties":[{"add":["26","Hudson.DisplayName=Jenkins"],"delete":["26","Hudson.DisplayName=Jenkins "]}]}},"d487d1f0f9654c37577861f3a58cbd1180ab8d37":{"changes":{"core\/src\/main\/java\/hudson\/slaves\/OfflineCause.java":"MODIFY","changelog.html":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/slaves\/OfflineCause.java":[{"add":["111","                    user!=null ? user.getId() : Jenkins.ANONYMOUS.getName(),"],"delete":["111","                    user.getId(),"]}],"changelog.html":[{"add":["63","  <li class=bug>","64","    Fixed NPE in <tt>UserCause<\/tt>","65","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-21875\">issue 21875<\/a>)"],"delete":[]}]}},"a1e0e4b70bb293c2f7d8f38ab094035d9d5ff22e":{"changes":{"changelog.html":"MODIFY"},"diff":{"changelog.html":[{"add":["485","  <li class=bug>","486","    Do not show Maven modules and matrix configurations in the Copy Job dialog.","487","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-19559\">issue 19559<\/a>)","488","  <li class=bug>","489","    Fix autocompletion for items in folders.","490","    (<a href=\"https:\/\/github.com\/jenkinsci\/jenkins\/pull\/1124\">pull request 1124<\/a>)  "],"delete":[]}]}},"da4ddde7564a15f6e8d9ee83f8499b7369dbe24b":{"changes":{"core\/src\/main\/java\/hudson\/model\/queue\/MappingWorksheet.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/queue\/MappingWorksheet.java":[{"add":["338","                    \/\/ total predicted load could exceed available executors [JENKINS-8882]","339","                    if (minIdle<0) {","340","                        \/\/ Should we toss a warning\/info message?","341","                        minIdle = 0;","342","                    }"],"delete":[]}]}},"432c63d9851cadb7e93a110a9a22716b0e033d87":{"changes":{"changelog.html":"MODIFY","test\/src\/test\/java\/hudson\/maven\/MavenProjectTest.java":"MODIFY"},"diff":{"changelog.html":[{"add":["83","  <li class=bug>","84","    Fixed NullPointerException when copying from existing Maven job","85","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-16499\">issue 16499<\/a>)"],"delete":[]}],"test\/src\/test\/java\/hudson\/maven\/MavenProjectTest.java":[{"add":["59","        project.save();"],"delete":[]}]}},"8dfa5e19ea94195e9737f99457297623d4180c7f":{"changes":{"test\/src\/test\/java\/hudson\/tasks\/FingerprinterTest.java":"ADD","changelog.html":"MODIFY","core\/src\/main\/java\/hudson\/model\/AbstractBuild.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/Fingerprint.java":"MODIFY"},"diff":{"test\/src\/test\/java\/hudson\/tasks\/FingerprinterTest.java":[{"add":[],"delete":[]}],"changelog.html":[{"add":["75","  <li class=bug>","76","    Project names in fingerprint records weren't updated when a project is renamed.","77","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-10330\">issue 10330<\/a>)"],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/AbstractBuild.java":[{"add":["721","     * get the fingerprints associated with this build","722","     *","723","     * @return never null","724","     *\/","725","    @Exported(name = \"fingerprint\", inline = true, visibility = -1)","726","    public Collection<Fingerprint> getBuildFingerprints() {","727","        FingerprintAction fingerprintAction = getAction(FingerprintAction.class);","728","        if (fingerprintAction != null) {","729","            return fingerprintAction.getFingerprints().values();","730","        }","731","        return Collections.<Fingerprint>emptyList();","732","    }","733","","734","    \/**"],"delete":[]}],"core\/src\/main\/java\/hudson\/model\/Fingerprint.java":[{"add":["3"," * Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi, Yahoo! Inc.","37","import hudson.Extension;","38","import hudson.model.listeners.ItemListener;","43","import hudson.util.RunList;","82","        String name;","106","        void setName(String newName) {","107","            name = newName;","108","        }","109","        ","533","    @Extension","534","    public static final class ProjectRenameListener extends ItemListener {","535","        @Override","536","        public void onRenamed(Item item, String oldName, String newName) {","537","            if (item instanceof AbstractProject) {","538","                AbstractProject p = Hudson.getInstance().getItemByFullName(newName, AbstractProject.class);","539","                if (p != null) {","540","                    RunList builds = p.getBuilds();","541","                    for (Object build : builds) {","542","                        if (build instanceof AbstractBuild) {","543","                            Collection<Fingerprint> fingerprints = ((AbstractBuild)build).getBuildFingerprints();","544","                            for (Fingerprint f : fingerprints) {","545","                                try {","546","                                    f.rename(oldName, newName);","547","                                } catch (IOException e) {","548","                                    logger.log(Level.WARNING, \"Failed to update fingerprint record \" + f.getFileName() + \" when \" + oldName + \" was renamed to \" + newName, e);","549","                                }","550","                            }","551","                        }","552","                    }","553","                }","554","            }","555","        }","556","    }","557","    ","847","    \/**","848","     * Update references to a renamed job in the fingerprint","849","     *\/","850","    public synchronized void rename(String oldName, String newName) throws IOException {","851","        boolean touched = false;","852","        if (original != null) {","853","            if (original.getName().equals(oldName)) {","854","                original.setName(newName);","855","                touched = true;","856","            }","857","        }","858","        ","859","        if (usages != null) {","860","            RangeSet r = usages.get(oldName);","861","            if (r != null) {","862","                usages.put(newName, r);","863","                usages.remove(oldName);","864","                touched = true;","865","            }","866","        }","867","        ","868","        if (touched) {","869","            save();","870","        }","871","    }","872","    "],"delete":["3"," * Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi","79","        final String name;"]}]}},"3cfa3e55a1f57b6634576a0d6d7ac044714e1022":{"changes":{"changelog.html":"MODIFY","pom.xml":"MODIFY"},"diff":{"changelog.html":[{"add":["57","  <li class=bug>","58","    Aborting download of workspace files make Jenkins unstable","59","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-7114\">issue 7114<\/a>)"],"delete":["57","  <li class=>"]}],"pom.xml":[{"add":["199","        <version>2.20<\/version>"],"delete":["199","        <version>2.19<\/version>"]}]}},"5d920577484dff973d6fa5bb002024f4e154a471":{"changes":{"core\/src\/main\/java\/hudson\/search\/Search.java":"MODIFY","core\/src\/main\/resources\/hudson\/search\/Search\/search-failed.jelly":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/search\/Search.java":[{"add":["31","import java.io.UnsupportedEncodingException;","32","import java.net.URLEncoder;","44","import org.kohsuke.accmod.Restricted;","45","import org.kohsuke.accmod.restrictions.NoExternalUse;","66","    @Restricted(NoExternalUse.class) \/\/ used from stapler views only","67","    public static String encodeQuery(String query) throws UnsupportedEncodingException {","68","        return URLEncoder.encode(query, \"UTF-8\");","69","    }","70",""],"delete":[]}],"core\/src\/main\/resources\/hudson\/search\/Search\/search-failed.jelly":[{"add":["45","                <a href=\"?q=${it.encodeQuery(i.path)}\">${i.path}<\/a>","51","                <em>result has been truncated, <a href=\"?q=${it.encodeQuery(q)}&amp;max=${max+20}\">see 20 more<\/a><\/em>"],"delete":["45","                <a href=\"?q=${i.path}\">${i.path}<\/a>","51","                <em>result has been truncated, <a href=\"?q=${q}&amp;max=${max+20}\">see 20 more<\/a><\/em>"]}]}},"a34479c418cd6be5c83bf5cd36121e9c42332da3":{"changes":{"core\/src\/test\/java\/hudson\/triggers\/TimerTriggerTest.java":"MODIFY"},"diff":{"core\/src\/test\/java\/hudson\/triggers\/TimerTriggerTest.java":[{"add":["26","import hudson.scheduler.CronTabList;","27","import hudson.scheduler.Hash;","28","import org.junit.Assert;","32","import java.util.TimeZone;","33","","43","","44","    @Issue(\"JENKINS-43328\")","45","    @Test","46","    public void testTimeZoneOffset() throws Exception {","47","        TimeZone defaultTz = TimeZone.getDefault();","48","        TimeZone.setDefault(TimeZone.getTimeZone(\"Europe\/Berlin\"));","49","        try {","50","            String cron = \"TZ=GMT\\nH 0 * * *\";","51","            CronTabList ctl = CronTabList.create(cron, Hash.from(\"whatever\"));","52","            Assert.assertEquals(\"previous occurrence is in GMT\", \"GMT\", ctl.previous().getTimeZone().getID());","53","","54","            cron = \"TZ=America\/Denver\\nH 0 * * *\";","55","            ctl = CronTabList.create(cron, Hash.from(\"whatever\"));","56","            Assert.assertEquals(\"next occurrence is in America\/Denver\", \"America\/Denver\", ctl.next().getTimeZone().getID());","57","        } finally {","58","            TimeZone.setDefault(defaultTz);","59","        }","60","    }"],"delete":[]}]}},"4fbe7fccee3c57ff2e3073250b61cb17df3205ca":{"changes":{"core\/src\/main\/java\/hudson\/scm\/SubversionSCM.java":"MODIFY","core\/pom.xml":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/scm\/SubversionSCM.java":[{"add":["622","                        return new SVNSSHAuthentication(userName, privateKey.toCharArray(), Scrambler.descramble(passphrase),-1,false);"],"delete":["622","                        return new SVNSSHAuthentication(userName, privateKey, Scrambler.descramble(passphrase),-1,false);"]}],"core\/pom.xml":[{"add":["111","      <version>1.1.2-hudson-3<\/version>"],"delete":["111","      <version>1.1.2-hudson-2<\/version>"]}]}},"cccb301fbe28ff8b33b044f81f1d02fcd7ea02ee":{"changes":{"maven-plugin\/src\/main\/java\/hudson\/maven\/MavenModule.java":"MODIFY"},"diff":{"maven-plugin\/src\/main\/java\/hudson\/maven\/MavenModule.java":[{"add":["405","        \/\/ In case two modules with the same name are defined, modules in the same MavenModuleSet","408","        \/\/ Can lead to OOME, if remembered in the computational data and there are lot big multi-module projects","409","        \/\/ TODO: try to use soft references to clean the heap when needed","410","        Map<ModuleDependency,MavenModule> myParentsModules; \/\/ = data.modulesPerParent.get(getParent());","411","        ","412","        \/\/if (myParentsModules == null) {","413","            myParentsModules = new HashMap<ModuleDependency, MavenModule>();","422","            \/\/data.modulesPerParent.put(getParent(), myParentsModules);","423","        \/\/}","447","        \/\/Map<MavenModuleSet, Map<ModuleDependency,MavenModule>> modulesPerParent = new HashMap<MavenModuleSet, Map<ModuleDependency,MavenModule>>();"],"delete":["405","        \/\/ in case two modules with the same name are defined, modules in the same MavenModuleSet","407","        Map<ModuleDependency,MavenModule> myParentsModules = data.modulesPerParent.get(getParent());","409","        if (myParentsModules == null) {","410","            myParentsModules =new HashMap<ModuleDependency, MavenModule>();","419","            data.modulesPerParent.put(getParent(), myParentsModules);","420","        }","444","        Map<MavenModuleSet, Map<ModuleDependency,MavenModule>> modulesPerParent = new HashMap<MavenModuleSet, Map<ModuleDependency,MavenModule>>();"]}]}},"95b9ff4e6332f24969bc98a3f9299d0cefb228bc":{"changes":{"debian\/debian\/jenkins.default":"MODIFY"},"diff":{"debian\/debian\/jenkins.default":[{"add":["33","#   this is on by default because http:\/\/github.com\/jenkinsci\/jenkins\/commit\/2fb288474e980d0e7ff9c4a3b768874835a3e92e"],"delete":["33","#   this is on by default because http:\/\/github.com\/feniix\/hudson\/commit\/d13c08ea8f5a3fa730ba174305e6429b74853927"]}]}},"c5d01b0645a12e64e2a256641b18989c2f68eeea":{"changes":{"test\/src\/test\/java\/hudson\/ProcStarterTest.java":"ADD"},"diff":{"test\/src\/test\/java\/hudson\/ProcStarterTest.java":[{"add":[],"delete":[]}]}},"9d250135e85d6662ff7a53d69424fac0c080b1da":{"changes":{"debian\/debian\/jenkins.postinst":"MODIFY"},"diff":{"debian\/debian\/jenkins.postinst":[{"add":["44","        chown jenkins:adm \/var\/lib\/jenkins \/var\/log\/jenkins","45","        chmod 750         \/var\/lib\/jenkins \/var\/log\/jenkins","48","        chown -R jenkins:adm \/var\/run\/jenkins","49","        chmod -R 750         \/var\/run\/jenkins"],"delete":["44","        chown jenkins:admin \/var\/lib\/jenkins \/var\/log\/jenkins","45","        chmod 750           \/var\/lib\/jenkins \/var\/log\/jenkins","48","        chown -R jenkins:admin \/var\/run\/jenkins","49","        chmod -R 750           \/var\/run\/jenkins"]}]}},"dcabd4ba9a6b6036d697b863dc9bfe21691a3504":{"changes":{"changelog.html":"MODIFY","maven-plugin\/src\/main\/java\/hudson\/maven\/AbstractMavenProcessFactory.java":"MODIFY"},"diff":{"changelog.html":[{"add":["65","  <li class=bug>","66","    Fixed Maven build error if headless option is set and MAVEN_OPTS empty","67","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-10375\">issue 10375<\/a>)"],"delete":[]}],"maven-plugin\/src\/main\/java\/hudson\/maven\/AbstractMavenProcessFactory.java":[{"add":["278","            if (mavenOpts == null) {","279","                mavenOpts = \"-Djava.awt.headless=true\";","280","            } else {","281","                mavenOpts += \" -Djava.awt.headless=true\";","282","            }"],"delete":["278","            mavenOpts += \" -Djava.awt.headless=true\";"]}]}},"da9c2c55c1962dc805a3bc74f7950379371dab98":{"changes":{"core\/src\/main\/java\/hudson\/model\/Slave.java":"MODIFY","changelog.html":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/Slave.java":[{"add":["459","        private final long startTime = System.currentTimeMillis();","469","        private final long remoteTime = System.currentTimeMillis();","477","            long endTime = System.currentTimeMillis();","478","            return new ClockDifference((startTime + endTime)\/2-remoteTime);"],"delete":["459","        private final long startTime = System.nanoTime();","469","        private final long remoteTime = System.nanoTime();","477","            long endTime = System.nanoTime();","478","            return new ClockDifference(TimeUnit2.NANOSECONDS.toMillis((startTime + endTime)\/2-remoteTime));"]}],"changelog.html":[{"add":["58","    Clock Difference broken on Manage Nodes page","59","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-18671\">issue 18671<\/a>)","60","  <li class=bug>"],"delete":[]}]}},"37e1c80c857fafd7793b1e46c4e9e6e4bc127c5d":{"changes":{"core\/src\/main\/java\/hudson\/model\/UpdateSite.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/UpdateSite.java":[{"add":["624","            rsp.sendRedirect2(\"..\/..\");"],"delete":["624","            rsp.sendRedirect(\"..\/updateCenter\/\");"]}]}},"66ec7029c66cc11b6513a6699880ae6cf0aa58ad":{"changes":{"war\/pom.xml":"MODIFY"},"diff":{"war\/pom.xml":[{"add":["91","      <version>4.5-20180827.050220-1<\/version>"],"delete":["91","      <version>4.4<\/version>"]}]}},"0aa2858b2e6745dcad88c3850231de7114e966a1":{"changes":{"core\/src\/main\/java\/hudson\/model\/View.java":"MODIFY","core\/src\/main\/java\/jenkins\/model\/Jenkins.java":"MODIFY","test\/src\/test\/java\/hudson\/model\/ViewTest.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/View.java":[{"add":["37","import hudson.model.listeners.ItemListener;","53","import hudson.util.FormValidation;","114","import org.kohsuke.stapler.QueryParameter;","1011","     * Makes sure that the given name is good as a job name.","1012","     * For use from {@code newJob}.","1013","     *\/","1014","    @Restricted(DoNotUse.class) \/\/ called from newJob view","1015","    public FormValidation doCheckJobName(@QueryParameter String value) {","1016","        \/\/ this method can be used to check if a file exists anywhere in the file system,","1017","        \/\/ so it should be protected.","1018","        getOwner().checkPermission(Item.CREATE);","1019","","1020","        if (Util.fixEmpty(value) == null) {","1021","            return FormValidation.ok();","1022","        }","1023","","1024","        try {","1025","            Jenkins.checkGoodName(value);","1026","            value = value.trim(); \/\/ why trim *after* checkGoodName? not sure, but ItemGroupMixIn.createTopLevelItem does the same","1027","            Jenkins.getInstance().getProjectNamingStrategy().checkName(value);","1028","        } catch (Failure e) {","1029","            return FormValidation.error(e.getMessage());","1030","        }","1031","","1032","        if (getOwnerItemGroup().getItem(value) != null) {","1033","            return FormValidation.error(Messages.Hudson_JobAlreadyExists(value));","1034","        }","1035","","1036","        \/\/ looks good","1037","        return FormValidation.ok();","1038","    }","1039","","1040","    \/**"],"delete":[]}],"core\/src\/main\/java\/jenkins\/model\/Jenkins.java":[{"add":[],"delete":["3583","    \/**","3584","     * Makes sure that the given name is good as a job name.","3585","     * @return trimmed name if valid; throws Failure if not","3586","     *\/","3587","    private String checkJobName(String name) throws Failure {","3588","        checkGoodName(name);","3589","        name = name.trim();","3590","        projectNamingStrategy.checkName(name);","3591","        if(getItem(name)!=null)","3592","            throw new Failure(Messages.Hudson_JobAlreadyExists(name));","3593","        \/\/ looks good","3594","        return name;","3595","    }","3596","","4125","     * Makes sure that the given name is good as a job name.","4126","     *\/","4127","    public FormValidation doCheckJobName(@QueryParameter String value) {","4128","        \/\/ this method can be used to check if a file exists anywhere in the file system,","4129","        \/\/ so it should be protected.","4130","        checkPermission(Item.CREATE);","4131","","4132","        if(fixEmpty(value)==null)","4133","            return FormValidation.ok();","4134","","4135","        try {","4136","            checkJobName(value);","4137","            return FormValidation.ok();","4138","        } catch (Failure e) {","4139","            return FormValidation.error(e.getMessage());","4140","        }","4141","    }","4142","","4143","    \/**"]}],"test\/src\/test\/java\/hudson\/model\/ViewTest.java":[{"add":["47","import hudson.security.ACL;","48","import hudson.security.AccessDeniedException2;","50","import hudson.util.FormValidation;","55","import jenkins.model.ProjectNamingStrategy;","56","import jenkins.security.NotReallyRoleSensitiveCallable;","63","import org.jvnet.hudson.test.MockAuthorizationStrategy;","64","import org.jvnet.hudson.test.MockFolder;","437","","438","    @Issue(\"JENKINS-20509\")","439","    @Test public void checkJobName() throws Exception {","440","        j.createFreeStyleProject(\"topprj\");","441","        final MockFolder d1 = j.createFolder(\"d1\");","442","        d1.createProject(FreeStyleProject.class, \"subprj\");","443","        final MockFolder d2 = j.createFolder(\"d2\");","444","        j.jenkins.setSecurityRealm(j.createDummySecurityRealm());","445","        j.jenkins.setAuthorizationStrategy(new MockAuthorizationStrategy().","446","            grant(Jenkins.ADMINISTER).everywhere().to(\"admin\").","447","            grant(Jenkins.READ).everywhere().toEveryone().","448","            grant(Job.READ).everywhere().toEveryone().","449","            grant(Item.CREATE).onFolders(d1).to(\"dev\")); \/\/ not on root or d2","450","        ACL.impersonate(Jenkins.ANONYMOUS, new NotReallyRoleSensitiveCallable<Void,Exception>() {","451","            @Override","452","            public Void call() throws Exception {","453","                try {","454","                    assertCheckJobName(j.jenkins, \"whatever\", FormValidation.Kind.OK);","455","                    fail(\"should not have been allowed\");","456","                } catch (AccessDeniedException2 x) {","457","                    \/\/ OK","458","                }","459","                return null;","460","            }","461","        });","462","        ACL.impersonate(User.get(\"dev\").impersonate(), new NotReallyRoleSensitiveCallable<Void,Exception>() {","463","            @Override","464","            public Void call() throws Exception {","465","                try {","466","                    assertCheckJobName(j.jenkins, \"whatever\", FormValidation.Kind.OK);","467","                    fail(\"should not have been allowed\");","468","                } catch (AccessDeniedException2 x) {","469","                    \/\/ OK","470","                }","471","                try {","472","                    assertCheckJobName(d2, \"whatever\", FormValidation.Kind.OK);","473","                    fail(\"should not have been allowed\");","474","                } catch (AccessDeniedException2 x) {","475","                    \/\/ OK","476","                }","477","                assertCheckJobName(d1, \"whatever\", FormValidation.Kind.OK);","478","                return null;","479","            }","480","        });","481","        ACL.impersonate(User.get(\"admin\").impersonate(), new NotReallyRoleSensitiveCallable<Void,Exception>() {","482","            @Override","483","            public Void call() throws Exception {","484","                assertCheckJobName(j.jenkins, \"whatever\", FormValidation.Kind.OK);","485","                assertCheckJobName(d1, \"whatever\", FormValidation.Kind.OK);","486","                assertCheckJobName(d2, \"whatever\", FormValidation.Kind.OK);","487","                assertCheckJobName(j.jenkins, \"d1\", FormValidation.Kind.ERROR);","488","                assertCheckJobName(j.jenkins, \"topprj\", FormValidation.Kind.ERROR);","489","                assertCheckJobName(d1, \"subprj\", FormValidation.Kind.ERROR);","490","                assertCheckJobName(j.jenkins, \"\", FormValidation.Kind.OK);","491","                assertCheckJobName(j.jenkins, \"foo\/bie\", FormValidation.Kind.ERROR);","492","                assertCheckJobName(d2, \"New\", FormValidation.Kind.OK);","493","                j.jenkins.setProjectNamingStrategy(new ProjectNamingStrategy.PatternProjectNamingStrategy(\"[a-z]+\", \"\", true));","494","                assertCheckJobName(d2, \"New\", FormValidation.Kind.ERROR);","495","                assertCheckJobName(d2, \"new\", FormValidation.Kind.OK);","496","                return null;","497","            }","498","        });","499","        JenkinsRule.WebClient wc = j.createWebClient().login(\"admin\");","500","        assertEquals(\"original ${rootURL}\/checkJobName still supported\", \"<div\/>\", wc.goTo(\"checkJobName?value=stuff\").getWebResponse().getContentAsString());","501","        assertEquals(\"but now possible on a view in a folder\", \"<div\/>\", wc.goTo(\"job\/d1\/view\/All\/checkJobName?value=stuff\").getWebResponse().getContentAsString());","502","    }","503","","504","    private void assertCheckJobName(ViewGroup context, String name, FormValidation.Kind expected) {","505","        assertEquals(expected, context.getPrimaryView().doCheckJobName(name).kind);","506","    }","507",""],"delete":[]}]}},"6ed7c7f1d00caa21bfd8e43d34140bf66b579f5f":{"changes":{"core\/src\/main\/resources\/hudson\/slaves\/JNLPLauncher\/config.jelly":"MODIFY","core\/src\/main\/java\/hudson\/slaves\/JNLPLauncher.java":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/slaves\/JNLPLauncher\/config.jelly":[{"add":["26","  <!-- This property is included only if used directly. Causes JENKINS-45895 in the case of includes otherwise -->","27","  <j:if test=\"${descriptor.workDirSupported}\"> ","28","    <f:property title=\"${%Enable work directory}\" field=\"workDirSettings\" \/>","29","  <\/j:if>"],"delete":["26","  <f:property title=\"${%Enable work directory}\" field=\"workDirSettings\" \/>"]}],"core\/src\/main\/java\/hudson\/slaves\/JNLPLauncher.java":[{"add":["165","        ","166","        \/**","167","         * Checks if Work Dir settings should be displayed.","168","         * ","169","         * This flag is checked in {@code config.jelly} before displaying the ","170","         * {@link JNLPLauncher#workDirSettings} property.","171","         * By default the configuration is displayed only for {@link JNLPLauncher},","172","         * but the implementation can be overridden.","173","         * @return {@code true} if work directories are supported by the launcher type.","174","         * @since TODO","175","         *\/","176","        public boolean isWorkDirSupported() {","177","            \/\/ This property is included only for JNLPLauncher by default. ","178","            \/\/ Causes JENKINS-45895 in the case of includes otherwise","179","            return DescriptorImpl.class.equals(getClass());","180","        }"],"delete":[]}]}},"a4ba526dc9693b5b10c11d9a27eca63ba37e7b7b":{"changes":{"core\/src\/main\/java\/hudson\/model\/AbstractItem.java":"MODIFY","changelog.html":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/AbstractItem.java":[{"add":["541","            Jenkins.getInstance().rebuildDependencyGraph();"],"delete":[]}],"changelog.html":[{"add":["69","  <li class=bug>","70","    Dependency wasn't recalculated with CLI \"update-job\" command.","71","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-11636\">issue 11636<\/a>)"],"delete":[]}]}},"33b796d0b9f5ecb1ee4f9ee7f4b2a22c38c558d4":{"changes":{"core\/src\/main\/resources\/hudson\/model\/UpdateCenter\/index_fr.properties":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/model\/UpdateCenter\/index_fr.properties":[{"add":["24","Restart\\ When\\ No\\ Jobs\\ Are\\ Running=Red\\u00E9marrer quand aucun job n''est en cours"],"delete":["24","Restart\\ When\\ No\\ Jobs\\ Are\\ Running=Red\\u00E9marrer quand aucun job n''''est en cours"]}]}},"20d44c5aa750f6fece96f83f0f7ed519e9df2e54":{"changes":{"core\/src\/main\/resources\/lib\/hudson\/executors.jelly":"MODIFY"},"diff":{"core\/src\/main\/resources\/lib\/hudson\/executors.jelly":[{"add":["131","          <j:if test=\"${(computersSize gt 1 and !cDisplayExecutors.isEmpty()) or (c.node == app and c.offline)}\">"],"delete":["131","          <j:if test=\"${computersSize gt 1 and !cDisplayExecutors.isEmpty()}\">"]}]}},"92a3e42068c5c54c2861d73d3c2e5fe0c5b64f39":{"changes":{"core\/src\/main\/java\/hudson\/lifecycle\/WindowsInstallerLink.java":"MODIFY","core\/src\/main\/java\/jenkins\/model\/Jenkins.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/lifecycle\/WindowsInstallerLink.java":[{"add":["232","                    Jenkins.getInstance().cleanUp();"],"delete":[]}],"core\/src\/main\/java\/jenkins\/model\/Jenkins.java":[{"add":["947","                \/\/ TODO cleanUp?","4265","        cleanUp();"],"delete":[]}]}},"3a57b104c9358bfc8f818dab525785ae72eb9e64":{"changes":{"core\/src\/main\/java\/hudson\/model\/WorkspaceCleanupThread.java":"MODIFY","changelog.html":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/WorkspaceCleanupThread.java":[{"add":["94","    private boolean shouldBeDeleted(String workspaceDirectoryName, FilePath dir, Node n) throws IOException, InterruptedException {","97","        TopLevelItem item = Jenkins.getInstance().getItem(workspaceDirectoryName);","109","        \/\/ Could mean that directory doesn't belong to a job. But can also mean that it's a custom workspace belonging to a job.","110","        \/\/ So better leave it alone - will still be deleted after 30 days - until we have a proper check for custom workspaces.","111","        \/\/ TODO: implement proper check for custom workspaces.","112","        \/\/ TODO: If we do the above, could also be good to add checkbox that lets users configure a workspace to never be auto-cleaned.","117","        if (item instanceof AbstractProject<?,?>) {","118","            AbstractProject<?,?> p = (AbstractProject<?,?>) item;","180","    public static final boolean disabled = Boolean.getBoolean(WorkspaceCleanupThread.class.getName()+\".disabled\");"],"delete":["94","    private boolean shouldBeDeleted(String jobName, FilePath dir, Node n) throws IOException, InterruptedException {","97","        TopLevelItem item = Jenkins.getInstance().getItem(jobName);","109","        \/\/ Assuming build name == workspace name breaks custom workspaces. Just skip out if the 30-day window doesn't catch it yet.","110","        \/\/ TODO: Add a check that covers custom workspaces, if possible.","111","        \/\/ TODO: If and when we do the above, also add checkbox that lets users configure a workspace to never be auto-cleaned.","116","        if (item instanceof AbstractProject) {","117","            AbstractProject p = (AbstractProject) item;","179","    public static boolean disabled = Boolean.getBoolean(WorkspaceCleanupThread.class.getName()+\".disabled\");"]}],"changelog.html":[{"add":["86","  <li class=bug>","87","    Workspace-cleanup thread shouldn't delete custom workspace directories","88","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-8880\">issue 8880<\/a>)"],"delete":[]}]}},"e0017ae1de222a69b093011f5b30b48cde1dc7e6":{"changes":{"core\/src\/main\/java\/hudson\/model\/AllView.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/AllView.java":[{"add":["166","                                new Object[]{allView.owner.getUrl(), primaryView, DEFAULT_VIEW_NAME});"],"delete":["166","                                new Object[]{allView.owner.getUrl(), DEFAULT_VIEW_NAME});"]}]}},"8a4b77e4b90a2bd9cc66c54aa03c5a47c86f25e2":{"changes":{"core\/src\/test\/java\/hudson\/UtilTest.java":"MODIFY"},"diff":{"core\/src\/test\/java\/hudson\/UtilTest.java":[{"add":["53","","54","    \/**","55","     * Test that Strings that contain spaces are correctly URL encoded.","56","     *\/","57","    public void testEncodeSpaces() {","58","        final String urlWithSpaces = \"http:\/\/hudson\/job\/Hudson Job\";","59","        String encoded = Util.encode(urlWithSpaces);","60","        assertEquals(encoded, \"http:\/\/hudson\/job\/Hudson%20Job\");","61","    }"],"delete":[]}]}},"8b91feb7b485708bd31a8b86ce67cd68d769c023":{"changes":{"test\/src\/test\/java\/jenkins\/slaves\/OldRemotingAgentTest.java":"MODIFY","core\/src\/main\/java\/hudson\/console\/ConsoleNote.java":"MODIFY"},"diff":{"test\/src\/test\/java\/jenkins\/slaves\/OldRemotingAgentTest.java":[{"add":["26","import hudson.Launcher;","27","import hudson.MarkupText;","28","import hudson.console.ConsoleAnnotationDescriptor;","29","import hudson.console.ConsoleAnnotator;","30","import hudson.console.ConsoleNote;","31","import hudson.model.AbstractBuild;","32","import hudson.model.BuildListener;","34","import hudson.model.FreeStyleBuild;","38","import hudson.model.TaskListener;","46","import jenkins.security.MasterToSlaveCallable;","55","import org.jvnet.hudson.test.TestBuilder;","56","import org.jvnet.hudson.test.TestExtension;","60","import java.io.StringWriter;","107","    @Issue(\"JENKINS-55257\")","108","    @Test","109","    public void remoteConsoleNote() throws Exception {","110","        Slave agent = j.createOnlineSlave();","111","        FreeStyleProject project = j.createFreeStyleProject();","112","        project.setAssignedLabel(agent.getSelfLabel());","113","        project.getBuildersList().add(new TestBuilder() {","114","            @Override","115","            public boolean perform(AbstractBuild<?, ?> build, Launcher launcher, BuildListener listener) throws InterruptedException, IOException {","116","                build.getWorkspace().act(new RemoteConsoleNotePrinter(listener));","117","                return true;","118","            }","119","        });","120","        FreeStyleBuild b = j.buildAndAssertSuccess(project);","121","        StringWriter sw = new StringWriter();","122","        \/\/ The note will not actually work by default; we just want to ensure that the attempt is ignored without breaking the build.","123","        \/\/ But for purposes of testing, check that the note really made it into the log.","124","        boolean insecureOriginal = ConsoleNote.INSECURE;","125","        ConsoleNote.INSECURE = true;","126","        try {","127","            b.getLogText().writeHtmlTo(0, sw);","128","        } finally {","129","            ConsoleNote.INSECURE = insecureOriginal;","130","        }","131","        assertThat(sw.toString(), containsString(\"@@@ANNOTATED@@@\"));","132","    }","133","    private static final class RemoteConsoleNotePrinter extends MasterToSlaveCallable<Void, IOException> {","134","        private final TaskListener listener;","135","        RemoteConsoleNotePrinter(TaskListener listener) {","136","            this.listener = listener;","137","        }","138","        @Override","139","        public Void call() throws IOException {","140","            listener.annotate(new RemoteConsoleNote());","141","            listener.getLogger().println();","142","            return null;","143","        }","144","    }","145","    public static final class RemoteConsoleNote extends ConsoleNote<Object> {","146","        @Override","147","        public ConsoleAnnotator<Object> annotate(Object context, MarkupText text, int charPos) {","148","            text.addMarkup(charPos, \"@@@ANNOTATED@@@\");","149","            return null;","150","        }","151","","152","        @TestExtension(\"remoteConsoleNote\")","153","        public static final class DescriptorImpl extends ConsoleAnnotationDescriptor {}","154","    }","155",""],"delete":[]}],"core\/src\/main\/java\/hudson\/console\/ConsoleNote.java":[{"add":["58","import org.kohsuke.accmod.Restricted;","59","import org.kohsuke.accmod.restrictions.NoExternalUse;","135","    @Restricted(NoExternalUse.class)","136","    public static \/* nonfinal for tests & script console *\/ boolean INSECURE = SystemProperties.getBoolean(ConsoleNote.class.getName() + \".INSECURE\");"],"delete":["133","    static \/* nonfinal for tests & script console *\/ boolean INSECURE = SystemProperties.getBoolean(ConsoleNote.class.getName() + \".INSECURE\");"]}]}},"853da6b65b53623db22cdd268aa2f8bb91613587":{"changes":{"core\/src\/main\/resources\/hudson\/tasks\/Fingerprinter\/config.jelly":"MODIFY","core\/src\/main\/java\/hudson\/tasks\/Fingerprinter.java":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/tasks\/Fingerprinter\/config.jelly":[{"add":["3","Copyright (c) 2004-2010, Sun Microsystems, Inc., Kohsuke Kawaguchi","23","<?jelly escape-by-default='true'?>","27","    <f:textbox name=\"targets\" value=\"${instance.targets}\"","31","    <f:checkbox name=\"recordBuildArtifacts\" checked=\"${instance.recordBuildArtifacts}\" \/>","34","  <!-- keepDependencies is actually a property of the Job, not Fingerprinter: -->"],"delete":["3","Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi","23","","27","    <f:textbox name=\"fingerprint_targets\" value=\"${instance.targets}\"","31","    <f:checkbox name=\"fingerprint_artifacts\" checked=\"${instance.recordBuildArtifacts}\" \/>"]}],"core\/src\/main\/java\/hudson\/tasks\/Fingerprinter.java":[{"add":["3"," * Copyright (c) 2004-2010, Sun Microsystems, Inc., Kohsuke Kawaguchi","47","import org.kohsuke.stapler.DataBoundConstructor;","82","    @DataBoundConstructor","223","            return req.bindJSON(Fingerprinter.class, formData);"],"delete":["3"," * Copyright (c) 2004-2009, Sun Microsystems, Inc., Kohsuke Kawaguchi","221","            return new Fingerprinter(","222","                req.getParameter(\"fingerprint_targets\").trim(),","223","                req.getParameter(\"fingerprint_artifacts\")!=null);"]}]}},"c5ee60142b676e432b0771e9f409f30d869969c3":{"changes":{"core\/src\/main\/java\/hudson\/scm\/SCMS.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/scm\/SCMS.java":[{"add":["29","        String scm = req.getParameter(\"scm\");","30","        if(scm==null)   return null;","31","","32","        int scmidx = Integer.parseInt(scm);"],"delete":["29","        int scmidx = Integer.parseInt(req.getParameter(\"scm\"));"]}]}},"82b6e8e02b7e1d535bd3704255363fe7d0d1e6da":{"changes":{"changelog.html":"MODIFY"},"diff":{"changelog.html":[{"add":["59","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-20143\">issue 20143<\/a>)"],"delete":["59","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-20123\">issue 20123<\/a>)"]}]}},"6ceccc0cc4ff20915f395accf9775c27975c5c3d":{"changes":{"core\/src\/main\/java\/hudson\/cli\/handlers\/JobOptionHandler.java":"ADD","core\/src\/main\/java\/hudson\/cli\/BuildCommand.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/cli\/handlers\/JobOptionHandler.java":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/cli\/BuildCommand.java":[{"add":["30","import hudson.model.CauseAction;","31","import hudson.model.Job;","32","import hudson.model.Run;","39","import hudson.model.Queue;","47","","61","import jenkins.model.ParameterizedJobMixIn;","62","import jenkins.triggers.SCMTriggerItem;","77","    public Job<?,?> job;","147","            SCMTriggerItem item = SCMTriggerItem.SCMTriggerItems.asSCMTriggerItem(job);","148","            if (item == null)","149","                throw new AbortException(job.getFullDisplayName()+\" has no SCM trigger, but checkSCM was specified\");","150","            if (!item.poll(new StreamTaskListener(stdout, getClientCharset())).hasChanges())","156","            if (job instanceof AbstractProject<?, ?> && ((AbstractProject<?, ?>)job).isDisabled()) {","164","        Queue.Item item = ParameterizedJobMixIn.scheduleBuild2(job, 0, new CauseAction(new CLICause(Jenkins.getAuthentication().getName())), a);","165","        QueueTaskFuture<? extends Run<?,?>> f = item != null ? (QueueTaskFuture)item.getFuture() : null;","171","            Run<?,?> b = f.waitForStart();    \/\/ wait for the start"],"delete":["70","    public AbstractProject<?,?> job;","140","            if (job.poll(new StreamTaskListener(stdout, getClientCharset())).change == Change.NONE) {","142","            }","147","            if (job.isDisabled()) {","155","        QueueTaskFuture<? extends AbstractBuild> f = job.scheduleBuild2(0, new CLICause(Jenkins.getAuthentication().getName()), a);","161","            AbstractBuild b = f.waitForStart();    \/\/ wait for the start"]}]}},"1a9f3c677859fff0539d5b9e39efae2759d6ff90":{"changes":{"maven-plugin\/src\/main\/java\/hudson\/maven\/MavenModuleSetBuild.java":"MODIFY"},"diff":{"maven-plugin\/src\/main\/java\/hudson\/maven\/MavenModuleSetBuild.java":[{"add":["1010","        private final String moduleRootPath;","1011","        ","1047","            ","1048","            this.moduleRootPath = ","1049","                project.getScm().getModuleRoot( project.getLastBuild().getWorkspace(), project.getLastBuild() ).getRemote();            ","1050","            ","1052","","1206","            String relPath = PathTool.getRelativeFilePath( this.moduleRootPath, mp.getBasedir().getPath() );","1207","                \/\/PathTool.getRelativeFilePath( this.workspaceProper, mp.getBasedir().getPath() );"],"delete":["1199","            String relPath = PathTool.getRelativeFilePath( this.workspaceProper, mp.getBasedir().getPath() );"]}]}},"c63e1f7084abc5c1e440d7a1785f2a2d5a035b78":{"changes":{"core\/src\/main\/resources\/lib\/hudson\/projectView.jelly":"MODIFY"},"diff":{"core\/src\/main\/resources\/lib\/hudson\/projectView.jelly":[{"add":["82","          <j:set var=\"relativeLinkToJob\" value=\"${h.getRelativeLinkTo(job)}\"\/>","83","          <t:projectViewRow jobBaseUrl=\"${relativeLinkToJob.substring(0, relativeLinkToJob.length() - job.shortUrl.length())}\"\/>"],"delete":["81","","83","          <t:projectViewRow jobBaseUrl=\"${h.getRelativeLinkTo(job).substring(0, h.getRelativeLinkTo(job).length() - job.shortUrl.length())}\"\/>"]}]}},"4d8bfb55388c459943fa3c56c417e03b11571819":{"changes":{"core\/src\/main\/java\/hudson\/tasks\/junit\/TestResult.java":"MODIFY","test\/src\/test\/java\/hudson\/tasks\/junit\/TestResultPublishingTest.java":"MODIFY","changelog.html":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/tasks\/junit\/TestResult.java":[{"add":[],"delete":["290","                throw new IOException2(\"Failed to read \"+reportFile,e);"]}],"test\/src\/test\/java\/hudson\/tasks\/junit\/TestResultPublishingTest.java":[{"add":["29","import hudson.Launcher;","30","import hudson.model.AbstractBuild;","31","import hudson.model.BuildListener;","35","import hudson.model.Result;","38","import hudson.tasks.Builder;","282","    @Bug(19186)","283","    public void testBrokenResultFile() throws Exception {","284","        FreeStyleProject p = createFreeStyleProject();","285","        p.getBuildersList().add(new TestBuilder());","286","        p.getPublishersList().add(new JUnitResultArchiver(\"TEST-foo.xml\", false, null));","287","        assertBuildStatus(Result.UNSTABLE, p.scheduleBuild2(0).get());","288","    }","289","    private static final class TestBuilder extends Builder {","290","        @Override public boolean perform(AbstractBuild<?,?> build, Launcher launcher, BuildListener listener) throws InterruptedException, IOException {","291","            build.getWorkspace().child(\"TEST-foo.xml\").write(\"<bogus>\", null);","292","            return true;","293","        }","294","    }"],"delete":["277",""]}],"changelog.html":[{"add":["57","  <li class=bug>","58","    A malformed JUnit result file should mark that test suite as a failure, but not interrupt archiving of other tests.","59","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-19186\">issue 19186<\/a>)"],"delete":["57","  <li class=>"]}]}},"d8076e9654a4be6cd0792ea954363b209c44313b":{"changes":{"core\/src\/main\/java\/hudson\/model\/Run.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/Run.java":[{"add":["2393","                + entry.getParent().getFullName()+':'+entry.getId();"],"delete":["2393","                + entry.getParent().getName()+':'+entry.getId();"]}]}},"e2e3ac2e0524dee9eb506d8ce4fd9a914be64e65":{"changes":{"core\/src\/main\/java\/hudson\/scm\/SubversionSCM.java":"MODIFY","test\/src\/test\/java\/hudson\/scm\/SubversionSCMTest.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/scm\/SubversionSCM.java":[{"add":["283","\t\t if (excludedRegions != null) {","287","\t\t\t for (String excludedRegion : excludedRegions) {","473","    \/**","903","            try {","904","                final SVNURL decodedURL = SVNURL.parseURIDecoded(url);","905","                SvnInfo remoteInfo = new SvnInfo(parseSvnInfo(decodedURL,authProvider));","906","                listener.getLogger().println(Messages.SubversionSCM_pollChanges_remoteRevisionAt(url,remoteInfo.revision));","907","                if(remoteInfo.revision > localInfo.getValue()) {","908","                    boolean changesFound = true;","909","                    Pattern[] excludedPatterns = getExcludedRegionsPatterns();","910","                    if (excludedPatterns != null) {","927","                    }","929","                    if (changesFound) {","930","                        listener.getLogger().println(Messages.SubversionSCM_pollChanges_changedFrom(localInfo.getValue()));","931","                        return true;","932","                    }","933","                }","934","            } catch (SVNException e) {","935","                e.printStackTrace(listener.error(\"Failed to check repository revision for \"+ url));","936","            }","942","    private final class SVNLogHandler implements ISVNLogEntryHandler {","991","    }","1574","        \/**","1583","\t                    String[] regions = v.split(\"[\\\\r\\\\n]+\");"],"delete":["283","\t\t if (excludedRegions != null)","284","\t\t {","288","\t\t\t for (String excludedRegion : excludedRegions)","289","\t\t\t {","475","\t\/**","867","","906","\t        boolean changesFound = false;","907","\t\t\t  try {","908","\t\t\t\t  final SVNURL decodedURL = SVNURL.parseURIDecoded(url);","909","\t\t\t\t  SvnInfo remoteInfo = new SvnInfo(parseSvnInfo(decodedURL,authProvider));","910","\t\t\t\t\tlistener.getLogger().println(Messages.SubversionSCM_pollChanges_remoteRevisionAt(url,remoteInfo.revision));","911","\t\t\t\t\tif(remoteInfo.revision > localInfo.getValue()) {","912","\t\t\t\t\t\tPattern[] excludedPatterns = getExcludedRegionsPatterns();","913","\t\t\t\t\t\tif (excludedPatterns == null) {","914","\t\t\t\t\t\t\tchangesFound = true; \/\/ change found","915","\t\t\t\t\t\t} else {","916","\t\t\t\t\t\t\ttry {","933","\t\t\t\t\t\t\t} catch (SVNException e) {","934","\t\t\t\t\t\t\t\te.printStackTrace(listener.error(\"Failed to check repository revision for \"+ url));","935","\t\t\t\t\t\t\t\tchangesFound = false;","936","\t\t\t\t\t\t\t}","937","\t\t\t\t\t  }","939","\t\t\t\t\t  if (changesFound) {","940","\t\t\t\t\t\t  listener.getLogger().println(Messages.SubversionSCM_pollChanges_changedFrom(localInfo.getValue()));","941","\t\t\t\t\t  }","942","\t\t\t\t\t}","943","\t\t\t  } catch (SVNException e) {","944","\t\t\t\t\te.printStackTrace(listener.error(\"Failed to check repository revision for \"+ url));","945","\t\t\t\t\tchangesFound = false;","946","\t\t\t  }","947","","948","\t        return changesFound;","954","\t private final class SVNLogHandler implements ISVNLogEntryHandler {","1003","\t }","1586","\t     \/**","1595","\t                    String[] regions = v.split(\"\\\\r\\\\n\");"]}],"test\/src\/test\/java\/hudson\/scm\/SubversionSCMTest.java":[{"add":["33","import java.io.FileWriter;","34","import java.util.Map;","55","        FreeStyleBuild b = p.scheduleBuild2(0, new Cause.UserCause()).get();","112","        FreeStyleBuild b = p.scheduleBuild2(0, new Cause.UserCause()).get();","127","        FreeStyleBuild b = p.scheduleBuild2(0, new Cause.UserCause()).get();","145","        FreeStyleBuild b = p.scheduleBuild2(0, new Cause.UserCause()).get();","150","        b = p.scheduleBuild2(0, new Cause.UserCause()).get();","165","        p.scheduleBuild2(0, new Cause.UserCause()).get();","177","        p.scheduleBuild2(0, new Cause.UserCause()).get();","201","    \/**","202","     * Test that multiple repository URLs are all polled.","203","     *\/","204","    @Bug(3168)","205","    public void testPollMultipleRepositories() throws Exception {","206","        \/\/ fetch the current workspaces","207","        FreeStyleProject p = createFreeStyleProject();","208","        String svnBase = \"file:\/\/\" + new CopyExisting(getClass().getResource(\"\/svn-repo.zip\")).allocate().toURI().toURL().getPath();","209","        p.setScm(new SubversionSCM(","210","            new String[] { svnBase + \"trunk\/a\", svnBase + \"branches\" },","211","            new String[] { null, null }, true, null, null));","212","        AbstractBuild build = p.scheduleBuild2(0, new Cause.UserCause()).get();","213","","214","        \/\/ as a baseline, this shouldn't detect any change","215","        TaskListener listener = createTaskListener();","216","        assertFalse(p.pollSCMChanges(listener));","217","","218","        \/\/ Force older \"current revision\" for each repository, make sure both are detected","219","        Map<String,Long> revInfo = SubversionSCM.parseRevisionFile(build);","220","        for (String outOfDateItem : new String[] { \"branches\", \"trunk\/a\" }) {","221","            FileWriter out = new FileWriter(SubversionSCM.getRevisionFile(build));","222","            for (Map.Entry<String,Long> entry : revInfo.entrySet()) {","223","                out.write(entry.getKey());","224","                out.write('\/');","225","                out.write(Long.toString(","226","                    entry.getValue().longValue() - (entry.getKey().endsWith(outOfDateItem) ? 1 : 0)));","227","                out.write('\\n');","228","            }","229","            out.close();","230","","231","            \/\/ now the polling should indicate that we need a new build","232","            assertTrue(\"change was not detected!\", p.pollSCMChanges(listener));","233","        }","234","    }"],"delete":["53","        FreeStyleBuild b = p.scheduleBuild2(0).get();","110","        FreeStyleBuild b = p.scheduleBuild2(0).get();","125","        FreeStyleBuild b = p.scheduleBuild2(0).get();","143","        FreeStyleBuild b = p.scheduleBuild2(0).get();","148","        b = p.scheduleBuild2(0).get();","163","        p.scheduleBuild2(0).get();","175","        p.scheduleBuild2(0).get();"]}]}},"683f1fcb8f369ace4913b1332ce8cd224e51cc33":{"changes":{"core\/src\/test\/java\/hudson\/util\/XStream2Test.java":"MODIFY","core\/src\/main\/java\/hudson\/util\/XStream2.java":"MODIFY"},"diff":{"core\/src\/test\/java\/hudson\/util\/XStream2Test.java":[{"add":["166","","167","    \/\/ @Bug(8006) -- Previously a null entry in an array caused NPE","168","    public void testEmptyStack() {","169","        assertEquals(\"<object-array><null\/><null\/><\/object-array>\",","170","                     Run.XSTREAM.toXML(new Object[2]).replaceAll(\"[ \\n\\r\\t]+\", \"\"));","171","    }"],"delete":[]}],"core\/src\/main\/java\/hudson\/util\/XStream2.java":[{"add":["115","                if (type != null && ImmutableMap.class.isAssignableFrom(type))"],"delete":["115","                if (ImmutableMap.class.isAssignableFrom(type))"]}]}},"85365c6f399cd3dcdc9a0c10fb6737e4d9a3e5ca":{"changes":{"core\/src\/main\/java\/hudson\/tasks\/BuildTrigger.java":"MODIFY","core\/src\/main\/resources\/hudson\/tasks\/Messages.properties":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/tasks\/BuildTrigger.java":[{"add":["370","            if (project == null) return FormValidation.ok(Messages.BuildTrigger_ok_ancestor_is_null());"],"delete":["370","            if (project == null) return FormValidation.ok();"]}],"core\/src\/main\/resources\/hudson\/tasks\/Messages.properties":[{"add":["49","BuildTrigger.ok_ancestor_is_null=Ancestor\/Context Unknown: the project specified cannot be validated"],"delete":[]}]}},"013758b2f55822eccb953eddc6083e691db93e34":{"changes":{"core\/src\/main\/java\/hudson\/model\/Hudson.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/Computer.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/Executor.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/Hudson.java":[{"add":["3572","    \/**","3573","     * Enabled by default as of 1.337. Will keep it for a while just in case we have some serious problems.","3574","     *\/","3575","    public static boolean FLYWEIGHT_SUPPORT = !\"false\".equals(System.getProperty(Hudson.class.getName()+\".flyweightSupport\"));"],"delete":["3572","    public static boolean FLYWEIGHT_SUPPORT = Boolean.getBoolean(Hudson.class.getName()+\".flyweightSupport\");"]}],"core\/src\/main\/java\/hudson\/model\/Computer.java":[{"add":["565","            while(executors.size()<numExecutors) {","566","                Executor e = new Executor(this, executors.size());","567","                e.start();","568","                executors.add(e);","569","            }","786","        OneOffExecutor e = new OneOffExecutor(this, p);","787","        e.start();","788","        oneOffExecutors.add(e);"],"delete":["565","            while(executors.size()<numExecutors)","566","                executors.add(new Executor(this,executors.size()));","783","        oneOffExecutors.add(new OneOffExecutor(this, p));"]}],"core\/src\/main\/java\/hudson\/model\/Executor.java":[{"add":[],"delete":["76","        start();"]}]}},"404384eefe9e5abf65ae68b4b1bf0accf3dff8eb":{"changes":{"test\/src\/test\/resources\/hudson\/model\/ViewTest\/testAllViewCreatedIfNoPrimary.zip":"ADD","test\/src\/test\/resources\/hudson\/model\/ViewTest\/testAllViewNotCreatedIfPrimary.zip":"ADD","core\/src\/main\/java\/jenkins\/model\/Jenkins.java":"MODIFY","test\/src\/test\/java\/hudson\/model\/ViewTest.java":"MODIFY"},"diff":{"test\/src\/test\/resources\/hudson\/model\/ViewTest\/testAllViewCreatedIfNoPrimary.zip":[{"add":[],"delete":[]}],"test\/src\/test\/resources\/hudson\/model\/ViewTest\/testAllViewNotCreatedIfPrimary.zip":[{"add":[],"delete":[]}],"core\/src\/main\/java\/jenkins\/model\/Jenkins.java":[{"add":["2870","                if(views.size()==0 || primaryView==null) {"],"delete":["2870","                if(views.size()==0) {","2876","                if (primaryView==null) {","2877","                    primaryView = views.get(0).getViewName();","2878","                }"]}],"test\/src\/test\/java\/hudson\/model\/ViewTest.java":[{"add":["66","import org.jvnet.hudson.test.recipes.LocalData;","508","    ","509","    ","510","    @Test","511","    @Issue(\"JENKINS-36908\")","512","    @LocalData","513","    public void testAllViewCreatedIfNoPrimary() throws Exception {","514","        assertNotNull(j.getInstance().getView(\"All\"));","515","    }","516","    ","517","    @Test","518","    @Issue(\"JENKINS-36908\")","519","    @LocalData","520","    public void testAllViewNotCreatedIfPrimary() throws Exception {","521","        assertNull(j.getInstance().getView(\"All\"));","522","    }"],"delete":[]}]}},"89e25fce5e5d8dbe65600ccff13950a1ad232d23":{"changes":{"core\/src\/main\/java\/hudson\/tasks\/LogRotator.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/Run.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/tasks\/LogRotator.java":[{"add":["4"," * Copyright (c) 2019 Intel Corporation","26","import static java.util.logging.Level.FINE;","27","import static java.util.logging.Level.FINER;","28","","29","import java.io.IOException;","30","import java.util.Arrays;","31","import java.util.Calendar;","32","import java.util.Collection;","33","import java.util.Collections;","34","import java.util.GregorianCalendar;","35","import java.util.List;","36","import java.util.logging.Logger;","37","","38","import org.jenkinsci.Symbol;","39","import org.kohsuke.stapler.DataBoundConstructor;","40","","41","import com.google.common.base.Joiner;","42","import com.google.common.collect.HashMultimap;","44","","61","    ","62","    public class CollatedLogRotatorException extends IOException {","63","        private static final long serialVersionUID = 5944233808072651101L;","64","        ","65","        public final Collection<Exception> collated;","66","        ","67","        public CollatedLogRotatorException(String msg, Exception... collated) {","68","            super(msg);","69","            if (collated == null || collated.length == 0) {","70","                this.collated = Collections.emptyList();","71","            } else {","72","                this.collated = Arrays.asList(collated);","73","            }","74","        }","76","        public CollatedLogRotatorException(String msg, Collection<Exception> values) {","77","            super(msg);","78","            this.collated = (values != null) ? values : Collections.emptyList();","79","        }","80","    }","81","    ","129","","137","    ","140","        \/\/Exceptions thrown by the deletion submethods are collated and reported","141","        HashMultimap<Run<?,?>, Exception> exceptionMap = HashMultimap.create();","142","        ","161","                try { r.delete(); }","162","                catch (IOException ex) { exceptionMap.put(r, ex); }","176","                    try { r.delete(); }","177","                    catch (IOException ex) { exceptionMap.put(r, ex); }","190","                try { r.deleteArtifacts(); }","191","                catch (IOException ex) { exceptionMap.put(r, ex); }","205","                    try { r.deleteArtifacts(); }","206","                    catch (IOException ex) { exceptionMap.put(r, ex); }","211","        ","212","        if (!exceptionMap.isEmpty()) {","213","            \/\/Collate all encountered exceptions into a single exception and throw that","214","            String msg = String.format(","215","                    \"Failed to rotate logs for [%s]\",","216","                    Joiner.on(\", \").join(exceptionMap.keySet())","217","            );","218","            LOGGER.severe(msg);","219","            throw new CollatedLogRotatorException(msg, exceptionMap.values());","220","        }"],"delete":["31","import org.jenkinsci.Symbol;","32","import org.kohsuke.stapler.DataBoundConstructor;","33","","34","import java.io.IOException;","35","import java.util.Calendar;","36","import java.util.Collection;","37","import java.util.GregorianCalendar;","38","import java.util.List;","39","import java.util.logging.Logger;","40","","41","import static java.util.logging.Level.*;","101","    ","109","","130","                r.delete();","144","                    r.delete();","157","                r.deleteArtifacts();","171","                    r.deleteArtifacts();"]}],"core\/src\/main\/java\/hudson\/model\/Run.java":[{"add":["7"," * Copyright (c) 2019 Intel Corporation","76","import java.lang.UnsupportedOperationException;","77","import java.lang.SecurityException;","80","import java.nio.file.StandardCopyOption;","1571","            \/\/No root directory found to delete. Somebody seems to have nuked","1572","            \/\/it externally. Logging a warning before dropping the build","1573","            LOGGER.warning(String.format(","1574","                    \"%s: %s looks to have already been deleted, assuming build dir was already cleaned up\",","1575","                    this, rootDir","1576","            ));","1577","            \/\/Still firing the delete listeners; just no need to clean up rootDir","1578","            RunListener.fireDeleted(this);","1579","            synchronized (this) { \/\/ avoid holding a lock while calling plugin impls of onDeleted","1580","                removeRunFromParent();","1581","            }","1582","            return;","1585","        \/\/The root dir exists and is a directory that needs to be purged","1587","        ","1592","        synchronized (this) { \/\/ avoid holding a lock while calling plugin impls of onDeleted","1593","            File tmp = new File(rootDir.getParentFile(),'.'+rootDir.getName());","1594","            ","1595","            if (tmp.exists()) {","1596","                Util.deleteRecursive(tmp);","1597","            }","1598","            try {","1599","                Files.move(","1600","                        Util.fileToPath(rootDir),","1601","                        Util.fileToPath(tmp),","1602","                        StandardCopyOption.ATOMIC_MOVE","1603","                );","1604","            } catch (UnsupportedOperationException | SecurityException ex) {","1605","                throw new IOException(rootDir + \" is in use\");","1606","            }","1607","            ","1609","            \/\/ some user reported that they see some left-over .xyz files in the workspace,","1610","            \/\/ so just to make sure we've really deleted it, schedule the deletion on VM exit, too.","1611","            if (tmp.exists()) {","1612","                tmp.deleteOnExit();","1613","            }","1614","            LOGGER.log(FINE, \"{0}: {1} successfully deleted\", new Object[] {this, rootDir});","1615","            removeRunFromParent();"],"delete":["6"," *","1568","            throw new IOException(this + \": \" + rootDir + \" looks to have already been deleted; siblings: \" + Arrays.toString(project.getBuildDir().list()));","1572","","1576","","1577","        synchronized (this) { \/\/ avoid holding a lock while calling plugin impls of onDeleted","1578","        File tmp = new File(rootDir.getParentFile(),'.'+rootDir.getName());","1580","        if (tmp.exists()) {","1582","        }","1583","        \/\/ TODO on Java 7 prefer: Files.move(rootDir.toPath(), tmp.toPath(), StandardCopyOption.ATOMIC_MOVE)","1584","        boolean renamingSucceeded = rootDir.renameTo(tmp);","1585","        Util.deleteRecursive(tmp);","1586","        \/\/ some user reported that they see some left-over .xyz files in the workspace,","1587","        \/\/ so just to make sure we've really deleted it, schedule the deletion on VM exit, too.","1588","        if(tmp.exists())","1589","            tmp.deleteOnExit();","1590","","1591","        if(!renamingSucceeded)","1592","            throw new IOException(rootDir+\" is in use\");","1593","        LOGGER.log(FINE, \"{0}: {1} successfully deleted\", new Object[] {this, rootDir});","1594","","1595","        removeRunFromParent();"]}]}},"cd526e99e63ae362f2d1ce1a04c3c68a38032a5c":{"changes":{"core\/src\/main\/java\/hudson\/model\/WorkspaceCleanupThread.java":"MODIFY","test\/src\/test\/java\/hudson\/model\/WorkspaceCleanupThreadTest.java":"ADD","changelog.html":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/model\/WorkspaceCleanupThread.java":[{"add":["25","import hudson.Extension;","29","import java.util.ArrayList;","32","import java.util.logging.Level;","34","import javax.annotation.Nonnull;","35","import jenkins.model.Jenkins;","36","import jenkins.model.ModifiableTopLevelItemGroup;","49","    @Override public long getRecurrencePeriod() {","57","    @Override protected void execute(TaskListener listener) throws InterruptedException, IOException {","58","        if (disabled) {","59","            LOGGER.fine(\"Disabled. Skipping execution\");","60","            return;","62","        List<Node> nodes = new ArrayList<Node>();","63","        Jenkins j = Jenkins.getInstance();","64","        nodes.add(j);","65","        nodes.addAll(j.getNodes());","66","        for (TopLevelItem item : j.getAllItems(TopLevelItem.class)) {","67","            if (item instanceof ModifiableTopLevelItemGroup) { \/\/ no such thing as TopLevelItemGroup, and ItemGroup offers no access to its type parameter","68","                continue; \/\/ children will typically have their own workspaces as subdirectories; probably no real workspace of its own","69","            }","70","            listener.getLogger().println(\"Checking \" + item.getFullDisplayName());","71","            for (Node node : nodes) {","72","                FilePath ws = node.getWorkspaceFor(item);","73","                if (ws == null) {","74","                    continue; \/\/ offline, fine","75","                }","76","                boolean check;","77","                try {","78","                    check = shouldBeDeleted(item, ws, node);","79","                } catch (IOException x) {","80","                    x.printStackTrace(listener.error(\"Failed to check \" + node.getDisplayName()));","81","                    continue;","82","                } catch (InterruptedException x) {","83","                    x.printStackTrace(listener.error(\"Failed to check \" + node.getDisplayName()));","84","                    continue;","85","                }","86","                if (check) {","87","                    listener.getLogger().println(\"Deleting \" + ws + \" on \" + node.getDisplayName());","88","                    try {","89","                        ws.deleteRecursive();","90","                    } catch (IOException x) {","91","                        x.printStackTrace(listener.error(\"Failed to delete \" + ws + \" on \" + node.getDisplayName()));","92","                    } catch (InterruptedException x) {","93","                        x.printStackTrace(listener.error(\"Failed to delete \" + ws + \" on \" + node.getDisplayName()));","94","                    }","95","                }","100","    private boolean shouldBeDeleted(@Nonnull TopLevelItem item, FilePath dir, Node n) throws IOException, InterruptedException {","103","        \/\/ (Could even invert master loop so that one FileCallable takes care of all known items.)","104","        if(!dir.exists()) {","105","            LOGGER.log(Level.FINE, \"Directory {0} does not exist\", dir);","107","        }","112","            LOGGER.log(Level.FINE, \"Directory {0} is only {1} old, so not deleting\", new Object[] {dir, Util.getTimeSpanString(now-dir.lastModified())});","116","        \/\/ TODO could also be good to add checkbox that lets users configure a workspace to never be auto-cleaned.","121","            LOGGER.log(Level.FINER, \"Directory {0} is last built on {1}\", new Object[] {dir, lb});","124","                LOGGER.log(Level.FINE, \"Directory {0} is the last workspace for {1}\", new Object[] {dir, p});","129","                LOGGER.log(Level.FINE, \"Directory deletion of {0} is vetoed by SCM\", dir);","134","        LOGGER.log(Level.FINER, \"Going to delete directory {0}\", dir);"],"delete":["27","import hudson.Extension;","28","import jenkins.model.Jenkins;","29","","30","import java.io.File;","31","import java.io.FileFilter;","33","import java.io.Serializable;","49","    public long getRecurrencePeriod() {","57","    \/\/ so that this can be easily accessed from sub-routine.","58","    private TaskListener listener;","59","","60","    protected void execute(TaskListener listener) throws InterruptedException, IOException {","61","        try {","62","            if(disabled) {","63","                LOGGER.fine(\"Disabled. Skipping execution\");","64","                return;","65","            }","66","            ","67","            this.listener = listener;","68","","69","            Jenkins h = Jenkins.getInstance();","70","            for (Node n : h.getNodes())","71","                if (n instanceof Slave) process((Slave)n);","72","","73","            process(h);","74","        } finally {","75","            this.listener = null;","77","    }","78","","79","    private void process(Jenkins h) throws IOException, InterruptedException {","80","        File jobs = new File(h.getRootDir(), \"jobs\");","81","        File[] dirs = jobs.listFiles(DIR_FILTER);","82","        if(dirs==null)      return;","83","        for (File dir : dirs) {","84","            FilePath ws = new FilePath(new File(dir, \"workspace\"));","85","            if(shouldBeDeleted(dir.getName(),ws,h)) {","86","                delete(ws);","91","    private boolean shouldBeDeleted(String workspaceDirectoryName, FilePath dir, Node n) throws IOException, InterruptedException {","94","        TopLevelItem item = Jenkins.getInstance().getItem(workspaceDirectoryName);","95","","96","        if(!dir.exists())","102","            LOGGER.fine(\"Directory \"+dir+\" is only \"+ Util.getTimeSpanString(now-dir.lastModified())+\" old, so not deleting\");","106","        \/\/ Could mean that directory doesn't belong to a job. But can also mean that it's a custom workspace belonging to a job.","107","        \/\/ So better leave it alone - will still be deleted after 30 days - until we have a proper check for custom workspaces.","108","        \/\/ TODO: implement proper check for custom workspaces.","109","        \/\/ TODO: If we do the above, could also be good to add checkbox that lets users configure a workspace to never be auto-cleaned.","110","        if(item==null) {","111","            return false;","112","        }","117","            LOGGER.finer(\"Directory \"+dir+\" is last built on \"+lb);","120","                LOGGER.fine(\"Directory \"+dir+\" is the last workspace for \"+p);","125","                LOGGER.fine(\"Directory deletion of \"+dir+\" is vetoed by SCM\");","130","        LOGGER.finer(\"Going to delete directory \"+dir);","134","    private void process(Slave s) throws InterruptedException {","135","        listener.getLogger().println(\"Scanning \"+s.getNodeName());","136","","137","        try {","138","            FilePath path = s.getWorkspaceRoot();","139","            if(path==null)  return;","140","","141","            List<FilePath> dirs = path.list(DIR_FILTER);","142","            if(dirs ==null) return;","143","            for (FilePath dir : dirs) {","144","                if(shouldBeDeleted(dir.getName(),dir,s))","145","                    delete(dir);","146","            }","147","        } catch (IOException e) {","148","            e.printStackTrace(listener.error(\"Failed on \"+s.getNodeName()));","149","        }","150","    }","151","","152","    private void delete(FilePath dir) throws InterruptedException {","153","        try {","154","            listener.getLogger().println(\"Deleting \"+dir);","155","            dir.deleteRecursive();","156","        } catch (IOException e) {","157","            e.printStackTrace(listener.error(\"Failed to delete \"+dir));","158","        }","159","    }","160","","161","","162","    private static class DirectoryFilter implements FileFilter, Serializable {","163","        public boolean accept(File f) {","164","            return f.isDirectory();","165","        }","166","        private static final long serialVersionUID = 1L;","167","    }","168","    private static final FileFilter DIR_FILTER = new DirectoryFilter();","169","","170","    private static final long DAY = 1000*60*60*24;","171",""]}],"test\/src\/test\/java\/hudson\/model\/WorkspaceCleanupThreadTest.java":[{"add":[],"delete":[]}],"changelog.html":[{"add":["70","    The workspace cleanup thread failed to handle the modern workspace location on master, and mishandled folders.","71","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-21023\">issue 21023<\/a>)","72","  <li class=bug>"],"delete":[]}]}},"cb3990a4d6094260bea4571e7079fd0e3949047f":{"changes":{"core\/src\/main\/java\/jenkins\/FilePathFilter.java":"MODIFY","core\/src\/main\/java\/hudson\/slaves\/ChannelPinger.java":"MODIFY","test\/src\/test\/java\/jenkins\/security\/Security218CliTest.java":"MODIFY","core\/src\/main\/java\/hudson\/slaves\/SlaveComputer.java":"MODIFY","core\/src\/main\/java\/hudson\/Launcher.java":"MODIFY","core\/src\/main\/java\/hudson\/model\/Computer.java":"MODIFY","test\/src\/test\/java\/hudson\/bugs\/JnlpAccessWithSecuredHudsonTest.java":"MODIFY","pom.xml":"MODIFY","core\/src\/main\/java\/jenkins\/slaves\/StandardOutputSwapper.java":"MODIFY"},"diff":{"core\/src\/main\/java\/jenkins\/FilePathFilter.java":[{"add":["104","     * or {@code null} if none is needed."],"delete":["104","     * or null if none is needed."]}],"core\/src\/main\/java\/hudson\/slaves\/ChannelPinger.java":[{"add":["135","            \/\/ No sense in setting up channel pinger if the channel is being closed","136","            setUpPingForChannel(getOpenChannelOrFail(), null, pingTimeoutSeconds, pingIntervalSeconds, false);"],"delete":["135","            setUpPingForChannel(Channel.current(), null, pingTimeoutSeconds, pingIntervalSeconds, false);"]}],"test\/src\/test\/java\/jenkins\/security\/Security218CliTest.java":[{"add":["241","                getChannelOrFail().call(new Callable<String, Exception>() {"],"delete":["241","                Channel.current().call(new Callable<String, Exception>() {"]}],"core\/src\/main\/java\/hudson\/slaves\/SlaveComputer.java":[{"add":["869","            Channel.currentOrFail().setProperty(\"slave\",Boolean.TRUE); \/\/ indicate that this side of the channel is the slave side."],"delete":["869","            Channel.current().setProperty(\"slave\",Boolean.TRUE); \/\/ indicate that this side of the channel is the slave side."]}],"core\/src\/main\/java\/hudson\/Launcher.java":[{"add":["1291","            final Channel channel = getOpenChannelOrFail();","1301","            return channel.export(RemoteProcess.class,new RemoteProcess() {","1307","                        Channel taskChannel = null;","1309","                            \/\/ Sync IO will fail automatically if the channel is being closed, no need to use getOpenChannelOrFail()","1310","                            taskChannel = Channel.currentOrFail();","1311","                            taskChannel.syncIO();","1314","                            LOGGER.log(Level.INFO, \"Failed to synchronize IO streams on the channel \" + taskChannel, t);"],"delete":["1300","            return Channel.current().export(RemoteProcess.class,new RemoteProcess() {","1307","                            Channel.current().syncIO();"]}],"core\/src\/main\/java\/hudson\/model\/Computer.java":[{"add":["1428","            final Channel ch = getChannelOrFail();","1430","            try (PrintWriter pw = new PrintWriter(sw)) {","1431","                ch.dumpExportTable(pw);","1432","            }"],"delete":["1429","            PrintWriter pw = new PrintWriter(sw);","1430","            Channel.current().dumpExportTable(pw);","1431","            pw.close();"]}],"test\/src\/test\/java\/hudson\/bugs\/JnlpAccessWithSecuredHudsonTest.java":[{"add":["156","            return getChannelOrFail().call(new ScriptLoader(path));"],"delete":["156","            return Channel.current().call(new ScriptLoader(path));"]}],"pom.xml":[{"add":["177","        <version>3.15<\/version>"],"delete":["177","        <version>3.14<\/version>"]}],"core\/src\/main\/java\/jenkins\/slaves\/StandardOutputSwapper.java":[{"add":["41","            Channel c = getOpenChannelOrFail();"],"delete":["41","","42","            Channel c = Channel.current();","43",""]}]}},"86fbe7cffbfdfc7837b9b0e27dc06dae2265562f":{"changes":{"\/dev\/null":"DELETE","core\/src\/main\/resources\/commons-logging.properties":"ADD"},"diff":{"\/dev\/null":[{"add":[],"delete":[]}],"core\/src\/main\/resources\/commons-logging.properties":[{"add":[],"delete":[]}]}},"983d0f6c56d7f0079f9471e7edebcae171d8aa51":{"changes":{"test\/src\/test\/java\/hudson\/bugs\/LoginRedirectTest.java":"ADD","core\/src\/main\/java\/hudson\/security\/HudsonAuthenticationEntryPoint.java":"MODIFY","war\/pom.xml":"MODIFY"},"diff":{"test\/src\/test\/java\/hudson\/bugs\/LoginRedirectTest.java":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/security\/HudsonAuthenticationEntryPoint.java":[{"add":["45","            String loginForm = req.getContextPath()+getLoginFormUrl();","47","            req.setAttribute(\"loginForm\", loginForm);"],"delete":["45","            String loginForm = getLoginFormUrl();","47","            req.setAttribute(\"loginForm\", req.getContextPath()+loginForm);"]}],"war\/pom.xml":[{"add":["92","          <contextPath>${contextPath}<\/contextPath>","252","    <contextPath>\/<\/contextPath><!-- context path during test -->"],"delete":["92","          <contextPath>\/<\/contextPath>"]}]}},"a3aa29b2614fd5c8ab65f40a29a6230894c673dd":{"changes":{"core\/src\/main\/java\/hudson\/cli\/BuildCommand.java":"MODIFY","test\/src\/test\/groovy\/hudson\/cli\/BuildCommandTest.groovy":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/cli\/BuildCommand.java":[{"add":["50","import java.io.FileNotFoundException;","85","    @Option(name=\"-r\", usage=\"Number of times to retry reading of the output log if it does not exists on first attempt. Defaults to 0. Use with -v.\")","86","    public String retryCntStr = \"0\";","87","","88","    \/\/ hold parsed retryCnt;","89","    private int retryCnt = 0;","90","","123","        retryCnt = Integer.parseInt(retryCntStr);","124","","139","                    \/\/ read output in a retry loop, by default try only once","140","                    \/\/ writeWholeLogTo may fail with FileNotFound","141","                    \/\/ exception on a slow\/busy machine, if it takes","142","                    \/\/ longish to create the log file","143","                    int retryInterval = 100;","144","                    for (int i=0;i<=retryCnt;) {","145","                        try {","146","                            b.writeWholeLogTo(stdout);","147","                            break;","148","                        }","149","                        catch (FileNotFoundException e) {","150","                            if ( i == retryCnt ) {","151","                                throw e;","152","                            }","153","                            i++;","154","                            Thread.sleep(retryInterval);","155","                        }","156","                    }"],"delete":["130","                    b.writeWholeLogTo(stdout);"]}],"test\/src\/test\/groovy\/hudson\/cli\/BuildCommandTest.groovy":[{"add":["86","    \/**","87","     * Tests synchronous execution with retried verbose output","88","     *\/","89","    void testSyncWOutputStreaming() {","90","        def p = createFreeStyleProject();","91","        p.buildersList.add(new Shell(\"sleep 3\"));","92","","93","        def cli =new CLI(getURL())","94","        try {","95","            cli.execute([\"build\",\"-s\",\"-v\",\"-r\",\"5\",p.name])","96","            assertFalse(p.getBuildByNumber(1).isBuilding())","97","        } finally {","98","            cli.close();","99","        }","100","    }","101",""],"delete":[]}]}},"80cf49068fe242c198ae2ba9ea3106e4bf3140fa":{"changes":{"test\/src\/main\/java\/org\/jvnet\/hudson\/test\/ChannelShutdownListener.java":"ADD","test\/src\/main\/java\/org\/jvnet\/hudson\/test\/HudsonTestCase.java":"MODIFY","test\/src\/main\/java\/org\/jvnet\/hudson\/test\/EndOfTestListener.java":"ADD","test\/src\/main\/java\/org\/jvnet\/hudson\/test\/JenkinsRule.java":"MODIFY"},"diff":{"test\/src\/main\/java\/org\/jvnet\/hudson\/test\/ChannelShutdownListener.java":[{"add":[],"delete":[]}],"test\/src\/main\/java\/org\/jvnet\/hudson\/test\/HudsonTestCase.java":[{"add":["383","            for (EndOfTestListener tl : jenkins.getExtensionList(EndOfTestListener.class))","384","                tl.onTearDown();","385",""],"delete":["59","import hudson.remoting.Channel;","60","import hudson.remoting.VirtualChannel;","79","import hudson.tasks.Mailer.DescriptorImpl;","179","import com.gargoylesoftware.htmlunit.WebResponse;","237","     * Remember channels that are created, to release them at the end.","238","     *\/","239","    private List<Channel> channels = new ArrayList<Channel>();","240","","241","    \/**","404","","405","            synchronized(channels) {","406","                for (Channel c : channels)","407","                    c.close();","408","                for (Channel c : channels)","409","                    c.join();","410","                channels.clear();","411","            }","412","","547","    @TestExtension","548","    public static class ComputerListenerImpl extends ComputerListener {","549","        @Override","550","        public void onOnline(Computer c, TaskListener listener) throws IOException, InterruptedException {","551","            VirtualChannel ch = c.getChannel();","552","            if (ch instanceof Channel)","553","            TestEnvironment.get().testCase.addChannel((Channel)ch);","554","        }","555","    }","556","","557","    private void addChannel(Channel ch) {","558","        synchronized (channels) {","559","            channels.add(ch);","560","        }","561","    }","562","    "]}],"test\/src\/main\/java\/org\/jvnet\/hudson\/test\/EndOfTestListener.java":[{"add":[],"delete":[]}],"test\/src\/main\/java\/org\/jvnet\/hudson\/test\/JenkinsRule.java":[{"add":["134","import org.jvnet.hudson.test.recipes.Recipe;","173","import java.net.HttpURLConnection;","386","    protected void after() throws Exception {","388","            for (EndOfTestListener tl : jenkins.getExtensionList(EndOfTestListener.class))","389","                tl.onTearDown();","390",""],"delete":["90","import hudson.remoting.Channel;","91","import hudson.remoting.VirtualChannel;","96","import hudson.security.SecurityRealm;","231","    private static JenkinsRule CURRENT = null;","232","","267","     * Remember channels that are created, to release them at the end.","268","     *\/","269","    private List<Channel> channels = new ArrayList<Channel>();","270","","271","    \/**","394","    protected void after() {","413","            for (Channel c : channels)","414","                try {","415","                    c.close();","416","                } catch (IOException e) {","417","                    \/\/ ignore","418","                }","419","            for (Channel c : channels)","420","                try {","421","                    c.join();","422","                } catch (InterruptedException e) {","423","                    \/\/ ignore","424","                }","425","            channels.clear();","426","","478","                CURRENT = JenkinsRule.this;","505","                    CURRENT = null;","617","    @TestExtension","618","    public static class ComputerListenerImpl extends ComputerListener {","619","        @Override","620","        public void onOnline(Computer c, TaskListener listener) throws IOException, InterruptedException {","621","            VirtualChannel ch = c.getChannel();","622","            if (ch instanceof Channel)","623","                CURRENT.channels.add((Channel)ch);","624","        }","625","    }","626",""]}]}},"b7dd22f3b3e55ea5b9c6b59d9d56350a2c91fa67":{"changes":{"core\/src\/main\/resources\/hudson\/slaves\/SlaveComputer\/slave-agent.jnlp.jelly":"MODIFY"},"diff":{"core\/src\/main\/resources\/hudson\/slaves\/SlaveComputer\/slave-agent.jnlp.jelly":[{"add":["72","        <j:if test=\"${rootURL!=app.rootUrlFromRequest}\">","73","          <!--","74","            rootURL is based on the URL in the system config, but there has been","75","            numerous reports about people moving Hudson to another place but","76","            forgetting to update it. To improve the user experience in this regard,","77","            let's also pass the URL that the browser sent us as well, so that the","78","            JNLP Main class can try both.","80","            Note that rootURL is still necessary in various situations, such","81","            as reverse HTTP proxy situation, which makes rootUrlFromRequest incorrect.","82","          -->","83","          <argument>-url<\/argument>","84","          <argument>${app.rootUrlFromRequest}<\/argument>","85","        <\/j:if>"],"delete":["72","        <!--","73","          rootURL is based on the URL in the system config, but there has been","74","          numerous reports about people moving Hudson to another place but","75","          forgetting to update it. To improve the user experience in this regard,","76","          let's also pass the URL that the browser sent us as well, so that the","77","          JNLP Main class can try both.","79","          Note that rootURL is still necessary in various situations, such","80","          as reverse HTTP proxy situation, which makes rootUrlFromRequest incorrect. ","81","        -->","82","        <argument>-url<\/argument>","83","        <argument>${app.rootUrlFromRequest}<\/argument>"]}]}},"24309c6cc22f7efa07c4befa24778f3939b115d7":{"changes":{"changelog.html":"MODIFY"},"diff":{"changelog.html":[{"add":["60","  <li class=bug>","61","    Environment variable not available for Maven build\/POM parsing.","62","    (<a href=\"http:\/\/issues.jenkins-ci.org\/browse\/JENKINS-8865\">issue 8865<\/a>)"],"delete":[]}]}},"7689840966b2d0cf169f1627ddc7bb3ca8d45332":{"changes":{"core\/src\/main\/java\/hudson\/security\/captcha\/CaptchaSupport.java":"ADD","core\/pom.xml":"MODIFY","core\/src\/main\/java\/hudson\/security\/captcha\/CaptchaSupportDescriptor.java":"ADD","core\/src\/main\/java\/hudson\/security\/HudsonPrivateSecurityRealm.java":"MODIFY","core\/src\/main\/java\/hudson\/Functions.java":"MODIFY","core\/src\/main\/resources\/hudson\/security\/HudsonPrivateSecurityRealm\/signup.jelly":"MODIFY","core\/src\/main\/resources\/hudson\/security\/HudsonPrivateSecurityRealm\/config.jelly":"MODIFY","changelog.html":"MODIFY","war\/src\/main\/webapp\/help\/security\/private-realm\/allow-signup.html":"MODIFY","core\/src\/main\/java\/hudson\/security\/SecurityRealm.java":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/security\/captcha\/CaptchaSupport.java":[{"add":[],"delete":[]}],"core\/pom.xml":[{"add":[],"delete":["705","    <dependency>","706","      <groupId>com.octo.captcha<\/groupId>","707","      <artifactId>jcaptcha-all<\/artifactId>","708","      <version>1.0-RC6<\/version>","709","      <exclusions>","710","        <exclusion>","711","          <groupId>hsqldb<\/groupId>","712","          <artifactId>hsqldb<\/artifactId>","713","        <\/exclusion>","714","        <exclusion>","715","          <groupId>hsqldb<\/groupId>","716","          <artifactId>hsqldb<\/artifactId>","717","        <\/exclusion>","718","        <exclusion>","719","          <groupId>net.sf.ehcache<\/groupId>","720","          <artifactId>ehcache<\/artifactId>","721","        <\/exclusion>","722","        <exclusion>","723","          <groupId>quartz<\/groupId>","724","          <artifactId>quartz<\/artifactId>","725","        <\/exclusion>","726","        <exclusion>","727","          <groupId>xerces<\/groupId>","728","          <artifactId>xercesImpl<\/artifactId>","729","        <\/exclusion>","730","        <exclusion>","731","          <groupId>xerces<\/groupId>","732","          <artifactId>xmlParserAPIs<\/artifactId>","733","        <\/exclusion>","734","        <exclusion>","735","          <groupId>org.springframework<\/groupId>","736","          <artifactId>spring<\/artifactId>","737","        <\/exclusion>","738","        <exclusion>","739","          <groupId>commons-dbcp<\/groupId>","740","          <artifactId>commons-dbcp<\/artifactId>","741","        <\/exclusion>","742","        <exclusion>","743","          <groupId>concurrent<\/groupId>","744","          <artifactId>concurrent<\/artifactId>","745","        <\/exclusion>","746","      <\/exclusions>","747","    <\/dependency>"]}],"core\/src\/main\/java\/hudson\/security\/captcha\/CaptchaSupportDescriptor.java":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/security\/HudsonPrivateSecurityRealm.java":[{"add":["37","import hudson.security.captcha.CaptchaSupport;","95","    \/**","96","     * If true, captcha will be enabled.","97","     *\/","98","    private final boolean enableCaptcha;","99","","100","    @Deprecated","102","        this(allowsSignup, false, (CaptchaSupport) null);","103","    }","104","","105","    @DataBoundConstructor","106","    public HudsonPrivateSecurityRealm(boolean allowsSignup, boolean enableCaptcha, CaptchaSupport captchaSupport) {","108","        this.enableCaptcha = enableCaptcha;","109","        setCaptchaSupport(captchaSupport);","127","     * Checks if captcha is disabled on signup.","128","     *","129","     * @return true if captcha is disabled on signup.","130","     *\/","131","    public boolean isEnableCaptcha() {","132","        return enableCaptcha;","133","    }","134","","135","    \/**","218","        User u = createAccount(req, rsp, enableCaptcha, formView);"],"delete":["94","    @DataBoundConstructor","196","        User u = createAccount(req, rsp, true, formView);"]}],"core\/src\/main\/java\/hudson\/Functions.java":[{"add":["36","import hudson.security.captcha.CaptchaSupport;","690","    public static List<Descriptor<CaptchaSupport>> getCaptchaSupportDescriptors() {","691","        return CaptchaSupport.all();","692","    }","693",""],"delete":[]}],"core\/src\/main\/resources\/hudson\/security\/HudsonPrivateSecurityRealm\/signup.jelly":[{"add":["29","  <local:_entryForm host=\"${app}\" title=\"${%Sign up}\" action=\"createAccount\" captcha=\"${it.isEnableCaptcha()}\" xmlns:local=\"\/hudson\/security\/HudsonPrivateSecurityRealm\" \/>","30","<\/j:jelly>"],"delete":["29","  <local:_entryForm host=\"${app}\" title=\"${%Sign up}\" action=\"createAccount\" captcha=\"${true}\" xmlns:local=\"\/hudson\/security\/HudsonPrivateSecurityRealm\" \/>","30","<\/j:jelly>"]}],"core\/src\/main\/resources\/hudson\/security\/HudsonPrivateSecurityRealm\/config.jelly":[{"add":["25","<j:jelly xmlns:j=\"jelly:core\" xmlns:st=\"jelly:stapler\" xmlns:d=\"jelly:define\" xmlns:l=\"\/lib\/layout\" xmlns:t=\"\/lib\/hudson\"","26","  xmlns:f=\"\/lib\/form\">","27","  <f:entry title=\"\" help=\"\/help\/security\/private-realm\/allow-signup.html\">","28","    <f:checkbox name=\"privateRealm.allowsSignup\" checked=\"${h.defaultToTrue(instance.allowsSignup())}\" title=\"${%Allow users to sign up}\" \/>","30","  <j:if test=\"${size(h.captchaSupportDescriptors) gt 0}\">","31","    <f:entry>","32","      <f:checkbox name=\"privateRealm.enableCaptcha\" checked=\"${h.defaultToTrue(instance.isEnableCaptcha())}\"","33","        title=\"${%Enable captcha on sing up}\" \/>","34","    <\/f:entry>","35","    <f:dropdownList name=\"privateRealm.captchaSupport\" title=\"${%Captcha Support}\">","36","      <!-- Loop through available Captcha Support Descriptors -->","37","      <j:forEach var=\"descriptor\" items=\"${h.captchaSupportDescriptors}\" varStatus=\"loop\">","38","        <f:dropdownListBlock title=\"${descriptor.displayName}\" value=\"${loop.index}\"","39","          selected=\"${descriptor==instance.captchaSupport.descriptor}\" staplerClass=\"${descriptor.clazz.name}\">","40","          <!-- Include config.jelly for this Captcha Support -->","41","          <st:include page=\"${descriptor.configPage}\" from=\"${descriptor}\" optional=\"true\" \/>","42","        <\/f:dropdownListBlock>","43","      <\/j:forEach>","44","    <\/f:dropdownList>","45","  <\/j:if>","46","<\/j:jelly>"],"delete":["25","<j:jelly xmlns:j=\"jelly:core\" xmlns:st=\"jelly:stapler\" xmlns:d=\"jelly:define\" xmlns:l=\"\/lib\/layout\" xmlns:t=\"\/lib\/hudson\" xmlns:f=\"\/lib\/form\">","26","\t<f:entry title=\"\" help=\"\/help\/security\/private-realm\/allow-signup.html\">","27","\t  <f:checkbox name=\"privateRealm.allowsSignup\" checked=\"${h.defaultToTrue(instance.allowsSignup())}\"","28","            title=\"${%Allow users to sign up}\"\/>","30","<\/j:jelly>"]}],"changelog.html":[{"add":["57","  <li class=rfe>","58","    Make captcha support optional; remove LGPL jcaptcha","59","    (<a href=\"http:\/\/issues.jenkins-ci.org\/browse\/JENKINS-9915\">issue 9915<\/a>)"],"delete":[]}],"war\/src\/main\/webapp\/help\/security\/private-realm\/allow-signup.html":[{"add":["6","  <p>","7","  By default, Jenkins does not use captcha verification if the user creates an account by themself.","8","  If you'd like to enable captcha verification, install a captcha support plugin, e.g. the Jenkins","9","  <a href=\"https:\/\/wiki.jenkins-ci.org\/display\/JENKINS\/JCaptcha+Plugin\">JCaptcha Plugin<\/a>.","10","<\/div>"],"delete":["4","","7","<\/div>"]}],"core\/src\/main\/java\/hudson\/security\/SecurityRealm.java":[{"add":["34","import hudson.security.captcha.CaptchaSupport;","63","import java.util.List;","128","     * Captcha Support to be used with this SecurityRealm for User Signup","129","     *\/","130","    private CaptchaSupport captchaSupport;","131","","132","    \/**","241","    public CaptchaSupport getCaptchaSupport() {","242","        return captchaSupport;","243","    }","244","","245","    public void setCaptchaSupport(CaptchaSupport captchaSupport) {","246","        this.captchaSupport = captchaSupport;","247","    }","248","","249","    public List<Descriptor<CaptchaSupport>> getCaptchaSupportDescriptors() {","250","        return CaptchaSupport.all();","251","    }","252","","345","        if (captchaSupport != null) {","346","            String id = req.getSession().getId();","347","            rsp.setContentType(\"image\/png\");","348","            rsp.addHeader(\"Cache-Control\", \"no-cache\");","349","            captchaSupport.generateImage(id, rsp.getOutputStream());","350","        }","357","        if (captchaSupport != null) {","359","            return captchaSupport.validateCaptcha(id, text);","361","","362","        \/\/ If no Captcha Support then bogus validation always returns true","363","        return true;"],"delete":["25","import com.octo.captcha.service.CaptchaServiceException;","26","import com.octo.captcha.service.image.DefaultManageableImageCaptchaService;","27","import com.octo.captcha.service.image.ImageCaptchaService;","59","import javax.imageio.ImageIO;","327","     * {@link DefaultManageableImageCaptchaService} holder to defer initialization.","328","     *\/","329","    public static final class CaptchaService {","330","        public static ImageCaptchaService INSTANCE = new DefaultManageableImageCaptchaService();","331","    }","332","","333","    \/**","337","        String id = req.getSession().getId();","338","        rsp.setContentType(\"image\/png\");","339","        rsp.addHeader(\"Cache-Control\",\"no-cache\");","340","        ImageIO.write( CaptchaService.INSTANCE.getImageChallengeForID(id), \"PNG\", rsp.getOutputStream() );","347","        try {","349","            Boolean b = CaptchaService.INSTANCE.validateResponseForID(id, text);","350","            return b!=null && b;","351","        } catch (CaptchaServiceException e) {","352","            LOGGER.log(Level.INFO, \"Captcha validation had a problem\",e);","353","            return false;"]}]}},"d9d4f08d2b9a4b00e31478b6e4991369da1dbfa9":{"changes":{"war\/src\/main\/webapp\/css\/style.css":"MODIFY"},"diff":{"war\/src\/main\/webapp\/css\/style.css":[{"add":["1127","  width: 70%;","1128","  padding: 2px 0;","1130",".build-row-cell .build-badge > span {","1131","  display: inline-block;","1132","  max-width: 256px;","1133","  padding: 0 1px;","1134","  overflow: hidden;","1136",".build-row-cell .build-badge > span + span {","1137","  margin: 0 0 0 2px !important;","1138","}","1139","@media (min-width: 1170px) {","1140","  .build-row-cell .build-badge > span {","1141","    max-width: 296px;","1142","  }","1143","}","1144",""],"delete":["1126","  padding: 2px;","1127","  width: 70%;","1130",".build-row-cell .build-badge span:after {","1131","    content: \" \";","1132","    font-size: 0%;"]}]}},"2dbd6eca7f8c19222a04f68b548d54a163883ba0":{"changes":{"test\/src\/test\/groovy\/hudson\/security\/TokenBasedRememberMeServices2Test.groovy":"ADD","core\/src\/main\/java\/hudson\/security\/TokenBasedRememberMeServices2.java":"MODIFY","changelog.html":"MODIFY"},"diff":{"test\/src\/test\/groovy\/hudson\/security\/TokenBasedRememberMeServices2Test.groovy":[{"add":[],"delete":[]}],"core\/src\/main\/java\/hudson\/security\/TokenBasedRememberMeServices2.java":[{"add":["30","import hudson.Functions;","103","    @Override","104","    public Authentication autoLogin(HttpServletRequest request, HttpServletResponse response) {","105","        try {","106","            return super.autoLogin(request, response);","107","        } catch (Exception e) {","108","            cancelCookie(request, response, \"Failed to handle remember-me cookie: \"+Functions.printThrowable(e));","109","            return null;","110","        }","111","    }","112",""],"delete":[]}],"changelog.html":[{"add":["66","    Jenkins should recover gracefully from a failure to process \"remember me\" cookie","67","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-11643\">issue 11643<\/a>)","68","  <li class=bug>"],"delete":[]}]}},"2757b471a0a7430dbc85db2ac042dc3f02a52f9c":{"changes":{"core\/src\/main\/resources\/lib\/layout\/html.jelly":"MODIFY","war\/src\/main\/js\/pluginSetupWizardGui.js":"MODIFY","core\/src\/main\/resources\/jenkins\/install\/pluginSetupWizard.properties":"MODIFY","war\/src\/main\/less\/pluginSetupWizard.less":"MODIFY","war\/src\/main\/js\/templates\/errorPanel.hbs":"MODIFY","core\/src\/main\/resources\/jenkins\/install\/SetupWizard\/authenticate-security-token.jelly":"MODIFY"},"diff":{"core\/src\/main\/resources\/lib\/layout\/html.jelly":[{"add":["157","    <j:invokeStatic var=\"j\" className=\"jenkins.model.Jenkins\" method=\"getInstance\" \/>","158","    <j:if test=\"${!j.installState.setupComplete}\">"],"delete":["157","  <j:invokeStatic var=\"j\" className=\"jenkins.model.Jenkins\" method=\"getActiveInstance\" \/>","158","    <j:set var=\"installState\" value=\"${j.installState.name()}\" \/>","159","    <j:if test=\"${installState == 'NEW' || installState == 'INITIAL_PLUGINS_INSTALLING'}\">"]}],"war\/src\/main\/js\/pluginSetupWizardGui.js":[{"add":["779","\t","780","\tvar startOver = function() {","781","\t\tjenkins.goTo('\/');","782","\t};","813","\t\t'.skip-plugin-installs': function() { installPlugins([]); },","814","\t\t'.start-over': startOver"],"delete":["809","\t\t'.skip-plugin-installs': function() { installPlugins([]); }"]}],"core\/src\/main\/resources\/jenkins\/install\/pluginSetupWizard.properties":[{"add":["51","installWizard_retry=Retry"],"delete":[]}],"war\/src\/main\/less\/pluginSetupWizard.less":[{"add":["80","        max-width: 100%;","81","        "],"delete":["80",""]}],"war\/src\/main\/js\/templates\/errorPanel.hbs":[{"add":["4","\t<div class=\"container error-container\" id=\"error-message\">","11","<div class=\"modal-footer\">","12","\t<button type=\"button\" class=\"btn btn-primary start-over\">","13","\t\t{{translations.installWizard_retry}}","14","\t<\/button>","15","<\/div>"],"delete":["4","\t<div class=\"container error-container\">"]}],"core\/src\/main\/resources\/jenkins\/install\/SetupWizard\/authenticate-security-token.jelly":[{"add":[],"delete":["31","                    <link rel=\"stylesheet\" href=\"${j.installWizardPath}.css\" type=\"text\/css\" \/>"]}]}},"f23b93a6d5e9e0435532bd06a1061d640fdbcdf0":{"changes":{"core\/src\/main\/java\/jenkins\/util\/io\/PathRemover.java":"MODIFY"},"diff":{"core\/src\/main\/java\/jenkins\/util\/io\/PathRemover.java":[{"add":["29","import java.nio.file.LinkOption;","32","import java.nio.file.attribute.DosFileAttributeView;","42","import javax.annotation.Nonnull;","43","","44","import org.kohsuke.accmod.Restricted;","45","import org.kohsuke.accmod.restrictions.NoExternalUse;","46","","47","import edu.umd.cs.findbugs.annotations.SuppressFBWarnings;","48","import hudson.Functions;","49","import hudson.Util;","50","","291","        } else {","292","          \/*","293","           * If on Windows a folder has a read only attribute set, the file.setWritable(true) doesn't work (JENKINS-57855)","294","           *\/","295","          DosFileAttributeView dos = Files.getFileAttributeView(path, DosFileAttributeView.class, LinkOption.NOFOLLOW_LINKS);","296","          if (dos != null) {","297","            dos.setReadOnly(false);","298","          }"],"delete":["26","import edu.umd.cs.findbugs.annotations.SuppressFBWarnings;","27","import hudson.Functions;","28","import hudson.Util;","29","import org.kohsuke.accmod.Restricted;","30","import org.kohsuke.accmod.restrictions.NoExternalUse;","31","","32","import javax.annotation.Nonnull;"]}]}},"b6ce03878ed7523878ceffdb69e699c19a941bfc":{"changes":{"core\/src\/main\/java\/hudson\/util\/ComboBoxModel.java":"MODIFY","changelog.html":"MODIFY"},"diff":{"core\/src\/main\/java\/hudson\/util\/ComboBoxModel.java":[{"add":[],"delete":["64","        w.print('(');","66","        w.print(')');"]}],"changelog.html":[{"add":["73","    <li class=bug>","74","    Fix combobox ui component","75","    (<a href=\"https:\/\/issues.jenkins-ci.org\/browse\/JENKINS-16069\">issue 16069<\/a>)"],"delete":[]}]}},"065d3c830361471651a6c59ff78a33f0f4aa0900":{"changes":{"core\/src\/main\/java\/jenkins\/model\/Jenkins.java":"MODIFY"},"diff":{"core\/src\/main\/java\/jenkins\/model\/Jenkins.java":[{"add":["2630","        ExtensionList<T> extensionList = extensionLists.get(extensionType);","2631","        return extensionList != null ? extensionList : extensionLists.computeIfAbsent(extensionType, key -> ExtensionList.create(this, key));"],"delete":["2630","        return extensionLists.computeIfAbsent(extensionType, key -> ExtensionList.create(this, key));"]}]}}}